$(window).resize(function(){"undefined"!==typeof wgcna&&("undefined"!==typeof wgcna.multiImage?wgcna.multiImage.draw():"undefined"!==typeof wgcna.singleImage&&wgcna.singleImage.draw())});function replaceDot(r){return r.replace(/\./g,"_")}function replaceUnderscore(r){return r.replace(/_/g,".")}function removeColon(r){return r.replace(/:/g,"")}
function WGCNABrowser(r,v,w,x,y,t){that={};that.singleID=r;that.region=v;that.dispType=x;that.viewType=y;that.geneList=w;that.moduleList=[];that.moduleGenes={};that.modules={};that.tissue=t;that.panel="";that.requests=0;that.skipGrey=1;that.chrLen=19;that.selSource="seq";"Mm"===organism?(that.panel="ILS/ISS",that.wDSID=1):"Rn"===organism&&("rn5"===genomeVer?(that.panel="BNLx/SHR",that.chrLen=20,that.wDSID=2):(that.panel="BNLx/SHR",that.chrLen=20,"seq"===that.selSource?"Whole Brain"===t?that.wDSID=
6:"Liver"===t&&(that.wDSID=7):"Whole Brain"===t?that.wDSID=3:"Heart"===t?that.wDSID=4:"Liver"===t&&(that.wDSID=5)));that.eQTLKey=function(a){return"Link_"+a.Snp};that.mirKey=function(a){return a.ID};that.modKey=function(a){return a.MODULE};that.removeInvalidIDChars=function(a){"undefined"!==typeof a&&(-1<a.indexOf("*")&&(a=a.replace(/\*/g,"star")),-1<a.indexOf(" ")&&(a=a.replace(/\s/g,"_")),-1<a.indexOf(".")&&(a=a.replace(/\./g,"_")));return a};that.setup=function(){that.requestModuleList();that.createImageControls();
that.createViewControls();that.createDataControls();$(".wgcnaControltooltip").tooltipster({position:"top-right",maxWidth:250,offsetX:5,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});ga&&ga("send","event","setupWGCNA","setupWGCNA")};that.requestModuleList=function(){that.moduleGenes={};that.moduleList=[];$.ajax({url:pathPrefix+"getWGCNAModules.jsp",type:"GET",async:!0,data:{source:that.selSource,modFileType:that.viewtype,id:that.singleID,organism:organism,panel:that.panel,tissue:that.tissue,
region:that.region,geneList:that.geneList,genomeVer:genomeVer},dataType:"json",beforeSend:function(){$("#waitCircos").show();console.log("request mod list:"+that.wDSID+":"+that.selSource)},success:function(a){$("#wgcnaGeneImage #message").hide();that.moduleList=[];if(0<a.length&&(1!==a.length||"grey"!==a[0].ModuleID)){for(var b=0;b<a.length;b++)"grey"!==a[b].ModuleID&&(that.moduleList.push(a[b].ModuleID),that.requests++,that.requestModule(a[b].ModuleID),"undefined"!==typeof a[b].GeneList&&(that.moduleGenes[a[b].ModuleID]=
a[b].GeneList));that.refreshRegion(1E3);setTimeout(function(){$("html, body").animate({scrollTop:$("#multiWGCNAScroll").offset().top},100)},1200)}else 0===a.length?that.displayMessage("There are no transcripts with Affymetrix Probesets that represent this gene."):1===a.length&&"grey"===a[0].ModuleID&&that.displayMessage("Only the Grey module contains transcripts for this gene.  The Grey module contains all transcripts that did not have a high enough correlation with any other transcripts to be included in another module.");
ga&&ga("send","event","requestModuleList","requestModuleList")},error:function(a,b,d){}})};that.displayMessage=function(a){$("#waitCircos").hide();$("#wgcnaGeneImage #message").html("<BR><BR><h2>"+a+"</h2><BR><BR>").show()};that.refreshRegion=function(a){setTimeout(function(){that.createMultiWGCNAImage();0<that.requests?that.refreshRegion(2E3):1!==a&&(that.refreshRegion(1),$("#waitCircos").hide())},a)};that.requestModule=function(a,b){$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+
that.wDSID+"/"+a+".json",type:"GET",async:!0,data:{},dataType:"json",success:function(d){setTimeout(function(){console.log(a);if(0<that.singleID.length)that.countGeneInstance(that.singleID,d);else{var c=that.moduleGenes[a].split(",");d.GroupedGenes=c.length;that.countGeneInstance(that.moduleGenes[a],d)}that.modules[a]=d;that.requests--;b&&b(a)},20);ga&&ga("send","event","requestModule",a)},error:function(a,c,b){that.requests--}})};that.scanFilter=function(a,b){var d=[];if(a)for(var c=0;c<a.length;c++)b(a[c])&&
d.append(a[c]);return d};that.countGeneInstance=function(a,b){var d=b.TCList,c=0;b.selectGeneTC={};for(var f=0;f<d.length;f++)-1<a.indexOf(d[f].Gene.ID)&&c++;b.GeneCount=c};that.createImageControls=function(){that.imageBar=d3.select("#imageControl").append("span").style("float","left");that.imageBar.append("span").attr("class","saveImage control").style("display","inline-block").attr("id","saveImage").style("cursor","pointer").append("img").attr("src",contextRoot+"web/images/icons/savePic_dark.png").attr("pointer-events",
"all").attr("cursor","pointer").on("click",function(){var a="";if(that.singleImage){"eqtl"===that.viewType&&"eqtl"===that.singleImage.type?a=$("div#circos").html():"gene"===that.viewType&&"gene"===that.singleImage.type?a=$("div#viewGene").html():"mir"===that.viewType&&"mir"===that.singleImage.type?a=$("div#viewGene").html():"go"===that.viewType&&"go"===that.singleImage.type&&(a=$("div#viewGene").html());var b=$(window).width();a=a.replace('width="100%"','width="'+b+'px"');$.ajax({url:pathPrefix+"saveBrowserImage.jsp",
type:"POST",contentType:"text/html",data:a+"\n",processData:!1,dataType:"json",success:function(a){var c=new Date;c=c.getMonth()+1+"_"+c.getDate()+"_"+c.getFullYear();var b="http://";"https:"===location.protocol&&(b="https://");var e=b+urlprefix+"/tmpData/download/"+a.imageFile;a="";that.selectedModule&&(a=new String(that.selectedModule.MOD_NAME));a=a+"_"+that.viewType;var g=a+"_"+c+".png",d=new XMLHttpRequest;d.open("GET",e);d.responseType="blob";d.send();d.onreadystatechange=function(){if(4!=d.readyState||
200!=d.status)return!1;var a=document.createElement("a");a.href=window.URL.createObjectURL(d.response);a.download=g;a.style.display="none";document.body.appendChild(a);try{a.click()}catch(l){$("#wgcnaMouseHelp").html("<span style='color:#FF0000;'>Your browser will not save the image directly. Image will open in a popup, in the new window right click to save image.</span>"),window.open(e)}return!0}},error:function(a,c,b){console.log(b)}});ga&&ga("send","event","saveWGCNAView","saveWGCNAView")}}).on("mouseover",
function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_white.png");$("#wgcnaMouseHelp").html("Click to download a PNG image of the current view.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_dark.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","reset control").style("display","inline-block").attr("id","wgcnaresetImage").style("cursor",
"pointer").append("img").attr("src",contextRoot+"web/images/icons/reset_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){that.singleImage&&("eqtl"===that.viewType?that.singleImage.panZoomCircos.reset():"undefined"!==typeof that.singleImage&&that.singleImage.panZoom.reset());ga&&ga("send","event","resetWGCNAView","resetWGCNAView")}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/reset_white.png");$("#wgcnaMouseHelp").html("Click to reset image zoom to initial region.")}).on("mouseout",
function(){d3.select(this).attr("src",contextRoot+"web/images/icons/reset_dark.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","zoomIn control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","wgcnazoomInImage").append("img").attr("src",contextRoot+"web/images/icons/magPlus_dark_32.png").attr("pointer-events","all").attr("cursor",
"pointer").style("position","relative").style("top","-5px").on("click",function(){"eqtl"===that.viewType&&that.singleImage?that.singleImage.panZoomCircos.zoomIn():void 0==that.singleImage&&that.multiImage?that.multiImage.zoomIn():"undefined"!==typeof that.singleImage&&that.singleImage&&that.singleImage.panZoom.zoomIn();ga&&ga("send","event","zoomInWGCNAView","zoomInWGCNAView")}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magPlus_light_32.png");$("#wgcnaMouseHelp").html("Click to zoom in.")}).on("mouseout",
function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magPlus_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","zoomOut control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","wgcnazoomOutImage").append("img").attr("src",contextRoot+"web/images/icons/magMinus_dark_32.png").attr("pointer-events","all").attr("cursor",
"pointer").style("position","relative").style("top","-5px").on("click",function(){"eqtl"===that.viewType&&that.singleImage?that.singleImage.panZoomCircos.zoomOut():void 0==that.singleImage&&that.multiImage?that.multiImage.zoomOut():that.singleImage&&"undefined"!==typeof that.singleImage&&"undefined"!==typeof that.singleImage.panZoom&&that.singleImage.panZoom.zoomOut();ga&&ga("send","event","zoomOutWGCNAView","zoomOutWGCNAView")}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magMinus_light_32.png");
$("#wgcnaMouseHelp").html("Click to zoom out.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/magMinus_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});that.imageBar.append("span").attr("class","back control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","backModule").append("img").attr("src",contextRoot+"web/images/icons/back_dark_32.png").attr("pointer-events",
"all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){that.multiImage.backModule()}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/back_light_32.png");$("#wgcnaMouseHelp").html("Click to move to the previous module.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/back_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
that.imageBar.append("span").attr("class","forward control").style("display","inline-block").style("cursor","pointer").style("position","relative").style("top","7px").attr("id","forwardModule").append("img").attr("src",contextRoot+"web/images/icons/forward_dark_32.png").attr("pointer-events","all").attr("cursor","pointer").style("position","relative").style("top","-5px").on("click",function(){that.multiImage.forwardModule()}).on("mouseover",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/forward_light_32.png");
$("#wgcnaMouseHelp").html("Click to move to the next module.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/forward_dark_32.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})};that.createViewControls=function(){that.viewBar=d3.select("#viewControl").append("div").attr("id","wgcnaViewControls").style("float","right").style("margin-left","10px").style("margin-right","5px").style("text-align","left");
that.viewBar.append("text").text("Views:");that.viewBar.append("span").attr("id","HelpWGCNAView").append("img").attr("src",contextRoot+"web/images/icons/help.png");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaGeneViewRB").attr("name","wgcnaViewRB").attr("value","gene").attr("checked","checked").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="gene";that.createSingleWGCNAImage();ga&&ga("send","event","WGCNA",
"moduleView")});that.viewBar.append("text").text("Module");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View transcripts within the selected module and their connectivity based on correlation of expression.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type",
"radio").attr("id","wgcnaEQTLViewRB").attr("name","wgcnaViewRB").attr("value","eqtl").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="eqtl";that.createSingleWGCNAImage();ga&&ga("send","event","WGCNA","eQTLView")});that.viewBar.append("text").text("Eigengene eQTL");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View Circos plot of the module Eigengene eQTLs.<BR><BR>Have a question about this view click the <img src="'+contextRoot+
'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaGOViewRB").attr("name","wgcnaViewRB").attr("value","go").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="go";that.createSingleWGCNAImage();ga&&ga("send","event","WGCNA","goView")});that.viewBar.append("text").text("Gene Ontology");
that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'TEMPORARILY DISABLED PLEASE CHECK BACK. View a summary of Gene Ontology terms assigned to transcripts in the selected module.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type",
"radio").attr("id","wgcnaMirViewRB").attr("name","wgcnaViewRB").attr("value","mir").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="mir";that.createSingleWGCNAImage();ga&&ga("send","event","WGCNA","mirView")});that.viewBar.append("text").text("miRNA Targets");that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View a summary of miRNAs that target genes in this module.<BR><BR>Have a question about this view click the <img src="'+
contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");that.viewBar.append("br");that.viewBar.append("input").attr("type","radio").attr("id","wgcnaMetaViewRB").attr("name","wgcnaViewRB").attr("value","meta").style("margin-left","7px").style("margin-right","3px").on("click",function(){that.viewType="meta";that.createSingleWGCNAImage();ga&&ga("send","event","WGCNA","metaView")});that.viewBar.append("text").text("Meta Module (nearest neighbors)");
that.viewBar.append("span").attr("class","wgcnaControltooltip").attr("title",'View most closely correlated modules and browse those modules.<BR><BR>Have a question about this view click the <img src="'+contextRoot+'web/images/icons/help.png"> above for a detailed description of each view.').style("margin-left","5px").append("img").attr("src","/web/images/icons/info.gif");$("#HelpWGCNAView").on("click",function(a){var b=$(this).attr("id");$("#"+b+"Content").dialog("option","position",{my:"right top",
at:"left bottom",of:$(this)});$("#"+b+"Content").dialog("open").css({"font-size":12});a.stopPropagation()})};that.createDataControls=function(){that.dataBar=d3.select("#dataControl").append("span").attr("id","wgcnaDataControls").style("margin-left","10px").style("margin-right","5px").append("table").append("tr");var a=that.dataBar.append("td");a.append("text").text("Data Source:");var b=a.append("select").attr("id","wgcnaSourceSelect").on("change",function(){$("#singleWGCNASVG").hide();d3.select("#multiWGCNASVG").remove();
$("#circosModule").hide();$("#wgcnaModuleTable").hide();$("#wgcnaMirTable").hide();$("#wgcnaMirGeneTable").hide();$("#wgcnaGoTable").hide();$("#wgcnaEqtlTable").hide();that.selSource=$("#wgcnaSourceSelect").val();that.tissue=$("#wgcnaTissueSelect").val();"array"===that.selSource?("Whole Brain"===that.tissue?that.wDSID=3:"Heart"===that.tissue?that.wDSID=4:"Liver"===that.tissue&&(that.wDSID=5),d3.select("#wgcnaTissueSelect").append("option").attr("value","Heart").text("Heart")):"seq"===that.selSource&&
("Whole Brain"===that.tissue?that.wDSID=6:"Liver"===that.tissue?that.wDSID=7:(that.wDSID=6,d3.select("#wgcnaTissueSelect").select('option[value="Brain"]').attr("selected","selected")),d3.select("#wgcnaTissueSelect").select('option[value="Heart"]').remove());that.requestModuleList()});that.sources=["array"];that.dispSources=["Arrays"];"Rn"===organism&&"rn6"===genomeVer&&(that.sources=["seq","array"],that.dispSources=["RNA-Seq","Arrays"]);for(var d=0;d<that.sources.length;d++)b.append("option").attr("value",
that.sources[d]).text(that.dispSources[d]);a.append("br");a.append("text").text("Tissue:");b=a.append("select").attr("id","wgcnaTissueSelect").on("change",function(){$("#singleWGCNASVG").hide();d3.select("#multiWGCNASVG").remove();$("#circosModule").hide();$("#wgcnaModuleTable").hide();$("#wgcnaMirTable").hide();$("#wgcnaMirGeneTable").hide();$("#wgcnaGoTable").hide();$("#wgcnaEqtlTable").hide();that.selSource=$("#wgcnaSourceSelect").val();that.tissue=$("#wgcnaTissueSelect").val();"array"===that.selSource?
"Whole Brain"===that.tissue?that.wDSID=3:"Heart"===that.tissue?that.wDSID=4:"Liver"===that.tissue&&(that.wDSID=5):"seq"===that.selSource&&("Whole Brain"===that.tissue?that.wDSID=6:"Liver"===that.tissue&&(that.wDSID=7));that.requestModuleList()});that.tissues=["Brain"];that.dispTissues=["Whole Brain"];"Rn"===organism&&"rn6"===genomeVer&&(that.source&&"arrays"===that.source?(that.tissues=["Whole Brain","Heart","Liver"],that.dispTissues=["Whole Brain","Heart","Liver"]):(that.tissues=["Whole Brain","Liver"],
that.dispTissues=["Whole Brain","Liver"]));for(d=0;d<that.tissues.length;d++)b.append("option").attr("value",that.tissues[d]).text(that.dispTissues[d]);a=that.dataBar.append("td").append("div").attr("id","goCtls").attr("class","goCTL").style("display","none").style("margin-left","10px");a.append("text").text("GO Domain:");b=a.append("select").attr("id","goDomainSelect").on("change",function(){that.singleImage.goDomain=$("#goDomainSelect").val();that.singleImage.draw();ga&&ga("send","event","WGCNA_go",
"changeDomain")});b.append("option").attr("value","cc").text("Cellular Component");b.append("option").attr("value","bp").text("Biological Process");b.append("option").attr("selected","selected").attr("value","mf").text("Molecular Function");a.append("br");a.append("text").text("Number of Levels to Display:");a.append("input").attr("name","value").attr("id","goSpinner");$("#goSpinner").spinner({min:1,max:100,step:1,change:function(a,b){console.log("change");that.singleImage.displayDepth=b.value;that.singleImage.selectedNode!==
that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[2]?that.singleImage.redraw():that.singleImage.draw();ga&&ga("send","event","WGCNA_go","changeDepth")},spin:function(a,b){that.singleImage.displayDepth=b.value;that.singleImage.selectedNode!==that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[2]?
that.singleImage.redraw():that.singleImage.draw();ga&&ga("send","event","WGCNA_go","changeDepth")}}).val(3);a=that.dataBar.append("td").append("div").attr("id","mirCtls").attr("class","mirCTL").style("display","none").style("margin-left","10px");b=a.append("table").append("tr");a.append("text").style("font-weight","bold").text("Filter miRNAs:");a.append("br");a.append("input").attr("type","checkbox").style("margin-right","5px").attr("id","mirValidatedCBX").on("click",function(){$(this).is(":checked")?
that.singleImage.mirValid=1:that.singleImage.mirValid=0;that.singleImage.drawMiR();ga&&ga("send","event","WGCNA_mir","changeValidated")});a.append("text").text("only miRNAs with Validated Targets");a.append("br");a.append("text").style("margin-right","5px").text("# of targeted Genes: ");a.append("div").attr("id","minMirGeneSlider").style("display","inline-block").style("width","150px");a.append("span").attr("id","minMirGeneLabel").style("margin-left","5px").append("text").text("1");a.append("br");
a.append("text").style("margin-right","5px").text("miRNAs targeting gene: ");a.append("input").attr("type","text").attr("id","mirGeneFilterTxt").on("keyup",function(a){that.singleImage.mirTargetID=$(this).val().toLowerCase();that.singleImage.drawMiR();ga&&ga("send","event","WGCNA_mir","geneFilter")});a.append("br");a.append("text").style("margin-right","5px").text("miRNA(ID or Accession): ");a.append("input").attr("type","text").attr("id","mirIDFilterTxt").on("keyup",function(a){that.singleImage.mirID=
$(this).val().toLowerCase();that.singleImage.drawMiR();ga&&ga("send","event","WGCNA_mir","geneFilter")});a=that.dataBar.append("td").append("div").attr("id","mirCtls2").attr("class","mirCTL").style("display","none").style("margin-left","10px");a.append("text").style("font-weight","bold").text("Display Options:");a.append("br");a.append("input").attr("type","checkbox").attr("id","mirSortCBX").style("margin-right","5px").on("click",function(){$(this).prop("checked")?that.singleImage.sortMir=$("#mirSortSelect").val():
that.singleImage.sortMir=0;that.singleImage.drawMiR();ga&&ga("send","event","WGCNA_mir","mirSort")});a.append("text").text("Hovering over a node(miR or transcript):");a.append("br");a.append("input").attr("type","checkbox").attr("id","mirLinkCBX").attr("checked","checked").style("margin-left","12px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?that.singleImage.showMirLinks=1:that.singleImage.showMirLinks=0;ga&&ga("send","event","WGCNA_mir","showLinks")});a.append("text").text("Display links between miRNAs and targeted transcripts");
a.append("br");a.append("input").attr("type","checkbox").attr("id","mirgeneLinkCBX").style("margin-left","12px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?(that.singleImage.showLinks=0,$("div#mirLinkColorSelect").show()):(that.singleImage.showLinks=1,$("div#mirLinkColorSelect").hide());that.singleImage.setupLegend();ga&&ga("send","event","WGCNA_mir","linkColor")});a.append("text").text("Display links between correlated transcripts");b=a.append("div").attr("id","mirLinkColorSelect").style("display",
"none");b.append("text").style("margin-left","24px").text("Correlation Link Color Options:");a=b.append("select").attr("id","mirlinkColor").on("change",function(){that.singleImage.updateColor("mirlinkColor");that.singleImage.setupLegend();ga&&ga("send","event","WGCNA_mir","linkColor")});a.append("option").attr("selected","selected").attr("value","Green_Red").text("Green(+) / Red(-)");a.append("option").attr("value","Blue_Yellow").text("Blue(+) / Yellow(-)");a.append("option").attr("value","Red_Green").text("Red(+) / Green(-)");
b.append("br");b.append("input").attr("type","checkbox").style("margin-left","24px").style("margin-right","3px").on("click",function(){$(this).prop("checked")?that.singleImage.showAllFromTarget=1:that.singleImage.showAllFromTarget=0;ga&&ga("send","event","WGCNA_mir","linkColor")});b.append("text").text("Display all cor. transcript links from targeted transcripts.");$("#minMirGeneSlider").slider({min:1,max:100,step:1,value:1,slide:function(a,b){that.singleImage.mirGeneCutoff=b.value;$("span#minMirGeneLabel").html(b.value);
that.singleImage.drawMiR();ga&&ga("send","event","WGCNA_mir","minMir")}});a=that.dataBar.append("td").append("div").attr("id","linkCtls").attr("class","linkCTL").style("display","none").style("margin-left","10px");a.append("text").text("Link Correlation Values");a.append("span").style("cursor","pointer").on("click",function(){$("#linkSliderMin").slider("value",.75);that.singleImage.CorCutoff_min=.75;$("span#minLabel").html(.75);$("#linkSliderMax").slider("value",1);that.singleImage.CorCutoff_max=
1;$("span#maxLabel").html(1);that.singleImage.draw();ga&&ga("send","event","WGCNA_mir","resetCorrelation")}).append("img").attr("src",contextRoot+"/web/images/icons/reset_16.png");d=a.append("table");b=d.append("tr");b.append("td").append("text").text("Min:");b.append("td").append("div").attr("id","linkSliderMin").style("width","100px");b.append("td").append("span").attr("id","minLabel").style("margin-left","5px").append("text").text("0.75");b=d.append("tr");b.append("td").append("text").text("Max:");
b.append("td").append("div").attr("id","linkSliderMax").style("width","100px");b.append("td").append("span").attr("id","maxLabel").style("margin-left","5px").append("text").text("1");a.append("input").attr("type","checkbox").attr("id","hideLinkExceptNode").on("click",function(){that.singleImage.showLinks=!$(this).is(":checked");that.singleImage.draw();that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,
minZoom:.1,maxZoom:4,fit:!0,center:!0})});a.append("text").text("Hide Links Except Selected Node");b=that.dataBar.append("td").append("div").attr("id","linkCtl2").attr("class","linkCTL").style("display","none").style("margin-left","10px");b.append("text").text("Correlation Link Color Options:");b.append("br");b=b.append("select").attr("id","linkColor").on("change",function(){that.singleImage.draw();that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,
dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})});b.append("option").attr("selected","selected").attr("value","Green_Red").text("Green(+) / Red(-)");b.append("option").attr("value","Blue_Yellow").text("Blue(+) / Yellow(-)");b.append("option").attr("value","Red_Green").text("Red(+) / Green(-)");$("#linkSliderMin").slider({min:.05,max:.95,step:.05,value:.75,slide:function(a,b){that.singleImage.CorCutoff_min=b.value;$("span#minLabel").html(b.value);that.singleImage.draw()}});
$("#linkSliderMax").slider({min:.1,max:1,step:.05,value:1,slide:function(a,b){that.singleImage.CorCutoff_max=b.value;$("span#maxLabel").html(b.value);that.singleImage.draw()}});a=that.dataBar.append("td").append("div").attr("class","eqtlCtls").attr("id","eqtlCtl").style("display","none").style("margin-left","10px");a.append("text").text("Select Chromosomes");a.append("br");b=a.append("select").attr("id","eqtlChr").attr("multiple","multiple").attr("size","4").style("width","100px");for(d=1;d<=that.chrLen;d++)b.append("option").attr("selected",
"selected").attr("value",organism.toLowerCase()+d).text("chr"+d);b.append("option").attr("selected","selected").attr("value",organism.toLowerCase()+"X").text("chrX");a=that.dataBar.append("td").append("div").attr("class","eqtlCtls").attr("id","eqtlCtl2").style("display","none").style("margin-left","10px");a.append("text").text("P-value cutoff:");b=a.append("select").attr("id","eqtlPval");b.append("option").attr("value","1").text("0.1");b.append("option").attr("selected","selected").attr("value","2").text("0.01");
b.append("option").attr("value","3").text("0.001");b.append("option").attr("value","4").text("0.0001");b.append("option").attr("value","5").text("0.00001");a.append("br");a.append("br");a.append("br");a.append("br");a.append("input").attr("type","button").attr("value","Apply Selections").on("click",function(){for(var a=$("#eqtlPval").val(),b=$("#eqtlChr").val(),e="",g=0;g<b.length;g++)e=e+b[g]+";";$.ajax({url:pathPrefix+"runCircosModule.jsp",type:"GET",async:!0,data:{cutoffValue:a,organism:organism,
module:that.selectedModule.MOD_NAME,modColor:that.selectedModule.ModRGB,chrList:e,genomeVer:genomeVer,tissue:that.tissue},dataType:"json",beforeSend:function(){$("#waitCircos").show()},success:function(a){$("#waitCircos").hide();that.singleImage.update(a.URL)},error:function(a,c,b){}})})};that.positionTTLeft=function(a){a+=20;a>$(window).width()/2&&(a-=250);return a+"px"};that.positionTTTop=function(a){a+="px";d3.event.clientY>.6*window.innerHeight&&(a=d3.event.pageY-2.2*$(".testToolTip").height()+
"px");return a};that.createMultiWGCNAImage=function(){that.multiImage=that.multiWGCNAImageGeneView(that.modules);that.multiImage.draw();that.img=that.multiImage};that.multiWGCNAImage=function(){var a={maxWidth:200};a.totalWidth=$(window).width();a.modPerLine=Math.floor($(window).width()/a.maxWidth);a.calcWidth=Math.floor($(window).width()/a.modPerLine);a.data=[];if(0===d3.select("#multiWGCNASVG").size()){var b=d3.select("#wgcnaGeneImage").append("div").attr("id","multiWGCNAScroll").style("overflow",
"auto").style("max-height","430px");a.svg=b.append("svg").attr("id","multiWGCNASVG").attr("height","430px").attr("width","100%");b=a.svg.append("linearGradient").attr("id","lgrad").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");b.append("stop").attr("offset","0%").attr("style","stop-color:rgb(153,218,255);stop-opacity:1");b.append("stop").attr("offset","100%").attr("style","stop-color:rgb(0,128,128);stop-opacity:1");b=a.svg.append("linearGradient").attr("id","selectGrad").attr("x1",
"11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");b.append("stop").attr("offset","0%").attr("style","stop-color:rgb(0,163,55);stop-opacity:1");b.append("stop").attr("offset","100%").attr("style","stop-color:rgb(0,75,20);stop-opacity:1")}else a.svg=d3.select("#multiWGCNASVG");a.modKey=function(a){return a.MOD_NAME};a.calcX=function(b,c){return c%a.modPerLine*a.calcWidth};a.calcY=function(b,c){return Math.floor(c/a.modPerLine)*a.maxWidth};a.sizing=function(b){b=a.size(b.TCList.length);b>a.maxWidth/
2&&(b=a.maxWidth/2);return b};a.zoomIn=function(){a.maxWidth<$(window).width()/2&&(a.maxWidth*=2,a.draw())};a.zoomOut=function(){var b=a.maxWidth;a.maxWidth=Math.floor(a.maxWidth/2);25>a.maxWidth?a.maxWidth=b:a.draw()};a.sortTCLenDesc=function(a,c){return c.TCList.length<a.TCList.length?-1:c.TCList.length>a.TCList.length?1:0};a.sortGeneInstanceDesc=function(b,c){return c.GeneCount<b.GeneCount?-1:c.GeneCount>b.GeneCount?1:a.sortTCLenDesc(b,c)};a.draw=function(){};a.redraw=function(){};return a};that.multiWGCNAImageGeneView=
function(){var a=that.multiWGCNAImage();a.createToolTip=function(a){var b="Module Name: "+a.MOD_NAME+"<BR>Transcript Size: "+a.TCList.length;"undefined"!==typeof a.GroupedGenes?(b=b+"<BR>Genes in Region/List: "+a.GroupedGenes,b=b+"<BR>Transcripts in Region/List: "+a.GeneCount):b=b+"<BR>Selected Gene Transcripts in Module: "+a.GeneCount;return b};a.draw=function(){"undefined"!==typeof that.selectedModule&&(a.maxWidth=85);a.svg.selectAll(".modules").remove();a.svg.selectAll(".moduleGradient").remove();
a.totalWidth=$(window).width();a.modPerLine=Math.floor($(window).width()/a.maxWidth);a.calcWidth=Math.floor($(window).width()/a.modPerLine);var b=[];a.dataList={};for(var d=0,c=0;c<that.moduleList.length;c++)if(("grey"!==that.moduleList[c]||"grey"===that.moduleList[c]&&0===that.skipGrey)&&"undefined"!==typeof that.modules[that.moduleList[c]]){b[d]=that.modules[that.moduleList[c]];var f=b[d].ModRGB.split(","),e="";for(e=0;e<f.length;e++)f[e]-=70,0>f[e]&&(f[e]=0);e=f[0]+","+f[1]+","+f[2];f=a.svg.append("linearGradient").attr("id",
"grad"+b[d].MOD_NAME).attr("class","moduleGradient").attr("x1","11%").attr("y1","0%").attr("x2","89%").attr("y2","100%");f.append("stop").attr("offset","0%").attr("style","stop-color:rgb("+b[d].ModRGB+");stop-opacity:1");f.append("stop").attr("offset","100%").attr("style","stop-color:rgb("+e+");stop-opacity:1");d++}d=a.maxWidth+15;b.length>a.modPerLine&&(c=Math.floor(b.length/a.modPerLine),0<b.length%a.modPerLine&&c++,d*=c);a.svg.attr("height",d+"px");b.sort(a.sortGeneInstanceDesc);a.data=b;for(c=
0;c<b.length;c++)a.dataList[b[c].MOD_NAME]=c;d=d3.min(b,function(a){return a.TCList.length});c=d3.max(b,function(a){return a.TCList.length});a.size=d3.scaleLinear().domain([d,c]).range([10,a.maxWidth/2]);b=a.svg.selectAll(".modules").data(b,a.modKey).attr("transform",function(c,b){return"translate("+a.calcX(c,b)+","+a.calcY(c,b)+")"});b.enter().append("g").attr("class","modules").attr("id",function(a){return a.MOD_NAME}).attr("transform",function(c,b){return"translate("+a.calcX(c,b)+","+a.calcY(c,
b)+")"}).merge(b).each(function(c){var b=d3.select("g#"+c.MOD_NAME);b.append("circle").attr("cx",a.calcWidth/2).attr("cy",a.maxWidth/2).attr("r",a.sizing).attr("stroke",function(a){var c="#FFFFFF";"undefined"!==typeof that.selectedModule&&that.selectedModule===a&&(c="#000000");return c}).attr("stroke-width",function(a){var c="1px";"undefined"!==typeof that.selectedModule&&that.selectedModule===a&&(c="3px");return c}).attr("fill",function(a){var c="url(#grad"+a.MOD_NAME+")";"undefined"!==typeof that.selectedModule&&
that.selectedModule===a&&(c="url(#selectGrad)");return c}).on("click",function(){a.maxWidth=85;that.selectedModule=c;a.draw();d3.select("#multiWGCNAScroll").style("max-height","110px");a.svg.select("g#"+c.MOD_NAME).style("background","#CECECE");a.svg.select("g#"+c.MOD_NAME).select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");a.svg.select("g#"+c.MOD_NAME).select("text.txtLbl").style("font-weight","bold");that.selectedGene={};for(var b=0;b<c.TCList.length;b++)"undefined"===
typeof that.selectedGene[c.TCList[b].Gene.ID]&&(that.selectedGene[c.TCList[b].Gene.ID]={},that.selectedGene[c.TCList[b].Gene.ID].geneSymbol=c.TCList[b].Gene.geneSymbol,that.selectedGene[c.TCList[b].Gene.ID].tcList=[]),that.selectedGene[c.TCList[b].Gene.ID].tcList.push(c.TCList[b]);setTimeout(that.createSingleWGCNAImage,20)}).on("mouseover",function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this module and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",
1);tt.html(a.createToolTip(c)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)})}).on("mouseout",function(){var a=d3.select(this).data()[0];"undefined"!==typeof that.selectedModule&&a.MOD_NAME===that.selectedModule.MOD_NAME||d3.select(this).style("fill","url(#grad"+a.MOD_NAME+")");tt.transition().duration(500).style("opacity",0)});"undefined"!==typeof that.selectedModule&&that.selectedModule===c?b.append("text").attr("class",
"txtLbl").attr("y",a.maxWidth+12).attr("x",function(c){return a.calcWidth/2-c.MOD_NAME.length/2*6.5}).style("font-weight","bold").text(replaceUnderscore(c.MOD_NAME)):6.5*c.MOD_NAME.length<a.calcWidth&&b.append("text").attr("class","txtLbl").attr("y",a.maxWidth+12).attr("x",function(c){return a.calcWidth/2-c.MOD_NAME.length/2*6.5}).text(replaceUnderscore(c.MOD_NAME));b.append("text").attr("y",a.maxWidth/2+5).attr("x",a.calcWidth/2-3).attr("pointer-events","none").attr("fill",function(a){var c="#000000";
a=a.ModRGB.split(",");360>a[0]+a[1]+a[2]&&(c="#FFFFFF");return c}).text(function(a){var c=a.GeneCount;"undefined"!==typeof a.GroupedGenes&&(c=a.GroupedGenes);return c})})};a.backModule=function(){if(that.selectedModule){var b=a.dataList[that.selectedModule.MOD_NAME];if(0<b){b=a.data[b-1];var d=a.svg.select("g#"+that.selectedModule.MOD_NAME);d.select("circle").attr("fill","url(#grad"+that.selectedModule.MOD_NAME+")").attr("stroke","#FFFFFF").attr("stroke-width","1px");d.select("text.txtLbl").style("font-weight",
"normal");that.selectedModule=b;b=a.svg.select("g#"+b.MOD_NAME);b.select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");b.select("text.txtLbl").style("font-weight","bold");setTimeout(that.createSingleWGCNAImage,20)}}};a.forwardModule=function(){if(that.selectedModule){var b=a.dataList[that.selectedModule.MOD_NAME];if(b<a.data.length-1){b=a.data[b+1];var d=a.svg.select("g#"+that.selectedModule.MOD_NAME);d.select("circle").attr("fill","url(#grad"+that.selectedModule.MOD_NAME+
")").attr("stroke","#FFFFFF").attr("stroke-width","1px");d.select("text.txtLbl").style("font-weight","normal");that.selectedModule=b;b=a.svg.select("g#"+b.MOD_NAME);b.select("circle").attr("fill","url(#selectGrad)").attr("stroke","#000000").attr("stroke-width","3px");b.select("text.txtLbl").style("font-weight","bold");setTimeout(that.createSingleWGCNAImage,20)}}};return a};that.createSingleWGCNAImage=function(){d3.select("#viewGene").remove();d3.select("#circos").remove();$("#wgcnaresetImage").show();
$("#wgcnazoomInImage").show();$("#wgcnazoomOutImage").show();"gene"===that.viewType?($("#linkSliderMin").slider("value",.01),$("span#minLabel").html(.01),$("#linkSliderMax").slider("value",1),$("span#maxLabel").html(1),$("#hideLinkExceptNode").prop("checked",!1),setTimeout(function(){that.singleImage=that.singleWGCNAImageGeneView(that.modules);that.singleImage.draw();that.img=that.singleImage;that.singleWGCNATableGeneView();setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",
{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50)):"go"===that.viewType?($("#wgcnaresetImage").hide(),$("#wgcnazoomInImage").hide(),$("#wgcnazoomOutImage").hide(),$("#goDomainSelect").val("mf"),$("#goSpinner").val(3),setTimeout(function(){that.singleImage=that.singleWGCNAImageGoView(that.modules);that.singleImage.goDomain=$("#goDomainSelect").val();that.singleImage.draw();that.img=that.singleImage},
50)):"eqtl"===that.viewType?($("#eqtlChr option").prop("selected",!0),$("#eqtlPval").val(2),setTimeout(function(){that.singleImage=that.singleWGCNAImageEQTLView(that.modules);that.singleImage.displayDefault();that.img=that.singleImage},50)):"mir"===that.viewType?($("#mirValidatedCBX").prop("checked",!1),$("#minMirGeneSlider").slider("value",1),$("span#minMirGeneLabel").html(1),$("#mirGeneFilterTxt").val(""),$("#mirIDFilterTxt").val(""),$("#mirSortCBX").prop("checked",!1),$("#mirLinkCBX").prop("checked",
!0),$("#mirgeneLinkCBX").prop("checked",!1),$("div#mirLinkColorSelect").hide(),setTimeout(function(){that.singleImage=that.singleWGCNAImageGeneView(that.modules);that.singleImage.draw();that.img=that.singleImage;setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50)):"meta"===that.viewType&&setTimeout(function(){that.singleImage=
that.singleWGCNAImageMetaView(that.modules);that.singleImage.requestMeta();that.img=that.singleImage;setTimeout(function(){that.singleImage.panZoom=svgPanZoom("#singleWGCNASVG",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0})},500)},50);ga&&ga("send","event","changedWGCNAView",that.viewType)};that.singleWGCNAImage=function(){var a={};a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>
a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.maxPerLevel=150;a.CorCutoff_min=.75;a.CorCutoff_max=1;a.showLinks=!0;a.data=[];a.maxNodeR=28;a.negColor="#DD0000";a.negDarkColor="#770000";a.posColor="#00DD00";a.posDarkColor="#007700";a.mirVal="#FFFF00";a.mirPred="#0000CC";0===d3.select("#singleWGCNASVG").size()?a.svg=d3.select("#wgcnaGeneImage").append("div").attr("id","viewGene").append("svg").attr("id","singleWGCNASVG").attr("height",a.height+"px").attr("width","100%"):a.svg=d3.select("#singleWGCNASVG");
a.geneKey=function(a){return a.ID};a.linkKey=function(a){return that.removeInvalidIDChars(a.TC1)+that.removeInvalidIDChars(a.TC2)};a.calcX=function(b,d){return d%a.modPerLine*a.calcWidth};a.calcY=function(b,d){return Math.floor(d/a.modPerLine)*a.maxWidth};a.sizing=function(b){b=a.size(b.TCList.length);b>a.maxWidth/2&&(b=a.maxWidth/2);return b};a.colorCircle=function(a){a=a.Gene.ID;var b="#DFC184";if(0==a.indexOf("PRN")||0==a.indexOf("PMM")||0==a.indexOf("Unannotated"))"Whole Brain"===that.tissue?
b="#7EB5D6":"Heart"===that.tissue?b="#DC7252":"Liver"===that.tissue&&(b="#bbbedd");return b};a.colorLink=function(b){var d=a.negColor;0<b.Cor&&(d=a.posColor);return d};a.colorLinkHighlight=function(b){var d=a.negDarkColor;0<b.Cor&&(d=a.posDarkColor);return d};a.updateColor=function(b){b=$("#"+b).val();"Red_Green"===b?(a.posColor="#DD0000",a.posDarkColor="#770000",a.negColor="#00DD00",a.negDarkColor="#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC"):"Blue_Yellow"===b?(a.posColor="#0000DD",a.posDarkColor=
"#000077",a.negColor="#ffef16",a.negDarkColor="#b7ae2a",a.mirVal="#FF9C2A",a.mirPred="#BA49FF"):(a.negColor="#DD0000",a.negDarkColor="#770000",a.posColor="#00DD00",a.posDarkColor="#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC")};a.nodeRadiusSum=function(b,d){var c=3+20*b.LinkSum;c>a.maxNodeR&&(c=a.maxNodeR);return c};a.zoomIn=function(){a.maxWidth<$(window).width()/2&&(a.maxWidth*=2,a.draw())};a.zoomOut=function(){var b=a.maxWidth;a.maxWidth=Math.floor(a.maxWidth/2);25>a.maxWidth?a.maxWidth=b:a.draw()};
a.draw=function(){};a.redraw=function(){};a.setupLegend=function(){a.svg.select("#legend").remove();a.svg.select("#legendDisp").remove();a.legendG=a.svg.append("g").attr("id","legend").attr("transform","translate(10,60)").style("cursor","pointer").on("mouseover",function(){a.legendDispG.transition().duration(300).style("opacity",1);ga&&ga("send","event","wgcna","viewLegend")}).on("mouseleave",function(){a.legendDispG.transition().duration(300).style("opacity",0)});a.legendG.append("image").attr("x",
0).attr("y",-20).attr("width","24px").attr("height","24px").attr("xlink:href","data:image/png;base64,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");
a.legendG.append("text").attr("x","25").style("font-size","18").text("Legend");a.legendDispG=a.svg.append("g").attr("id","legendDisp").attr("transform","translate(10,70)").style("opacity",1);a.drawLegend();setTimeout(function(){a.legendDispG.transition().duration(750).style("opacity",0)},8E3)};a.drawLegend=function(){};a.createToolTip=function(a){var b="Gene: "+a.Gene.geneSymbol+" ("+a.Gene.ID+")<BR><BR>Transcript:"+a.ID+"<BR>";b=b+"<BR>Link Count:"+a.LinkCount;b=b+"<BR>Link Sum:"+a.LinkSum.toFixed(2);
var c=that.selectedGene[a.Gene.ID].tcList;if(1<c.length){"<BR><BR>Additional Transcripts in this Module:<BR>";c=that.selectedGene[a.Gene.ID].tcList;for(var f=0;f<c.length;f++)c[f].ID!==a.ID&&(b=b+c[f].ID+"<BR>")}a.PSList&&"array"===that.selSource&&(b=b+"<BR><BR>"+a.PSList.length+" Probe Sets in Transcript<BR>");return b};return a};that.singleWGCNAImageGeneView=function(){var a=that.singleWGCNAImage();$(".goCTL").hide();$(".eqtlCtls").hide();if("gene"===that.viewType)$(".linkCTL").show(),$(".mirCTL").hide(),
a.showMirLinks=0;else{$(".mirCTL").show();$(".linkCTL").hide();a.showLinks=1;a.geneList={};a.geneMirList={};for(var b=that.selectedModule.TCList,d=0;d<b.length;d++)a.geneList[that.selectedModule.TCList[d].Gene.ID]=that.selectedModule.TCList[d].Gene.geneSymbol;a.showMirLinks=1;a.showAllFromTarget=0}a.CorCutoff_min=.75;a.CorCutoff_max=1;a.type=that.viewType;a.truncated=0;a.filterOneDB=1;a.mirGeneCutoff=1;a.mirValid=0;a.mirTargetID="";a.mirID="";a.miRcolor=d3.scaleOrdinal(d3.schemeCategory20b);a.sortMir=
0;a.maxCorWidth=5;a.drawLinks=function(c){"gene"===that.viewType?a.updateColor("linkColor"):"mir"===that.viewType&&a.updateColor("mirlinkColor");a.svg.selectAll(".link").remove();for(var b=that.selectedModule.LinkList,e=[],g=0,d=0;d<b.length;d++)(b[d].TC1===c.ID||b[d].TC2===c.ID)&&a.CorCutoff_min<=Math.abs(b[d].Cor)&&Math.abs(b[d].Cor)<=a.CorCutoff_max&&(e[g]=b[d],g++);b=e;1E4>b.length&&(c=a.topG.selectAll(".link").data(b,a.linkKey),c.enter().append("line").attr("class","link").attr("pointer-events",
"none").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.TC1)+that.removeInvalidIDChars(a.TC2)}).attr("x1",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC1)).attr("cx")}).attr("y1",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC1)).attr("cy")}).attr("x2",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC2)).attr("cx")}).attr("y2",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",
function(c){return Math.abs(c.Cor)*a.maxCorWidth}).merge(c))};a.drawLinksBetween=function(c){for(var b={},e=0;e<c.length;e++)b[c[e]]=1;"gene"===that.viewType?a.updateColor("linkColor"):"mir"===that.viewType&&a.updateColor("mirlinkColor");a.svg.selectAll(".link").remove();c=that.selectedModule.LinkList;e=[];for(var g=0,d=0;d<c.length;d++)(0===a.showAllFromTarget&&"undefined"!==typeof b[c[d].TC1]&&"undefined"!==typeof b[c[d].TC2]||1===a.showAllFromTarget&&("undefined"!==typeof b[c[d].TC1]||"undefined"!==
typeof b[c[d].TC2]))&&a.CorCutoff_min<=Math.abs(c[d].Cor)&&Math.abs(c[d].Cor)<=a.CorCutoff_max&&(e[g]=c[d],g++);c=e;1E4>c.length&&(b=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".link").data(c,a.linkKey),b.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.TC1)+that.removeInvalidIDChars(a.TC2)}).attr("x1",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC1)).attr("cx")}).attr("y1",function(a){return d3.select("#tc_"+
that.removeInvalidIDChars(a.TC1)).attr("cy")}).attr("x2",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC2)).attr("cx")}).attr("y2",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(c){return Math.abs(c.Cor)*a.maxCorWidth}).merge(b))};a.nodeX=function(c,b){var e=50,f=Math.floor(b/a.maxPerLevel)+1;1<f&&(e=60*f);return a.width/2+(a.r-e)*Math.cos(b%a.maxPerLevel*a.angle-1.57079633)};a.nodeY=function(c,
b){var e=50;b>a.maxPerLevel&&(e=60*(Math.floor(b/a.maxPerLevel)+1));return a.height/2+(a.r-e)*Math.sin(b%a.maxPerLevel*a.angle-1.57079633)};a.nodeXLbl=function(c,b){var e=b%a.maxPerLevel*a.angle-1.57079633,f=1;if(Math.PI/2<e&&e<1.5*Math.PI){var d=0;"undefined"!==typeof c.Gene.geneSymbol&&(d=c.Gene.geneSymbol.length);f+=7.5*d}return a.width/2+(a.r+f)*Math.cos(e)};a.nodeYLbl=function(c,b){var e=b%a.maxPerLevel*a.angle-1.57079633,f=1;if(Math.PI/2<e&&e<1.5*Math.PI){var d=0;"undefined"!==typeof c.Gene.geneSymbol&&
(d=c.Gene.geneSymbol.length);f+=7.5*d}return a.height/2+(a.r+f)*Math.sin(e)};a.drawCorLegend=function(c){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",c).text("Positive Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",c-10).attr("width","30").attr("height","10").style("fill",a.posColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",c+20).text("Negative Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",c+
10).attr("width","30").attr("height","10").style("fill",a.negColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",c+40).text("Lower Correlation");a.legendDispG.append("line").attr("x1","0").attr("y1",c+30).attr("x2","30").attr("y2",c+30).style("stroke","#000000").style("stroke-width","0");a.legendDispG.append("line").attr("x1","0").attr("y1",c+35).attr("x2","30").attr("y2",c+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1",
"0").attr("y1",c+40).attr("x2","30").attr("y2",c+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",c+45).attr("x2","30").attr("y2",c+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",c+55).attr("x2","30").attr("y2",c+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",c+65).attr("x2","30").attr("y2",c+65).style("stroke","#000000").style("stroke-width",
"5");a.legendDispG.append("line").attr("x1","0").attr("y1",c+75).attr("x2","30").attr("y2",c+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",c+80).text("Higher Correlation")};a.drawMirSupportLegend=function(c){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",c).text("Validated miRNA Target");a.legendDispG.append("rect").attr("x","0").attr("y",c-10).attr("width","30").attr("height","10").style("fill",
a.mirVal);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",c+20).text("Predicted miRNA Target");a.legendDispG.append("rect").attr("x","0").attr("y",c+10).attr("width","30").attr("height","10").style("fill",a.mirPred);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",c+40).text("Lower support of targeting");a.legendDispG.append("line").attr("x1","0").attr("y1",c+30).attr("x2","30").attr("y2",c+30).style("stroke","#000000").style("stroke-width",
"0");a.legendDispG.append("line").attr("x1","0").attr("y1",c+35).attr("x2","30").attr("y2",c+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1","0").attr("y1",c+40).attr("x2","30").attr("y2",c+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",c+45).attr("x2","30").attr("y2",c+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1","0").attr("y1",c+55).attr("x2",
"30").attr("y2",c+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",c+65).attr("x2","30").attr("y2",c+65).style("stroke","#000000").style("stroke-width","5");a.legendDispG.append("line").attr("x1","0").attr("y1",c+75).attr("x2","30").attr("y2",c+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",c+80).text("Higher support of targeting")};a.drawLegend=function(){"gene"===
that.viewType?a.drawCorLegend(20):(a.drawMirSupportLegend(20),a.showLinks||a.drawCorLegend(130))};a.draw=function(){"mir"===that.viewType?(a.requestMiR(),a.updateColor("mirlinkColor")):"gene"===that.viewType&&a.updateColor("linkColor");a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.svg.attr("height",a.height+"px");a.svg.selectAll("circle").remove();a.svg.selectAll("text").remove();a.svg.selectAll("line").remove();
a.svg.selectAll(".geneTC").remove();"undefined"!==typeof a.panZoom&&(a.panZoom.destroy(),delete a.panZoom);a.svg.selectAll(".svg-pan-zoom_viewport").remove();setTimeout(function(){a.svg.append("text").style("font-size","20").attr("y",22).attr("x",5).text(function(){return that.selectedModule?replaceUnderscore(that.selectedModule.MOD_NAME):""});a.setupLegend();a.data=that.selectedModule.TCList;a.angle=2*Math.PI/a.data.length;a.angleDeg=360/a.data.length;a.data.length>a.maxPerLevel&&(a.angle=2*Math.PI/
a.maxPerLevel,a.angleDeg=360/a.maxPerLevel);a.data.sort(function(a,c){return a.LinkSum===c.LinkSum?0:a.LinkSum>c.LinkSum?-1:1});if(150<a.data.length){a.truncated=1;a.maxNodeR=15;for(var c=[],b=0;150>b;b++)c[b]=a.data[b];a.data=c;a.dataIndex={};for(b=0;b<a.data.length;b++)a.dataIndex[a.data[b].ID]=1;a.CorCutoff_min=.85;$("#linkSliderMin").slider("value",.85);$("span#minLabel").html(.85);a.svg.append("image").attr("x",7.8*that.selectedModule.MOD_NAME.length+20).attr("y",1).attr("width","24px").attr("height",
"24px").attr("xlink:href","data:image/png;base64,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").attr("pointer-events",
"all").style("cursor","pointer").on("mouseover",function(){$("#wgcnaMouseHelp").html("Warning: Transcripts displayed are truncated to the top 150 most connected transcripts due to the size of the module.")}).on("mouseout",function(){$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}else a.maxNodeR=28;a.topG=a.svg.append("g").attr("class","svg-pan-zoom_viewport");if("gene"===that.viewType){c=a.topG.selectAll(".geneTC").data(a.data,a.geneKey);
c.enter().append("circle").attr("class","geneTC").attr("id",function(a){return"tc_"+that.removeInvalidIDChars(a.ID)}).attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",3).attr("stroke","#000000").attr("fill","#FF0000").merge(c);c=that.selectedModule.LinkList;b=[];for(var e=0,g=0;g<c.length;g++)a.CorCutoff_min<=Math.abs(c[g].Cor)&&Math.abs(c[g].Cor)<=a.CorCutoff_max&&(0===a.truncated||"undefined"!==typeof a.dataIndex[c[g].TC1]&&"undefined"!==typeof a.dataIndex[c[g].TC2])&&(b[e]=c[g],e++);c=b;a.showLinks&&
1E4>c.length&&a.topG.selectAll(".link").data(c,a.linkKey).enter().append("line").attr("class","link").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.TC1)+that.removeInvalidIDChars(a.TC2)}).attr("x1",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC1)).attr("cx")}).attr("y1",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC1)).attr("cy")}).attr("x2",function(a){return d3.select("#tc_"+that.removeInvalidIDChars(a.TC2)).attr("cx")}).attr("y2",function(a){return d3.select("#tc_"+
that.removeInvalidIDChars(a.TC2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(c){return Math.abs(c.Cor)*a.maxCorWidth})}a.topG.selectAll(".geneTC").remove();c=a.topG.selectAll(".geneTC").data(a.data,a.geneKey);c.enter().append("g").append("circle").attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",a.nodeRadiusSum).attr("stroke","#000000").attr("fill",a.colorCircle).attr("class",function(a){return"geneTC "+a.Gene.ID}).attr("id",function(a){return"tc_"+that.removeInvalidIDChars(a.ID)}).on("click",
function(){}).on("mouseover",a.mouseoverGene).on("mouseout",a.mouseleaveGene).merge(c).each(function(c,b){d3.select(this.parentNode).append("g").attr("class","label").attr("id",function(a){return"txt_"+that.removeInvalidIDChars(a.ID)}).attr("transform",function(){var e=a.nodeXLbl(c,b),f=a.nodeYLbl(c,b);return"translate("+e+","+f+")"}).append("text").attr("transform",function(){var c=-90+b%a.maxPerLevel*a.angleDeg;90<c&&(c-=180);return"rotate("+c+")"}).text(function(){return c.Gene.geneSymbol})});
c.exit().remove();"mir"===that.viewType&&a.drawMiR()},250)};a.requestMiR=function(){$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".miR.json",type:"GET",async:!0,data:{},dataType:"json",success:function(c){setTimeout(function(){a.mirData=c;a.geneMirList={};for(var b=0;b<a.mirData.MIRList.length;b++)for(var e=a.mirData.MIRList[b],g=e.GeneList,d=0;d<g.length;d++)if("undefined"===typeof a.geneMirList[g[d].ID])a.geneMirList[g[d].ID]=
[],a.geneMirList[g[d].ID].push(e);else{for(var n=0,l=0;l<a.geneMirList[g[d].ID].length&&0===n;l++)e.ID===a.geneMirList[g[d].ID][l].ID&&(n=1);0===n&&a.geneMirList[g[d].ID].push(e)}a.drawMiR();that.singleWGCNATableMirView()},50)},error:function(c,b,e){setTimeout(function(){a.requestMiR()},2E3)}})};a.drawMiR=function(){if("undefined"!==typeof a.topG&&"undefined"!==typeof a.mirData){a.svg.select("#mirG").remove();a.miRdiameter=1.5*a.r;a.miRformat=d3.format(",d");a.miRbubble=d3.pack().size([a.miRdiameter,
a.miRdiameter]).padding(1.5);var c=a.runMirFilter(a.mirData.MIRList);a.hierarch=d3.hierarchy({children:c}).sum(function(a){return a.filterGLSize});a.mirNode=a.miRbubble(a.hierarch.sort());c=a.topG.append("g").attr("id","mirG").attr("transform",function(){return"translate("+(a.width/2-a.miRdiameter/2)+","+(a.height/2-a.miRdiameter/2)+")"}).selectAll(".node").data(a.hierarch.leaves(),that.mirKey);c.enter().append("g").attr("class","node").attr("id",function(a){return that.removeInvalidIDChars(a.ID)}).attr("transform",
function(a){return"translate("+a.x+","+a.y+")"}).merge(c).on("mouseover",a.mouseoverMir).on("mouseleave",a.mouseleaveMir);c.exit().remove();d3.selectAll(".node").each(function(c){var b=c.data;if(0<c.depth){d3.select(this).append("circle").attr("r",function(a){return a.r}).style("fill",function(c){return a.miRcolor(b.ID)});var d=b.ID.substring(8);d.length<c.r/3&&d3.select(this).append("text").attr("dy",".2em").attr("pointer-events","none").style("text-anchor","middle").style("cursor","pointer").append("tspan").attr("x",
0).attr("dy","-0.5em").text("miR").append("tspan").attr("x",0).attr("dy","1em").text(d)}})}};a.sortMirFunction=function(c,b){return 0<a.sortMir?c.value-b.value:0>a.sortMir?b.value-c.value:0};a.runMirFilter=function(c){var b=c;if(1===a.filterOneDB||1<a.mirGeneCutoff||1===a.mirValid||0<a.mirID.length||0<a.mirTargetID.length){var e=0;b=[];for(var d=0;d<c.length;d++)a.filterMiR(c[d])&&(b[e]=c[d],e++)}return b};a.filterMiR=function(c){val=!0;c.GeneList.length<a.mirGeneCutoff&&(val=!1);val&&1===a.mirValid&&
0===c.vC&&(val=!1);val&&0<a.mirID.length&&(-1<c.ID.toLowerCase().indexOf(a.mirID)||-1<c.ACC.toLowerCase().indexOf(a.mirID)||(val=!1));if(val&&0<a.mirTargetID.length){for(var b=!1,e=0;e<c.GeneList.length&&!b;e++)if(1===a.filterOneDB)(1<c.GeneList[e].P||0<c.GeneList[e].V)&&(-1<c.GeneList[e].ID.toLowerCase().indexOf(a.mirTargetID)||-1<a.geneList[c.GeneList[e].ID].toLowerCase().indexOf(a.mirTargetID))&&(b=!0);else if(-1<c.GeneList[e].ID.toLowerCase().indexOf(a.mirTargetID)||-1<a.geneList[c.GeneList[e].ID].toLowerCase().indexOf(a.mirTargetID))b=
!0;b||(val=!1)}if(val&&1===a.filterOneDB&&"undefined"===typeof c.filterGLSize){for(e=b=0;e<c.GeneList.length;e++)(1<c.GeneList[e].P||0<c.GeneList[e].V)&&b++;c.filterGLSize=b;0===c.filterGLSize&&0===c.vC&&(val=!1)}else val&&1===a.filterOneDB&&0===c.filterGLSize&&0===c.vC&&(val=!1);return val};a.filterRevMiR=function(b){var c=[];if("undefined"!==typeof b)if(1===a.filterOneDB)for(var e=0;e<b.length;e++)(0<b[e].filterGLSize||0<b[e].vC)&&c.push(b[e]);else c=b;return c};a.filterMiRGenes=function(b){var c=
[];if(1===a.filterOneDB)for(var e=0;e<b.length;e++)(1<b[e].P||0<b[e].V)&&c.push(b[e]);else c=b;return c};a.createMirToolTip=function(a){return'<div id="ttSVG"></div>ID: '+a.ID+"<BR>Accession: "+a.ACC+"<BR><BR>Genes Targeted within Module: "+a.filterGLSize+"<BR>"};a.mouseoverMir=function(){var b=d3.select(this).data()[0],d=b.data,e=d.GeneList;e=a.filterMiRGenes(e);d3.select(this).style("opacity","0.3");tt.transition().duration(200).style("opacity",1);tt.html(a.createMirToolTip(d)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",
function(){return that.positionTTTop(d3.event.pageY)});d=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".mirlink").data(e,that.mirKey);d.enter().append("line").attr("class","mirlink").attr("pointer-events","none").attr("id",function(a){return"ln_"+a.ID}).attr("x1",function(c){return b.x+a.width/2-a.miRdiameter/2}).attr("y1",function(c){return b.y+a.height/2-a.miRdiameter/2}).attr("x2",function(c){var e=b.x+a.width/2-a.miRdiameter/2;0<d3.select("."+c.ID).size()&&(e=d3.select("."+c.ID).attr("cx"));
return e}).attr("y2",function(c){var e=b.y+a.height/2-a.miRdiameter/2;0<d3.select("."+c.ID).size()&&(e=d3.select("."+c.ID).attr("cy"));return e}).attr("stroke",function(b){var c=a.mirPred;0<b.V&&(c=a.mirVal);return c}).attr("stroke-width",function(a){return a.P+3*a.V}).merge(d);if(!a.showLinks){d=[];for(var g=0;g<e.length;g++)for(var h=d3.selectAll("."+e[g].ID).nodes(),n=0;n<h.length;n++)"undefined"!==typeof h[n]&&d.push(d3.select(h[n].parentNode).datum().ID);a.drawLinksBetween(d)}ga&&ga("send","event",
"wgcna","mouseOverMir")};a.mouseleaveMir=function(){d3.select(this).style("opacity","1");tt.transition().duration(200).style("opacity",0);a.svg.selectAll(".mirlink").remove();a.svg.selectAll(".link").remove()};a.mouseoverGene=function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this gene cluster and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).data()[0])).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",
function(){return that.positionTTTop(d3.event.pageY)});var b=d3.select(this.parentNode).datum();"mir"===that.viewType?(a.mirTargetID=b.Gene.ID.toLowerCase(),that.singleImage.drawMiR(),a.svg.selectAll(".link").remove()):($("[id^=ln_"+that.removeInvalidIDChars(b.ID)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLinkHighlight)}),$("[id$="+that.removeInvalidIDChars(b.ID)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLinkHighlight)}));
a.showLinks||a.drawLinks(b);d3.select("#txt_"+that.removeInvalidIDChars(b.ID)).select("text").attr("fill","#00A347");for(var d=that.selectedGene[b.Gene.ID].tcList,e=0;e<d.length;e++)d3.select("#tc_"+that.removeInvalidIDChars(d[e].ID)).attr("fill","#FEFF49");if("mir"===that.viewType&&a.showMirLinks){var g=b.Gene.ID;b=a.geneMirList[b.Gene.ID];b=a.filterRevMiR(b);b=a.svg.select("g.svg-pan-zoom_viewport").selectAll(".mirlink").data(b,that.mirKey);b.enter().append("line").attr("class","mirlink").attr("pointer-events",
"none").attr("id",function(a){return"ln_"+a.ID}).attr("x1",function(b){var c=d3.select("."+g).attr("cx");0<d3.select("#"+that.removeInvalidIDChars(b.ID)).size()&&(c=d3.select("#"+that.removeInvalidIDChars(b.ID))[0][0].__data__.x+a.width/2-a.miRdiameter/2);return c}).attr("y1",function(b){var c=d3.select("."+g).attr("cy");0<d3.select("#"+that.removeInvalidIDChars(b.ID)).size()&&(c=d3.select("#"+that.removeInvalidIDChars(b.ID))[0][0].__data__.y+a.height/2-a.miRdiameter/2);return c}).attr("x2",function(a){return d3.select("."+
g).attr("cx")}).attr("y2",function(a){return d3.select("."+g).attr("cy")}).attr("stroke",function(b){var c=a.mirPred;0<b.V&&(c=a.mirVal);return c}).attr("stroke-width",function(a){return a.P+3*a.V}).merge(b)}ga&&ga("send","event","wgcna","mouseOverGene")};a.mouseleaveGene=function(){var b=d3.select(this.parentNode).datum();$("[id^=ln_"+that.removeInvalidIDChars(b.ID)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLink)});$("[id$="+that.removeInvalidIDChars(b.ID)+
"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLink)});d3.select(this).style("fill",a.colorCircle);d3.select("#txt_"+that.removeInvalidIDChars(b.ID)).select("text").attr("fill","#000000");tt.transition().duration(500).style("opacity",0);a.showLinks||a.svg.selectAll(".link").remove();"mir"===that.viewType&&(a.mirTargetID=$("#mirGeneFilterTxt").val().toLowerCase(),a.svg.selectAll(".mirLink").remove(),that.singleImage.drawMiR())};return a};that.singleWGCNATableGeneView=
function(){"undefined"!==typeof that.selectedModule?($("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaMirTable").hide(),$("div#wgcnaMirGeneTable").hide(),$("div#wgcnaGoTable").hide(),$("div#wgcnaModuleTable").show(),$("span#modTableName").html(that.selectedModule.MOD_NAME),d3.select("div#tableExportCtl").selectAll("span").remove(),d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",function(){$("#moduleTable").tableExport({type:"csv",
escape:"false"})}).html("Export CSV"),$.fn.DataTable.isDataTable("table#moduleTable")&&$("table#moduleTable").DataTable().destroy(),d3.select("table#moduleTable").select("tbody").selectAll("tr").remove(),d3.select("table#moduleTable").select("tbody").selectAll("tr").data(that.selectedModule.TCList,that.geneKey).enter().append("tr").attr("id",function(a){return"modtrx"+a.ID}).attr("class",function(a,b){var d="odd";0===b%2&&(d="even");return d}).each(function(a,b){d3.select(this).append("td").html(a.Gene.geneSymbol);
d3.select(this).append("td").html(a.Gene.ID);d3.select(this).append("td").html(a.ID);a.PSList?d3.select(this).append("td").html(a.PSList.length):d3.select(this).append("td").html("0");d3.select(this).append("td").html(a.LinkSum.toFixed(2));d3.select(this).append("td").html(function(){return b+1})}),$("table#moduleTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:"fi<t>"})):($("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaModuleTable").hide(),$("div#wgcnaGoTable").hide())};
that.singleWGCNATableMirView=function(){var a={orgPref:"mmu-",runMirFilter:function(a){for(var b=[],c=0,d=0;d<a.length;d++)if(0<a[d].filterGLSize||0<a[d].vC)b[c]=a[d],c++;return b},createMirTable:function(){$("div#waitMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaMirTable").show();$("span#mirTableName").html(that.selectedModule.MOD_NAME);$.fn.DataTable.isDataTable("table#mirTable")&&$("table#mirTable").DataTable().destroy();d3.select("table#mirTable").select("tbody").selectAll("tr").remove();
var b=a.runMirFilter(that.singleImage.mirData.MIRList);d3.select("table#mirTable").select("tbody").selectAll("tr").data(b,that.mirKey).enter().append("tr").attr("id",function(a){return"mirTR"+that.removeInvalidIDChars(a.ID)}).attr("class",function(a,b){var c="odd";0===b%2&&(c="even");return c}).each(function(a,b){for(var c=0,d=[],e=0,f=[],p=a.GeneList,q=0;q<p.length;q++)0<p[q].V?(c++,d.push(p[q])):1<p[q].P&&(e++,f.push(p[q]));d3.select(this).append("td").html(a.ID);d3.select(this).append("td").html(a.ACC);
d3.select(this).append("td").html(function(){if(0<e){var a='<span class="triggerpL" name="pl'+b+'">'+e+"</span><BR>";a=a+'<span id="pl'+b+'" style="display:none;" >';for(var c=0;c<f.length;c++){0<c&&(a+=", ");var d=f[c].ID;"undefined"!==typeof that.singleImage.geneList[d]&&(d=that.singleImage.geneList[d]);a+=d}a+="</span>"}else a=e;return a});d3.select(this).append("td").html(function(){if(0<c){var a='<span class="triggervL" name="vl'+b+'">'+c+"</span><BR>";a=a+'<span id="vl'+b+'" style="display:none;" >';
for(var e=0;e<d.length;e++){0<e&&(a+=", ");var g=d[e].ID;"undefined"!==typeof that.singleImage.geneList[g]&&(g=that.singleImage.geneList[g]);a+=g}a+="</span>"}else a=c;return a});d3.select(this).append("td").html(function(){var a=e+c;if(0<a){a='<span class="triggerMiL" name="mil'+b+'">'+a+"</span><BR>";a=a+'<span id="mil'+b+'" style="display:none;" >';if(0<d.length){a+="Validated: ";for(var g=0;g<d.length;g++){0<g&&(a+=", ");var h=d[g].ID;"undefined"!==typeof that.singleImage.geneList[h]&&(h=that.singleImage.geneList[h]);
a+=h}}if(0<f.length)for(0<d.length&&(a+="<BR><BR>"),a+="Predicted: ",g=0;g<f.length;g++)0<g&&(a+=", "),h=f[g].ID,"undefined"!==typeof that.singleImage.geneList[h]&&(h=that.singleImage.geneList[h]),a+=h;a+="</span>"}return a})});$("#mirTable .triggerMiL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+b).hide());a.stopPropagation()});$("#mirTable .triggerpL").on("click",function(a){var b=
this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+b).hide());a.stopPropagation()});$("#mirTable .triggervL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+b).hide());a.stopPropagation()});$("table#mirTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:'f<"rightTable"i><t>'})},createMirGeneTable:function(){$("div#waitMirGeneTable").hide();
$("div#wgcnaMirGeneTable").show();$("div#wgcnaMirTable").hide();$("span#mirGeneTableName").html(that.selectedModule.MOD_NAME);d3.select("table#mirGeneTable").select("tbody").selectAll("tr").remove();d3.select("table#mirGeneTable").select("tbody").selectAll("tr").data(that.selectedModule.TCList,that.geneKey).enter().append("tr").attr("id",function(a){return"mirg"+that.removeInvalidIDChars(a.ID)}).attr("class",function(a,b){var c="odd";0===b%2&&(c="even");return c}).each(function(b,d){var c=that.singleImage.geneMirList[b.Gene.ID],
g=0,f=[],n=0,l=[];if("undefined"!==typeof c)for(var p=0;p<c.length;p++)for(var q=c[p].GeneList,k=0,m=0;m<q.length&&0===k;m++)q[m].ID===b.Gene.ID&&(0<q[m].V?(g++,f.push(c[p])):1<q[m].P&&(n++,l.push(c[p])),k=1);d3.select(this).append("td").html(b.Gene.geneSymbol);d3.select(this).append("td").html(b.Gene.ID);d3.select(this).append("td").html(function(b,c){if(0<n){var e='<span class="triggerpL" name="pl'+d+'">'+n+"</span><BR>";e=e+'<span id="pl'+d+'" style="display:none;" >';for(var g=0;g<l.length;g++){0<
g&&(e+=", ");var f=l[g].ID.replace(a.orgPref,"");e+=f}e+="</span>"}else e=n;return e});d3.select(this).append("td").html(function(b,c){if(0<g){var e='<span class="triggervL" name="vl'+d+'">'+g+"</span><BR>";e=e+'<span id="vl'+d+'" style="display:none;" >';for(var h=0;h<f.length;h++){0<h&&(e+=", ");var l=f[h].ID.replace(a.orgPref,"");e+=l}e+="</span>"}else e=g;return e});d3.select(this).append("td").html(function(b,c){var e=g+n;if(0<e){e='<span class="triggerMiL" name="mil'+d+'">'+e+"</span><BR>";
e=e+'<span id="mil'+d+'" style="display:none;" >';if(0<f.length){e+="Validated: ";for(var h=0;h<f.length;h++){0<h&&(e+=", ");var k=f[h].ID.replace(a.orgPref,"");e+=k}}if(0<l.length)for(0<f.length&&(e+="<BR><BR>"),e+="Predicted: ",h=0;h<l.length;h++)0<h&&(e+=", "),k=l[h].ID.replace(a.orgPref,""),e+=k;e+="</span>"}return e})});$("#mirGeneTable .triggerMiL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),
$("span#"+b).hide());a.stopPropagation()});$("#mirGeneTable .triggerpL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+b).hide());a.stopPropagation()});$("#mirGeneTable .triggervL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+b).hide());a.stopPropagation()});$.fn.DataTable.isDataTable("table#mirGeneTable")&&
$("table#mirGeneTable").DataTable().destroy();$("table#mirGeneTable").DataTable({bPaginate:!1,aaSorting:[[4,"desc"]],sDom:'<"rightTable"i><"leftTable"f><t>'})}};if("undefined"!==typeof that.selectedModule){$("div#wgcnaEqtlTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaGoTable").hide();d3.select("div#tableExportCtl").selectAll("span").remove();var b=d3.select("div#tableExportCtl"),d=b.append("span").style("display","inline-block").style("text-align","left").style("margin-left","20px").style("margin-right",
"10px");d.append("text").text("View by:");d.append("br");d.append("input").attr("type","radio").attr("checked","checked").attr("name","wgcnaMirTableRB").on("click",function(){a.createMirTable()});d.append("text").text(" miRNA");d.append("br");d.append("input").attr("type","radio").attr("name","wgcnaMirTableRB").on("click",function(){a.createMirGeneTable()});d.append("text").text(" Gene");b.append("span").attr("class","button").style("display","inline-block").style("margin-right","10px").on("click",
function(){$("#moduleTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");a.createMirTable()}else $("div#waitModuleTable").hide(),$("div#wgcnaEqtlTable").hide(),$("div#wgcnaModuleTable").hide(),$("div#wgcnaMirTable").hide(),$("div#wgcnaMirGeneTable").hide(),$("div#wgcnaGoTable").hide();return a};that.singleWGCNAImageGoView=function(){var a=that.singleWGCNAImage();$(".goCTL").show();$(".linkCTL").hide();$(".mirCTL").hide();$(".eqtlCtls").hide();a.type=that.viewType;a.goDomain="mf";
a.lastDrawn="mf";a.selectedNode;a.displayedLevel="d1";a.width=$(window).width();a.height=Math.floor(.92*window.innerHeight);a.padding=5;a.radius=(Math.min(a.width,a.height)-2*a.padding)/2;a.duration=1E3;a.xScale=d3.scaleLinear().range([0,2*Math.PI]);a.yScale=d3.scalePow().exponent(1.3).domain([0,1]).range([0,a.radius]);a.colorGO=d3.scaleOrdinal(d3.schemeCategory20);a.displayDepth=3;a.geneList={};var b=[];if(that.selectedModule){b=that.selectedModule.TCList;for(var d=0;d<b.length;d++)a.geneList[that.selectedModule.TCList[d].Gene.ID]=
that.selectedModule.TCList[d].Gene.geneSymbol}a.pathColor=function(b){return b&&b.data?b.data.name&&0==b.data.name.indexOf("ENS")?"#DFC184":b.data.name?a.colorGO(b.data.name):"#000000":b&&b.name&&0==b.name.indexOf("ENS")?"#DFC184":b&&b.name?a.colorGO(b.name):"#000000"};a.addLabels=function(b,d,e,g,h,n,l){n=a.radius/(l+1)*b.depth+a.radius/(l+1)-12;var c=a.radius/(l+1)*b.depth,f=(h-e)/360*Math.PI*c*2;l=Math.floor((h-e)/360*Math.PI*n*2/7)-1;n=Math.floor((n-c)/12);var k=b.data.name;0===b.data.name.indexOf("ENS")&&
"undefined"!==typeof a.geneList[k]&&(k=a.geneList[k],25<h-e&&(k=k+" ("+b.data.name+")"));var m=k.split(" ")[0].split("-")[0];if(m.length<=l||-1===b.data.name.indexOf("ENS")&&m.length/2<=l&&10<h-e){f=[];m=0;if(k.length>l)for(;0<k.length;){var u=k.indexOf(" ");if(-1===u)k.length>l?(f[m]=k.substr(0,l),m++,k=k.substr(l)):(f[m]=k,m++,k="");else{for(var r=0;u<l&&1>r;){var t=k.indexOf(" ",u+1);-1!==t&&t<=l?u=t:r=1}u>l?-1<k.indexOf("-")&&k.indexOf("-")<l?(u=k.indexOf("-"),f[m]=k.substr(0,u+1),m++,k=k.substr(u+
1)):(f[m]=k.substr(0,l),m++,k=k.substr(l)):(f[m]=k.substr(0,u),m++,k=k.substr(u+1))}}else f[m]=k;m=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(b.data.id)).attr("text-anchor",function(a){return"start"}).attr("dy","1em").style("opacity",function(a){return 1}).append("textPath").attr("xlink:href",function(a){return"#ap"+d}).attr("startOffset",function(a){return 0===e&&360===h?90:5});for(b=0;b<f.length&&b<n;b++)b<n&&(b===
n-1&&f.length>n&&(f[b]+="...",f[b].length>l&&(f[b]=f[b].substr(0,l-4)+"...")),m.append("tspan").attr("x",0).attr("dy","1em").text(f[b]))}else if(12<=f&&0===b.data.name.indexOf("ENS"))for(m=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(b.data.id)).attr("text-anchor",function(a){a="start";180<=h&&(a="end");return a}).attr("dy",".2em").attr("transform",function(a){a=g-2.5;var b=c;0===e&&360===h&&(b=20);180<=h&&(a=g+2.5);
return"rotate("+(a-90)+")translate("+b+")rotate("+(180<a?-180:0)+")"}).style("opacity",function(a){return 1}),k=b.data.name,0===b.data.name.indexOf("ENS")&&"undefined"!==typeof a.geneList[k]&&(k=a.geneList[k]),l=k.split(" "),b=0;b<l.length;b++)m.append("tspan").attr("x",0).attr("dy","1em").text(l[b])};a.redraw=function(){a.svg.selectAll("path").remove();a.svg.select("#center").remove();var b=a.partition(a.rootN).descendants().filter(a.filterNodes),d=a.displayDepth;a.arc=d3.arc().startAngle(function(a){return Math.max(0,
Math.min(2*Math.PI,a.x0))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.x1))}).innerRadius(function(b){return b===a.selectedNode&&a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2]?20:Math.max(0,a.radius/(d+1)*(b.depth-a.rootN.depth))}).outerRadius(function(b){return Math.max(0,a.radius/(d+1)*(b.depth-a.rootN.depth)+a.radius/(d+1))});a.topG.selectAll("path").remove();a.topG.selectAll("text").remove();var e=180/Math.PI;a.path=a.topG.selectAll("path").data(b);
a.path.enter().append("path").merge(a.path).attr("d",a.arc).attr("id",function(a,b){return"ap"+b}).attr("class",function(a,b){return removeColon(a.data.id)}).attr("fill-rule","evenodd").attr("fill",a.pathColor).attr("pointer-events","all").on("mouseover",a.mouseover).on("click",a.click).each(function(b,c){if(b.depth<a.rootN.depth+a.displayDepth){var g=Math.max(0,Math.min(2*Math.PI,b.x0))*e,f=Math.max(0,Math.min(2*Math.PI,b.x1))*e,h=g+(f-g)/2;0===g&&360===f&&(h=90);a.addLabels(b,c,g,h,f,b.depth-a.rootN.depth,
d)}});if(a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2])a.svg.append("circle").attr("id","center").attr("cx",a.width/2+a.padding).attr("cy",a.height/2+a.padding).attr("r","20").attr("fill-rule","evenodd").attr("fill",function(){return a.pathColor(a.rootN.parent)}).attr("pointer-events","all").on("click",function(){if(a.rootN.parent.data===a.data.GOList[0]||a.rootN.parent.data===a.data.GOList[1]||a.rootN.parent.data===a.data.GOList[2])a.selectedNode=
null,a.draw();else{if(a.rootN.parent.data!==a.data.GOList[0]&&a.rootN.parent.data!==a.data.GOList[1]&&a.rootN.parent.data!==a.data.GOList[2])a.selectedNode=a.rootN.parent.data,a.rootN=a.rootN.parent,a.mouseover(a.rootN.parent);else{var b=a.data.GOList[0];"mf"===a.goDomain?b=a.data.GOList[2]:"bp"===a.goDomain&&(b=a.data.GOList[1]);a.selectedNode=b}a.redraw();d3.event.stopPropagation();ga&&ga("send","event","wgcna","mouseClickGO")}}).on("mouseover",function(b){"undefined"!==typeof a.selectedNode&&a.selectedNode.parent!==
a.data.GOList[0]&&a.selectedNode.parent!==a.data.GOList[1]&&a.selectedNode.parent!==a.data.GOList[2]?a.mouseover(a.selectedNode.parent):(tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(a.selectedNode)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)}));d3.event.stopPropagation();ga&&ga("send","event","wgcna","mouseOverGO")}).on("mouseleave",function(a){tt.transition().duration(200).style("opacity",
0)})};a.getModuleGOFile=function(b){"undefined"!==typeof that.selectedModule&&"undefined"!==typeof that.selectedModule.MOD_NAME&&$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".GO.json",type:"GET",async:!0,data:{},dataType:"json",success:function(b){a.data=b;console.log(a.data);console.log(a.data.GOList[0]);b=a.data.GOList[0];for(var c=0,d=0;d<b.length;d++)b[d].UnqID=c,console.log(b[d]),c++;b=a.data.GOList[1];
for(d=0;d<b.length;d++)b[d].UnqID=c,c++;b=a.data.GOList[2];for(d=0;d<b.length;d++)b[d].UnqID=c,c++;a.draw()},error:function(c,d,g){console.log(g);25>b&&setTimeout(function(){a.getModuleGOFile(b+1)},1E3)}})};a.draw=function(){a.svg.attr("width",a.width).attr("height",a.height);a.initializeBreadcrumbTrail();a.topG=a.svg.append("g").attr("transform","translate("+[a.width/2+a.padding,a.height/2+a.padding]+")");a.partition=d3.partition().size([2*Math.PI,a.radius]);if("undefined"===typeof a.data.MOD_NAME||
"undefined"!==typeof that.selectedModule.MOD_NAME&&replaceUnderscore(a.data.MOD_NAME)!==replaceUnderscore(that.selectedModule.MOD_NAME))a.getModuleGOFile(0),a.selectedNode=null;else{if(a.goDomain!==a.lastDrawn||"undefined"===typeof a.selectedNode||null===a.selectedNode){var b=a.data.GOList[0];"mf"===a.goDomain?b=a.data.GOList[2]:"bp"===a.goDomain&&(b=a.data.GOList[1]);a.selectedNode=b;a.rootN=d3.hierarchy(b).sum(function(a){return a&&a.name&&-1<a.name.indexOf("ENS")?1:a.uniqueGene}).sort(function(a,
b){return b.value-a.value})}b=a.partition(a.rootN).descendants().filter(a.filterNodes);a.lastDrawn=a.goDomain;if(a.selectedNode===a.data.GOList[0]||a.selectedNode===a.data.GOList[1]||a.selectedNode===a.data.GOList[2])a.totalSize=a.selectedNode.uniqueGene;var d=a.displayDepth;a.arc=d3.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.x0))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.x1))}).innerRadius(function(b){return Math.max(0,a.radius/(d+1)*b.depth)}).outerRadius(function(b){return Math.max(0,
a.radius/(d+1)*b.depth+a.radius/(d+1))});setTimeout(function(){that.singleWGCNATableGoView()},50);a.vis=a.topG.append("svg:circle").attr("r",a.radius+30).style("opacity",0).on("mouseover",a.mouseleave);var e=180/Math.PI;a.path=a.topG.selectAll("path").data(b);a.path.enter().append("path").attr("d",a.arc).attr("id",function(a,b){return"ap"+b}).attr("fill-rule","evenodd").attr("fill",a.pathColor).attr("pointer-events","all").on("mouseover",a.mouseover).on("click",a.click).each(function(b,c){var g=Math.max(0,
Math.min(2*Math.PI,b.x0))*e,f=Math.max(0,Math.min(2*Math.PI,b.x1))*e,h=g+(f-g)/2;0===g&&360===f&&(h=90);a.addLabels(b,c,g,h,f,b.depth-a.rootN.depth,d)});a.path.exit().remove();a.svg.append("g").attr("transform","translate(0,15)").append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("text-anchor","start").style("opacity",function(a){return 1}).text(a.selectedNode.uniqueGene+" genes in module with GO annotation")}};a.filterNodes=function(b,d){return b.depth<
a.rootN.depth+a.displayDepth?!0:!1};a.click=function(b){a.selectedNode=b.data;a.rootN=b;b.data!==a.data.GOList[0]&&b.data!==a.data.GOList[1]&&b.data!==a.data.GOList[2]?a.redraw():a.draw();d3.event.stopPropagation()};a.mouseover=function(b){if("undefined"!==typeof b&&null!==b){var c=a.data.GOList[0];"mf"===a.goDomain?c=a.data.GOList[2]:"bp"===a.goDomain&&(c=a.data.GOList[1]);var d=0;d="undefined"!==typeof b&&"undefined"!==typeof b.data.value?(100*b.data.value/c.uniqueGene).toPrecision(3):"undefined"!==
typeof b?(100*b.data.uniqueGene/c.uniqueGene).toPrecision(3):100;c=d+"%";.1>d&&(c="< 0.1%");"undefined"!==typeof b.data.name&&-1===b.data.name.indexOf("ENS")&&(c=b.data.uniqueGene+" genes ("+c+")");d3.select("#percentage").text(c);d3.select("#explanation").style("visibility","");var g=a.getAncestors(b);a.updateBreadcrumbs(g,c);d3.selectAll("path").style("opacity",.3);a.topG.selectAll("text").style("opacity",.3);a.topG.selectAll("path").filter(function(a){return 0<=g.indexOf(a)}).style("opacity",1).each(function(b){a.topG.selectAll(".txt"+
removeColon(b.data.id)).style("opacity",1)});a.topG.selectAll("."+removeColon(b.data.id)).style("opacity",1);tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(b)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)})}d3.event.stopPropagation()};a.createToolTip=function(b){b.data&&(b=b.data);var c="Name:"+b.name+" ("+b.id+")<BR><BR>Definition: "+b.definition+"<BR><BR>Unique Genes in this module with this term: "+
b.uniqueGene+"<BR>";if(0<b.uniqueGene)for(var d=0;d<b.uniqueGenes.length;d++){0<d&&(c+=", ");var g=b.uniqueGenes[d].id;"undefined"!==typeof a.geneList[g]&&(g=a.geneList[g]);c+=g}return c};a.mouseleave=function(a){d3.select("#trail").style("visibility","hidden");d3.selectAll("text").style("opacity",1);d3.selectAll("path").transition().duration(500).style("opacity",1);d3.select("#explanation").style("visibility","hidden");tt.transition().duration(200).style("opacity",0)};a.getAncestors=function(a){for(var b=
[];a.parent;)b.unshift(a),a=a.parent;return b};a.isParentOf=function(b,d){return b===d?!0:b.children?b.children.some(function(b){return a.isParentOf(b,d)}):!1};a.b={w:250,h:30,s:3,t:10,runW:0,runH:0};a.initializeBreadcrumbTrail=function(){d3.select("#singleWGCNASVG").remove();d3.select("#trail").remove();d3.select("#viewGene").append("svg:svg").attr("width",a.width).attr("height",68).attr("id","trail").append("svg:text").attr("id","endlabel").style("fill","#000");a.svg=d3.select("#viewGene").append("svg").attr("id",
"singleWGCNASVG").attr("height",a.height+"px").attr("width","100%")};a.breadcrumbPoints=function(b,d){var c=7.5*b.data.name.length+25,g=[];g.push("0,0");g.push(c+",0");g.push(c+a.b.t+","+a.b.h/2);g.push(c+","+a.b.h);g.push("0,"+a.b.h);0<d&&g.push(a.b.t+","+a.b.h/2);return g.join(" ")};a.updateBreadcrumbs=function(b,d){var c=d3.select("#trail").selectAll("g").data(b,function(a){return a.data.name+a.depth});c.exit().remove();a.b.runW=0;a.b.runH=0;c=c.enter().append("svg:g").merge(c).attr("transform",
function(b,c){var d=7.5*b.data.name.length+25,e=a.b.runW;e+d>a.width&&(e=0,a.b.runH=a.b.runH+a.b.h+a.b.s,a.b.runW=0);a.b.runW=a.b.runW+d+a.b.s;return"translate("+e+", "+a.b.runH+")"});c.append("svg:polygon").attr("points",a.breadcrumbPoints).style("fill",a.pathColor);c.append("svg:text").attr("x",function(b){return(7.5*b.data.name.length+25+a.b.t)/2}).attr("y",a.b.h/2).attr("dy","0.35em").attr("text-anchor","middle").text(function(b){b=b.data.name;0===b.indexOf("ENS")&&"undefined"!==typeof a.geneList[b]&&
(b=a.geneList[b]);return b});d3.select("#trail").select("#endlabel").attr("x",a.b.runW+15).attr("y",a.b.h/2+a.b.runH).attr("dy","0.35em").attr("text-anchor","start").text(d);d3.select("#trail").attr("height",function(){var b=a.b.runH+a.b.h+5;68>b&&(b=68);return b}).style("visibility","")};return a};that.flattenTree=function(a,b){-1===b.data.name.indexOf("ENS")&&a.push(b);if(b.children)for(var d=0;d<b.children.length;d++)that.flattenTree(a,b.children[d])};that.singleWGCNATableGoView=function(){$("div#waitGoTable").hide();
$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaEqtlTable").hide();$("div#wgcnaGoTable").show();$("span#GoTableName").html(that.selectedModule.MOD_NAME);d3.select("div#tableExportCtl").selectAll("span").remove();d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",function(){$("#GoTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");$.fn.DataTable.isDataTable("table#GoTable")&&
$("table#GoTable").DataTable().destroy();d3.select("#GoTable").select("tbody").selectAll("tr").remove();var a=[];that.flattenTree(a,that.singleImage.rootN);a=d3.select("#GoTable").select("tbody").selectAll("tr").data(a,function(a,d){return d});a.exit().remove();a.enter().append("tr").style("background-color",that.singleImage.pathColor).style("display",function(a){var b="none";a.depth<=that.singleImage.rootN.depth?b="":a.depth===that.singleImage.rootN.depth+1&&(b="");return b}).style("cursor","pointer").merge(a).attr("id",
function(a){return a.id}).attr("class",function(a){return" d"+a.depth}).on("mouseover",function(a){d3.select(this).style("background-color","#FFFFFF");ga&&ga("send","event","wgcna","mouseOverGOTbl")}).on("mouseleave",function(a){d3.select(this).style("background-color",that.singleImage.pathColor(a))}).on("click",function(a){that.singleImage.selectedNode=a.data;that.singleImage.rootN=a;$("span[name=d"+a.depth+"]").addClass("less");$("tr.d"+a.depth).show();that.singleImage.redraw();ga&&ga("send","event",
"wgcna","mouseClickGOTbl")}).each(function(a,d){var b=d3.select(this);b.append("td").style("padding-left",function(){return 20*a.depth+"px"}).html(function(){var b=a.data.name+" ("+a.data.id+")";-1<a.data.name.indexOf("ENS")&&(b=that.singleImage.geneList[a.data.name]+" ("+a.data.id+")");var c=b;if("undefined"!==typeof a.children&&0<a.children.length){c="";a.depth<=that.singleImage.rootN.depth&&(c=" less");for(var d=0,h=0;h<a.children.length&&0===d;h++)-1===a.children[h].data.name.indexOf("ENS")&&
(d=1);c=1===d?'<span class="trigger'+c+'" name="d'+(a.depth+1)+'">'+b+"</span>":b}return c});b.append("td").html(a.data.definition);b.append("td").html(function(){if(0<a.data.uniqueGene){var b='<span class="triggerGL" name="gl'+d+'">'+a.data.uniqueGene+"</span><BR>";b=b+'<span id="gl'+d+'" style="display:none;" >';for(var c=0;c<a.data.uniqueGenes.length;c++){0<c&&(b+=", ");var g=a.data.uniqueGenes[c].id;"undefined"!==typeof that.singleImage.geneList[g]&&(g=that.singleImage.geneList[g]);b+=g}b+="</span>"}else b=
"0";return b})});$("#GoTable .trigger").on("click",function(a){var b=this.getAttribute("name");if($("."+b).is(":hidden"))$("span[name="+b+"]").addClass("less"),$("tr."+b).show();else for(b=parseInt(b.substr(1));0<$("tr.d"+b).length;)$("span[name=d"+b+"]").removeClass("less"),$("tr.d"+b).hide(),b++;a.stopPropagation()});$("#GoTable .triggerGL").on("click",function(a){var b=this.getAttribute("name");$("#"+b).is(":hidden")?($(this).addClass("less"),$("span#"+b).show()):($(this).removeClass("less"),$("span#"+
b).hide());a.stopPropagation()});$("#GoTable").DataTable({bPaginate:!1,bSort:!1,asStripClasses:[],sDom:"f<t>"})};that.singleWGCNAImageEQTLView=function(){var a=that.singleWGCNAImage();$(".linkCTL").hide();$(".mirCTL").hide();$(".goCTL").hide();$(".eqtlCtls").show();a.type="eqtl";a.createToolTip=function(a){var b=that.selectedGene[a];return b.geneSymbol?"<BR>Gene: "+b.geneSymbol+"("+a+")":"<BR>Gene: "+a};a.colorGene=function(a){var b="#DFC184";if(0===a.indexOf("Brain")||0===a.indexOf("Unannotated"))b=
"#7EB5D6";return b};a.displayDefault=function(){d3.select("#viewGene").remove();d3.select("#circos").remove();that.selectedModule&&(a.update(contextRoot+"tmpData/browserCache/"+genomeVer+"/circos/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+"_1/svg/circos_new.svg"),that.singleWGCNATableEQTLView())};a.draw=function(){};a.update=function(b){$.ajax({url:b,type:"GET",data:{},dataType:"html",success:function(b){d3.select("#circos").remove();
d3.select("#wgcnaGeneImage").append("div").attr("id","circos");$("#circos").html(b);$("#circosModule").css("width","100%");$("#circosModule").css("height",Math.floor(.9*window.innerHeight)+"px");a.panZoomCircos=svgPanZoom("#circosModule",{panEnabled:!0,controlIconsEnabled:!1,zoomEnabled:!0,dblClickZoomEnabled:!0,zoomScaleSensitivity:.2,minZoom:.1,maxZoom:4,fit:!0,center:!0});d3.select("#circosModule").selectAll(".circosGene").style("cursor","pointer").on("mouseover",function(){d3.select(this).style("fill",
"#000000").attr("font-size","50px");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).attr("id"))).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)});ga&&ga("send","event","wgcna","mouseOverEQTL")}).on("mouseout",function(){var b=a.colorGene(d3.select(this).attr("id"));d3.select(this).style("fill",b).attr("font-size","26px");tt.transition().duration(500).style("opacity",0)});
that.singleWGCNATableEQTLView()}})};return a};that.singleWGCNATableEQTLView=function(){$("div#waitEqtlTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaGoTable").hide();$("div#wgcnaEqtlTable").show();$("span#eqtlTableName").html(that.selectedModule.MOD_NAME);d3.select("div#tableExportCtl").selectAll("span").remove();d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",
function(){$("#eqtlTable").tableExport({type:"csv",escape:"false"})}).html("Export CSV");$.ajax({url:contextRoot+"tmpData/browserCache/"+genomeVer+"/modules/ds"+that.wDSID+"/"+replaceUnderscore(that.selectedModule.MOD_NAME)+".eQTL.json",type:"GET",async:!0,data:{},dataType:"json",beforeSend:function(){$("div#waitEqtlTable").show()},success:function(a){setTimeout(function(){$.fn.DataTable.isDataTable("table#eqtlTable")&&$("table#eqtlTable").DataTable().destroy();for(var b=[],d=1*$("#eqtlPval").val(),
c="",f=0,e=0;e<a.length;e++)a[e].Pval>=d&&(a[e].Pval>f&&(c=a[e].Snp,f=a[e].Pval),b.push(a[e]));d3.select("#eqtlTable").select("tbody").selectAll("tr").remove();d3.select("#eqtlTable").select("tbody").selectAll("tr").data(b,that.eQTLKey).enter().append("tr").attr("id",function(a){return"tblLink_"+a.Snp}).attr("class",function(a,b){var c="odd";0===b%2&&(c="even");return c}).each(function(a,b){var c=a.Start/1E6;d3.select(this).append("td").html(a.Chr);d3.select(this).append("td").html(c.toFixed(1));
d3.select(this).append("td").html(a.Snp);d3.select(this).append("td").html(a.Pval.toFixed(2))});$("#eqtlTable").DataTable({bPaginate:!1,aaSorting:[[3,"desc"]],sDom:"fi<t>"});$("div#waitEqtlTable").hide();d3.select("#circosModule").select("g#Link_"+c).select("path").style("stroke","#FFF450")},20)},error:function(a,b,d){}})};that.singleWGCNAImageMetaView=function(){var a=that.singleWGCNAImage();$(".goCTL").hide();$(".eqtlCtls").hide();$(".linkCTL").show();a.CorCutoff_min=.75;a.CorCutoff_max=1;a.type=
that.viewType;a.truncated=0;a.filterOneDB=1;a.mirGeneCutoff=1;a.mirValid=0;a.mirTargetID="";a.mirID="";a.miRcolor=d3.scaleOrdinal(d3.schemeCategory20b);a.sortMir=0;a.maxCorWidth=5;a.mlinkKey=function(a){return that.removeInvalidIDChars(a.MOD1)+"_"+that.removeInvalidIDChars(a.MOD2)};a.colorCircle=function(a){return a.COLOR};a.colorLink=function(b){var d=a.negColor;0<b.COR&&(d=a.posColor);return d};a.colorLinkHighlight=function(b){var d=a.negDarkColor;0<b.COR&&(d=a.posDarkColor);return d};a.drawLinks=
function(b){a.updateColor("linkColor");a.svg.selectAll(".link").remove();for(var d=a.metaData.LINKS,c=[],f=0,e=0;e<d.length;e++)(d[e].MOD1===b.MODULE||d[e].MOD2===b.MODULE)&&a.CorCutoff_min<=Math.abs(d[e].COR)&&Math.abs(d[e].COR)<=a.CorCutoff_max&&(c[f]=d[e],f++);d=c;1E4>d.length&&(b=a.topG.selectAll(".link").data(d,a.mlinkKey),b.enter().append("line").attr("class","link").attr("pointer-events","none").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.MOD1)+that.removeInvalidIDChars(a.MOD2)}).attr("x1",
function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cx")}).attr("y1",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cy")}).attr("x2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cx")}).attr("y2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cy")}).attr("stroke",a.colorLink).attr("stroke-width",function(b){return Math.abs(b.COR)*a.maxCorWidth}).merge(b))};a.drawLinksBetween=function(b){a.updateColor("linkColor");
for(var d={},c=0;c<b.length;c++)d[b[c]]=1;a.svg.selectAll(".link").remove();b=a.metaData.LINKS;c=[];for(var f=0,e=0;e<b.length;e++)(0===a.showAllFromTarget&&"undefined"!==typeof d[b[e].MOD1]&&"undefined"!==typeof d[b[e].MOD2]||1===a.showAllFromTarget&&("undefined"!==typeof d[b[e].MOD1]||"undefined"!==typeof d[b[e].MOD2]))&&a.CorCutoff_min<=Math.abs(b[e].COR)&&Math.abs(b[e].COR)<=a.CorCutoff_max&&(c[f]=b[e],f++);b=c;1E4>b.length&&(d=a.topG.selectAll(".link").data(b,a.mlinkKey),d.enter().append("line").attr("class",
"link").attr("pointer-events","none").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.MOD1)+that.removeInvalidIDChars(a.MOD2)}).attr("x1",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cx")}).attr("y1",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cy")}).attr("x2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cx")}).attr("y2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cy")}).attr("stroke",
a.colorLink).attr("stroke-width",function(b){return Math.abs(b.COR)*a.maxCorWidth}).merge(d))};a.nodeX=function(b,d){var c=50,f=Math.floor(d/a.maxPerLevel)+1;1<f&&(c=60*f);return a.width/2+(a.r-c)*Math.cos(d%a.maxPerLevel*a.angle-1.57079633)};a.nodeY=function(b,d){var c=50;d>a.maxPerLevel&&(c=60*(Math.floor(d/a.maxPerLevel)+1));return a.height/2+(a.r-c)*Math.sin(d%a.maxPerLevel*a.angle-1.57079633)};a.nodeXLbl=function(b,d){var c=d%a.maxPerLevel*a.angle-1.57079633,f=1;if(Math.PI/2<c&&c<1.5*Math.PI){var e=
0;"undefined"!==typeof b.MODULE&&(e=b.MODULE.length);f+=7.5*e}return a.width/2+(a.r+f)*Math.cos(c)};a.nodeYLbl=function(b,d){var c=d%a.maxPerLevel*a.angle-1.57079633,f=1;if(Math.PI/2<c&&c<1.5*Math.PI){var e=0;"undefined"!==typeof b.MODULE&&(e=b.MODULE.length);f+=7.5*e}return a.height/2+(a.r+f)*Math.sin(c)};a.drawCorLegend=function(b){a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b).text("Positive Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",b-10).attr("width",
"30").attr("height","10").style("fill",a.posColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+20).text("Negative Correlation");a.legendDispG.append("rect").attr("x","0").attr("y",b+10).attr("width","30").attr("height","10").style("fill",a.negColor);a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+40).text("Lower Correlation");a.legendDispG.append("line").attr("x1","0").attr("y1",b+30).attr("x2","30").attr("y2",b+30).style("stroke",
"#000000").style("stroke-width","0");a.legendDispG.append("line").attr("x1","0").attr("y1",b+35).attr("x2","30").attr("y2",b+35).style("stroke","#000000").style("stroke-width","0.5");a.legendDispG.append("line").attr("x1","0").attr("y1",b+40).attr("x2","30").attr("y2",b+40).style("stroke","#000000").style("stroke-width","1");a.legendDispG.append("line").attr("x1","0").attr("y1",b+45).attr("x2","30").attr("y2",b+45).style("stroke","#000000").style("stroke-width","2");a.legendDispG.append("line").attr("x1",
"0").attr("y1",b+55).attr("x2","30").attr("y2",b+55).style("stroke","#000000").style("stroke-width","3");a.legendDispG.append("line").attr("x1","0").attr("y1",b+65).attr("x2","30").attr("y2",b+65).style("stroke","#000000").style("stroke-width","5");a.legendDispG.append("line").attr("x1","0").attr("y1",b+75).attr("x2","30").attr("y2",b+75).style("stroke","#000000").style("stroke-width","7");a.legendDispG.append("text").style("font-size","16").attr("x","35").attr("y",b+80).text("Higher Correlation")};
a.drawLegend=function(){a.drawCorLegend(20)};a.selectMetaMod=function(a){that.topselectedModule=that.selectedModule;that.selectedModule=that.modules[a];that.topselectedGene=that.selectedGene;that.selectedGene={};for(a=0;a<that.selectedModule.TCList.length;a++)"undefined"===typeof that.selectedGene[that.selectedModule.TCList[a].Gene.ID]&&(that.selectedGene[that.selectedModule.TCList[a].Gene.ID]={},that.selectedGene[that.selectedModule.TCList[a].Gene.ID].geneSymbol=that.selectedModule.TCList[a].Gene.geneSymbol,
that.selectedGene[that.selectedModule.TCList[a].Gene.ID].tcList=[]),that.selectedGene[that.selectedModule.TCList[a].Gene.ID].tcList.push(that.selectedModule.TCList[a]);that.viewType="gene";d3.select("#wgcnaGeneViewRB").property("checked",!0);that.createSingleWGCNAImage()};a.draw=function(){a.updateColor("linkColor");a.width=$(window).width();a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2*.95):Math.floor(a.height/2*.95);a.svg.attr("height",a.height+"px");a.svg.selectAll("circle").remove();
a.svg.selectAll("text").remove();a.svg.selectAll("line").remove();a.svg.selectAll(".mod").remove();"undefined"!==typeof a.panZoom&&(a.panZoom.destroy(),delete a.panZoom);a.svg.selectAll(".svg-pan-zoom_viewport").remove();setTimeout(function(){a.svg.append("text").style("font-size","20").attr("y",22).attr("x",5).text(function(){return that.selectedModule?"Meta Module for "+replaceUnderscore(that.selectedModule.MOD_NAME):""});a.setupLegend();a.data=a.metaData.MODULES;a.angle=2*Math.PI/a.data.length;
a.angleDeg=360/a.data.length;a.data.length>a.maxPerLevel&&(a.angle=2*Math.PI/a.maxPerLevel,a.angleDeg=360/a.maxPerLevel);if(150<a.data.length){a.truncated=1;a.maxNodeR=15;for(var b=[],d=0;150>d;d++)b[d]=a.data[d];a.data=b;a.dataIndex={};for(d=0;d<a.data.length;d++)a.dataIndex[a.data[d].ID]=1;a.CorCutoff_min=.75;$("#linkSliderMin").slider("value",.75);$("span#minLabel").html(.75);a.svg.append("image").attr("x",7.8*that.selectedModule.MOD_NAME.length+20).attr("y",1).attr("width","24px").attr("height",
"24px").attr("xlink:href","data:image/png;base64,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").attr("pointer-events",
"all").style("cursor","pointer").on("mouseover",function(){$("#wgcnaMouseHelp").html("Warning: Modules displayed are truncated to the top 150 most connected modules due to the size of the meta module.")}).on("mouseout",function(){$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}else a.maxNodeR=28;a.topG=a.svg.append("g").attr("class","svg-pan-zoom_viewport");b=a.topG.selectAll(".mod").data(a.data,a.modKey);b.enter().append("circle").attr("class",
"mod").attr("id",function(a){return"mod_"+that.removeInvalidIDChars(a.MODULE)}).attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",3).attr("stroke","#000000").attr("fill","#FF0000").merge(b);b=a.metaData.LINKS;d=[];for(var c=0,f=0;f<b.length;f++)a.CorCutoff_min<=Math.abs(b[f].COR)&&Math.abs(b[f].COR)<=a.CorCutoff_max&&(0===a.truncated||"undefined"!==typeof a.dataIndex[b[f].MOD1]&&"undefined"!==typeof a.dataIndex[b[f].MOD2])&&(d[c]=b[f],c++);b=d;a.showLinks&&1E4>b.length&&(b=a.topG.selectAll(".link").data(b,
a.mlinkKey),b.enter().append("line").attr("class","link").attr("id",function(a){return"ln_"+that.removeInvalidIDChars(a.MOD1)+that.removeInvalidIDChars(a.MOD2)}).attr("x1",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cx")}).attr("y1",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD1)).attr("cy")}).attr("x2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cx")}).attr("y2",function(a){return d3.select("#mod_"+that.removeInvalidIDChars(a.MOD2)).attr("cy")}).attr("stroke",
a.colorLink).attr("stroke-width",function(b){return Math.abs(b.COR)*a.maxCorWidth}).merge(b));a.topG.selectAll(".mod").remove();b=a.topG.selectAll(".mod").data(a.data,a.geneKey);b.enter().append("g").append("circle").attr("cx",a.nodeX).attr("cy",a.nodeY).attr("r",20).attr("stroke","#000000").attr("fill",a.colorCircle).attr("class",function(a){return"mod "+that.removeInvalidIDChars(a.MODULE)}).attr("id",function(a){return"mod_"+that.removeInvalidIDChars(a.MODULE)}).on("click",function(b){console.log("request"+
b.MODULE);that.moduleGenes[b.MODULE]||(that.moduleGenes[b.MODULE]="",that.requestModule(b.MODULE,a.selectMetaMod))}).on("mouseover",a.mouseoverModule).on("mouseout",a.mouseleaveModule).merge(b).each(function(b,c){d3.select(this.parentNode).append("g").attr("class","label").attr("id",function(a){return"txt_"+that.removeInvalidIDChars(a.MODULE)}).attr("transform",function(){var d=a.nodeXLbl(b,c),e=a.nodeYLbl(b,c);return"translate("+d+","+e+")"}).append("text").attr("transform",function(){var b=-90+
c%a.maxPerLevel*a.angleDeg;90<b&&(b-=180);return"rotate("+b+")"}).text(function(){return b.MODULE})});b.exit().remove()},250)};a.requestMeta=function(){$.ajax({url:pathPrefix+"getWGCNAMetaModules.jsp",type:"GET",async:!0,data:{source:that.selSource,id:replaceUnderscore(that.selectedModule.MOD_NAME),organism:organism,panel:that.panel,tissue:that.tissue,region:that.region,geneList:that.geneList,genomeVer:genomeVer},dataType:"json",success:function(b){setTimeout(function(){a.metaData=b[0];a.draw()},
50)},error:function(b,d,c){setTimeout(function(){a.requestMeta()},2E3)}})};a.mouseoverModule=function(){$("#wgcnaMouseHelp").html("<B>Click</B> to select this module and see additional details.");d3.select(this).style("fill","url(#selectGrad)");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(d3.select(this).datum())).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)});var b=d3.select(this.parentNode).datum();
$("[id^=ln_"+that.removeInvalidIDChars(b.MODULE)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLinkHighlight)});$("[id$="+that.removeInvalidIDChars(b.MODULE)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLinkHighlight)});a.showLinks||a.drawLinks(b);d3.select("#txt_"+that.removeInvalidIDChars(b.MODULE)).select("text").attr("fill","#00A347");ga&&ga("send","event","wgcna","mouseOverModule")};a.mouseleaveModule=function(){var b=
d3.select(this.parentNode).datum();$("[id^=ln_"+that.removeInvalidIDChars(b.MODULE)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLink)});$("[id$="+that.removeInvalidIDChars(b.MODULE)+"]").each(function(){var b=$(this).attr("id");d3.select("line#"+b).attr("stroke",a.colorLink)});d3.select(this).style("fill",a.colorCircle);d3.select("#txt_"+that.removeInvalidIDChars(b.MODULE)).select("text").attr("fill","#000000");tt.transition().duration(500).style("opacity",
0);a.showLinks||a.svg.selectAll(".link").remove();"mir"===that.viewType&&(a.mirTargetID=$("#mirGeneFilterTxt").val().toLowerCase(),a.svg.selectAll(".mirLink").remove(),that.singleImage.drawMiR())};a.createToolTip=function(a){return"Module: "+a.MODULE};return a};that.singleWGCNATableMetaView=function(){$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaGoTable").hide();$("div#wgcnaEqtlTable").hide()};return that};