var tt=d3.select("body").append("div").attr("class","testToolTip").style("z-index",1001).attr("pointer-events","all").style("opacity",0);function removeColon(q){return q.replace(/:/g,"")}$(window).resize(function(){0!==goBrwsr&&(goBrwsr.singleImage.resize(),goBrwsr.singleImage.draw())});
function GOBrowser(q,t){that={};that.path=q;that.fileName=t;that.setup=function(){console.log("setup");that.createImageControls();that.createDataControls();$(".wgcnaControltooltip").tooltipster({position:"top-right",maxWidth:250,offsetX:5,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});setTimeout(function(){console.log("start settimeout setup");that.singleImage=that.singleWGCNAImageGoView();that.singleImage.goDomain=$("#goDomainSelect").val();that.singleImage.draw();that.img=
that.singleImage;console.log("end settimeout setup")},100)};that.positionTTLeft=function(a){a+=20;a>$(window).width()/2&&(a-=250);return a+"px"};that.positionTTTop=function(a){a+="px";d3.event.clientY>.6*window.innerHeight&&(a=d3.event.pageY-2.2*$(".testToolTip").height()+"px");return a};that.createImageControls=function(){that.imageBar=d3.select("#imageControl").append("span").style("float","left");that.imageBar.append("span").attr("class","saveImage control").style("display","inline-block").attr("id",
"saveImage").style("cursor","pointer").append("img").attr("src",contextRoot+"web/images/icons/savePic_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var a="";if(that.singleImage){"eqtl"===that.viewType&&"eqtl"===that.singleImage.type?a=$("div#circos").html():"gene"===that.viewType&&"gene"===that.singleImage.type?a=$("div#viewGene").html():"mir"===that.viewType&&"mir"===that.singleImage.type?a=$("div#viewGene").html():"go"===that.viewType&&"go"===that.singleImage.type&&
(a=$("div#viewGene").html());var d=$(window).width();a=a.replace('width="100%"','width="'+d+'px"');$.ajax({url:pathPrefix+"saveBrowserImage.jsp",type:"POST",contentType:"text/html",data:a+"\n",processData:!1,dataType:"json",success:function(a){var b=new Date;b=b.getMonth()+1+"_"+b.getDate()+"_"+b.getFullYear();var c="http://";"https:"===location.protocol&&(c="https://");var m=c+urlprefix+"/tmpData/download/"+a.imageFile,e="_"+that.viewType+"_"+b+".png",d=new XMLHttpRequest;d.open("GET",m);d.responseType=
"blob";d.send();d.onreadystatechange=function(){if(4!=d.readyState||200!=d.status)return!1;var a=document.createElement("a");a.href=window.URL.createObjectURL(d.response);a.download=e;a.style.display="none";document.body.appendChild(a);try{a.click()}catch(h){$("#wgcnaMouseHelp").html("<span style='color:#FF0000;'>Your browser will not save the image directly. Image will open in a popup, in the new window right click to save image.</span>"),window.open(m)}return!0}},error:function(a,b,k){console.log(k)}})}}).on("mouseover",
function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_white.png");$("#wgcnaMouseHelp").html("Click to download a PNG image of the current view.")}).on("mouseout",function(){d3.select(this).attr("src",contextRoot+"web/images/icons/savePic_dark.png");$("#wgcnaMouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})};that.createDataControls=function(){that.dataBar=d3.select("#dataControl").append("span").attr("id","wgcnaDataControls").style("margin-left",
"10px").style("margin-right","5px").append("table").append("tr");var a=that.dataBar.append("td").append("div").attr("id","goCtls").attr("class","goCTL").style("display","none").style("margin-left","10px");a.append("text").text("GO Domain:");sel=a.append("select").attr("id","goDomainSelect").on("change",function(){that.singleImage.goDomain=$("#goDomainSelect").val();that.singleImage.draw()});sel.append("option").attr("value","cc").text("Cellular Component");sel.append("option").attr("value","bp").text("Biological Process");
sel.append("option").attr("selected","selected").attr("value","mf").text("Molecular Function");a.append("text").style("padding-left","15px").text("Number of Levels to Display:");a.append("input").attr("name","value").attr("id","goSpinner");$("#goSpinner").spinner({min:1,max:100,step:1,change:function(a,c){that.singleImage.displayDepth=c.value;that.singleImage.selectedNode!==that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&that.singleImage.selectedNode!==
that.singleImage.data.GOList[2]?that.singleImage.redraw():that.singleImage.draw();ga&&ga("send","event","gl_WGCNA_go","changeDepth")},spin:function(a,c){that.singleImage.displayDepth=c.value;that.singleImage.selectedNode!==that.singleImage.data.GOList[0]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[1]&&that.singleImage.selectedNode!==that.singleImage.data.GOList[2]?that.singleImage.redraw():that.singleImage.draw();ga&&ga("send","event","gl_WGCNA_go","changeDepth")}}).val(3)};that.singleWGCNAImage=
function(){var a={},d=0;1E3<$(window).width()&&(d=400);a.width=$(window).width()-d;a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2):Math.floor(a.height/2);a.maxPerLevel=150;a.CorCutoff_min=.75;a.CorCutoff_max=1;a.showLinks=!0;a.data=[];a.maxNodeR=28;a.negColor="#DD0000";a.negDarkColor="#770000";a.posColor="#00DD00";a.posDarkColor="#007700";a.mirVal="#FFFF00";a.mirPred="#0000CC";0===d3.select("#singleWGCNASVG").size()?a.svg=d3.select("#wgcnaGeneImage").append("div").attr("id",
"viewGene").append("svg").attr("id","singleWGCNASVG").attr("height",a.height+"px").attr("width","100%"):a.svg=d3.select("#singleWGCNASVG");a.geneKey=function(a){return a.ID};a.linkKey=function(a){return a.TC1+"_"+a.TC2};a.calcX=function(c,b){return b%a.modPerLine*a.calcWidth};a.calcY=function(c,b){return Math.floor(b/a.modPerLine)*a.maxWidth};a.sizing=function(c){c=a.size(c.TCList.length);c>a.maxWidth/2&&(c=a.maxWidth/2);return c};a.resize=function(){var c=0;1E3<$(window).width()&&(c=400);a.width=
$(window).width()-c;a.height=Math.floor(.9*window.innerHeight);a.r=a.height>a.width?Math.floor(a.width/2):Math.floor(a.height/2)};a.colorCircle=function(a){a=a.Gene.ID;var b="#DFC184";if(0==a.indexOf("Brain")||0==a.indexOf("Unannotated"))b="#7EB5D6";return b};a.colorLink=function(c){var b=a.negColor;0<c.Cor&&(b=a.posColor);return b};a.colorLinkHighlight=function(c){var b=a.negDarkColor;0<c.Cor&&(b=a.posDarkColor);return b};a.updateColor=function(c){c=$("#"+c).val();"Red_Green"===c?(a.posColor="#DD0000",
a.posDarkColor="#770000",a.negColor="#00DD00",a.negDarkColor="#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC"):"Blue_Yellow"===c?(a.posColor="#0000DD",a.posDarkColor="#000077",a.negColor="#ffef16",a.negDarkColor="#b7ae2a",a.mirVal="#FF9C2A",a.mirPred="#BA49FF"):(a.negColor="#DD0000",a.negDarkColor="#770000",a.posColor="#00DD00",a.posDarkColor="#007700",a.mirVal="#FFFF00",a.mirPred="#0000CC")};a.nodeRadiusSum=function(c,b){var k=3+20*c.LinkSum;k>a.maxNodeR&&(k=a.maxNodeR);return k};a.zoomIn=function(){a.maxWidth<
$(window).width()/2&&(a.maxWidth*=2,a.draw())};a.zoomOut=function(){var c=a.maxWidth;a.maxWidth=Math.floor(a.maxWidth/2);25>a.maxWidth?a.maxWidth=c:a.draw()};a.draw=function(){};a.redraw=function(){};a.setupLegend=function(){a.svg.select("#legend").remove();a.svg.select("#legendDisp").remove();a.legendG=a.svg.append("g").attr("id","legend").attr("transform","translate(10,60)").style("cursor","pointer").on("mouseover",function(){a.legendDispG.transition().duration(300).style("opacity",1)}).on("mouseleave",
function(){a.legendDispG.transition().duration(300).style("opacity",0)});a.legendG.append("image").attr("x",0).attr("y",-20).attr("width","24px").attr("height","24px").attr("xlink:href","data:image/png;base64,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");
a.legendG.append("text").attr("x","25").style("font-size","18").text("Legend");a.legendDispG=a.svg.append("g").attr("id","legendDisp").attr("transform","translate(10,70)").style("opacity",1);a.drawLegend();setTimeout(function(){a.legendDispG.transition().duration(750).style("opacity",0)},8E3)};a.drawLegend=function(){};a.createToolTip=function(a){var b="Gene: "+a.Gene.geneSymbol+" ("+a.Gene.ID+")<BR><BR>Transcript:"+a.ID+"<BR>";b=b+"<BR>Link Count:"+a.LinkCount;b=b+"<BR>Link Sum:"+a.LinkSum.toFixed(2);
var k=that.selectedGene[a.Gene.ID].tcList;if(1<k.length){"<BR><BR>Additional Transcripts in this Module:<BR>";k=that.selectedGene[a.Gene.ID].tcList;for(var d=0;d<k.length;d++)k[d].ID!==a.ID&&(b=b+k[d].ID+"<BR>")}return b=b+"<BR><BR>"+a.PSList.length+" Probe Sets in Transcript<BR>"};return a};that.singleWGCNAImageGoView=function(){var a=that.singleWGCNAImage();$(".goCTL").show();$(".linkCTL").hide();$(".mirCTL").hide();$(".eqtlCtls").hide();a.type=that.viewType;a.goDomain="mf";a.lastDrawn="mf";a.selectedNode;
a.displayedLevel="d1";var d=0;1E3<$(window).width()&&(d=400);a.width=$(window).width()-d;a.height=Math.floor(.92*window.innerHeight);a.padding=5;a.radius=(Math.min(a.width,a.height)-2*a.padding)/2;a.duration=1E3;a.xScale=d3.scaleLinear().range([0,2*Math.PI]);a.yScale=d3.scalePow().exponent(1.3).domain([0,1]).range([0,a.radius]);a.colorGO=d3.scaleOrdinal(d3.schemeCategory20);a.displayDepth=3;a.geneList={};d=[];if(that.selectedModule){d=that.selectedModule.TCList;for(var c=0;c<d.length;c++)a.geneList[that.selectedModule.TCList[c].Gene.ID]=
that.selectedModule.TCList[c].Gene.geneSymbol}a.pathColor=function(b){return b&&b.data?b.data.name&&0==b.data.name.indexOf("ENS")?"#DFC184":b.data.name?a.colorGO(b.data.name):"#000000":b&&b.name&&0==b.name.indexOf("ENS")?"#DFC184":b&&b.name?a.colorGO(b.name):"#000000"};a.addLabels=function(b,k,d,e,c,p,h){p=a.radius/(h+1)*b.depth+a.radius/(h+1)-12;var m=a.radius/(h+1)*b.depth,g=(c-d)/360*Math.PI*m*2;h=Math.floor((c-d)/360*Math.PI*p*2/7)-1;p=Math.floor((p-m)/12);var f=b.data.name;0===b.data.name.indexOf("ENS")&&
"undefined"!==typeof a.geneList[f]&&(f=a.geneList[f],25<c-d&&(f=f+" ("+b.data.name+")"));var l=f.split(" ")[0].split("-")[0];if(l.length<=h||-1===b.data.name.indexOf("ENS")&&l.length/2<=h&&10<c-d){g=[];l=0;if(f.length>h)for(;0<f.length;){var n=f.indexOf(" ");if(-1===n)f.length>h?(g[l]=f.substr(0,h),l++,f=f.substr(h)):(g[l]=f,l++,f="");else{for(var q=0;n<h&&1>q;){var r=f.indexOf(" ",n+1);-1!==r&&r<=h?n=r:q=1}n>h?-1<f.indexOf("-")&&f.indexOf("-")<h?(n=f.indexOf("-"),g[l]=f.substr(0,n+1),l++,f=f.substr(n+
1)):(g[l]=f.substr(0,h),l++,f=f.substr(h)):(g[l]=f.substr(0,n),l++,f=f.substr(n+1))}}else g[l]=f;l=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(b.data.id)).attr("text-anchor",function(a){return"start"}).attr("dy","1em").style("opacity",function(a){return 1}).append("textPath").attr("xlink:href",function(a){return"#ap"+k}).attr("startOffset",function(a){return 0===d&&360===c?90:5});for(b=0;b<g.length&&b<p;b++)b<p&&(b===
p-1&&g.length>p&&(g[b]+="...",g[b].length>h&&(g[b]=g[b].substr(0,h-4)+"...")),l.append("tspan").attr("x",0).attr("dy","1em").text(g[b]))}else if(12<=g&&0===b.data.name.indexOf("ENS"))for(l=a.topG.append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("class","txt"+removeColon(b.data.id)).attr("text-anchor",function(a){a="start";180<=c&&(a="end");return a}).attr("dy",".2em").attr("transform",function(a){a=e-2.5;var b=m;0===d&&360===c&&(b=20);180<=c&&(a=e+2.5);
return"rotate("+(a-90)+")translate("+b+")rotate("+(180<a?-180:0)+")"}).style("opacity",function(a){return 1}),f=b.data.name,0===b.data.name.indexOf("ENS")&&"undefined"!==typeof a.geneList[f]&&(f=a.geneList[f]),h=f.split(" "),b=0;b<h.length;b++)l.append("tspan").attr("x",0).attr("dy","1em").text(h[b])};a.redraw=function(){a.svg.selectAll("path").remove();a.svg.select("#center").remove();var b=a.partition(a.rootN).descendants().filter(a.filterNodes),k=a.displayDepth;a.arc=d3.arc().startAngle(function(a){return Math.max(0,
Math.min(2*Math.PI,a.x0))}).endAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.x1))}).innerRadius(function(b){return b===a.selectedNode&&a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2]?20:Math.max(0,a.radius/(k+1)*(b.depth-a.rootN.depth))}).outerRadius(function(b){return Math.max(0,a.radius/(k+1)*(b.depth-a.rootN.depth)+a.radius/(k+1))});a.topG.selectAll("path").remove();a.topG.selectAll("text").remove();var d=180/Math.PI;a.path=a.topG.selectAll("path").data(b);
a.path.enter().append("path").merge(a.path).attr("d",a.arc).attr("id",function(a,b){return"ap"+b}).attr("class",function(a,b){return removeColon(a.data.id)}).attr("fill-rule","evenodd").attr("fill",a.pathColor).attr("pointer-events","all").on("mouseover",a.mouseover).on("click",a.click).each(function(b,c){if(b.depth<a.rootN.depth+a.displayDepth){var e=Math.max(0,Math.min(2*Math.PI,b.x0))*d,m=Math.max(0,Math.min(2*Math.PI,b.x1))*d,g=e+(m-e)/2;0===e&&360===m&&(g=90);a.addLabels(b,c,e,g,m,b.depth-a.rootN.depth,
k)}});if(a.selectedNode!==a.data.GOList[0]&&a.selectedNode!==a.data.GOList[1]&&a.selectedNode!==a.data.GOList[2])a.svg.append("circle").attr("id","center").attr("cx",a.width/2+a.padding).attr("cy",a.height/2+a.padding).attr("r","20").attr("fill-rule","evenodd").attr("fill",function(){return a.pathColor(a.rootN.parent)}).attr("pointer-events","all").on("click",function(){if(a.rootN.parent.data===a.data.GOList[0]||a.rootN.parent.data===a.data.GOList[1]||a.rootN.parent.data===a.data.GOList[2])a.selectedNode=
null,a.draw();else{if(a.rootN.parent.data!==a.data.GOList[0]&&a.rootN.parent.data!==a.data.GOList[1]&&a.rootN.parent.data!==a.data.GOList[2])a.selectedNode=a.rootN.parent.data,a.rootN=a.rootN.parent,a.mouseover(a.rootN.parent);else{var b=a.data.GOList[0];"mf"===a.goDomain?b=a.data.GOList[2]:"bp"===a.goDomain&&(b=a.data.GOList[1]);a.selectedNode=b}a.redraw();d3.event.stopPropagation();ga&&ga("send","event","wgcna","mouseClickGO")}}).on("mouseover",function(b){"undefined"!==typeof a.selectedNode&&a.selectedNode.parent!==
a.data.GOList[0]&&a.selectedNode.parent!==a.data.GOList[1]&&a.selectedNode.parent!==a.data.GOList[2]?a.mouseover(a.selectedNode.parent):(tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(a.selectedNode)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)}));d3.event.stopPropagation();ga&&ga("send","event","wgcna","mouseOverGO")}).on("mouseleave",function(a){tt.transition().duration(200).style("opacity",
0)})};a.getModuleGOFile=function(b){$.ajax({url:that.path+that.fileName,type:"GET",async:!0,data:{},dataType:"json",success:function(b){$("#waitCircos").hide();a.data=b;console.log(a.data);console.log(a.data.GOList[0]);b=a.data.GOList[0];for(var d=0,e=0;e<b.length;e++)b[e].UnqID=d,console.log(b[e]),d++;b=a.data.GOList[1];for(e=0;e<b.length;e++)b[e].UnqID=d,d++;b=a.data.GOList[2];for(e=0;e<b.length;e++)b[e].UnqID=d,d++;a.resize();a.draw()},error:function(d,c,e){console.log(e);25>b&&setTimeout(function(){a.getModuleGOFile(b+
1)},1E3)}})};a.draw=function(){a.svg.attr("width",a.width).attr("height",a.height);a.initializeBreadcrumbTrail();a.topG=a.svg.append("g").attr("transform","translate("+[a.width/2+a.padding,a.height/2+a.padding]+")");a.partition=d3.partition().size([2*Math.PI,a.radius]);if(a.data.GOList){if(a.goDomain!==a.lastDrawn||"undefined"===typeof a.selectedNode||null===a.selectedNode){var b=a.data.GOList[0];"mf"===a.goDomain?b=a.data.GOList[2]:"bp"===a.goDomain&&(b=a.data.GOList[1]);a.selectedNode=b;a.rootN=
d3.hierarchy(b).sum(function(a){return a&&a.name&&-1<a.name.indexOf("ENS")?1:a.uniqueGene}).sort(function(a,b){return b.value-a.value})}b=a.partition(a.rootN).descendants().filter(a.filterNodes);a.lastDrawn=a.goDomain;if(a.selectedNode===a.data.GOList[0]||a.selectedNode===a.data.GOList[1]||a.selectedNode===a.data.GOList[2])a.totalSize=a.selectedNode.uniqueGene;var d=a.displayDepth;a.arc=d3.arc().startAngle(function(a){return Math.max(0,Math.min(2*Math.PI,a.x0))}).endAngle(function(a){return Math.max(0,
Math.min(2*Math.PI,a.x1))}).innerRadius(function(b){return Math.max(0,a.radius/(d+1)*b.depth)}).outerRadius(function(b){return Math.max(0,a.radius/(d+1)*b.depth+a.radius/(d+1))});setTimeout(function(){that.singleWGCNATableGoView()},50);a.vis=a.topG.append("svg:circle").attr("r",a.radius+30).style("opacity",0).on("mouseover",a.mouseleave);var c=180/Math.PI;a.path=a.topG.selectAll("path").data(b);a.path.enter().append("path").attr("d",a.arc).attr("id",function(a,b){return"ap"+b}).attr("fill-rule","evenodd").attr("fill",
a.pathColor).attr("pointer-events","all").on("mouseover",a.mouseover).on("click",a.click).each(function(b,k){var e=Math.max(0,Math.min(2*Math.PI,b.x0))*c,m=Math.max(0,Math.min(2*Math.PI,b.x1))*c,g=e+(m-e)/2;0===e&&360===m&&(g=90);a.addLabels(b,k,e,g,m,b.depth-a.rootN.depth,d)});a.path.exit().remove();a.svg.append("g").attr("transform","translate(0,15)").append("text").style("fill-opacity",1).style("fill","#000").attr("pointer-events","none").attr("text-anchor","start").style("opacity",function(a){return 1}).text(a.selectedNode.uniqueGene+
" genes in module with GO annotation")}else a.getModuleGOFile()};a.filterNodes=function(b,d){return b.depth<a.rootN.depth+a.displayDepth?!0:!1};a.click=function(b){a.selectedNode=b.data;a.rootN=b;b.data!==a.data.GOList[0]&&b.data!==a.data.GOList[1]&&b.data!==a.data.GOList[2]?a.redraw():a.draw();d3.event.stopPropagation()};a.mouseover=function(b){if("undefined"!==typeof b&&null!==b){var d=a.data.GOList[0];"mf"===a.goDomain?d=a.data.GOList[2]:"bp"===a.goDomain&&(d=a.data.GOList[1]);var c=0;c="undefined"!==
typeof b&&"undefined"!==typeof b.data.value?(100*b.data.value/d.uniqueGene).toPrecision(3):"undefined"!==typeof b?(100*b.data.uniqueGene/d.uniqueGene).toPrecision(3):100;d=c+"%";.1>c&&(d="< 0.1%");"undefined"!==typeof b.data.name&&-1===b.data.name.indexOf("ENS")&&(d=b.data.uniqueGene+" genes ("+d+")");d3.select("#percentage").text(d);d3.select("#explanation").style("visibility","");var e=a.getAncestors(b);a.updateBreadcrumbs(e,d);d3.selectAll("path").style("opacity",.3);a.topG.selectAll("text").style("opacity",
.3);a.topG.selectAll("path").filter(function(a){return 0<=e.indexOf(a)}).style("opacity",1).each(function(b){a.topG.selectAll(".txt"+removeColon(b.data.id)).style("opacity",1)});a.topG.selectAll("."+removeColon(b.data.id)).style("opacity",1);tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(b)).style("left",function(){return that.positionTTLeft(d3.event.pageX)}).style("top",function(){return that.positionTTTop(d3.event.pageY)})}d3.event.stopPropagation()};a.createToolTip=function(b){b.data&&
(b=b.data);var d="Name:"+b.name+" ("+b.id+")<BR><BR>Definition: "+b.definition+"<BR><BR>Unique Genes in this module with this term: "+b.uniqueGene+"<BR>";if(0<b.uniqueGene)for(var c=0;c<b.uniqueGenes.length;c++){0<c&&(d+=", ");var e=b.uniqueGenes[c].id;"undefined"!==typeof a.geneList[e]&&(e=a.geneList[e]);d+=e}return d};a.mouseleave=function(a){d3.select("#trail").style("visibility","hidden");d3.selectAll("text").style("opacity",1);d3.selectAll("path").transition().duration(500).style("opacity",1);
d3.select("#explanation").style("visibility","hidden");tt.transition().duration(200).style("opacity",0)};a.getAncestors=function(a){for(var b=[];a.parent;)b.unshift(a),a=a.parent;return b};a.isParentOf=function(b,d){return b===d?!0:b.children?b.children.some(function(b){return a.isParentOf(b,d)}):!1};a.b={w:250,h:30,s:3,t:10,runW:0,runH:0};a.initializeBreadcrumbTrail=function(){d3.select("#singleWGCNASVG").remove();d3.select("#trail").remove();d3.select("#viewGene").append("svg:svg").attr("width",
a.width).attr("height",68).attr("id","trail").append("svg:text").attr("id","endlabel").style("fill","#000");a.svg=d3.select("#viewGene").append("svg").attr("id","singleWGCNASVG").attr("height",a.height+"px").attr("width","100%")};a.breadcrumbPoints=function(b,d){var c=7.5*b.data.name.length+25,e=[];e.push("0,0");e.push(c+",0");e.push(c+a.b.t+","+a.b.h/2);e.push(c+","+a.b.h);e.push("0,"+a.b.h);0<d&&e.push(a.b.t+","+a.b.h/2);return e.join(" ")};a.updateBreadcrumbs=function(b,d){var c=d3.select("#trail").selectAll("g").data(b,
function(a){return a.data.name+a.depth});c.exit().remove();a.b.runW=0;a.b.runH=0;c=c.enter().append("svg:g").merge(c).attr("transform",function(b,d){var c=7.5*b.data.name.length+25,e=a.b.runW;e+c>a.width&&(e=0,a.b.runH=a.b.runH+a.b.h+a.b.s,a.b.runW=0);a.b.runW=a.b.runW+c+a.b.s;return"translate("+e+", "+a.b.runH+")"});c.append("svg:polygon").attr("points",a.breadcrumbPoints).style("fill",a.pathColor);c.append("svg:text").attr("x",function(b){return(7.5*b.data.name.length+25+a.b.t)/2}).attr("y",a.b.h/
2).attr("dy","0.35em").attr("text-anchor","middle").text(function(b){b=b.data.name;0===b.indexOf("ENS")&&"undefined"!==typeof a.geneList[b]&&(b=a.geneList[b]);return b});d3.select("#trail").select("#endlabel").attr("x",a.b.runW+15).attr("y",a.b.h/2+a.b.runH).attr("dy","0.35em").attr("text-anchor","start").text(d);d3.select("#trail").attr("height",function(){var b=a.b.runH+a.b.h+5;68>b&&(b=68);return b}).style("visibility","")};return a};that.flattenTree=function(a,d){-1===d.data.name.indexOf("ENS")&&
a.push(d);if(d.children)for(var c=0;c<d.children.length;c++)that.flattenTree(a,d.children[c])};that.singleWGCNATableGoView=function(){$("div#waitGoTable").hide();$("div#wgcnaModuleTable").hide();$("div#wgcnaMirTable").hide();$("div#wgcnaMirGeneTable").hide();$("div#wgcnaEqtlTable").hide();$("div#wgcnaGoTable").show();d3.select("div#tableExportCtl").selectAll("span").remove();d3.select("div#tableExportCtl").append("span").attr("class","button").style("margin-right","10px").on("click",function(){$("#GoTable").tableExport({type:"csv",
escape:"false"})}).html("Export CSV");$.fn.DataTable.isDataTable("table#GoTable")&&$("table#GoTable").DataTable().destroy();d3.select("#GoTable").select("tbody").selectAll("tr").remove();var a=[];that.flattenTree(a,that.singleImage.rootN);a=d3.select("#GoTable").select("tbody").selectAll("tr").data(a,function(a,c){return c});a.exit().remove();a.enter().append("tr").style("background-color",that.singleImage.pathColor).style("display",function(a){var d="none";a.depth<=that.singleImage.rootN.depth?d=
"":a.depth===that.singleImage.rootN.depth+1&&(d="");return d}).style("cursor","pointer").merge(a).attr("id",function(a){return a.id}).attr("class",function(a){return" d"+a.depth}).on("mouseover",function(a){d3.select(this).style("background-color","#FFFFFF");ga&&ga("send","event","wgcna","mouseOverGOTbl")}).on("mouseleave",function(a){d3.select(this).style("background-color",that.singleImage.pathColor(a))}).on("click",function(a){that.singleImage.selectedNode=a.data;that.singleImage.rootN=a;$("span[name=d"+
a.depth+"]").addClass("less");$("tr.d"+a.depth).show();that.singleImage.redraw();ga&&ga("send","event","wgcna","mouseClickGOTbl")}).each(function(a,c){var b=d3.select(this);b.append("td").style("padding-left",function(){return 20*a.depth+"px"}).html(function(){var b=a.data.name+" ("+a.data.id+")";-1<a.data.name.indexOf("ENS")&&(b=that.singleImage.geneList[a.data.name]+" ("+a.data.id+")");var c=b;if("undefined"!==typeof a.children&&0<a.children.length){c="";a.depth<=that.singleImage.rootN.depth&&(c=
" less");for(var d=0,g=0;g<a.children.length&&0===d;g++)-1===a.children[g].data.name.indexOf("ENS")&&(d=1);c=1===d?'<span class="trigger'+c+'" name="d'+(a.depth+1)+'">'+b+"</span>":b}return c});b.append("td").html(a.data.definition);b.append("td").html(function(){if(0<a.data.uniqueGene){var b='<span class="triggerGL" name="gl'+c+'">'+a.data.uniqueGene+"</span><BR>";b=b+'<span id="gl'+c+'" style="display:none;" >';for(var d=0;d<a.data.uniqueGenes.length;d++){0<d&&(b+=", ");var e=a.data.uniqueGenes[d].id;
"undefined"!==typeof that.singleImage.geneList[e]&&(e=that.singleImage.geneList[e]);b+=e}b+="</span>"}else b="0";return b})});$("#GoTable .trigger").on("click",function(a){var c=this.getAttribute("name");if($("."+c).is(":hidden"))$("span[name="+c+"]").addClass("less"),$("tr."+c).show();else for(c=parseInt(c.substr(1));0<$("tr.d"+c).length;)$("span[name=d"+c+"]").removeClass("less"),$("tr.d"+c).hide(),c++;a.stopPropagation()});$("#GoTable .triggerGL").on("click",function(a){var c=this.getAttribute("name");
$("#"+c).is(":hidden")?($(this).addClass("less"),$("span#"+c).show()):($(this).removeClass("less"),$("span#"+c).hide());a.stopPropagation()});$("#GoTable").DataTable({bPaginate:!1,bSort:!1,asStripClasses:[],sDom:"f<t>"})};return that};