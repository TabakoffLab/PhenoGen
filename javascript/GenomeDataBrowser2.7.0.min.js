$.cookie.defaults.expires=365;var svgList=[],svgViewIDList=[],processAjax=0,ajaxList=[],trackInfo=[],selectedGeneSymbol="",selectedID="",trackSettings=[],overSelectable=0,zoomUpdateHandle=Math.NaN,ratOnly=[],mouseOnly=[],history=[[],[]],customTrackCount=0,testChrome=/chrom(e|ium)/.test(navigator.userAgent.toLowerCase()),testSafari=/safari/.test(navigator.userAgent.toLowerCase()),testFireFox=/firefox/.test(navigator.userAgent.toLowerCase()),testIE=/(wow|.net|ie)/.test(navigator.userAgent.toLowerCase());
testChrome&&testSafari&&(testSafari=!1);!testIE||testChrome||testFireFox||testSafari||$("#IEproblem").show();ratOnly.snpSHRJ=1;ratOnly.snpF344=1;ratOnly.snpSHRH=1;ratOnly.snpBNLX=1;ratOnly.helicos=1;ratOnly.spliceJnct=1;ratOnly.illuminaTotal=1;ratOnly.illuminaSmall=1;ratOnly.illuminaPolyA=1;ratOnly.liverTotal=1;ratOnly.liverspliceJnct=1;ratOnly.liverilluminaTotalPlus=1;ratOnly.liverilluminaTotalMinus=1;ratOnly.polyASite=1;ratOnly.braincoding=1;ratOnly.brainnoncoding=1;ratOnly.brainsmallnc=1;
ratOnly.heartTotal=1;ratOnly.heartilluminaTotalPlus=1;ratOnly.heartilluminaTotalMinus=1;ratOnly.probe=1;ratOnly.mergedTotal=1;"rn5"===genomeVer&&(mouseOnly.brainTotal=1);mouseOnly.brainilluminaTotalPlus=1;mouseOnly.brainilluminaTotalMinus=1;mouseOnly.brainspliceJnct=1;mouseOnly.probeMouse=1;
var mmVer='Mouse(<span id="verSelect"></span>) Strain:C57BL/6J',rnVer='Rat(<span id="verSelect"></span>) Strain:BN',siteVer="PhenoGen v3.5.0(9/6/2018)",trackBinCutoff=1E4,customTrackLevel=-1,mouseTTOver=0,ttHideHandle=0,tt=d3.select("body").append("div").attr("class","testToolTip").style("z-index",1001).style("opacity",0);tt.append("span").style("float","right").append("img").attr("src","web/images/icons/close.png").on("click",function(){tt.style("opacity",0)});
var tsDialog=d3.select("body").append("div").attr("class","trackSetting").attr("id","trackSettingDialog").style("z-index",1001).style("margin-left","15px").style("margin-right","15px");tsDialog.append("div").attr("id","trackSettingContent").append("table").attr("cellpadding","0").attr("cellspacing","0").append("tbody");
function updatePage(e){var h=Math.round(e.xScale.domain()[0]),l=Math.round(e.xScale.domain()[1]);if((h<e.prevMinCoord||l>e.prevMaxCoord)&&(h<e.dataMinCoord||l>e.dataMaxCoord)){processAjax=1;var p=h;var b=l;h>=e.dataMinCoord&&l>e.dataMaxCoord?p=e.dataMaxCoord+1:h<e.dataMinCoord&&l<=e.dataMaxCoord&&(b=e.dataMinCoord-1);e.setLoading();$.ajax({url:pathPrefix+"updateRegion.jsp",type:"GET",data:{chromosome:chr,minCoord:p,maxCoord:b,fullminCoord:h,fullmaxCoord:l,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,
myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(a){e.prevMinCoord=h;e.prevMaxCoord=l;h<e.dataMinCoord&&(e.dataMinCoord=h);l>e.dataMaxCoord&&(e.dataMaxCoord=l);e.folderName=a.folderName;e.updateData();processAjax=0;ga&&ga("send","event","updatePage","outsideLoadedRegion")},error:function(a,b,f){console.log(f)}})}}
function back(e){var h=1<history[e].length?history[e].pop():history[e][0];chr==h.chr&&(h.start==svgList[e].xScale.domain()[0]&&h.stop==svgList[e].xScale.domain()[1]&&(h=1<history[e].length?history[e].pop():history[e][0]),0==e&&$("#geneTxt").val(h.chr+":"+h.start+"-"+h.stop),svgList[e].xScale.domain([h.start,h.stop]),svgList[e].scaleSVG.select(".x.axis").call(svgList[e].xAxis),svgList[e].redraw(),0===e&&updatePage(svgList[e]),svgList[e].updateFullData());ga&&ga("send","event","stepBackSVGNaviation",
"navigateBack")}
function zoomIn(e,h){var l={};l.chr=chr;l.start=svgList[e].xScale.domain()[0];l.stop=svgList[e].xScale.domain()[1];var p=Math.floor((l.stop-l.start)*h);1>p&&(p=1);l.start+=p;l.stop-=p;20>l.stop-l.start&&(l.start-=p,l.stop+=p);svgList[e].xScale.domain([l.start,l.stop]);history[e].push(l);svgList[e].scaleSVG.select(".x.axis").call(svgList[e].xAxis);svgList[e].redraw();isNaN(zoomUpdateHandle)||(clearTimeout(zoomUpdateHandle),zoomUpdateHandle=Math.NaN);zoomUpdateHandle=setTimeout(function(){0===e&&updatePage(svgList[e]);
svgList[e].updateFullData();0===e&&setTimeout(function(){DisplayRegionReport()},100)},300);0===e&&$("#geneTxt").val(chr+":"+l.start+"-"+l.stop);ga&&ga("send","event","calledZoomIn",e)}
function zoomOut(e,h){var l={};l.chr=chr;l.start=svgList[e].xScale.domain()[0];l.stop=svgList[e].xScale.domain()[1];var p=Math.floor((l.stop-l.start)*h);1>p&&(p=1);l.start-=p;l.stop+=p;svgList[e].xScale.domain([l.start,l.stop]);history[e].push(l);svgList[e].scaleSVG.select(".x.axis").call(svgList[e].xAxis);svgList[e].redraw();isNaN(zoomUpdateHandle)||(clearTimeout(zoomUpdateHandle),zoomUpdateHandle=Math.NaN);zoomUpdateHandle=setTimeout(function(){0===e&&updatePage(svgList[e]);svgList[e].updateFullData();
0===e&&setTimeout(function(){DisplayRegionReport()},100)},300);0===e&&$("#geneTxt").val(chr+":"+l.start+"-"+l.stop);ga&&ga("send","event","calledZoomOut",e)}
function mup(){var e=0;for(e=0;e<svgList.length;e++)if(svgList[e]&&"undefined"!==typeof svgList[e])if(!(svgList[e].overSettings&&0!=svgList[e].overSettings||isNaN(svgList[e].downx)&&isNaN(svgList[e].downPanx))){if(0===e&&updatePage(svgList[e]),svgList[e].downx=Math.NaN,svgList[e].downPanx=Math.NaN,svgList[e].updateFullData(),0===e&&setTimeout(function(){DisplayRegionReport()},300),0==e||1==e){var h={};h.chr=chr;h.start=svgList[e].xScale.domain()[0];h.stop=svgList[e].xScale.domain()[1];history[e].push(h)}}else if(!(svgList[e].overSettings&&
0!=svgList[e].overSettings||isNaN(svgList[e].downZoomx))){var l=svgList[e].downZoomx;var p=d3.mouse(svgList[e].vis.node());svgList[e].downZoomxEnd=p[0];h=1;p[0]<l?(l=p[0],h=svgList[e].downZoomx-l):h=p[0]-l;p=Math.round(svgList[e].xScale.invert(l));l=Math.round(svgList[e].xScale.invert(l+h));svgList[e].downZoomx=Math.NaN;svgList[e].downZoomxEnd=Math.NaN;0===e&&$("#geneTxt").val(chr+":"+p+"-"+l);d3.select("#Level"+svgList[e].levelNumber).selectAll("svg rect.zoomRect").remove();d3.select("#Level"+svgList[e].levelNumber).selectAll("svg text#zoomTextStart").remove();
d3.select("#Level"+svgList[e].levelNumber).selectAll("svg text#zoomTextEnd").remove();svgList[e].xScale.domain([p,l]);svgList[e].scaleSVG.select(".x.axis").call(svgList[e].xAxis);svgList[e].redraw();svgList[e].updateFullData();0===e&&setTimeout(function(){DisplayRegionReport()},300);if(0==e||1==e)h={},h.chr=chr,h.start=p,h.stop=l,history[e].push(h)}ga&&ga("send","event","dragMouseUp","mouseUpFromDrag")}
function mmove(){var e;for(e=0;e<svgList.length;e++)if(svgList[e]&&(!svgList[e].overSettings||0===svgList[e].overSettings))if(!isNaN(svgList[e].downx)){var h=d3.mouse(svgList[e].vis.node());rupx=h[0];if(0!==rupx){var l=Math.round(svgList[e].downscalex.domain()[0]);var p=Math.round(svgList[e].mw*(svgList[e].downx-svgList[e].downscalex.domain()[0])/rupx+svgList[e].downscalex.domain()[0]);p<=svgList[e].xMax&&l>=svgList[e].xMin&&(0===e&&$("#geneTxt").val(chr+":"+l+"-"+p),svgList[e].xScale.domain([l,p]),
svgList[e].scaleSVG.select(".x.axis").call(svgList[e].xAxis),svgList[e].redraw())}}else if(isNaN(svgList[e].downPanx))isNaN(svgList[e].downZoomx)||(b=svgList[e].downZoomx,h=d3.mouse(svgList[e].vis.node()),svgList[e].downZoomxEnd=h[0],h[0]<b?(b=h[0],h=svgList[e].downZoomx-b):h=h[0]-b,l=Math.round(svgList[e].xScale.invert(b)),p=Math.round(svgList[e].xScale.invert(b+h)),d3.select("#Level"+svgList[e].levelNumber).selectAll("svg rect.zoomRect").attr("x",b).attr("width",h),d3.select("#Level"+svgList[e].levelNumber).selectAll("svg text#zoomTextStart").attr("x",
b).attr("y",15).text(numberWithCommas(l)),d3.select("#Level"+svgList[e].levelNumber).selectAll("svg text#zoomTextEnd").attr("x",b+h).attr("y",50).text(numberWithCommas(p)));else if(h=d3.mouse(svgList[e].vis.node()),rupx=h[0],0!==rupx){p=svgList[e].downPanx-rupx;var b=(svgList[e].downscalex.domain()[1]-svgList[e].downscalex.domain()[0])/svgList[e].mw;l=Math.round(svgList[e].downscalex.domain()[0]+p*b);p=Math.round(p*b+svgList[e].downscalex.domain()[1]);p<=svgList[e].xMax&&l>=svgList[e].xMin&&(0===
e&&$("#geneTxt").val(chr+":"+l+"-"+p),svgList[e].xScale.domain([l,p]),svgList[e].scaleSVG.select(".x.axis").call(svgList[e].xAxis),svgList[e].redraw(),svgList[e].downPanx=h[0])}}d3.select("html").on("mousemove",mmove).on("mouseup",mup);$(window).resize(function(){for(var e=0;e<svgList.length;e++)svgList[e]&&svgList[e].resize($(window).width()-25)});
$(document).on("click",".closeBtn",function(){var e=new String($(this).attr("id"));e=e.substr(6);$("."+e).fadeOut("fast");if(-1<e.indexOf("viewsLevel")){var h=e.substr(e.length-1);$("div#nameView"+h).hide();$("div#selection"+h).show();$("span#viewMenuLbl"+h).html("Select/Edit Views");$("div.trackLevel"+h).fadeOut("fast")}ga&&ga("send","event","closeSettings",e);return!1});
$(document).on("click",".viewSelect",function(){var e=$(this).attr("id");e=e.substr(e.length-1);if($(".viewsLevel"+e).is(":visible"))$(".viewsLevel"+e).fadeOut("fast");else{var h=$(this).parent().parent().position().top;$(".viewsLevel"+e).css("top",h).css("left",$(window).width()-610);$(".viewsLevel"+e).fadeIn("fast");$("#trackSettingDialog").hide();tt.transition().duration(200).style("opacity",0);ga&&ga("send","event","openViews",e)}return!1});
$(document).on("change","input[name='optioncbx']",function(){var e=new String($(this).attr("id")),h=e.indexOf("CBX"),l=new String(e.substr(0,h));h=e.substr(h+3,1);redrawTrack(h,l);ga&&ga("send","event","changeSettingView",e)});$(document).on("change","input[name='imgCBX']",function(){var e=new String($(this).attr("id")),h=e.indexOf("CBX");new String(e.substr(0,h));h=e.substr(h+3,1);svgList[h].redraw();setTimeout(function(){DisplayRegionReport()},300);ga&&ga("send","event","clickCbx",e)});
$(document).on("click",".reset",function(){var e=new String($(this).attr("id")),h=e.substr(e.length-1);0===e.indexOf("resetImage")?0===h&&($("#geneTxt").val(chr+":"+initMin+"-"+initMax),svgList[0].xScale.domain([initMin,initMax]),svgList[0].scaleSVG.select(".x.axis").call(svgList[0].xAxis),svgList[0].redraw()):0===e.indexOf("resetTracks")&&(svgList[h].removeAllTracks(),setupDefaultView(h));ga&&ga("send","event","resetImage",e)});
function numberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}
function displayHelpFirstTime(){if(-1===navigator.userAgent.toLowerCase().indexOf("phantomjs"))if($.cookie("genomeBrowserHelp")){var e=$.cookie("genomeBrowserHelp"),h=e.indexOf("v")+1,l=e.indexOf(".",e.indexOf(".")+1);e=e.substr(h,l-h);h=siteVer.indexOf("v")+1;l=siteVer.indexOf(".",siteVer.indexOf(".")+1);h=siteVer.substr(h,l-h);e!==h&&(setTimeout(function(){$("a#fbhelp1").click()},1E3),$.cookie("genomeBrowserHelp",siteVer))}else setTimeout(function(){$("a#fbhelp1").click()},1E3),$.cookie("genomeBrowserHelp",
siteVer)}function removeTrack(e,h){"undefined"!==typeof svgList[e]&&svgList[e].removeTrack(h);ga&&ga("send","event","removeTrack",e,h)}function redrawTrack(e,h){svgList[e].redrawTrack(h);ga&&ga("send","event","redrawTrack",e,h)}function changeTrackHeight(e,h){if(0<h){var l=h+"px";$("#Scroll"+e).css({"max-height":l,overflow:"auto"})}else $("#Scroll"+e).css({"max-height":"",overflow:"hidden"})}registerKeyboardHandler=function(e){d3.select(window).on("keydown",e)};
function getAllChildrenByName(e,h){var l=[],p=0;if("undefined"!==typeof e&&null!==e&&"undefined"!==typeof e.childNodes)for(var b=e.childNodes,a=0;a<b.length;a++)b.item(a).nodeName==h&&(l[p]=b.item(a),p++);return l}function getFirstChildByName(e,h){var l=null;if(null!==e&&"undefined"!==typeof e&&"undefined"!==typeof e.childNodes)for(var p=e.childNodes,b=!1,a=0;a<p.length&&!b;a++)p.item(a).nodeName==h&&(l=p.item(a),b=!0);return l}
function getAddMenuDiv(e,h){var l=contextPath+"/"+pathPrefix;""==pathPrefix&&(l="");$.ajax({url:l+"settingsMenu.jsp",type:"GET",cache:!1,data:{level:e,organism:organism,type:h},dataType:"html",success:function(h){$("#imageMenu"+e).remove();d3.select("div#imageMenu").append("div").attr("id","imageMenu"+e);$("#imageMenu"+e).html(h)},error:function(h,b,a){$("#imageMenu"+e).remove();d3.select("div#imageMenu").append("div").attr("id","imageMenu"+e);$("#imageMenu"+e).append('<div class="settingsLevel'+
e+'">An error occurred generating this menu.  Please try back later.</div>')},async:!1})}function loadStateFromString(e,h,l,p){loadSavedConfigTracks(e,l,p);loadImageState(h,l)}
function loadSavedConfigTracks(e,h,l){e=e.split(";");var p=0;l=90>h?svgList[h]:l;for(var b=0;b<e.length;b++){var a=e[b].split(",");console.log("loadingSavedTrack");console.log(a);if(("Rn"==organism&&"undefined"===typeof mouseOnly[a[0]]||"Mm"==organism&&"undefined"===typeof ratOnly[a[0]])&&""!=a[0]){p++;var c="";if(2<a.length)for(var f=2;f<a.length;f++)c=2==f?a[f]:c+","+a[f];1==h&&(c+=",DrawTrx");l.addTrack(a[0],a[1],c,0)}}0==p&&setupDefaultView(h)}
function loadImageState(e,h){if("undefined"!==typeof e&&""!=e)for(var l=e.split(";"),p=0;p<l.length;p++){var b=l[p].split("=");0==(new String(b[0])).indexOf("displaySelect")&&changeTrackHeight("Level"+h,b[1])}}function calculateBin(e,h){var l=new String(Math.floor(e/h));l=l.substr(0,1)*Math.pow(10,l.length-1);l=Math.floor(l/2);5>l&&(l=0);return l}function key(e){return"undefined"!==typeof e?e.getAttribute("ID"):"unknown"}
function keyName(e){return"undefined"!==typeof e?e.getAttribute("name"):"unknown"}function keyStart(e){return"undefined"!==typeof e?e.getAttribute("start"):"unknown"}function keyTissue(e,h){return"undefined"!==typeof e?e.getAttribute("ID")+h:"unknown"}function keyPos(e){return"undefined"!==typeof e?e.pos:"unknown"}function keyID(e){return"undefined"!==typeof e?e.id:"unknown"}function keySNP(e){return"undefined"!==typeof e?e.getAttribute("strain")+"_"+e.getAttribute("start"):"unknown"}
function GenomeSVG(e,h,l,p,b,a,c,f){var d={isToolTip:0,folderName:"",selectedTrackSetting:"",trackListHash:{},overSettings:0,zoomFactor:.05};d.strainSpecificCountColors=d3.scaleOrdinal(d3.schemeCategory20);0==b&&(d.folderName=regionfolderName);var n={};n.chr=chr;n.start=l;n.stop=p;d.allowSelectGenomeVer="undefined"===typeof f?!0:f;if(20>b)try{history[b].push(n)}catch(k){Rollbar.error("history["+b+"] not defined")}d.get=function(a){return d[a]};d.getTrackData=function(a){for(var b=[],c=0;c<d.trackList.length;c++)"undefined"!==
typeof d.trackList[c]&&d.trackList[c].trackClass==a&&(b=d.trackList[c].data);return b};d.getTrack=function(a){return d.trackListHash[a]};d.addTrackErrorRemove=function(a,b){if("undefined"!==typeof a){var c=b.substr(7);a.select(".infoIcon").style("opacity",0);a.select(".settings").style("opacity",0);a.append("g").attr("class","removeErrorTrack").attr("id","remove"+c+d.levelNumber).attr("transform","translate("+(d.width-40)+",0)").append("image").attr("width","16px").attr("height","16px").attr("xlink:href",
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAARBJREFUeNpi/P//PwMlgBHZgNNajGCO6bX/jNgUY5UHGQDCpzSB1Jn/YAxmQ8UJyaNKNitAMJoifPJMIFecvA4ktitCnPT7DwPDJlkG08X/wU4GYRAbJAaWY4CoBetBDoMpjIz/c4rlIKI/v0HohNcQeoEohGbngqjtfcSQ8x8SDiiBCDYkAar41zfUEGSDal7wGq4ZwwC4IT48WKNsypYvKJpBgAVdkbkmkHj3DasBYDk0wIQez+AA+/kPK4YFLNaEBNccC3QhF45kB3IYyBCgGnhiQolnEA3CxhA8mQGCYXwwhqqFpQOwAWBFWDTDEhKGIUjy8KQ6mwG7ZmyGIMtjpAMQjR5V+OQZKc3OAAEGAInHQgT+/r+xAAAAAElFTkSuQmCC").attr("pointer-events",
"all").style("cursor","pointer").on("click",function(a){d3.select(b).remove();ga&&ga("send","event","removeErrorTrack",b)}).on("mouseover",function(){d.overSettings=1;$("#mouseHelp").html("");ga&&ga("send","event","mouseHelp",b)}).on("mouseout",function(){d.overSettings=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");ga&&ga("send","event","hideMouseHelp",b)})}};d.addTrack=function(a,c,f,n){"Trx"==d.forceDrawAsValue&&-1==(new String(f)).indexOf("DrawTrx")&&
(f=","===f.substr(f.length-1)?f+"DrawTrx,":f+",DrawTrx,");var k=new String(d.folderName);(0>k.indexOf("_"+d.xScale.domain()[0]+"_")||0>k.indexOf("_"+d.xScale.domain()[1]+"_"))&&$.ajax({url:pathPrefix+"getFullPath.jsp",type:"GET",cache:!1,async:!1,data:{chromosome:chr,minCoord:d.xScale.domain()[0],maxCoord:d.xScale.domain()[1],panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(a){d.folderName=a.folderName;0==b&&(regionfolderName=
d.folderName)},error:function(a,d,c){console.log(c)}});k=null;k=d3.select("#Level"+d.levelNumber+a).nodes();if(0===k.length||null==k){k=d.topLevel.append("li").attr("class","draggable"+d.levelNumber).attr("id","li"+a).style("margin-bottom","-3px").append("svg").attr("width",d.width).attr("height",30).attr("class","track").attr("id","Level"+d.levelNumber+a).style("cursor","move").on("mouseover",function(){0===overSelectable&&("dragzoom"===d.defaultMouseFunct?$("#mouseHelp").html("<B>Zoom:</B> Click and drag to select a region to zoom in. <B>Navigate or Reorder Tracks:</B> Select the appropriate function at the top left of the image."):
"pan"===d.defaultMouseFunct?$("#mouseHelp").html("<B>Navigate:</B> Move along Genome by clicking and dragging in desired direction. <B>Zoom or Reorder Tracks:</B> Select the appropriate function at the top left of the image."):"reorder"===d.defaultMouseFunct&&$("#mouseHelp").html("<B>Reorder Tracks:</B> Click on the track and drag up or down to desired location. <B>Zoom or Navigate:</B> Select the appropriate function at the top left of the image."));ga&&ga("send","event","mouseOverTrack","")}).on("mouseout",
function(){0===overSelectable&&$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mousemove",function(){d3.event.shiftKey?d.changeTrackCursor("ns-resize"):d3.event.altKey&&"dragzoom"!==d.defaultMouseFunct?d.changeTrackCursor("crosshair"):d3.event.altKey&&"dragzoom"===d.defaultMouseFunct?d.changeTrackCursor("move"):d3.event.altKey||"dragzoom"!==d.defaultMouseFunct?d3.event.altKey||"dragzoom"===d.defaultMouseFunct||d.changeTrackCursor("move"):d.changeTrackCursor("crosshair")});
var g=new String("Loading...");k.append("text").text(g).attr("x",d.width/2-g.length/2*7.5).attr("y",12).attr("id","trkLbl");g=k.append("g").attr("class","infoIcon").attr("transform","translate("+(d.width-20)+",0)").style("cursor","pointer").attr("track",a).attr("title",a).on("mouseover",function(){var d=$(this).attr("track"),c=trackInfo[d];d=$(this).tooltipster({position:"top-right",maxWidth:250,offsetX:24,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});d.tooltipster("content",
function(){var a="";"undefined"!==typeof c&&"undefined"!==typeof c.Description&&(a=c.Description);return a});d.tooltipster("show");ga&&ga("send","event","trackInfo",a)}).on("mouseout",function(){$(this).tooltipster("hide")});g.append("rect").attr("x",0).attr("y",0).attr("rx",3).attr("ry",3).attr("height",14).attr("width",14).attr("fill","#A7C5E2").attr("stroke","#7795B2");g.append("text").attr("x",2.5).attr("y",12).attr("style","font-family:monospace;font-weight:bold;").attr("fill","#FFFFFF").text("i");
k.append("g").attr("class","settings").attr("id",a+"_"+d.levelNumber).attr("transform","translate("+(d.width-40)+",0)").append("image").attr("width","16px").attr("height","16px").attr("xlink:href","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAAAmJLR0QA/4ePzL8AAAAJcEhZcwAAAEgAAABIAEbJaz4AAAAJdnBBZwAAABAAAAAQAFzGrcMAAAGASURBVCjPlZGxaxNhAMV/9128JF/uLsndaVoPhEopFW2RGAXpKOpQHNwEHXTVf0Chm6OL4OhccFHoYKGFQgMOLoIUEQfBSZCUBtI2yaVt8hwarI6+5cF7v+HBg/+RH1U3q2/+zdxjK0znO0EhWgru20t2J/fZnXInjrYBHAD/ut30OkW3FBURfXrtLDroduf2f4ABaARlLzkdRwFFLCFxFBMdPezDGLj5PT/yMChLNqLm6MDFI2eSvT9Dzj2/qLqu7q4+0mXVlx83BnVdUPrC9wEor6Sa0awW38oCKLy1NqsZpap8AgP5BTgk41fP6QE4u60s4xCwCQArDxofUk2q1i5NAJSmantnlWphvXkXABXf3U6GsSrytwsvC6+CTlWxat2v1+SNR96ZLA9ChSrJyspXqFDlwfkUIAfwcbrvGRwEwAgzEjLDlJ9joPXl6VK639h5cm9rEebfv14emOaZZ9+ck0uUKJTXnretfHvrik7JU+W4+QsCOdzAsOEMT7LfaTGJVMIWBCwAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTAtMDItMTFUMDA6NTM6MDItMDY6MDDZzrlFAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDA5LTA4LTE4VDAyOjI2OjEwLTA1OjAw2ytpkgAAAABJRU5ErkJggg==").attr("pointer-events",
"all").style("cursor","pointer").on("click",function(c){a!=d.selectedTrackSetting?(d.getTrack(a).generateSettingsDiv("div#trackSettingContent"),d.selectedTrackSetting=a,c=$(this).position(),$("#trackSettingDialog").css("top",c.top).css("left",$(window).width()-380),$("#trackSettingDialog").fadeIn("fast")):(d.selectedTrackSetting="",$("#trackSettingDialog").fadeOut("fast"));ga&&ga("send","event","trackSettings","click");return!1}).on("mouseover",function(){d.overSettings=1;$("#mouseHelp").html("Track Settings: Click to access track settings or quickly remove the track from the current view.")}).on("mouseout",
function(){d.overSettings=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")})}if("genomeSeq"==a)k=SequenceTrack(d,a,"Reference Genomic Sequence",f),d.addTrackList(k);else if(-1<a.indexOf("noncoding"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",function(b,k){if(b)if(10>n){var g=2500;1==n&&(g=5E3);setTimeout(function(){d.addTrack(a,c,f,n+1)},g)}else d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+
a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a);else if(null==k)if(11<=n){g=[];var m=GeneTrack(d,g,a,"Long Non-Coding / Non-PolyA+ Genes",f);d.addTrackList(m)}else setTimeout(function(){d.addTrack(a,c,f,10)},5E3);else{g=k.documentElement.getElementsByTagName("Gene");var q=0,e=k.documentElement.getElementsByTagName("GeneList");0<e.length&&"undefined"!==typeof e[0].getAttribute("ver")&&(q=e[0].getAttribute("ver"));
try{m=GeneTrack(d,g,a,"Long Non-Coding / Non-PolyA+ Genes",f),m.dataVer=q,d.addTrackList(m)}catch(F){}}});else if(-1<a.indexOf("coding"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",function(b,k){if(b)if(10>n){var g=2500;1==n&&(g=1E4);setTimeout(function(){d.addTrack(a,c,f,n+1)},g)}else d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+
d.levelNumber+a),"#Level"+d.levelNumber+a);else if(null==k)if(11<=n){g=[];var m=GeneTrack(d,g,a,"Protein Coding / PolyA+",f);d.addTrackList(m)}else setTimeout(function(){d.addTrack(a,c,f,11)},5E3);else{g=k.documentElement.getElementsByTagName("Gene");var q=0,e=k.documentElement.getElementsByTagName("GeneList");0<e.length&&"undefined"!==typeof e[0].getAttribute("ver")&&(q=e[0].getAttribute("ver"));try{m=GeneTrack(d,g,a,"Protein Coding / PolyA+",f),m.dataVer=q,d.addTrackList(m)}catch(F){console.log(F)}}});
else if(-1<a.indexOf("smallnc"))d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",function(b,k){if(b){if(0===n){var g=d.xScale.domain()[0],m=d.xScale.domain()[1],q=contextPath+"/"+pathPrefix;pathPrefix||(q="");$.ajax({url:q+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,minCoord:g,maxCoord:m,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",success:function(a){ga&&
ga("send","event","browser","generateTrackRefseq")},error:function(a,d,c){}})}10>n?(g=2500,1==n&&(g=1E4),setTimeout(function(){d.addTrack(a,c,f,n+1)},g)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==k)11<=n?(g=[],m=GeneTrack(d,g,a,"Small RNA (<200 bp) Genes",f),d.addTrackList(m)):setTimeout(function(){d.addTrack(a,
c,f,11)},5E3);else{g="rn5"===genomeVer?k.documentElement.getElementsByTagName("smnc"):k.documentElement.getElementsByTagName("Gene");try{m=GeneTrack(d,g,a,"Small RNA (<200 bp) Genes",f),d.addTrackList(m),""!=selectGene&&m.setSelected(selectGene)}catch(G){}}});else if(0===a.indexOf("liverTotal")||"heartTotal"===a||0===a.indexOf("brainTotal")||"mergedTotal"===a){var q="Liver Reconstructed";"heartTotal"===a?q="Heart Reconstructed":"brainTotal"===a?q="Whole Brain Reconstructed":"mergedTotal"===a&&(q=
"Merged (Brain,Heart,Liver) Reconstructed");(0===a.indexOf("liverTotal")||0===a.indexOf("brainTotal"))&&0<a.indexOf("_")&&(k=a.substr(a.indexOf("_")+1),"LEStm"===k&&(k="LE-Stm"),"F344Stm"===k&&(k="F344-Stm"),q=k+" "+q);d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",function(b,k){if(b){if(1===n&&("mergedTotal"===a||0===a.indexOf("liverTotal")||0===a.indexOf("brainTotal"))){var g=d.xScale.domain()[0],m=d.xScale.domain()[1],e=contextPath+"/"+pathPrefix;pathPrefix||
(e="");var r=panel;(0===a.indexOf("liverTotal")||0===a.indexOf("brainTotal"))&&0<a.indexOf("_")&&(r=a.substr(a.indexOf("_")+1),"LEStm"===r&&(r="LE-Stm"),"F344Stm"===r&&(r="F344-Stm"));$.ajax({url:e+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,minCoord:g,maxCoord:m,panel:r,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackRefseq")},
error:function(a,d,c){}})}10>n?(g=2500,1==n&&(g=1E4),setTimeout(function(){d.addTrack(a,c,f,n+1)},g)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==k)11<=n?(g=[],m=GeneTrack(d,g,a,q,f),d.addTrackList(m)):setTimeout(function(){d.addTrack(a,c,f,11)},5E3);else{g=k.documentElement.getElementsByTagName("Gene");
e=0;r=k.documentElement.getElementsByTagName("GeneList");0<r.length&&"undefined"!==typeof r[0].getAttribute("ver")&&(e=r[0].getAttribute("ver"));try{m=GeneTrack(d,g,a,q,f),m.dataVer=e,d.addTrackList(m),""!=selectGene&&m.setSelected(selectGene)}catch(F){}}})}else if(0===a.indexOf("refSeq")){$("#"+a+d.levelNumber+"Select").val();var m=d.xScale.domain()[0],e=d.xScale.domain()[1];k=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml";d3.xml(k,function(b,k){if(b){console.log(b);
if(0===n){var g=contextPath+"/"+pathPrefix;pathPrefix||(g="");$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,minCoord:m,maxCoord:e,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackRefseq")},error:function(a,d,c){}})}10>n?(g=2500,1===n&&(g=1E4),setTimeout(function(){d.addTrack(a,c,f,n+1)},g)):(d3.select("#Level"+
d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==k)if(11<=n){g=[];var q=RefSeqTrack(d,g,a,"Ref Seq Genes",f);d.addTrackList(q)}else setTimeout(function(){d.addTrack(a,c,f,11)},5E3);else{g=k.documentElement.getElementsByTagName("Gene");try{q=RefSeqTrack(d,g,a,"Ref Seq Genes",f),d.addTrackList(q)}catch(y){console.log(y)}}})}else if(0==
a.indexOf("snp"))m=d.xScale.domain()[0],e=d.xScale.domain()[1],k=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",d3.xml(k,function(b,k){if(b){console.log(b);if(0==n){var g=contextPath+"/"+pathPrefix;pathPrefix||(g="");$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,minCoord:m,maxCoord:e,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",
success:function(a){ga&&ga("send","event","browser","generateTrackSNP")},error:function(a,d,c){}})}10>n?(g=2500,1==n&&(g=15E3),setTimeout(function(){d.addTrack(a,c,f,n+1)},g)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==k)if(11<=n){g=[];var q=SNPTrack(d,g,a,c,f);d.addTrackList(q)}else setTimeout(function(){d.addTrack(a,
c,f,11)},5E3);else{g=k.documentElement.getElementsByTagName("Snp");try{q=SNPTrack(d,g,a,c,f),d.addTrackList(q)}catch(y){}}});else if("qtl"===a)d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/qtl.xml",function(b,k){if(b)if(10>n){var g=2500;1==n&&(g=1E4);setTimeout(function(){d.addTrack(a,c,f,n+1)},g)}else d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+
d.levelNumber+a),"#Level"+d.levelNumber+a);else if(null==k)if(11<=n){g=[];var m=QTLTrack(d,g,a,c);d.addTrackList(m)}else setTimeout(function(){d.addTrack(a,c,f,11)},5E3);else{g=k.documentElement.getElementsByTagName("QTL");try{m=QTLTrack(d,g,a,c),d.addTrackList(m)}catch(y){}}});else if("trx"===a)k=getAllChildrenByName(getFirstChildByName(d.selectedData,"TranscriptList"),"Transcript"),k=TranscriptTrack(d,k,a,c),d.addTrackList(k);else if("probe"===a||"probeMouse"==a)d3.xml(dataPrefix+"tmpData/browserCache/"+
genomeVer+"/regionData/"+d.folderName+"/probe.xml",function(b,k){if(b)if(10>n){var g=2500;1==n&&(g=1E4);setTimeout(function(){d.addTrack(a,c,f,n+1)},g)}else d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a);else if(null==k)11<=n?(m=[],g=ProbeTrack(d,m,a,"Affy Exon 1.0 ST Probe Sets",c+","+f),d.addTrackList(g)):setTimeout(function(){d.addTrack(a,
c,f,11)},5E3);else{var m=k.documentElement.getElementsByTagName("probe");try{g=ProbeTrack(d,m,a,"Affy Exon 1.0 ST Probe Sets",c+","+f),d.addTrackList(g)}catch(y){}}});else if("helicos"==a||-1<a.indexOf("illuminaTotal")||-1<a.indexOf("illuminaSmall")||"illuminaPolyA"==a){m=d.xScale.domain()[0];e=d.xScale.domain()[1];var h=calculateBin(e-m,d.width);k=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/tmp/"+m+"_"+e+".count."+a+".xml";0<h&&(m-=m%h,e+=h-e%h,k=dataPrefix+"tmpData/browserCache/"+
genomeVer+"/regionData/"+d.folderName+"/tmp/"+m+"_"+e+".bincount."+h+"."+a+".xml");d3.xml(k,function(b,k){if(b){if(0==n||3==n){var g=contextPath+"/"+pathPrefix;pathPrefix||(g="");tmpPanel=panel;-1<a.indexOf("-")&&(tmpPanel=a.substr(a.indexOf("-")+1));$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,minCoord:m,maxCoord:e,panel:tmpPanel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName,binSize:h},dataType:"json",
success:function(a){ga&&ga("send","event","browser","generateTrackCounts")},error:function(a,d,c){}});g=1E4}30>n?(g=1E4,0===n&&(g=5E3),setTimeout(function(){d.addTrack(a,c,f,n+1)},g)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==k)4<=n?(g=[],"helicos"==a?q=HelicosTrack(d,g,a,c):"illuminaTotal"==
a?q=IlluminaTotalTrack(d,g,a,c):"illuminaSmall"==a?q=IlluminaSmallTrack(d,g,a,c):"illuminaPolyA"==a?q=IlluminaPolyATrack(d,g,a,c):"liverilluminaTotalPlus"==a?q=LiverIlluminaTotalPlusTrack(d,g,a,c):"liverilluminaTotalMinus"==a?q=LiverIlluminaTotalMinusTrack(d,g,a,c):"heartilluminaTotalPlus"==a?q=HeartIlluminaTotalPlusTrack(d,g,a,c):"heartilluminaTotalMinus"==a?q=HeartIlluminaTotalMinusTrack(d,g,a,c):"brainilluminaTotalPlus"==a?q=BrainIlluminaTotalPlusTrack(d,g,a,c):"brainilluminaTotalMinus"==a?q=BrainIlluminaTotalMinusTrack(d,
g,a,c):"liverilluminaSmall"==a?q=LiverIlluminaSmallTrack(d,g,a,c):"heartilluminaSmall"==a?q=HeartIlluminaSmallTrack(d,g,a,c):-1<a.indexOf("illuminaTotal")&&(q=StrainSpecificIlluminaTotalTrack(d,g,a,c)),d.addTrackList(q)):setTimeout(function(){d.addTrack(a,c,f,4)},3E3);else{g=k.documentElement.getElementsByTagName("Count");var q;try{"helicos"===a?q=HelicosTrack(d,g,a,c):"illuminaTotal"===a?q=IlluminaTotalTrack(d,g,a,c):"illuminaSmall"===a?q=IlluminaSmallTrack(d,g,a,c):"illuminaPolyA"===a?q=IlluminaPolyATrack(d,
g,a,c):"liverilluminaTotalPlus"===a?q=LiverIlluminaTotalPlusTrack(d,g,a,c):"liverilluminaTotalMinus"===a?q=LiverIlluminaTotalMinusTrack(d,g,a,c):"heartilluminaTotalPlus"===a?q=HeartIlluminaTotalPlusTrack(d,g,a,c):"heartilluminaTotalMinus"===a?q=HeartIlluminaTotalMinusTrack(d,g,a,c):"brainilluminaTotalPlus"===a?q=BrainIlluminaTotalPlusTrack(d,g,a,c):"brainilluminaTotalMinus"===a?q=BrainIlluminaTotalMinusTrack(d,g,a,c):"liverilluminaSmall"===a?q=LiverIlluminaSmallTrack(d,g,a,c):"heartilluminaSmall"===
a?q=HeartIlluminaSmallTrack(d,g,a,c):-1<a.indexOf("illuminaTotal")&&(q=StrainSpecificIlluminaTotalTrack(d,g,a,c)),d.addTrackList(q)}catch(y){}}})}else if(-1<a.indexOf("spliceJnct")){m=d.xScale.domain()[0];e=d.xScale.domain()[1];k=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml";var l="Brain ";"liverspliceJnct"==a?l="Liver ":"heartspliceJnct"==a&&(l="Heart ");d3.xml(k,function(b,g){if(b){console.log(b);if(0==n){var k=contextPath+"/"+pathPrefix;pathPrefix||(k="");
$.ajax({url:k+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,minCoord:m,maxCoord:e,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackSpliceJnct")},error:function(a,d,c){}})}10>n?(k=2500,1==n&&(k=1E4),setTimeout(function(){d.addTrack(a,c,f,n+1)},k)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+
a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==g)if(11<=n){k=[];var q=SpliceJunctionTrack(d,k,a,l+"Splice Junctions",1,"");d.addTrackList(q)}else setTimeout(function(){d.addTrack(a,c,f,11)},5E3);else{k=g.documentElement.getElementsByTagName("Feature");console.log(k);try{q=SpliceJunctionTrack(d,k,a,l+"Splice Junctions",3,""),d.addTrackList(q)}catch(y){console.log(y)}}})}else if("polyASite"==
a)d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/polyASite.xml",function(b,g){if(b)if(3>n){var k=1E4;1==n&&(k=15E3);setTimeout(function(){d.addTrack(a,c,f,n+1)},k)}else d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a);else if(null==g)if(4<=n){k=[];var q=PolyATrack(d,k,a,"Predicted PolyA Sites",
f);d.addTrackList(q)}else setTimeout(function(){d.addTrack(a,c,f,4)},5E3);else{k=g.documentElement.getElementsByTagName("Feature");try{q=PolyATrack(d,k,a,"Predicted PolyA Sites",f),d.addTrackList(q)}catch(y){}}});else if(0===a.indexOf("repeatMask"))$("#"+a+d.levelNumber+"Select").val(),m=d.xScale.domain()[0],e=d.xScale.domain()[1],k=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+d.folderName+"/"+a+".xml",d3.xml(k,function(b,k){if(b){console.log(b);if(0===n){var g=contextPath+"/"+pathPrefix;
pathPrefix||(g="");$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,minCoord:m,maxCoord:e,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:a,folder:d.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackRepeatMask")},error:function(a,d,c){}})}10>n?(g=2500,1===n&&(g=1E4),setTimeout(function(){d.addTrack(a,c,f,n+1)},g)):(d3.select("#Level"+d.levelNumber+a).select("#trkLbl").text("An errror occurred loading Track:"+
a),d3.select("#Level"+d.levelNumber+a).attr("height",15),d.addTrackErrorRemove(d3.select("#Level"+d.levelNumber+a),"#Level"+d.levelNumber+a))}else if(null==k)if(11<=n){g=[];var q=RepeatMaskTrack(d,g,a,"Repeat Masker",c,f);d.addTrackList(q)}else setTimeout(function(){d.addTrack(a,c,f,11)},5E3);else{g=k.documentElement.getElementsByTagName("Feature");try{q=RepeatMaskTrack(d,g,a,"Repeat Masker",c,f),d.addTrackList(q)}catch(y){console.log(y)}}});else if(0==a.indexOf("custom"))if(k=trackInfo[a],f=f+",Name="+
k.Name,f="DataFile="+k.Location+","+f,"bed"==k.Type||"bb"==k.Type)g=[],k=CustomTranscriptTrack(d,g,a,k.Name,3,f),d.addTrackList(k),k.updateFullData(0,0);else if("bg"==k.Type||"bw"==k.Type)g=[],k=CustomCountTrack(d,g,a,3,f),d.addTrackList(k);$(".sortable"+d.levelNumber).sortable("refresh");ga&&ga("send","event","trackAdded",a)};d.addTrackList=function(a){null!=a&&(d.trackList[d.trackCount]=a,d.trackCount++,d.trackListHash[a.trackClass]=a,setTimeout(function(){DisplayRegionReport()},300))};d.updateLinks=
function(){1===d.levelNumber&&d3.select("#probeSetDetailLink1").each(function(){var a=new String(d3.select(this).attr("href"));a=a.substr(0,a.lastIndexOf("=")+1);a+=d.currentView.ViewID;d3.select(this).attr("href",a)})};d.changeTrackHeight=function(a,d){0<d?d3.select("#"+a+"Scroll").style("max-height",d+"px").style("overflow","auto"):d3.select("#"+a+"Scroll").style("max-height","none").style("overflow","hidden")};d.removeAllTracks=function(){d3.selectAll("li.draggable"+d.levelNumber).remove();d.trackList=
[];setTimeout(function(){DisplayRegionReport()},300);ga&&ga("send","event","SVGremoveAllTracks",d.levelNumber)};d.removeTrack=function(a){d3.select("#Level"+d.levelNumber+a).remove();for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&d.trackList[c].trackClass==a&&(d.trackList.splice(c,1),d.trackCount--);d.trackListHash[a]=void 0;setTimeout(function(){DisplayRegionReport()},300);ga&&ga("send","event","removeTrack",d.levelNumber,a)};d.redrawTrack=function(a){for(var c=0;c<d.trackList.length;c++)"undefined"!==
typeof d.trackList[c]&&d.trackList[c].trackClass==a&&d.trackList[c].redraw();setTimeout(function(){DisplayRegionReport()},300)};d.redraw=function(){for(var a=0;a<d.trackList.length;a++)"undefined"!==typeof d.trackList[a]&&"undefined"!==typeof d.trackList[a].redraw&&d.trackList[a].redraw();d.selectSvg.redraw()};d.update=function(){for(var a=0;a<d.trackList.length;a++)"undefined"!==typeof d.trackList[a].update&&d.trackList[a].update();setTimeout(function(){DisplayRegionReport()},300);ga&&ga("send",
"event","gsvgUpdate","genomeSVG.update")};d.updateData=function(){for(var a=0;a<d.trackList.length;a++)"undefined"!==typeof d.trackList[a]&&"undefined"!==typeof d.trackList[a].updateData&&d.trackList[a].updateData(0);d.updateFullData();setTimeout(function(){DisplayRegionReport()},300);ga&&ga("send","event","gsvgUpdateData","genomeSVG.updateData")};d.updateFullData=function(){-1<(new String(d.folderName)).indexOf("img")&&$.ajax({url:pathPrefix+"getFullPath.jsp",type:"GET",async:!1,data:{chromosome:chr,
minCoord:d.xScale.domain()[0],maxCoord:d.xScale.domain()[1],panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(a){d.folderName=a.folderName;0==d.levelNumber&&regionfolderName!=d.folderName&&(regionfolderName=d.folderName);setTimeout(function(){DisplayRegionReport()},300)},error:function(a,d,c){console.log(c)}});for(var a=0;a<d.trackList.length;a++)"undefined"!==typeof d.trackList[a]&&"undefined"!==typeof d.trackList[a].updateFullData&&
d.trackList[a].updateFullData(0,1);ga&&ga("send","event","gsvgUpdateFullData","genomeSVG.updateFullData")};d.setLoading=function(){for(var a=0;a<d.trackList.length;a++)"undefined"===typeof d.trackList[a]||"undefined"===typeof d.trackList[a].updateData&&"undefined"===typeof d.trackList[a].updateFullData||d.trackList[a].showLoading()};d.clearSelection=function(){d.selectionStart=-1;d.selectionEnd=-1;d.scaleSVG.selectAll("rect.selectedArea").remove();d.selectSvg.setVis(!1);for(var a=0;a<d.trackList.length;a++)"undefined"!==
typeof d.trackList[a]&&"undefined"!==typeof d.trackList[a].clearSelection&&d.trackList[a].clearSelection()};d.mdown=function(){if(0==d.overSettings)if("dragzoom"!==d.defaultMouseFunct&&d3.event.altKey||"dragzoom"===d.defaultMouseFunct&&!d3.event.altKey){var a=d3.mouse(d.vis.node());d.downZoomx=a[0];d.scaleSVG.append("rect").attr("class","zoomRect").attr("x",a[0]).attr("y",0).attr("height",d.scaleSVG.attr("height")).attr("width",1).attr("fill","#CECECE").attr("opacity",.3);d.scaleSVG.append("text").attr("id",
"zoomTextStart").attr("x",d.downZoomx).attr("y",15).text(numberWithCommas(Math.round(d.xScale.invert(d.downZoomx))));d.scaleSVG.append("text").attr("id","zoomTextEnd").attr("x",d.downZoomx).attr("y",50).text(numberWithCommas(Math.round(d.xScale.invert(d.downZoomx))))}else 0==processAjax&&(d.prevMinCoord=d.xScale.domain()[0],d.prevMaxCoord=d.xScale.domain()[1],a=d3.mouse(d.vis.node()),d.downx=d.xScale.invert(a[0]),d.downscalex=d.xScale)};d.forceDrawAs=function(a){for(var c=0;c<d.trackList.length;c++)"undefined"!==
typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].drawAs&&(d.trackList[c].drawAs=a,d.trackList[c].draw(d.trackList[c].data));d.forceDrawAsValue=a};d.resize=function(a){d.width=a;d.xScale.range([0,d.width]);d.xAxis=d3.axisTop(d.xScale).ticks(6).tickSize(8).tickPadding(10);d.scaleSVG.attr("width",d.width);d.scaleSVG.select(".x.axis").call(d.xAxis);d3.select("#Level"+d.levelNumber).select(".axisLbl").attr("x",(d.width-2*d.margin)/2);d.topLevel.style("width",d.width+18+"px");for(var c=0;c<d.trackList.length;c++)"undefined"!==
typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].redraw&&d.trackList[c].resize();d.selectSvg.width=a;d.selectSvg.draw()};d.updateCountScales=function(a,c){for(var b=0;b<d.trackList.length;b++)"undefined"!==typeof d.trackList[b]&&"undefined"!==typeof d.trackList[b].updateCountScale&&d.trackList[b].updateCountScale(a,c)};d.resetDefaultMouse=function(a){var c="/web/images/icons/"+a+"_dark.png";d3.select("span#"+a+d.levelNumber+" img").attr("src",c);d3.select("span#"+a+d.levelNumber).style("background",
"#DCDCDC")};d.changeTrackCursor=function(a){for(var c=0;c<d.trackList.length;c++)"undefined"!==typeof d.trackList[c]&&"undefined"!==typeof d.trackList[c].svg&&d.trackList[c].svg.style("cursor",a)};d.changeScaleCursor=function(a){"undefined"!==typeof d.scaleSVG&&d.scaleSVG.style("cursor",a)};d.updateTrackSelectedArea=function(a,c){d.selectionStart=a;d.selectionEnd=c;var b=d.xScale(a),f=d.xScale(c)-b;d.scaleSVG.selectAll("rect.selectedArea").remove();if((0<b||0<b+f)&&b<d.width)for(1>f&&(f=1),d.scaleSVG.append("rect").attr("class",
"selectedArea").attr("x",b).attr("y",15).attr("height",d.scaleSVG.attr("height")-15).attr("width",f).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none"),b=0;b<d.trackList.length;b++)"undefined"!==typeof d.trackList[b]&&"undefined"!==typeof d.trackList[b].setSelectedArea&&d.trackList[b].setSelectedArea(a,c)};d.getAddMenus=function(){var a=contextPath+"/"+pathPrefix;""==pathPrefix&&(a="");$.ajax({url:a+"trackMenu.jsp",type:"GET",cache:!1,data:{level:d.levelNumber,organism:organism},
dataType:"html",success:function(a){$("#trackMenu"+d.levelNumber).remove();d3.select("div#trackMenu").append("div").attr("id","trackMenu"+d.levelNumber);$("#trackMenu"+d.levelNumber).html(a)},error:function(a,c,b){$("#trackMenu"+d.levelNumber).remove();d3.select("div#trackMenu").append("div").attr("id","trackMenu"+d.levelNumber);$("#trackMenu"+d.levelNumber).append('<div class="viewsLevel'+d.levelNumber+'">An error occurred generating this menu.  Please try back later.</div>')},async:!1});$.ajax({url:a+
"viewMenu.jsp",type:"GET",cache:!1,data:{level:d.levelNumber,organism:organism},dataType:"html",success:function(a){$("#viewMenu"+d.levelNumber).remove();d3.select("div#viewMenu").append("div").attr("id","viewMenu"+d.levelNumber);$("#viewMenu"+d.levelNumber).html(a)},error:function(a,c,b){$("#viewMenu"+d.levelNumber).remove();d3.select("div#viewMenu").append("div").attr("id","viewMenu"+d.levelNumber);$("#viewMenu"+d.levelNumber).append('<div class="viewsLevel'+d.levelNumber+'">An error occurred generating this menu.  Please try back later.</div>')},
async:!1})};d.zoomMenuChange=function(a){d3.select("#zoomSelectMenu"+d.levelNumber).selectAll("li").style("background","#FFFFFF");d.zoomFactor=parseFloat(d3.select(a).attr("value"));d3.select(a).style("background","#CECECE")};d.setupFunctionBar=function(){d3.select(e).select("#functLevel"+d.levelNumber).remove();d.functionBar=d.vis.append("div").attr("class","functionBar").attr("id","functLevel"+d.levelNumber).style("float","left");var a=d.functionBar.append("div").attr("class","defaultMouse").attr("id",
"defaultMouse"+d.levelNumber);a.append("span").attr("id","dragzoom"+d.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt dragzoom").attr("src","/web/images/icons/dragzoom_dark.png").attr("pointer-events","all").on("click",function(){d.resetDefaultMouse(d.defaultMouseFunct);d.defaultMouseFunct="dragzoom";d3.select(this).attr("src","/web/images/icons/dragzoom_white.png");d3.select("span#dragzoom"+d.levelNumber).style("background",
"#989898");d.changeTrackCursor("crosshair");d.changeScaleCursor("crosshair");ga&&ga("send","event","clickDragZoom","")}).on("mouseout",function(){"dragzoom"!=d.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/dragzoom_dark.png"),d3.select("span#dragzoom"+d.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/dragzoom_white.png");d3.select("span#dragzoom"+d.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to allow click and drag to select a region to zoom in on.")});
a.append("span").attr("id","pan"+d.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/pan_dark.png").attr("pointer-events","all").on("click",function(){d.resetDefaultMouse(d.defaultMouseFunct);d.defaultMouseFunct="pan";d3.select(this).attr("src","/web/images/icons/pan_white.png");d3.select("span#pan"+d.levelNumber).style("background","#989898");d.changeTrackCursor("move");d.changeScaleCursor("ew-resize");
ga&&ga("send","event","clickPan","")}).on("mouseout",function(){"pan"!=d.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/pan_dark.png"),d3.select("span#pan"+d.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/pan_white.png");d3.select("span#pan"+d.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to allow click and drag to navigate along the genome.")});a.append("span").attr("id",
"reorder"+d.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/reorder_dark.png").attr("pointer-events","all").on("click",function(){d.resetDefaultMouse(d.defaultMouseFunct);d.defaultMouseFunct="reorder";d3.select(this).attr("src","/web/images/icons/reorder_white.png");d3.select("span#reorder"+d.levelNumber).style("background","#989898");d.changeTrackCursor("ns-resize");d.changeScaleCursor("ew-resize");
ga&&ga("send","event","clickReorder","")}).on("mouseout",function(){"reorder"!=d.defaultMouseFunct&&(d3.select(this).attr("src","/web/images/icons/reorder_dark.png"),d3.select("span#reorder"+d.levelNumber).style("background","#DCDCDC"))}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/reorder_white.png");d3.select("span#reorder"+d.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to set default mouse function to reorder image tracks. <strong>Optionally hold down shift in any mode.</strong>")});
$("span#"+d.defaultMouseFunct+d.levelNumber+" img").click();d.functionBar.append("span").attr("class","saveImage control").style("display","inline-block").attr("id","saveLevel"+d.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/savePic_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var a=$(this).parent().attr("id"),d=(new String(a)).substr(9);a=$("div#Level"+d).html();$.ajax({url:pathPrefix+"saveBrowserImage.jsp",type:"POST",
contentType:"text/html",data:a+"\n",processData:!1,dataType:"json",success:function(a){var c=new Date;c=c.getMonth()+1+"_"+c.getDate()+"_"+c.getFullYear();var b="http://";"https:"===location.protocol&&(b="https://");var f=b+urlprefix+"/tmpData/download/"+a.imageFile;a=new String($("#geneTxt").val());a=a.replace(/:/g,"_");a=a.replace(/-/g,"_");a=a.replace(/,/g,"");"Level1"==d&&(a=svgList[1].selectedData.getAttribute("geneSymbol"));var g=a+"_"+c+".png",k=new XMLHttpRequest;k.open("GET",f);k.responseType=
"blob";k.send();k.onreadystatechange=function(){if(4!=k.readyState||200!=k.status)return!1;var a=document.createElement("a");a.href=window.URL.createObjectURL(k.response);a.download=g;a.style.display="none";document.body.appendChild(a);try{a.click()}catch(D){$("#mouseHelp").html("<span style='color:#FF0000;'>Your browser will not save the image directly. Image will open in a popup, in the new window right click to save image.</span>"),window.open(f)}return!0};ga&&ga("send","event","browser","saveBrowserImage")},
error:function(a,d,c){console.log(c)}});ga&&ga("send","event","saveImage","")}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/savePic_white.png");d3.select("span#savePic"+d.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Click to download a PNG image of the current view.")}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/savePic_dark.png");d3.select("span#savePic"+d.levelNumber).style("background","#989898");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});
d.functionBar.append("span").attr("class","reset control").style("display","inline-block").attr("id","resetImage"+d.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/reset_dark.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){var a=new String($(this).parent().attr("id"));a=a.substr(a.length-1);0==a?($("#geneTxt").val(chr+":"+initMin+"-"+initMax),svgList[0].xScale.domain([initMin,initMax]),svgList[0].scaleSVG.select(".x.axis").call(svgList[0].xAxis),
svgList[0].redraw()):(svgList[a].xScale.domain([svgList[a].initMin,svgList[a].initMax]),svgList[a].scaleSVG.select(".x.axis").call(svgList[a].xAxis),svgList[a].redraw());svgList[0].updateFullData();ga&&ga("send","event","clickResetImage","")}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/reset_white.png");d3.select("span#reset"+d.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Click to reset image zoom to initial region.")}).on("mouseout",function(){d3.select(this).attr("src",
"/web/images/icons/reset_dark.png");d3.select("span#reset"+d.levelNumber).style("background","#989898");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});d.functionBar.append("span").attr("class","back control").style("display","inline-block").attr("id","backButton"+d.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/back_dark2.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){back(d.levelNumber);
ga&&ga("send","event","clickBack","")}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/back_white2.png");$("#mouseHelp").html("Click to undo last zoom/pan.")}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/back_dark2.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")});a=d.functionBar.append("span").style("display","inline-block").style("position","relative").style("top","-9px").attr("id","zoom"+
d.levelNumber);a.append("button").attr("id","zoomInButton"+d.levelNumber).attr("class","zoomIn").style("height","2.3em").append("img").style("position","relative").style("top","-5px").attr("src","/web/images/icons/magPlus_dark_32.png").attr("pointer-events","all").attr("cursor","pointer");a.append("button").attr("id","zoomOutButton"+d.levelNumber).attr("class","zoomOut").style("height","2.3em").append("img").style("position","relative").style("top","-5px").attr("src","/web/images/icons/magMinus_dark_32.png").attr("pointer-events",
"all").attr("cursor","pointer");a.append("button").attr("id","zoomMenuSelect"+d.levelNumber).attr("class","zoomSelectMenu");testChrome?(console.log("CHROME"),d3.select("#zoomSelect"+d.levelNumber).style("height","2.3em")):testSafari&&d3.select("#zoomSelect"+d.levelNumber).style("height","2.3em");a=d.functionBar.append("ul").attr("id","zoomSelectMenu"+d.levelNumber);a.append("li").attr("id","zoom1"+d.levelNumber).attr("value","0.025").on("click",function(){d.zoomMenuChange(this)}).text("0.5x");a.append("li").attr("id",
"zoom2"+d.levelNumber).attr("value","0.05").style("background","#CECECE").on("click",function(){d.zoomMenuChange(this)}).text("1x");a.append("li").attr("id","zoom3"+d.levelNumber).attr("value","0.1").on("click",function(){d.zoomMenuChange(this)}).text("2x");a.append("li").attr("id","zoom4"+d.levelNumber).attr("value","0.25").on("click",function(){d.zoomMenuChange(this)}).text("5x");a.append("li").attr("id","zoom5"+d.levelNumber).attr("value","0.5").on("click",function(){d.zoomMenuChange(this)}).text("10x");
$("#zoomInButton"+d.levelNumber).button().click(function(){zoomIn(d.levelNumber,d.zoomFactor);ga&&ga("send","event","clickZoomIn","")}).on("mouseover",function(){$(this).css("background","#989898");$("img",this).attr("src","/web/images/icons/magPlus_light_32.png");$("#mouseHelp").html("Click to zoom in on the center of the region.  Click and drag the scale to zoom in or out more quickly or select the region select tool to highlight a specific region.")}).on("mouseout",function(){$(this).css("background",
"#e6e6e6");$("img",this).attr("src","/web/images/icons/magPlus_dark_32.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).next().button().click(function(){zoomOut(d.levelNumber,d.zoomFactor);ga&&ga("send","event","clickZoomOut","")}).on("mouseover",function(){$(this).css("background","#989898");$("img",this).attr("src","/web/images/icons/magMinus_light_32.png");$("#mouseHelp").html("Click to zoom out from the center of the region.  Click and drag the scale to zoom in or out more quickly or select the region select tool to highlight a specific region.")}).on("mouseout",
function(){$(this).css("background","#e6e6e6");$("img",this).attr("src","/web/images/icons/magMinus_dark_32.png");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).next().button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).click(function(){var a=$(this).parent().next().show().position({my:"left top",at:"left bottom",of:this});$(document).on("click",function(){a.hide()});return!1}).parent().buttonset().next().hide().menu()};d.generateSettingsString=
function(){ret="";$("#ScrollLevel"+d.levelNumber+" li.draggable"+d.levelNumber).each(function(){var a=new String($(this).attr("id"));a=a.substr(2);"undefined"!==typeof d.trackListHash[a]&&(ret+=d.trackListHash[a].generateTrackSettingString())});return ret};d.setCurrentViewModified=function(){d.currentView.modified=1;$("span#viewModifiedCtl"+d.levelNumber).show()};d.clearCurrentView=function(){d.currentView.modified=0;$("span#viewModifiedCtl"+d.levelNumber).hide()};d.type=c;d.div=e;d.margin=0;d.halfWindowWidth=
$(window).width()/2;d.mh=400;d.downx=Math.NaN;d.downscalex;d.downPanx=Math.NaN;d.downZoomx=Math.NaN;d.downZoomxEnd=Math.NaN;d.defaultMouseFunct="pan";d.xMax=29E7;d.xMin=1;d.prevMinCoord=l;d.prevMaxCoord=p;d.initMin=l;d.initMax=p;d.dataMinCoord=l;d.dataMaxCoord=p;d.y=0;d.xScale=null;d.xAxis=null;d.vis=null;d.level=null;d.svg=null;d.txType=null;d.txList=null;d.tt=null;d.trackList=[];d.trackCount=0;d.levelNumber=b;d.selectedData=null;d.txType=null;d.selectionStart=-1;d.selectionEnd=-1;d.scrollSize=350;
d.width=h;d.mw=d.width-d.margin;d3.select(e).select("#viewsLevel"+b).remove();d3.select(e).select("#Level"+b).remove();d.vis=d3.select(e);d.setupFunctionBar();0==$("#viewSelect"+d.levelNumber).length&&(h=d.vis.append("div").style("float","right").style("display","inline-block").style("margin-right","5px"),c=h.append("div"),c.append("button").attr("id","viewSelect"+d.levelNumber).attr("class","viewSelect").text("Select/Edit Views").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",
function(){$("#mouseHelp").html("Click to select another view or edit the current view.")}),c.append("button").attr("id","viewMenuSelect"+d.levelNumber).attr("class","viewSelectMenu").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Click for options to quickly save and delete your current view.")}),testChrome?d3.select("#viewSelect"+d.levelNumber).style("height","2.3em"):
testSafari?d3.select("#viewSelect"+d.levelNumber).style("height","2.3em"):testFireFox||testIE&&d3.select("#viewSelect"+d.levelNumber).style("position","relative").style("top","-8px").style("height","2.3em"),h=h.append("ul").attr("id","viewSelectMenu"+d.levelNumber),h.append("li").attr("id","menusaveView"+d.levelNumber).on("click",function(){viewMenu[d.levelNumber].saveView(d.currentView.ViewID,d,!1);$("#viewModifiedCtl"+d.level).hide();ga&&ga("send","event","menuSaveView","")}).text("Save"),h.append("li").attr("id",
"menusaveAsView"+d.levelNumber).on("click",function(){viewMenu[d.levelNumber].saveAsView(d.currentView,svgList[d.levelNumber]);$(".viewsLevel"+d.levelNumber).css("top",250).css("left",$(window).width()-610);$(".viewsLevel"+d.levelNumber).fadeIn("fast");$("#viewModifiedCtl"+d.level).hide();ga&&ga("send","event","menuSaveAsView","")}).text("Save As"),h.append("li").attr("id","menudeleteView"+d.levelNumber).on("click",function(){viewMenu[d.levelNumber].confirmDeleteView(d.currentView);$(".viewsLevel"+
d.levelNumber).css("top",250).css("left",$(window).width()-610);$(".viewsLevel"+d.levelNumber).fadeIn("fast");ga&&ga("send","event","menuDeleteView","")}).text("Delete"),$("#viewSelect"+d.levelNumber).button().click(function(){}).next().button({text:!1,icons:{primary:"ui-icon-triangle-1-s"}}).click(function(){var a=$(this).parent().next().show().position({my:"left top",at:"left bottom",of:this});$(document).on("click",function(){a.hide()});return!1}).parent().buttonset().next().hide().menu(),d.vis.append("span").style("float",
"right").style("margin-right","5px").append("span").attr("id","mainAddTrack"+d.levelNumber).attr("class","control").style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mainAddTrack").attr("src","/web/images/icons/addTrack_dark_32.png").attr("pointer-events","all").style("height","37px").style("position","relative").style("top","-8px").on("click",function(){if($(".trackLevel"+d.levelNumber).is(":visible"))$(".trackLevel"+d.levelNumber).fadeOut("fast");
else{var a=$(this).parent().parent().position();trackMenu[d.levelNumber].standalone=!0;$(".trackLevel"+d.levelNumber).css("top",a.top).css("left",a.left+-561);$(".trackLevel"+d.levelNumber+" span#selectedViewName").html(d.currentView.Name);$(".trackLevel"+d.levelNumber).fadeIn("fast");$("div#selectTrack"+d.levelNumber).show();$("div#addUsrTrack"+d.levelNumber).hide();$("div#addUsrTrack"+d.levelNumber).hide();$("div#deleteUsrTrack"+d.levelNumber).hide();setTimeout(function(){trackMenu[d.levelNumber].generateTrackTable()},
250);ga&&ga("send","event","clickAddTrack","")}}).on("mouseout",function(){d3.select(this).attr("src","/web/images/icons/addTrack_dark_32.png");d3.select("span#mainAddTrack"+d.levelNumber).style("background","#DCDCDC");$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){d3.select(this).attr("src","/web/images/icons/addTrack_light_32.png");d3.select("span#mainAddTrack"+d.levelNumber).style("background","#989898");$("#mouseHelp").html("Click to quickly add other tracks to the current view.")}),
h=d.vis.append("span").style("float","right").style("margin-right","5px"),h.append("input").attr("type","checkbox").attr("name","imgCBX").attr("id","forceTrxCBX"+d.levelNumber),h.append("label").attr("for","forceTrxCBX"+d.levelNumber).text("Draw Genes as Transcripts").on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Click to display Gene Tracks as Transcripts. Note: in smaller regions this occurs automatically.")}),
$("input#forceTrxCBX"+d.levelNumber).button(),h=d.vis.append("span").style("float","right").style("margin-right","5px"),c=h.append("div").attr("class","defaultMouse").style("width","64px").attr("id","scrollSize"+d.levelNumber),c.append("span").attr("id","scrollIncr"+d.levelNumber).style("height","24px").style("display","inline-block").style("cursor","pointer").append("img").attr("class","mouseOpt ").attr("src","/web/images/icons/scroll_smaller.png").attr("pointer-events","all").on("click",function(){d.scrollSize-=
100;100>d.scrollSize&&(d.scrollSize=100);changeTrackHeight("Level"+d.levelNumber,d.scrollSize);ga&&ga("send","event","changeScrollHeight","")}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",function(){$("#mouseHelp").html("Decrease the vertical length of the scrollable browser image on the page.")}),c.append("span").attr("id","pan"+d.levelNumber).style("height","24px").style("display","inline-block").style("cursor",
"pointer").append("img").attr("class","mouseOpt pan").attr("src","/web/images/icons/scroll_larger.png").attr("pointer-events","all").on("click",function(){0<$("#ScrollLevel"+d.levelNumber).length&&"undefined"!==typeof $("#ScrollLevel"+d.levelNumber)[0]&&d.scrollSize<$("#ScrollLevel"+d.levelNumber)[0].scrollHeight&&(d.scrollSize+=100,changeTrackHeight("Level"+d.levelNumber,d.scrollSize))}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mouseover",
function(){$("#mouseHelp").html("Increase the vertical length of the scrollable browser image on the page.")}),h.append("span").attr("class","scrollBtn control").style("display","inline-block").attr("id","scrollImage"+d.levelNumber).style("cursor","pointer").append("img").attr("src","/web/images/icons/scroll.png").attr("pointer-events","all").attr("cursor","pointer").on("click",function(){"/web/images/icons/no_scroll.png"==d3.select(this).attr("src")?(d3.select(this).attr("src","/web/images/icons/scroll.png"),
d3.select("span#reset"+d.levelNumber).style("background","#989898"),$("#scrollSize"+d.levelNumber).show(),changeTrackHeight("Level"+d.levelNumber,d.scrollSize)):(d3.select(this).attr("src","/web/images/icons/no_scroll.png"),d3.select("span#reset"+d.levelNumber).style("background","#DCDCDC"),$("#scrollSize"+d.levelNumber).hide(),changeTrackHeight("Level"+d.levelNumber,0));ga&&ga("send","event","toggleImageScroll","")}).on("mouseover",function(){$("#mouseHelp").html("Click to toggle browser image scrolling on/off.  <b>Off</b> the image takes as much space as needed. <b>On</b> you can adjust the maximum length of the image.")}).on("mouseout",
function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}));d.topDiv=d.vis.append("div").attr("id","Level"+b).style("text-align","left");d.xScale=d3.scaleLinear().domain([l,p]).range([0,d.width]);h={};h.chr=chr;h.start=l;h.stop=p;history[d.levelNumber]||(history[d.levelNumber]=[]);history[d.levelNumber].push(h);d.xAxis=d3.axisTop(d.xScale).ticks(6).tickSize(8).tickPadding(10);d.scaleSVG=d.topDiv.append("svg:svg").attr("width",d.width).attr("height",
60).attr("pointer-events","all").attr("class","scale").on("mousedown",d.mdown).on("mouseup",mup).on("mouseover",function(){"dragzoom"!=d.defaultMouseFunct?$("#mouseHelp").html("<B>Zoom:</b> Click and Drag right to zoom in or left to zoom out. <B>OR</B> Hold the Alt/Option Key while clicking, then drag to select a specific area."):$("#mouseHelp").html("<B>Zoom:</b> Click and Drag to select an area to zoom in on it. <B>OR</B> Hold the Alt/Option Key while clicking and drag right to zoom in or left to zoom out.");
d3.event.altKey&&"dragzoom"!=d.defaultMouseFunct?d.changeScaleCursor("crosshair"):d3.event.altKey&&"dragzoom"==d.defaultMouseFunct&&d.changeScaleCursor("ew-resize")}).on("mouseout",function(){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.")}).on("mousemove",function(){d3.event.altKey&&"dragzoom"!=d.defaultMouseFunct?d.changeScaleCursor("crosshair"):d3.event.altKey&&"dragzoom"==d.defaultMouseFunct?d.changeScaleCursor("ew-resize"):d3.event.altKey||
"dragzoom"!=d.defaultMouseFunct?d3.event.altKey||"dragzoom"==d.defaultMouseFunct||d.changeScaleCursor("ew-resize"):d.changeScaleCursor("crosshair")}).style("cursor","ew-resize");d.scaleSVG.append("g").attr("class","x axis").attr("transform","translate(0,55)").attr("shape-rendering","crispEdges").call(d.xAxis);d3.select("#Level"+d.levelNumber).select(".x.axis").append("text").text(a).attr("x",(d.width-2*d.margin)/2).attr("y",-40).attr("class","axisLbl");d.topLevel=d.topDiv.append("div").attr("id",
"ScrollLevel"+b).attr("class","scroll").style("max-height","350px").style("overflow","auto").style("width","100%").append("ul").attr("id","sortable"+b);d.getAddMenus();svgList[b]=d;$("#sortable"+b).sortable({appendTo:"parent",containment:"parent",stop:function(){}}).disableSelection();$(".draggable"+b).draggable({connectToSortable:"#sortable"+b,scroll:!0,revert:"invalid",axis:"y"});l=mmVer;"Rn"==organism&&(l=rnVer);d3.select("div#imageHeader").html("Organism: "+l+"&nbsp&nbsp&nbsp&nbsp"+siteVer);0<
$("span#verSelect").length&&(l=d3.select("span#verSelect").append("select"),d.allowSelectGenomeVer?(l.on("change",function(){displayWorking();!0===isLocalStorage()?localStorage.setItem(organism+"DefGenomeVer",$(this).val()):$.cookie(organism+"DefGenomeVer",$(this).val());changeGenome($(this).val(),d.currentView);setTimeout(function(){$("form#geneCentricForm").submit()},1500)}),"Rn"===organism?(p=l.append("option").attr("value","rn6").html("rn6"),"rn6"===genomeVer&&p.attr("selected","selected"),l=
l.append("option").attr("value","rn5").html("rn5"),"rn5"===genomeVer&&l.attr("selected","selected")):"Mm"===organism&&(l=l.append("option").attr("value","mm10").html("mm10"),"mm10"===genomeVer&&l.attr("selected","selected"))):l.append("option").attr("value",genomeVer).html(genomeVer));d.addTrack("genomeSeq",3,"both",0);d.selectSvg=selectionSVG("#Level"+d.levelNumber,d.width,d.levelNumber,d);return d}
function toolTipSVG(e,h,l,p,b,a,c){var f={isToolTip:1};f.folderName=regionfolderName;f.updateTimeoutHandle={};f.timeoutTrack=-1;f.forLevel=-1;f.strainSpecificCountColors=d3.scaleOrdinal(d3.schemeCategory20);f.get=function(a){return f[a]};f.getTrack=function(a){for(var d,c=0;c<f.trackList.length;c++)"undefined"!==typeof f.trackList[c]&&f.trackList[c].trackClass===a&&(d=f.trackList[c]);return d};f.addTrackErrorRemove=function(a,c){};f.addTrack=function(a,c,b,g){"Trx"==f.forceDrawAsValue&&-1==(new String(b)).indexOf("DrawTrx")&&
(b+="DrawTrx,");var d=d3.select("#Level"+f.levelNumber+a).nodes();if(0===d.length||null==d){d=f.topLevel.append("li").attr("class","draggable"+f.levelNumber).append("svg:svg").attr("width",f.get("width")).attr("height",30).attr("class","track").attr("id","Level"+f.levelNumber+a);var k=new String("Loading...");d.append("text").text(k).attr("x",f.width/2-k.length/2*7.5).attr("y",12).attr("id","trkLbl")}d="";-1<f.forLevel&&99==f.levelNumber&&"undefined"!==typeof svgList[f.forLevel]&&(d=svgList[f.forLevel].getTrack(a).generateTrackSettingString(),
b=d=d.substr(d.indexOf(",")+1));if("genomeSeq"===a){var n=SequenceTrack(f,a,"Reference Genomic Sequence",b);n.seqRegionSize=10;f.addTrackList(n)}else if(-1<a.indexOf("noncoding"))n=GeneTrack(f,g,a,"Non-Coding/Non-PolyA+ Transcripts",b),f.addTrackList(n);else if(-1<a.indexOf("coding"))n=GeneTrack(f,g,a,"Protein Coding/PolyA+ Transcripts",b),f.addTrackList(n);else if(0===a.indexOf("liverTotal")||"heartTotal"===a||0===a.indexOf("brainTotal")||"mergedTotal"===a)c="Liver Total RNA Transcripts","heartTotal"===
a?c="Heart Total RNA Transcripts":"brainTotal"===a?c="Brain Total RNA Transcripts":"mergedTotal"===a&&(c="Merged (Brain,Heart,Liver) Reconstructed"),n=GeneTrack(f,g,a,c,b),f.addTrackList(n);else if(-1<a.indexOf("smallnc"))n=GeneTrack(f,g,a,"Small RNA (<200 bp) Genes",b),f.addTrackList(n);else if(0===a.indexOf("refSeq"))99===f.levelNumber&&(b+="DrawTrx,"),n=RefSeqTrack(f,g,a,"Ref Seq Genes",b),n.density=99===f.levelNumber?2:c,f.addTrackList(n);else if(0===a.indexOf("snp"))n=SNPTrack(f,g,a,1,"4"),f.addTrackList(n);
else if("qtl"===a)n=QTLTrack(f,g,a,1),f.addTrackList(n);else if("trx"===a)g=getAllChildrenByName(getFirstChildByName(f.selectedData,"TranscriptList"),"Transcript"),n=TranscriptTrack(f,g,a,c),f.addTrackList(n);else if("probe"===a||"probeMouse"===a)99!==f.levelNumber&&(b=c+","+b),n=ProbeTrack(f,g,a,"Affy Exon 1.0 ST Probe Sets",b),f.addTrackList(n);else if(-1<a.indexOf("spliceJnct"))b="Brain ","liverspliceJnct"===a?b="Liver ":"heartspliceJnct"===a&&(b="Heart "),n=SpliceJunctionTrack(f,g,a,b+"Splice Junctions",
3,""),100===f.levelNumber&&(n.density=c),f.addTrackList(n);else if("polyASite"===a)n=PolyATrack(f,g,a,"Predicted PolyA Sites",b),f.addTrackList(n);else if("helicos"===a||-1<a.indexOf("illuminaTotal")||-1<a.indexOf("illuminaSmall")||"illuminaPolyA"===a){f.updateTimeoutHandle[a]&&(f.updateTimeoutHandle[a]=-1);c=2;b=d.split(",");1<b.length&&(1===b[1]||2===b[1])&&(c=b[1]);"helicos"===a?n=HelicosTrack(f,g,a,c):"illuminaTotal"===a?n=IlluminaTotalTrack(f,g,a,c):"illuminaSmall"===a?n=IlluminaSmallTrack(f,
g,a,c):"illuminaPolyA"===a?n=IlluminaPolyATrack(f,g,a,c):"liverilluminaTotalPlus"===a?n=LiverIlluminaTotalPlusTrack(f,g,a,c):"liverilluminaTotalMinus"===a?n=LiverIlluminaTotalMinusTrack(f,g,a,c):"heartilluminaTotalPlus"===a?n=HeartIlluminaTotalPlusTrack(f,g,a,c):"heartilluminaTotalMinus"===a?n=HeartIlluminaTotalMinusTrack(f,g,a,c):"brainilluminaTotalPlus"===a?n=BrainIlluminaTotalPlusTrack(f,g,a,c):"brainilluminaTotalMinus"===a?n=BrainIlluminaTotalMinusTrack(f,g,a,c):"liverilluminaSmall"===a?n=LiverIlluminaSmallTrack(f,
g,a,c):"heartilluminaSmall"===a?n=HeartIlluminaSmallTrack(f,g,a,c):-1<a.indexOf("illuminaTotal")&&(n=StrainSpecificIlluminaTotalTrack(f,g,a,c));if(99===f.levelNumber){if(0!==f.updateTimeoutHandle[a]){clearTimeout(f.updateTimeoutHandle[a]);try{clearTimeout(f.timeoutTrack[a].fullDataTimeOutHandle)}catch(v){}f.updateTimeoutHandle[a]=0}f.updateTimeoutHandle[a]=setTimeout(function(){n.updateFullData(0,1);f.timeoutTrack[a]=n;f.updateTimeoutHandle[a]=0},300)}f.addTrackList(n)}else if(0===a.indexOf("repeatMask"))n=
RepeatMaskTrack(f,g,a,"Repeat Masker",1,b),f.addTrackList(n);else if(-1<a.indexOf("custom"))if(c=trackInfo[a],b="DataFile="+c.Location+","+b,"bed"===c.Type||"bb"===c.Type)g=[],n=CustomTranscriptTrack(f,g,a,c.Name,3,b),f.addTrackList(n);else if("bg"===c.Type||"bw"===c.Type)g=[],n=CustomCountTrack(f,g,a,3,b),f.addTrackList(n);$(".sortable"+f.levelNumber).sortable("refresh")};f.addTrackList=function(a){null!=a&&(f.trackList[f.trackCount]=a,f.trackCount++,setTimeout(function(){DisplayRegionReport()},
300))};f.changeTrackHeight=function(a,c){0<c?d3.select("#"+a+"Scroll").style("max-height",c+"px"):d3.select("#"+a+"Scroll").style("max-height","none")};f.removeAllTracks=function(){for(var a=0;a<f.trackList.length;a++)"undefined"!==typeof f.trackList[a]&&"genomeSeq"!==f.trackList[a].trackClass&&d3.select("#Level"+f.levelNumber+f.trackList[a].trackClass).remove();f.trackList=[];setTimeout(function(){DisplayRegionReport()},300)};f.removeTrack=function(a){d3.select("#Level"+f.levelNumber+a).remove();
for(var c=0;c<f.trackList.length;c++)"undefined"!==typeof f.trackList[c]&&f.trackList[c].trackClass==a&&(f.trackList.splice(c,1),f.trackCount--);setTimeout(function(){DisplayRegionReport()},300)};f.redrawTrack=function(a){for(var c=0;c<f.trackList.length;c++)"undefined"!==typeof f.trackList[c]&&f.trackList[c].trackClass==a&&f.trackList[c].redraw();setTimeout(function(){DisplayRegionReport()},300)};f.redraw=function(){for(var a=0;a<f.trackList.length;a++)"undefined"!==typeof f.trackList[a]&&"undefined"!==
typeof f.trackList[a].redraw&&f.trackList[a].redraw()};f.update=function(){for(var a=0;a<f.trackList.length;a++)"undefined"!==typeof f.trackList[a].update&&f.trackList[a].update();setTimeout(function(){DisplayRegionReport()},300)};f.updateData=function(){for(var a=0;a<f.trackList.length;a++)"undefined"!==typeof f.trackList[a]&&"undefined"!==typeof f.trackList[a].updateData&&f.trackList[a].updateData(0);f.updateFullData();setTimeout(function(){DisplayRegionReport()},300)};f.updateFullData=function(){-1<
(new String(f.folderName)).indexOf("img")&&$.ajax({url:pathPrefix+"getFullPath.jsp",type:"GET",async:!1,data:{chromosome:chr,minCoord:f.xScale.domain()[0],maxCoord:f.xScale.domain()[1],panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer},dataType:"json",success:function(a){f.folderName=a.folderName},error:function(a,c,b){}});for(var a=0;a<f.trackList.length;a++)"undefined"!==typeof f.trackList[a]&&"undefined"!==typeof f.trackList[a].updateFullData&&
f.trackList[a].updateFullData(0,1)};f.setLoading=function(){for(var a=0;a<f.trackList.length;a++)"undefined"===typeof f.trackList[a]||"undefined"===typeof f.trackList[a].updateData&&"undefined"===typeof f.trackList[a].updateFullData||f.trackList[a].showLoading()};f.clearSelection=function(){for(var a=0;a<f.trackList.length;a++)"undefined"!==typeof f.trackList[a]&&"undefined"!==typeof f.trackList[a].clearSelection&&f.trackList[a].clearSelection()};f.mdown=function(){if(0==processAjax){f.prevMinCoord=
f.xScale.domain()[0];f.prevMaxCoord=f.xScale.domain()[1];var a=d3.mouse(f.vis.node());f.downx=f.xScale.invert(a[0]);f.downscalex=f.xScale}};f.forceDrawAs=function(a){for(var c=0;c<f.trackList.length;c++)"undefined"!==typeof f.trackList[c]&&"undefined"!==typeof f.trackList[c].drawAs&&(f.trackList[c].drawAs=a,f.trackList[c].draw(f.trackList[c].data));f.forceDrawAsValue=a};f.generateSettingsString=function(){ret="";for(var a=0;a<f.trackList.length;a++)"undefined"!==typeof f.trackList[a]&&"undefined"!==
typeof f.trackList[a].generateTrackSettingString&&(ret+=f.trackList[a].generateTrackSettingString());return ret};f.setCurrentViewModified=function(){"undefined"!==typeof f.currentView&&(f.currentView.modified=1,$("span#viewModifiedCtl"+f.levelNumber).show())};f.clearCurrentView=function(){f.currentView.modified=0;$("span#viewModifiedCtl"+f.levelNumber).hide()};f.type=c;f.div=e;f.margin=0;f.halfWindowWidth=$(window).width()/2;f.mh=400;f.downx=Math.NaN;f.downscalex;f.downPanx=Math.NaN;f.xMax=29E7;f.xMin=
1;f.prevMinCoord=l;f.prevMaxCoord=p;f.dataMinCoord=l;f.dataMaxCoord=p;f.y=0;f.xScale=null;f.xAxis=null;f.vis=null;f.level=null;f.svg=null;f.txType=null;f.txList=null;f.tt=null;f.trackList=[];f.trackCount=0;f.levelNumber=b;f.selectedData=null;f.txType=null;f.width=h;f.mw=f.width-f.margin;f.vis=d3.select(e);f.topDiv=f.vis.append("div").attr("id","Level"+b).style("text-align","left");f.xScale=d3.scaleLinear().domain([l,p]).range([0,f.width]);f.xAxis=d3.axisTop(f.xScale).ticks(3).tickSize(8).tickPadding(10);
f.scaleSVG=f.topDiv.append("svg:svg").attr("width",f.width).attr("height",60).attr("class","scale");f.scaleSVG.append("g").attr("class","x axis").attr("transform","translate(0,55)").attr("shape-rendering","crispEdges").call(f.xAxis);d3.select("#Level"+f.levelNumber).select(".x.axis").append("text").text(a).attr("x",(f.width-2*f.margin)/2).attr("y",-40).attr("class","axisLbl");f.topLevel=f.topDiv.append("div").attr("id","ScrollLevel"+f.levelNumber).style("width",f.width+18+"px").append("ul").attr("id",
"sortable"+f.levelNumber);return f}
function selectionSVG(e,h,l,p){var b={};b.imageWidth=h+25;b.levelNumber=l;b.parent=p;b.coordSelectStart=0;b.coordSelectStop=0;b.visible=!1;b.changeSelection=function(a,c){b.start=a;b.stop=c;b.setVis(!0);b.draw()};b.setVis=function(a){b.visible=a;b.visible?(b.svg.style("display","inline-block"),$("div#regionDiv").hide()):(b.svg.style("display","none"),$("div#regionDiv").show())};b.draw=function(){if(b.visible){b.xScale(b.stop);b.xScale(b.start);b.parent.updateTrackSelectedArea(b.start,b.stop);var a=
new String(numberWithCommas(Math.floor(b.start))),c=new String(numberWithCommas(Math.floor(b.stop)));b.svg.selectAll("line").remove();b.svg.selectAll("text").remove();b.svg.append("line").attr("x1",function(){var a=b.xScale(b.start);0>a&&(a=0);return a}).attr("x2",function(){var a=b.xScale(b.start);0>a&&(a=0);return a}).attr("y1",0).attr("y2",15).attr("stroke","#00992D").attr("stroke-width","1");b.svg.append("line").attr("x1",function(){return b.xScale(b.stop)}).attr("x2",function(){return b.xScale(b.stop)}).attr("y1",
0).attr("y2",15).attr("stroke","#00992D").attr("stroke-width","1");b.svg.append("line").attr("x1",function(){var a=b.xScale(b.start);0>a&&(a=0);return a}).attr("x2",0).attr("y1",15).attr("y2",60).attr("stroke","#00992D").attr("stroke-width","1");b.svg.append("line").attr("x1",function(){return b.xScale(b.stop)}).attr("x2",b.imageWidth).attr("y1",15).attr("y2",60).attr("stroke","#00992D").attr("stroke-width","1");b.svg.append("text").attr("x",b.xScale(b.start)-7.5*a.length-10).attr("y",15).text(a);
b.svg.append("text").attr("x",b.xScale(b.stop)+10).attr("y",15).text(c)}};b.redraw=function(){b.draw()};b.setup=function(){b.svg=d3.select(e).append("svg:svg").attr("width",b.imageWidth).attr("height",60).attr("id","selectionLevel"+b.levelNumber).style("display","none");b.xScale=b.parent.xScale};b.setup();return b}
function Track(e,h,l,p){var b={};b.selectionStart=e.selectionStart;b.selectionEnd=e.selectionEnd;b.ttSVGMinWidth=20;b.panDown=function(){if(!d3.event.shiftKey&&0===b.gsvg.overSettings&&0===overSelectable&&("dragzoom"!==b.gsvg.defaultMouseFunct&&d3.event.altKey||"dragzoom"===b.gsvg.defaultMouseFunct&&!d3.event.altKey)){var a=d3.mouse(b.gsvg.vis.node());b.gsvg.downZoomx=a[0];b.svg.append("rect").attr("class","zoomRect").attr("x",a[0]).attr("y",0).attr("height",b.svg.attr("height")).attr("width",1).attr("fill",
"#CECECE").attr("opacity",.3);b.scaleSVG.append("rect").attr("class","zoomRect").attr("x",a[0]).attr("y",0).attr("height",b.scaleSVG.attr("height")).attr("width",1).attr("fill","#CECECE").attr("opacity",.3);b.scaleSVG.append("text").attr("id","zoomTextStart").attr("x",b.gsvg.downZoomx).attr("y",15).text(numberWithCommas(Math.round(b.xScale.invert(b.gsvg.downZoomx))));b.scaleSVG.append("text").attr("id","zoomTextEnd").attr("x",b.gsvg.downZoomx).attr("y",50).text(numberWithCommas(Math.round(b.xScale.invert(b.gsvg.downZoomx))))}else!d3.event.shiftKey&&
0===b.gsvg.overSettings&&0===overSelectable&&("pan"===b.gsvg.defaultMouseFunct&&!d3.event.altKey||"pan"!==b.gsvg.defaultMouseFunct&&d3.event.altKey)&&0==processAjax&&(a=d3.mouse(b.gsvg.vis.node()),b.gsvg.downPanx=a[0],b.gsvg.downscalex=b.xScale)};b.zoomToFeature=function(a){var c=parseInt(a.getAttribute("stop"),10)-parseInt(a.getAttribute("start"),10);c*=.25;var f=parseInt(a.getAttribute("start"),10)-c;a=parseInt(a.getAttribute("stop"),10)+c;a<=b.gsvg.xMax&&1<=f&&(b.xScale.domain([f,a]),b.scaleSVG.select(".x.axis").call(b.xAxis),
b.gsvg.redraw(),0==b.gsvg.levelNumber||1==b.gsvg.levelNumber)&&(c={},c.chr=chr,c.start=f,c.stop=a,history[b.gsvg.levelNumber].push(c))};b.clearSelection=function(){b.selectionStart=-1;b.selectionEnd=-1;b.svg.selectAll("rect.selectedArea").remove();b.svg.selectAll(".selected").each(function(){b.svg.select(this).attr("class","").style("fill",b.color)})};b.setSelectedArea=function(a,c){b.selectionStart=a;b.selectionEnd=c;b.redrawSelectedArea()};b.redrawSelectedArea=function(){d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass).selectAll(".selectedArea").remove();if(-1<b.selectionStart&&-1<b.selectionEnd){var a=b.xScale(b.selectionStart),c=b.xScale(b.selectionEnd)-a;1>c&&(c=1);d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).append("rect").attr("class","selectedArea").attr("x",a).attr("y",0).attr("height",function(){var a=b.svg.attr("height");15>a&&(a=15);return a}).attr("width",c).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none")}};b.colorStroke=function(a){var c="black";3>b.xScale(a.getAttribute("stop"))-
b.xScale(a.getAttribute("start"))&&(c=b.color(a));return c};b.calcY=function(a,c,f){a=3===b.density||"3"===b.density?b.calcYPack(a,c,f):2===b.density||"2"===b.density?b.calcYFull(f):b.calcYDense();b.trackYMax<a/15&&(b.trackYMax=a/15);return a};b.calcYPack=function(a,c,f){if(a>=b.xScale.domain()[0]&&a<=b.xScale.domain()[1]||c>=b.xScale.domain()[0]&&c<=b.xScale.domain()[1]||a<=b.xScale.domain()[0]&&c>=b.xScale.domain()[1]){a=Math.round(b.xScale(a));0>a&&(a=0);c=Math.round(b.xScale(c));c>=b.gsvg.width&&
(c=b.gsvg.width-1);f=a-b.xPadding;0>f&&(f=0);var d=c+b.xPadding;d>=b.gsvg.width&&(d=b.gsvg.width-1);for(var n=0,k=f;k<=d;k++)b.yMaxArr[k]>n&&(n=b.yMaxArr[k]);n++;var g=n;if(b.yArr.length<=n)for(b.yArr[g]=[],k=0;k<b.gsvg.width;k++)b.yArr[g][k]=0;k=n-b.scanBackYLines;1>k&&(k=1);g=0;for(var q=k;q<n&&0==g;q++){var m=0;for(k=f;k<=d&&0==m;k++)b.yArr[q][k]>m&&(m=1);0==m&&(n=q,g=1)}n>b.trackYMax&&(b.trackYMax=n);for(k=a;k<=c;k++)b.yMaxArr[k]<n&&(b.yMaxArr[k]=n),b.yArr[n][k]=1;a=15*n}else a=15;return a};b.calcYDense=
function(){return 15};b.calcYFull=function(a){return 15*(a+1)};b.positionTTLeft=function(a){a+=20;a>b.gsvg.halfWindowWidth&&(a-=490);return a+"px"};b.positionTTTop=function(a){a=window.pageYOffset+10;var c=window.innerHeight-1.8*$(".testToolTip").height();20<c&&(a+=c/2);return a};b.drawLegend=function(a){var c=new String(b.label),f=b.gsvg.width/2+c.length/2*7.5+16;500>b.gsvg.width&&(f=7.5*c.length);d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".legend").remove();for(var d=0;d<a.length;d++)b.svg.append("rect").attr("class",
"legend").attr("x",f).attr("y",0).attr("rx",3).attr("ry",3).attr("height",12).attr("width",16).attr("fill",a[d].color).attr("stroke",a[d].color),c=new String(a[d].label),b.svg.append("text").text(c).attr("class","legend").attr("x",f+18).attr("y",12),f=f+25+8*c.length};b.drawScaleLegend=function(a,c,f,d,n,k){var g=new String(b.label),q=b.gsvg.width/2+g.length/2*7.5+16;500>b.gsvg.width&&(q=7.5*g.length);q+=k;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".legend").remove();d3.select("#Level"+
b.gsvg.levelNumber+b.trackClass).selectAll("#def1").remove();g=b.svg.append("defs").attr("id","def1").append("linearGradient").attr("id","grad"+b.gsvg.levelNumber+b.trackClass);g.append("stop").attr("offset","0%").style("stop-color",d);g.append("stop").attr("offset","100%").style("stop-color",n);g=new String(a);a=7.6*g.length;b.svg.append("text").text(g).attr("class","legend").attr("x",q).attr("y",12);b.svg.append("rect").attr("class","legend").attr("x",q+a+5).attr("y",0).attr("rx",3).attr("ry",3).attr("height",
12).attr("width",75).attr("fill","url(#grad"+b.gsvg.levelNumber+b.trackClass+")");g=new String(c);b.svg.append("text").text(g).attr("class","legend").attr("x",q+a+80).attr("y",12);c=8*g.length+5;g=new String(f);b.svg.append("text").text(g).attr("class","legend").attr("x",q+a+80+c).attr("y",12)};b.showLoading=function(){0<d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.loading")?b.loading=d3.select(b.svg).selectAll("g.loading"):(b.loading=b.svg.append("g").attr("class","loading"),
b.loading.append("rect").attr("x",0).attr("y",0).attr("height",b.svg.attr("height")).attr("width",b.gsvg.width).attr("fill","#CECECE").attr("opacity",.6),b.loading.append("text").text("Loading...").attr("x",b.gsvg.width/2-37.5).attr("y",b.svg.attr("height")/2))};b.hideLoading=function(){b.loading=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.loading");"undefined"!==typeof b.loading&&b.loading.remove()};b.displayBreakDown=function(a){$(window).width();1E3<$(window).width()&&$(window).width();
if("undefined"!==typeof b.counts&&0<b.counts.length){for(var c=1,f=0;f<b.counts.length&&1===c;f++)0<b.counts[f].value&&(c=0);if(0===c){var d=d3.arc().outerRadius(140).innerRadius(0);c=d3.pie().value(function(a){return a.value});a=d3.select(a).append("svg").attr("width",300).attr("height",300).append("g").attr("transform","translate(150,150)").selectAll(".arc").data(c(b.counts)).enter().append("g").attr("class","arc");a.append("path").attr("d",d).attr("fill",b.pieColor).on("mouseover",function(a){d3.select(".testToolTip").transition().duration(200).style("opacity",
.95);d3.select(".testToolTip").html("Name: "+a.data.names+"<BR>Count: "+a.data.value).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px");b.triggerTableFilter(a)}).on("mouseout",function(a){d3.select(".testToolTip").transition().delay(500).duration(200).style("opacity",0);b.clearTableFilter(a)});a.append("text").attr("transform",function(a){return"translate("+d.centroid(a)+")"}).attr("dy",".35em").attr("fill","#FFFFFF").style("text-anchor","middle").text(function(a){var c=a.value;
0==a.value&&(c="");return c})}}};b.updateLabel=function(a){b.label=a;a=new String(b.label);600<b.gsvg.width?d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("#trkLbl").attr("x",b.gsvg.width/2-a.length/2*7.5).text(a):d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select("#trkLbl").attr("x",0).text(a);d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select(".infoIcon").attr("transform","translate("+(b.gsvg.width-20)+",0)");d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).select(".settings").attr("transform",
"translate("+(b.gsvg.width-40)+",0)")};b.resize=function(){d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).attr("width",b.gsvg.width);b.updateLabel(b.label);"undefined"!==typeof b.redrawLegend&&b.redrawLegend();b.redraw()};b.triggerTableFilter=function(a){};b.clearTableFilter=function(a){};b.getDisplayID=function(a){return a.getAttribute("ID")};b.setupToolTipSVG=function(a,c){var f=parseInt(a.getAttribute("start"),10),d=parseInt(a.getAttribute("stop"),10),n=Math.floor((d-f)*c);20>n&&(n=20);var k=
f-n;n=d+n;1>k&&(k=1);"undefined"!==typeof b.ttSVGMinWidth&&n-k<b.ttSVGMinWidth&&(k=f-b.ttSVGMinWidth/2,n=d+b.ttSVGMinWidth/2);f=toolTipSVG("div#ttSVG",450,k,n,99,b.getDisplayID(a),"transcript");f.forLevel=b.gsvg.levelNumber;d=[];d.push(a);f.addTrack(b.trackClass,3,"",d);for(d=0;d<b.ttTrackList.length;d++){var g=b.gsvg.getTrackData(b.ttTrackList[d]),q=[];if("undefined"!==typeof g&&0<g.length){for(var m=0,e=0;e<g.length;e++)if(k<=parseInt(g[e].getAttribute("start"),10)&&parseInt(g[e].getAttribute("start"),
10)<=n||parseInt(g[e].getAttribute("start"),10)<=k&&parseInt(g[e].getAttribute("stop"),10)>=k)q[m]=g[e],m++;0<q.length&&f.addTrack(b.ttTrackList[d],3,"DrawTrx",q)}}};b.generateSettingsDiv=function(a){b.savePrevious();var c=trackInfo[b.trackClass];d3.select(a).select("table").select("tbody").html("");if("undefined"!==typeof c&&0<c.Controls.length&&"null"!=c.Controls){var f=(new String(c.Controls)).split(",");a=d3.select(a).select("table").select("tbody");a.append("tr").append("td").style("font-weight",
"bold").html("Track Settings: "+c.Name);for(c=0;c<f.length;c++)if("undefined"!==typeof f[c]&&""!=f[c]){var d=f[c].split(";"),n=a.append("tr").append("td"),k=d[0].substr(5);n.append("text").text(k+": ");k="";3<d.length&&0==d[3].indexOf("Default=")&&(k=d[3].substr(8));if(0==d[1].toLowerCase().indexOf("select")){var g=d[1].split(":");d=d[2].split("}");var q="",m="";2<g.length&&(q=g[2]);3<g.length&&(m=g[3]);n=n.append("select").attr("id",b.trackClass+q+b.level+m).attr("name",g[1]);for(g=0;g<d.length;g++){var e=
d[g].substr(1).split(":");if(2==e.length){var h=n.append("option").attr("value",e[1]).text(e[0]);"Dense"===q&&e[1]==b.density?h.attr("selected","selected"):"Version"===q&&e[1]==b.dataVer?h.attr("selected","selected"):e[1]==k&&h.attr("selected","selected")}}d3.select("select#"+b.trackClass+q+b.level+m).on("change",function(){b.updateSettingsFromUI();b.redraw()})}else console.log("Undefined track settings:  "+f[c])}f=a.append("tr").append("td");f.append("input").attr("type","button").attr("value","Remove Track").style("float",
"left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.setCurrentViewModified();b.gsvg.removeTrack(b.trackClass);var a=svgList[b.gsvg.levelNumber].currentView.ViewID,c=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,a);c=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(c.TrackID,a);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(c,a)});f.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left",
"5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density!=b.prevSetting.density&&b.gsvg.setCurrentViewModified()});f.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){b.revertPrevious();b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else c&&(a=d3.select(a).select("table").select("tbody"),a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),a.append("tr").append("td").html("Sorry no settings for this track."),
f=a.append("tr").append("td"),f.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.setCurrentViewModified();b.gsvg.removeTrack(b.trackClass)}),f.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}))};b.updateSettingsFromUI=function(){0<$("#"+b.trackClass+
"Dense"+b.level+"Select").length&&(b.density=$("#"+b.trackClass+"Dense"+b.level+"Select").val())};b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density};b.revertPrevious=function(){b.density=b.prevSetting.density};b.updateSettings=function(a){};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+";"};b.gsvg=e;b.level=b.gsvg.levelNumber;b.data=h;b.label=p;b.density=3;b.loading;b.trackYMax=0;b.trackClass=l;b.topLevel=b.gsvg.get("topLevel");b.xScale=b.gsvg.get("xScale");
b.scaleSVG=b.gsvg.get("scaleSVG");b.xAxis=b.gsvg.get("xAxis");b.yMaxArr=[];b.yArr=[];b.yArr[0]=[];for(e=0;e<b.gsvg.width;e++)b.yMaxArr[e]=0,b.yArr[0][e]=0;b.scanBackYLines=12;b.xPadding=2;b.vis=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass);b.svg=d3.select("svg#Level"+b.gsvg.levelNumber+b.trackClass);b.svg.on("mousedown",b.panDown);b.updateLabel(b.label);return b}
function SequenceTrack(e,h,l,p){p=[];var b=Track(e,p,h,l);b.dispCutoff=300;b.aaDispCutoff=2900;b.seqRegionSize=4E3;b.strands="both";b.includeAA=1;b.labelBase=l;b.lastUpdate=0;b.seqRegionMin=0;b.seqRegionMax=0;b.color=function(a){};b.colorAA=function(a,c){d3.rgb("#FFFFFF");var b=0==a.pos%2?d3.rgb("#C3C3C3"):d3.rgb("#838383");"M"==a.aa&&(b=d3.rgb("#00FF00"));"*"==a.aa&&(b=d3.rgb("#FF0000"));return b};b.createCodon=function(){b.codons=[];b.codons.AAA="K";b.codons.AAT="N";b.codons.AAG="K";b.codons.AAC=
"N";b.codons.ATA="I";b.codons.ATT="I";b.codons.ATG="M";b.codons.ATC="I";b.codons.ACA="T";b.codons.ACT="T";b.codons.ACG="T";b.codons.ACC="T";b.codons.AGA="R";b.codons.AGT="S";b.codons.AGG="R";b.codons.AGC="S";b.codons.TAA="*";b.codons.TAT="Y";b.codons.TAG="*";b.codons.TAC="Y";b.codons.TTA="L";b.codons.TTT="F";b.codons.TTG="L";b.codons.TTC="F";b.codons.TCA="S";b.codons.TCT="S";b.codons.TCG="S";b.codons.TCC="S";b.codons.TGA="*";b.codons.TGT="C";b.codons.TGG="W";b.codons.TGC="C";b.codons.CAA="Q";b.codons.CAT=
"H";b.codons.CAG="Q";b.codons.CAC="H";b.codons.CTA="L";b.codons.CTT="L";b.codons.CTG="L";b.codons.CTC="L";b.codons.CCA="P";b.codons.CCT="P";b.codons.CCG="P";b.codons.CCC="P";b.codons.CGA="R";b.codons.CGT="R";b.codons.CGG="R";b.codons.CGC="R";b.codons.GAA="E";b.codons.GAT="D";b.codons.GAG="E";b.codons.GAC="D";b.codons.GTA="V";b.codons.GTT="V";b.codons.GTG="V";b.codons.GTC="V";b.codons.GCA="A";b.codons.GCT="A";b.codons.GCG="A";b.codons.GCC="A";b.codons.GGA="G";b.codons.GGT="G";b.codons.GGG="G";b.codons.GGC=
"G"};b.translate=function(a){a=a.toUpperCase();return b.codons[a]};b.translateRegion=function(a,c,f,d){var n=[],k=0,g=0;if(b.data){if(f>d){g=1;var q=f;f=d;d=q}for(q=f;q<=d;q+=3){var m=b.data.substring(q,q+3);1==g&&(m=b.reverseCompliment(m));n[k]=[];n[k].aa=b.translate(m);n[k].pos=c+(q-f);n[k].id=a+":"+q+":"+b.translate(m);k++}}return n};b.reverseCompliment=function(a){for(var c="",f=a.length-1;-1<f;f--)c+=b.complement(a.charAt(f));return c};b.complement=function(a){var c="N";"A"==a?c="T":"T"==a?c=
"A":"G"==a?c="C":"C"==a&&(c="G");return c};b.redraw=function(){b.redrawSelectedArea();var a=b.xScale.domain()[0],c=b.xScale.domain()[1];if(b.prevStrand!=b.strands||b.prevIncldAA!=b.includeAA)d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.base").each(function(a){d3.select(this).remove()}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.aa0").each(function(a){d3.select(this).remove()}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.aa1").each(function(a){d3.select(this).remove()}),
d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.aa2").each(function(a){d3.select(this).remove()}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.aarev0").each(function(a){d3.select(this).remove()}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.aarev1").each(function(a){d3.select(this).remove()}),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.aarev2").each(function(a){d3.select(this).remove()}),a<b.seqRegionMin||c>b.seqRegionMax?
b.updateData(0):b.draw(b.data);else if(a<b.seqRegionMin||c>b.seqRegionMax)b.updateData(0);else{var f=c-a,d="12px";200<f&&(d="10px");if(f<=b.aaDispCutoff&&1==b.includeAA||f<=b.dispCutoff){if(b.seqRegionMin<=a&&a<=b.seqRegionMax&&b.seqRegionMin<=c&&c<=b.seqRegionMax){var n=b.gsvg.width/f,k=n/2;c=a-b.seqRegionMin;var g=f+c,q=27;1==b.includeAA&&"-"!=b.strands&&(q+=30);if(f<b.dispCutoff){d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.line").remove();for(var m=[],e=c;e<g;e++)m[e-c]=[],
m[e-c].base=b.data.charAt(e),m[e-c].id=e,m[e-c].pos=e-c;b.textSize(f);var h=b.yPosition(f);e=b.svg.selectAll(".base").data(m,keyID).attr("transform",function(a,c){return"translate("+(a.pos*n-k)+","+q+")"});m=e.enter().append("g").attr("class","base").attr("transform",function(a,c){return"translate("+(a.pos*n-k)+","+q+")"});m.each(function(a){d3.select(this).append("text").text(function(a){return"-"!=b.strands?a.base:b.complement(a.base)});"both"==b.strands&&d3.select(this).append("text").attr("class",
"comp").attr("y",h).text(function(a){return b.complement(a.base)})});e.exit().remove();e.selectAll("text").attr("font-size",function(a){return b.textSize(f)});e.selectAll("text.comp").attr("y",h)}else d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.base").remove(),b.svg.append("g").attr("class","line").append("line").attr("stroke","#000000").attr("x1",0).attr("y1",q).attr("x2",b.gsvg.width).attr("y2",q);if(1==b.includeAA){var l=3*n,p=l/2-4,t=25;if("both"==b.strands||"+"==b.strands)for(e=
a%3,m=c-e,g=[],g[0]=b.translateRegion(0,a-e,m,m+f),g[1]=b.translateRegion(1,a-e-1,m-1,m-1+f),g[2]=b.translateRegion(2,a-e-2,m-2,m-2+f),t=25,e=0;3>e;e++){var u=b.svg.selectAll(".aa"+e).data(g[e],keyID).attr("transform",function(a,c){return"translate("+(b.xScale(a.pos)-n)+","+t+")"}).each(function(a){d3.select(this).select("rect").attr("width",l);f<b.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",p).attr("font-size",d).text(function(a){return a.aa}):d3.select(this).select("text").attr("x",
p).attr("font-size",d):d3.select(this).select("text").remove()});m=u.enter().append("g").attr("class","aa"+e).attr("transform",function(a,c){return"translate("+(b.xScale(a.pos)-n)+","+t+")"});m.each(function(a){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",l).attr("stroke",b.colorAA).attr("fill",b.colorAA);f<b.dispCutoff&&d3.select(this).append("text").attr("x",p).attr("font-size",d).text(function(a){return a.aa})});u.exit().remove();t+=11}t="both"==b.strands?80:45;if("both"==
b.strands||"-"==b.strands)for(e=a%3,m=c-e,g=[],g[0]=b.translateRegion(0,a-e,m+f,m),g[1]=b.translateRegion(1,a-e-1,m-1+f,m-1),g[2]=b.translateRegion(2,a-e-2,m-2+f,m-2),e=0;3>e;e++)u=b.svg.selectAll(".aarev"+e).data(g[e],keyID).attr("transform",function(a,c){return"translate("+(b.xScale(a.pos)-n)+","+t+")"}).each(function(a){d3.select(this).select("rect").attr("width",l);f<b.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",p).attr("font-size",d).text(function(a){return a.aa}):
d3.select(this).select("text").attr("x",p).attr("font-size",d):d3.select(this).select("text").remove()}),m=u.enter().append("g").attr("class","aarev"+e).attr("transform",function(a,c){return"translate("+b.xScale(a.pos)+","+t+")"}),m.each(function(a){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",l).attr("stroke",b.colorAA).attr("fill",b.colorAA);f<b.dispCutoff&&d3.select(this).append("text").attr("x",p).attr("font-size",d).text(function(a){return a.aa})}),u.exit().remove(),
t+=11;"both"==b.strands?b.svg.attr("height",125):b.svg.attr("height",75)}else"both"==b.strands?b.svg.attr("height",45):b.svg.attr("height",30)}else b.updateData(0);$("li.draggable"+b.gsvg.levelNumber+"#li"+b.trackClass).show()}else b.svg.attr("height",0),$("li.draggable"+b.gsvg.levelNumber+"#li"+b.trackClass).hide()}};b.draw=function(a){b.redrawSelectedArea();var c=b.xScale.domain()[0],f=b.xScale.domain()[1]-c,d="";1==b.includeAA&&(d=" and Amino Acids");"both"==b.strands?b.label=b.labelBase+d+" on +/- strands":
"+"==b.strands?b.label=b.labelBase+d+" on + strand":"-"==b.strands&&(b.label=b.labelBase+d+" on - strand");f<=b.aaDispCutoff&&1==b.includeAA||f<=b.dispCutoff||(b.label="");b.updateLabel(b.label);b.data=new String(a);var n="10px";200<f&&(n="8px");if(b.data&&f<=b.aaDispCutoff&&1==b.includeAA||f<=b.dispCutoff){d=c-b.seqRegionMin;var k=f+d,g=b.gsvg.width/f;b.svg.selectAll("text.dir").remove();"both"==b.strands?(b.svg.append("text").attr("class","dir").attr("x",5).attr("y",15).text("--\x3e"),b.svg.append("text").attr("class",
"dir").attr("x",5).attr("y",120).text("<--"),b.svg.append("text").attr("class","dir").attr("x",b.gsvg.width-60).attr("y",15).text("--\x3e"),b.svg.append("text").attr("class","dir").attr("x",b.gsvg.width-20).attr("y",120).text("<--")):"+"==b.strands?(b.svg.append("text").attr("class","dir").attr("x",5).attr("y",15).text("--\x3e"),b.svg.append("text").attr("class","dir").attr("x",b.gsvg.width-60).attr("y",15).text("--\x3e")):"-"==b.strands&&(b.svg.append("text").attr("class","dir").attr("x",5).attr("y",
15).text("<--"),b.svg.append("text").attr("class","dir").attr("x",b.gsvg.width-60).attr("y",15).text("<--"));if(f<b.dispCutoff&&1<a.length){for(var e=[],m=d;m<k;m++)e[m-d]=[],e[m-d].base=a.charAt(m),e[m-d].id=m,e[m-d].pos=m-d;m=b.textSize(f);var r=b.yPosition(f),h=27;1==b.includeAA&&"-"!=b.strands&&(h+=30);e=b.svg.selectAll(".base").data(e,keyID).attr("transform",function(a,c){return"translate("+a.pos*g+","+h+")"});a=e.enter().append("g").attr("class","base").attr("transform",function(a,c){return"translate("+
a.pos*g+","+h+")"});a.each(function(a){d3.select(this).append("text").text(function(c){return"-"!=b.strands?a.base:b.complement(a.base)});"both"==b.strands&&d3.select(this).append("text").attr("class","comp").attr("y",r).text(function(c){return b.complement(a.base)})});e.exit().remove();e.selectAll("text").attr("font-size",m)}else b.svg.append("g").attr("class","base").append("line").attr("stroke","#000000").attr("x1",0).attr("y1",57).attr("x2",b.gsvg.width).attr("y2",57);if(b.data&&1==b.includeAA){var l=
3*g,p=l/2-4,t=25;if("both"==b.strands||"+"==b.strands)for(m=c%3,a=d-m,e=[],e[0]=b.translateRegion(0,c-m,a,a+f),e[1]=b.translateRegion(1,c-m-2,a-2,a-2+f),e[2]=b.translateRegion(2,c-m-1,a-1,a-1+f),t=25,m=0;3>m;m++)k=b.svg.selectAll(".aa"+m).data(e[m],keyID).attr("transform",function(a,c){return"translate("+b.xScale(a.pos)+","+t+")"}).each(function(a){d3.select(this).select("rect").attr("width",l);f<b.dispCutoff?0==d3.select(this).select("text").size()?d3.select(this).append("text").attr("x",p).attr("font-size",
n).text(function(c){return a.aa}):d3.select(this).select("text").attr("x",p).attr("font-size",n):d3.select(this).select("text").remove()}),k.enter().append("g").attr("class","aa"+m).attr("transform",function(a,c){return"translate("+b.xScale(a.pos)+","+t+")"}).each(function(a){d3.select(this).append("rect").attr("y",-10).attr("height",10).attr("width",l).attr("stroke",b.colorAA(a)).attr("fill",b.colorAA(a));f<b.dispCutoff&&d3.select(this).append("text").attr("x",p).attr("font-size",n).text(function(){return a.aa})}),
k.exit().remove(),t+=11;t="both"==b.strands?80:45;if("both"==b.strands||"-"==b.strands)for(m=c%3,a=d-m,e=[],e[0]=b.translateRegion(0,c-m,a+f,a),e[1]=b.translateRegion(1,c-m-1,a-1+f,a-1),e[2]=b.translateRegion(2,c-m-2,a-2+f,a-2),m=0;3>m;m++)k=b.svg.selectAll(".aarev"+m).data(e[m],keyID).attr("transform",function(a,c){return"translate("+b.xScale(a.pos)+","+t+")"}),a=k.enter().append("g").attr("class","aarev"+m).attr("transform",function(a,c){return"translate("+b.xScale(a.pos)+","+t+")"}),a.each(function(a){d3.select(this).append("rect").attr("y",
-10).attr("height",10).attr("width",l).attr("stroke",b.colorAA(a)).attr("fill",b.colorAA(a));f<b.dispCutoff&&d3.select(this).append("text").attr("x",p).attr("font-size",n).text(function(c){return a.aa})}),k.exit().remove(),t+=11;"both"==b.strands?b.svg.attr("height",125):b.svg.attr("height",75)}else"both"==b.strands?b.svg.attr("height",45):b.svg.attr("height",30);b.prevStrand=b.strands;b.prevIncldAA=b.includeAA;$("li.draggable"+b.gsvg.levelNumber+"#li"+b.trackClass).show()}else b.svg.attr("height",
0),$("li.draggable"+b.gsvg.levelNumber+"#li"+b.trackClass).hide()};b.textSize=function(a){var c="9px";100>=a?c="11px":150>=a?c="8px":200>=a?c="6.8px":250>=a?c="5.8px":300>=a&&(c="4.8px");return c};b.yPosition=function(a){var c=12;100>=a?c=12:150>=a?c=10:200>=a?c=8:250>=a?c=6:300>=a&&(c=5);return c};b.updateData=function(a){var c=(new Date).getTime();if(25E3<c-b.lastUpdate||0<a)0===a&&(0===b.lastUpdate||25E3>c-b.lastUpdate)&&(b.tmpseqRegionMin=b.xScale.domain()[0]-b.seqRegionSize,b.tmpseqRegionMax=
b.xScale.domain()[1]+b.seqRegionSize,0>b.tmpseqRegionMin&&(b.tmpseqRegionMin=0)),b.xScale.domain()[1]-b.xScale.domain()[0]<b.aaDispCutoff&&(b.lastUpdate=c,b.svg&&30>b.svg.attr("height")&&b.svg.attr("height",30),0===a&&b.showLoading(),d3.text(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/"+b.tmpseqRegionMin+"_"+b.tmpseqRegionMax+".seq",function(c,d){if(c){if(0===a){var f=contextPath+"/"+pathPrefix;pathPrefix||(f="");$.ajax({url:f+"generateTrackXML.jsp",type:"GET",
cache:!1,data:{chromosome:chr,minCoord:b.tmpseqRegionMin,maxCoord:b.tmpseqRegionMax,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:b.trackClass,folder:b.gsvg.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackSequence")},error:function(a,c,b){}})}3>a?(f=1E4,1===a&&(f=15E3),setTimeout(function(){b.updateData(a+1)},f)):(b.seqRegionMin=0,b.seqRegionMax=0,b.hideLoading(),d3.select("#Level"+b.gsvg.levelNumber+
b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass),b.lastUpdate=0)}else b.seqRegionMin=b.tmpseqRegionMin,b.seqRegionMax=b.tmpseqRegionMax,b.hideLoading(),b.draw(d),b.lastUpdate=0,setTimeout(function(){DisplayRegionReport()},300)}))};b.updateSettingsFromUI=function(){0<$("#"+b.trackClass+b.level+"Select").length&&(b.strands=
$("#"+b.trackClass+b.level+"Select").val());0<$("#"+b.trackClass+"CBX"+b.level+"dispAA").length&&($("#"+b.trackClass+"CBX"+b.level+"dispAA").is(":checked")?b.includeAA=1:b.includeAA=0)};b.savePrevious=function(){b.prevSetting={};b.prevSetting.strands=b.strands;b.prevSetting.includeAA=b.includeAA};b.revertPrevious=function(){b.strands=b.prevSetting.strands;b.includeAA=b.prevSetting.includeAA};b.generateTrackSettingString=function(){return b.trackClass+","+b.strands+","+b.includeAA+";"};b.generateSettingsDiv=
function(a){var c=trackInfo[b.trackClass];b.savePrevious();d3.select(a).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var f=(new String(c.Controls)).split(",");a=d3.select(a).select("table").select("tbody");a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<f.length;c++)if(f[c]&&""!=f[c]){var d=f[c].split(";"),n=a.append("tr").append("td"),k=d[0].substr(5);3<d.length&&0===d[3].indexOf("Default=")&&d[3].substr(8);
if(0===d[1].toLowerCase().indexOf("select")){n.append("text").text(k+": ");k=d[1].split(":");d=d[2].split("}");for(var g=b.trackClass+b.level+"Select",e=n.append("select").attr("id",g).attr("name",k[1]),m=0;m<d.length;m++){var r=d[m].substr(1).split(":");2==r.length&&(n=e.append("option").attr("value",r[1]).text(r[0]),r[1]==b.strands&&n.attr("selected","selected"))}d3.select("select#"+g).on("change",function(){b.updateSettingsFromUI();b.redraw()})}else if(0===d[1].toLowerCase().indexOf("cbx"))for(n.append("text").text(k),
k=d[1].split(":"),d=d[2].split("}"),m=0;m<d.length;m++)if(r=d[m].substr(1).split(":"),2===r.length){g=n.append("div").style("display","inline-block");var h="",l="";2<k.length&&(l=k[2]);3<k.length&&(h=k[3]);e=g.append("input").attr("type","checkbox").attr("id",b.trackClass+l+"CBX"+b.level+h).attr("name",k[1]).style("margin-left","5px");g.append("text").text(r[0]);1==b.includeAA?$("#"+b.trackClass+l+"CBX"+b.level+h).prop("checked",!0):$("#"+b.trackClass+l+"CBX"+b.level+h).prop("checked",!1);d3.select("input#"+
b.trackClass+l+"CBX"+b.level+h).on("change",function(){b.updateSettingsFromUI();b.redraw()})}}f=a.append("tr").append("td");f.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.removeTrack(b.trackClass);b.gsvg.setCurrentViewModified();var a=svgList[b.gsvg.levelNumber].currentView.ViewID,c=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,a);c=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(c.TrackID,
a);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(c,a)});f.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.strands==b.prevSetting.strands&&b.includeAA==b.prevSetting.includeAA||b.gsvg.setCurrentViewModified()});f.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){b.revertPrevious();b.draw(b.data);
$("#trackSettingDialog").fadeOut("fast")})}else a=d3.select(a).select("table").select("tbody"),a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),a.append("tr").append("td").html("Sorry no settings for this track."),f=a.append("tr").append("td"),f.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),f.append("input").attr("type","button").attr("value",
"Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.createCodon();b.updateData(0);b.draw(p);return b}
function GeneTrack(e,h,l,p,b){var a=Track(e,h,l,p);a.counts=[{value:0,names:"Ensembl"},{value:0,names:"Brain RNA-Seq"}];e=new String(b);a.drawAs="Gene";a.trxCutoff=1E5;e=new String(b);a.xScale.domain();a.xScale.domain();-1<e.indexOf("DrawTrx")&&(a.drawAs="Trx");a.density=3;a.dataVer=0;a.reqDataVer=0;a.ttTrackList=[];-1===a.trackClass.indexOf("smallnc")?(a.ttTrackList.push("ensemblcoding"),a.ttTrackList.push("braincoding"),a.ttTrackList.push("brainTotal"),a.ttTrackList.push("liverTotal"),a.ttTrackList.push("heartTotal"),
a.ttTrackList.push("mergedTotal"),a.ttTrackList.push("refSeq"),a.ttTrackList.push("ensemblnoncoding"),a.ttTrackList.push("brainnoncoding")):(a.ttTrackList.push("ensemblsmallnc"),a.ttTrackList.push("brainsmallnc"),a.ttTrackList.push("liversmallnc"),a.ttTrackList.push("heartsmallnc"),a.ttTrackList.push("refSeq"));a.ttTrackList.push("repeatMask");a.ttTrackList.push("snpSHRH");a.ttTrackList.push("snpBNLX");a.ttTrackList.push("snpF344");a.ttTrackList.push("snpSHRJ");"braincoding"===l?(a.ttTrackList.push("spliceJnct"),
a.ttTrackList.push("illuminaPolyA")):0===l.indexOf("liverTotal")?(a.ttTrackList.push("liverspliceJnct"),a.ttTrackList.push("liverilluminaTotalPlus"),a.ttTrackList.push("liverilluminaTotalMinus")):"heartTotal"===l?(a.ttTrackList.push("heartspliceJnct"),a.ttTrackList.push("heartilluminaTotalPlus"),a.ttTrackList.push("heartilluminaTotalMinus")):0===l.indexOf("brainTotal")?(a.ttTrackList.push("brainspliceJnct"),a.ttTrackList.push("brainilluminaTotalPlus"),a.ttTrackList.push("brainilluminaTotalMinus")):
"brainsmallnc"===l?a.ttTrackList.push("illuminaSmall"):"heartsmallnc"===l?a.ttTrackList.push("heartilluminaSmall"):"liversmallnc"===l&&a.ttTrackList.push("liverilluminaSmall");a.pieColorPalette=d3.scaleOrdinal(d3.schemeCategory20);a.color=function(c){var b="#000000";"ensemblcoding"===a.trackClass?b="#DFC184":"braincoding"===a.trackClass?(b="#7EB5D6",null!==c.getAttribute("strain")&&"undefined"!==typeof c.getAttribute("strain")&&"All"!==c.getAttribute("strain")&&(b=a.strainSpecColor(b,c))):"ensemblnoncoding"===
a.trackClass?b="#B58AA5":"brainnoncoding"===a.trackClass?(b="#CECFCE",null!==c.getAttribute("strain")&&"undefined"!==typeof c.getAttribute("strain")&&"BNLX"===c.getAttribute("strain").toUpperCase()?b="#3E75FF":null===c.getAttribute("strain")||"undefined"===typeof c.getAttribute("strain")||"SHR"!==c.getAttribute("strain").toUpperCase()&&"SHRH"!==c.getAttribute("strain").toUpperCase()||(b="#FE7596")):"ensemblsmallnc"===a.trackClass?b="#FFCC00":"brainsmallnc"===a.trackClass?(b="#3E7596",null!==c.getAttribute("strain")&&
"undefined"!==typeof c.getAttribute("strain")&&"All"!==c.getAttribute("strain")&&(b=a.strainSpecColor(b,c))):0===a.trackClass.indexOf("liverTotal")?(b="#bbbedd",0<a.trackClass.indexOf("_F344Stm")?b="#abaefd":0<a.trackClass.indexOf("_LEStm")&&(b="#dbaecd"),null!==c.getAttribute("strain")&&"undefined"!==typeof c.getAttribute("strain")&&"All"!==c.getAttribute("strain")&&(b=a.strainSpecColor(b,c))):"heartTotal"===a.trackClass?(b="#DC7252",null!==c.getAttribute("strain")&&"undefined"!==typeof c.getAttribute("strain")&&
"All"!==c.getAttribute("strain")&&(b=a.strainSpecColor(b,c))):0===a.trackClass.indexOf("brainTotal")?(b="#7EB5D6",0<a.trackClass.indexOf("_F344Stm")?b="#6EA5F6":0<a.trackClass.indexOf("_LEStm")&&(b="#9EA5C6"),null!==c.getAttribute("strain")&&"undefined"!==typeof c.getAttribute("strain")&&"All"!==c.getAttribute("strain")&&(b=a.strainSpecColor(b,c))):"liversmallnc"===a.trackClass?(b="#7b7e9d",null!==c.getAttribute("strain")&&"undefined"!==typeof c.getAttribute("strain")&&"All"!==c.getAttribute("strain")&&
(b=a.strainSpecColor(b,c))):"heartsmallnc"===a.trackClass?(b="#9C3212",null!==c.getAttribute("strain")&&"undefined"!==typeof c.getAttribute("strain")&&"All"!==c.getAttribute("strain")&&(b=a.strainSpecColor(b,c))):"mergedTotal"===a.trackClass&&(b="#9F4F92");return b=d3.rgb(b)};a.strainSpecColor=function(a,b){var c=parseInt(a.substr(1,2),16),f=parseInt(a.substr(3,2),16),k=parseInt(a.substr(5),16);"BNLX"===b.getAttribute("strain").toUpperCase()?(k+=64,c-=32,f-=32):"SHR"===b.getAttribute("strain").toUpperCase()||
"SHRH"===b.getAttribute("strain").toUpperCase()?(c+=64,k-=32,f-=32):"F344_ST"===b.getAttribute("strain").toUpperCase()?(k+=32,c-=16,f-=16):"LE_ST"===b.getAttribute("strain").toUpperCase()&&(c+=32,k-=16,f-=16);255<c&&(c=255);255<f&&(f=255);255<k&&(k=255);return"#"+c.toString(16)+f.toString(16)+k.toString(16)};a.pieStrainSpecColor=function(a,b){var c=parseInt(a.substr(1,2),16),f=parseInt(a.substr(3,2),16),k=parseInt(a.substr(5),16);if("BNLX"===b.toUpperCase())k+=64,c-=32,f-=32;else if("SHR"===b.toUpperCase()||
"SHRH"===b.toUpperCase())c+=64,k-=32,f-=32;255<c&&(c=255);255<f&&(f=255);255<k&&(k=255);return a="#"+c.toString(16)+f.toString(16)+k.toString(16)};a.pieColor=function(c,b){var d="#000000";"ensemblcoding"===a.trackClass?d="#DFC184":"braincoding"===a.trackClass?d=a.pieStrainSpecColor("#7EB5D6",c.data.names):"ensemblnoncoding"===a.trackClass?d="#B58AA5":"brainnoncoding"===a.trackClass?(d="#CECFCE",null!==c.data.names&&"undefined"!==typeof c.data.names&&"BNLX"===c.data.names.toUpperCase()?d="#3E75FF":
null===c.data.names||"undefined"===typeof c.data.names||"SHR"!==c.data.names.toUpperCase()&&"SHRH"!==c.data.names.toUpperCase()||(d="#FE7596")):"ensemblsmallnc"===a.trackClass?d=a.pieColorPalette(c.data.names):"brainsmallnc"===a.trackClass?d=a.pieStrainSpecColor("#99CC99",c.data.names):0===a.trackClass.indexOf("liverTotal")?d=a.pieStrainSpecColor("#bbbedd",c.data.names):"heartTotal"===a.trackClass?d=a.pieStrainSpecColor("#DC7252",c.data.names):0===a.trackClass.indexOf("brainTotal")?d=a.pieStrainSpecColor("#7EB5D6",
c.data.names):"liversmallnc"===a.trackClass?d=a.pieStrainSpecColor("#8b8ead",c.data.names):"heartsmallnc"===a.trackClass?d=a.pieStrainSpecColor("#BC5232",c.data.names):"mergedTotal"===a.trackClass&&(d="#9F4F92");return d=d3.rgb(d)};a.getDisplayID=function(c){-1<a.trackClass.indexOf("smallnc")||-1<c.indexOf("_")&&(c=c.substr(c.indexOf("_")+1));return c};a.createToolTip=function(c){var b="";if(-1<a.trackClass.indexOf("smallnc")){b="Known - "+c.getAttribute("biotype");var d=".";1==c.getAttribute("strand")?
d="+":-1==c.getAttribute("strand")&&(d="-");if(0===(new String(c.getAttribute("ID"))).indexOf("P")){var n=getAllChildrenByName(getFirstChildByName(c,"TranscriptList"),"Transcript");getAllChildrenByName(getFirstChildByName(c,"StrainQuantList"),"Strains")[1].getAttribute("strain");b=n[0].getAttribute("category")+" - "+n[0].getAttribute("source")}n='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>ID: '+c.getAttribute("ID");-1===a.trackClass.indexOf("ensembl")&&(n=n+"<BR>PhenoGen ID: "+c.getAttribute("intGeneID"));
n=n+"<BR>Length: "+(c.getAttribute("stop")-c.getAttribute("start"))+"<BR>Type:"+b+"<BR>Location: "+c.getAttribute("chromosome")+":"+numberWithCommas(c.getAttribute("start"))+"-"+numberWithCommas(c.getAttribute("stop"))+"<BR>Strand: "+d+"<BR>"}else{var k=c.getAttribute("ID");k=a.getDisplayID(k);var g="";c.getAttribute("geneSymbol")?g=c.getAttribute("geneSymbol"):c.parent&&c.parent.getAttribute("geneSymbol")&&(g=c.parent.getAttribute("geneSymbol"));d=".";1==c.getAttribute("strand")?d="+":-1==c.getAttribute("strand")&&
(d="-");if(c.parent){n=getAllChildrenByName(getFirstChildByName(c.parent,"TranscriptList"),"Transcript");for(var e=0;e<n.length;e++){var m=new String(n[e].getAttribute("ID"));k!=m&&(-1<(new String(n[e].getAttribute("ID"))).indexOf("ENS")?b+="<B>"+m+"</B>":(b+="<B>"+m+"</B>",-1==(new String(n[e].getAttribute("ID"))).indexOf("ENS")&&(m=getFirstChildByName(getFirstChildByName(n[e],"annotationList"),"annotation"),null!=m&&(b+=" - "+m.getAttribute("reason")))),b+="<br>");if(""==g){m=getAllChildrenByName(getFirstChildByName(n[e],
"annotationList"),"annotation");for(var r=0;r<m.length&&""==g;r++)"AKA"==m[r].getAttribute("source")&&(g=m[r].getAttribute("annot_value"),g=(new String(g)).split(":"),g=0!=(new String(g[g.length-1])).indexOf("ENS")?g[g.length-1]:g[0])}}n='<BR><div id="ttSVG" style="background:#FFFFFF;overflow:"></div><BR>Transcript ID: '+k+"<BR>Location: "+c.getAttribute("chromosome")+":"+numberWithCommas(c.getAttribute("start"))+"-"+numberWithCommas(c.getAttribute("stop"))+"<BR>Strand: "+d;n=n+"<BR><BR>Gene Symbol: "+
g+"<BR>Gene ID: "+a.getDisplayID(c.parent.getAttribute("ID"))+"<BR><BR>Other Transcripts:<BR>"+b+"<BR>"}else{n=getAllChildrenByName(getFirstChildByName(c,"TranscriptList"),"Transcript");for(e=0;e<n.length;e++)if(m=new String(n[e].getAttribute("ID")),-1<(new String(n[e].getAttribute("ID"))).indexOf("ENS")?b+="<B>"+m+"</B>":(b+="<B>"+m+"</B>",-1===(new String(n[e].getAttribute("ID"))).indexOf("ENS")&&(m=getFirstChildByName(getFirstChildByName(n[e],"annotationList"),"annotation"),null!=m&&(b+=" - "+
m.getAttribute("reason")))),b+="<br>",0===g.length)for(m=getAllChildrenByName(getFirstChildByName(n[e],"annotationList"),"annotation"),r=0;r<m.length&&0===g.length;r++)"AKA"===m[r].getAttribute("source")&&(g=m[r].getAttribute("annot_value"),g=(new String(g)).split(":"),g=0!==(new String(g[g.length-1])).indexOf("ENS")?g[g.length-1]:g[0]);n='<BR><div id="ttSVG" style="background:#FFFFFF;overflow:scroll;max-height:400px;"></div>Gene ID: '+k+"<BR>Gene Symbol: "+g+"<BR>Location: "+c.getAttribute("chromosome")+
":"+numberWithCommas(c.getAttribute("start"))+"-"+numberWithCommas(c.getAttribute("stop"))+"<BR>Strand: "+d+"<BR><BR>Transcripts:<BR>"+b+"<BR>"}"brainTotal"!==a.trackClass&&"liverTotal"!==a.trackClass||!(-1<c.getAttribute("ID").indexOf("PRN6T")||-1<c.getAttribute("ID").indexOf("PRN6G"))||(d="Gene",-1<c.getAttribute("ID").indexOf("PRN6T")&&(d="Transcript"),n=n+'<div>Heritability: <span id="ttsingleHerit"></span></div>'+d+' Expression:<BR><div style="text-align:center;">Median Estimated Counts Per Million</div><div id="ttChart"></div>',
b="Brain",k="Whole Brain","liverTotal"===a.trackClass&&(k=b="Liver"),tmpChart=chart({data:"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+b+"expr.json",selector:"#ttChart",allowResize:!1,type:"scatter",width:"400",height:"275",displayHerit:!1,displayControls:!1,title:d+" Expression",titlePrefix:k,filterID:c.getAttribute("ID")}))}return n};a.redraw=function(){a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;a.trackYMax=0;c=a.xScale.domain()[0];
c=a.xScale.domain()[1]-c;var b=0;if(a.reqDataVer!==a.dataVer)a.updateDataVersion(a.reqDataVer,0);else if("undefined"!==typeof a.prevSetting&&a.prevSetting.density!==a.density)a.draw(a.data);else if(c<a.trxCutoff&&"Gene"===a.drawnAs||c>=a.trxCutoff&&"Trx"===a.drawnAs&&"Trx"!==a.drawAs||"Gene"===a.drawnAs&&$("#forceTrxCBX"+a.gsvg.levelNumber).is(":checked"))a.draw(a.data);else if(c<a.trxCutoff&&"Trx"===a.drawnAs&&"Trx"!==a.drawAs&&(b=1),"Gene"===a.drawAs&&0===b||-1<a.trackClass.indexOf("smallnc"))a.svg&&
(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene").attr("transform",function(c,b){return"translate("+a.xScale(c.getAttribute("start"))+","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),b)+")"}),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene rect").attr("width",function(c){var b=1;1<a.xScale(c.getAttribute("stop"))-a.xScale(c.getAttribute("start"))&&(b=a.xScale(c.getAttribute("stop"))-a.xScale(c.getAttribute("start")));
return b}).attr("stroke",a.colorStroke),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene").each(function(c){var b=d3.select(this),d=parseInt(c.getAttribute("strand"),10);if(-1===d||1===d){var f=">";-1===d&&(f="<");d="";var e=b.select("rect").attr("width");if(8.3<=e&&15.8>=e)d=f;else for(;8.5<e;)d+=f,e-=8.5;b.select("text#strandTxt").text(d)}if(2===a.density){var m=c.getAttribute("ID");c.getAttribute("geneSymbol")&&0<c.getAttribute("geneSymbol").length&&(m=m+" ("+c.getAttribute("geneSymbol")+
")");0===b.select("text#lblTxt").size()?b.append("svg:text").attr("dx",function(){var b=a.xScale(c.getAttribute("start"));return b=b<$(window).width()/2?a.xScale(c.getAttribute("stop"))-a.xScale(c.getAttribute("start"))+5:-9*m.length}).attr("dy",10).attr("id","lblTxt").text(m):b.select("text#lblTxt").attr("dx",function(){var b=a.xScale(c.getAttribute("start"));return b=b<$(window).width()/2?a.xScale(c.getAttribute("stop"))-a.xScale(c.getAttribute("start"))+5:-9*m.length})}else b.select("text#lblTxt").remove()})),
1===a.density?a.svg.attr("height",30):2===a.density?a.svg.attr("height",15*(a.trackYMax+1)):3===a.density&&a.svg.attr("height",15*(a.trackYMax+1));else if(1===b||"Trx"===a.drawAs)a.svg.selectAll(".trx"+a.gsvg.levelNumber).attr("transform",function(c,b){return"translate(0,"+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),b)+")"}).each(function(c,b){var d=parseInt(c.getAttribute("start"),10),f=parseInt(c.getAttribute("stop"),10);c.getAttribute("cdsStart")&&c.getAttribute("cdsStop")&&
(d=parseInt(c.getAttribute("cdsStart"),10),f=parseInt(c.getAttribute("cdsStop"),10));exList=getAllChildrenByName(getFirstChildByName(c,"exonList"),"exon");var e="";1===a.gsvg.levelNumber?e="tx":99===a.gsvg.levelNumber&&(e="ttTx");for(var n=0;n<exList.length;n++){var r=exList[n].getAttribute("start"),h=exList[n].getAttribute("stop");if(r<d&&d<h||h>f&&f>r){var l=r,p=d;h>f?(l=f,p=h,h=f):r=d;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass+" g#"+e+c.getAttribute("ID")+a.gsvg.levelNumber+" rect#ExNC"+
exList[n].getAttribute("ID")).attr("x",function(c){return a.xScale(l)}).attr("width",function(c){return a.xScale(p)-a.xScale(l)})}d3.select("#Level"+a.gsvg.levelNumber+a.trackClass+" g#"+e+c.getAttribute("ID")+a.gsvg.levelNumber+" rect#Ex"+exList[n].getAttribute("ID")).attr("x",function(c){return a.xScale(r)}).attr("width",function(c){return a.xScale(h)-a.xScale(r)});if(0<n){var t=">";"-1"==c.getAttribute("strand")&&(t="<");var u=t,D=a.xScale(exList[n-1].getAttribute("stop")),E=a.xScale(exList[n].getAttribute("start")),
z=E-D,B=0;if(7>z||"0"==c.getAttribute("strand")||"."==c.getAttribute("strand"))u="";else for(z-=7;8<z;)0===B?(u+=" ",B=1):(u+=t,B=0),z-=7;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass+" g.trx"+a.gsvg.levelNumber+"#"+e+c.getAttribute("ID")+a.gsvg.levelNumber+" line#Int"+exList[n-1].getAttribute("ID")+"_"+exList[n].getAttribute("ID")).attr("x1",D).attr("x2",E);d3.select("#Level"+a.gsvg.levelNumber+a.trackClass+" g.trx"+a.gsvg.levelNumber+"#"+e+c.getAttribute("ID")+a.gsvg.levelNumber+" #IntTxt"+
exList[n-1].getAttribute("ID")+"_"+exList[n].getAttribute("ID")).attr("dx",D+1).text(u)}}if(2===a.density){var A=c.getAttribute("ID");c.getAttribute("geneSymbol")&&0<c.getAttribute("geneSymbol").length&&(A=A+" ("+c.getAttribute("geneSymbol")+")");0===d3.select("#Level"+a.gsvg.levelNumber+a.trackClass+" g.trx"+a.gsvg.levelNumber+"#"+e+c.getAttribute("ID")+a.gsvg.levelNumber+" text#lblTxt").size()?d3.select("#Level"+a.gsvg.levelNumber+a.trackClass+" g.trx"+a.gsvg.levelNumber+"#"+e+c.getAttribute("ID")+
a.gsvg.levelNumber).append("svg:text").attr("dx",function(){var b=a.xScale(c.parent.getAttribute("start"));return b=b<$(window).width()/2?a.xScale(c.parent.getAttribute("stop"))-a.xScale(c.parent.getAttribute("start"))+5:-9*A.length}).attr("dy",10).attr("id","lblTxt").text(A):d3.select("#Level"+a.gsvg.levelNumber+a.trackClass+" g.trx"+a.gsvg.levelNumber+"#"+e+c.getAttribute("ID")+a.gsvg.levelNumber+" text#lblTxt").attr("dx",function(){var b=a.xScale(c.getAttribute("start"));return b=b<$(window).width()/
2?a.xScale(c.getAttribute("stop"))-a.xScale(c.getAttribute("start"))+5:-9*A.length})}else d3.select("#Level"+a.gsvg.levelNumber+a.trackClass+" g.trx"+a.gsvg.levelNumber+"#"+e+c.getAttribute("ID")+a.gsvg.levelNumber+" text#lblTxt").remove()}),1===a.density?a.svg.attr("height",30):2===a.density?a.svg.attr("height",15*(a.trackYMax+1)):3===a.density&&a.svg.attr("height",15*(a.trackYMax+1));a.redrawSelectedArea()};a.setSelected=function(c){if(c)if(0<d3.selectAll("g.gene").size()){if(d3.selectAll("rect.selected").each(function(){d3.select(this).attr("class",
"").style("fill",a.color)}),c=d3.select("g.gene rect#"+c))c.attr("class","selected").style("fill","green"),a.setupDetailedView(c.data()[0]),selectGene=""}else if(0<d3.selectAll("g.trx"+a.gsvg.levelNumber).size()){var b=(new String(c)).replace(".","_");a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").selectAll("line").style("stroke",a.color);a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").selectAll("rect").style("fill",a.color);a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").selectAll("text").style("opacity",
"0.6").style("fill",a.color);a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").each(function(){var a=new String($(this).attr("class"));a=a.replace(" selected","");$(this).attr("class",a)});a.svg.selectAll("g.gene"+b).each(function(){var a=$(this).attr("class")+" selected";$(this).attr("class",a)});a.svg.selectAll("g.gene"+b).selectAll("line").style("stroke","green");a.svg.selectAll("g.gene"+b).selectAll("rect").style("fill","green");a.svg.selectAll("g.gene"+b).selectAll("text").style("opacity",
"0.3").style("fill","green");a.svg.selectAll("g.gene"+b)&&((b=a.svg.selectAll("g.gene"+b).data())&&0<b.length?a.setupDetailedView(b[0].parent):(console.log("tmp[0]"),console.log(b),Rollbar.debug("tmp[0] is undefined.  tmp.length is "+b.length+":"+c+":"+a.gsvg.levelNumber+":"+a.trackClass)));selectGene=""}};a.clearSelection=function(){a.selectionStart=-1;a.selectionEnd=-1;a.svg.selectAll("rect.selectedArea").remove();0<a.svg.selectAll("g.gene").size()?a.svg.selectAll("rect.selected").each(function(c){d3.select(this).attr("class",
"").style("fill",a.color)}):0<a.svg.selectAll("g.trx"+a.gsvg.levelNumber).size()&&(a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").selectAll("line").style("stroke",a.color),a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").selectAll("rect").style("fill",a.color),a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").selectAll("text").style("opacity","0.6").style("fill",a.color),a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").each(function(){var a=new String($(this).attr("class"));
a=a.replace(" selected","");$(this).attr("class",a)}))};a.setupDetailedView=function(c){if(c){a.gsvg.clearSelection();jQuery.Event("keyup").which=32;var b=a.gsvg.levelNumber+1;$("div#collapsableReport").is(":hidden")||($("div#collapsableReport").hide(),$("span[name='collapsableReport']").removeClass("less"));$("div#selectedDetailHeader").is(":hidden")&&$("div#selectedDetailHeader").show();$("div#selectedDetail").is(":hidden")&&$("div#selectedDetail").show();var d="none";0===a.trackClass.indexOf("liverTotal")?
d=a.trackClass:"heartTotal"===a.trackClass?d="heartTotal":0===a.trackClass.indexOf("brainTotal")?d=a.trackClass:"mergedTotal"===a.trackClass?d="mergedTotal":"protein_coding"===c.getAttribute("biotype")&&200<=c.getAttribute("stop")-c.getAttribute("start")?d="protein":"protein_coding"!==c.getAttribute("biotype")&&200<=c.getAttribute("stop")-c.getAttribute("start")?d="long":200>c.getAttribute("stop")-c.getAttribute("start")&&(d="small");var e=0,k=0;if("protein"===d||"long"===d||0===d.indexOf("liverTotal")||
"heartTotal"===d||0===d.indexOf("brainTotal")||"mergedTotal"===d||"small"===d&&"rn5"!==genomeVer||"small"===d&&-1<(new String(c.getAttribute("ID"))).indexOf("ENS")){console.log("totalType");e=c.getAttribute("ID");var g="";if(c.getAttribute("geneSymbol")&&0<c.getAttribute("geneSymbol").length)e=e+" ("+c.getAttribute("geneSymbol")+")";else{k=getAllChildrenByName(getFirstChildByName(c,"TranscriptList"),"Transcript");for(var q=0;q<k.length&&""===g;q++)if(""===g)for(var m=getAllChildrenByName(getFirstChildByName(k[q],
"annotationList"),"annotation"),r=0;r<m.length&&0===g.length;r++)if("AKA"===m[r].getAttribute("source")){var h=m[r].getAttribute("annot_value");h=(new String(h)).split(":");1<=h.length?(g=h[0],e=e+" ("+g+")"):2<=h.length&&(g=h[0],h=h[1],e=e+" ("+h+")")}}k=parseInt(c.getAttribute("start"),10);m=parseInt(c.getAttribute("stop"),10);c.getAttribute("extStart")&&c.getAttribute("extStop")&&(k=parseInt(c.getAttribute("extStart"),10),m=parseInt(c.getAttribute("extStop"),10));svgViewIDList[b]||(svgViewIDList[b]=
a.gsvg.currentView?a.gsvg.currentView.ViewID:defaultView);q=GenomeSVG("div#selectedImage",a.gsvg.width,k,m,b,e,"transcript");q.xMin=k-.05*(m-k);q.xMax=m+.05*(m-k);e=q.xMin;k=q.xMax;svgList[b]=q;svgList[b].txType=d;svgList[b].selectedData=c;selectedGeneSymbol=c.getAttribute("geneSymbol");selectedID=new String(c.getAttribute("ID"));-1===selectedID.indexOf("ENS")&&0<g.length&&(selectedID=g);$("div#selectedImage").show();console.log("here");-1<(new String(selectedID)).indexOf("ENS")&&-1<a.trackClass.indexOf("ensembl")?
(console.log("geneReport"),$("div#selectedReport").show(),b=pathPrefix+"geneReport.jsp",c={id:selectedID,geneSymbol:selectedGeneSymbol,chromosome:chr,species:organism,genomeVer:genomeVer},DisplaySelectedDetailReport(b,c)):"small"!==d?$("div#selectedReport").html("<BR><BR>Detailed Gene Reports are not currently provided for RNA-Seq(Cufflinks) generated genes that are novel and have not been matched to an existing annotated gene.  In the future overlapping probesets and SNPs will be summarized in the same manner.  This feature should be added by December 2014.  Please keep checking back or let us know you'd like to see it sooner."):
"rn6"===genomeVer&&(c=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.trackClass+".xml",b=pathPrefix+"smallRNAReport.jsp",c={dataPath:c,id:selectedID},DisplaySelectedDetailReport(b,c))}else"small"===d&&-1===(new String(c.getAttribute("ID"))).indexOf("ENS")&&"rn5"===genomeVer&&($("div#selectedImage").hide(),$("div#selectedReport").show(),e=c.getAttribute("start"),k=c.getAttribute("stop"),b=pathPrefix+"viewSmallNonCoding.jsp",c={id:c.getAttribute("ID"),name:"smRNA_"+
c.getAttribute("ID")},DisplaySelectedDetailReport(b,c));a.gsvg.selectSvg.changeSelection(e,k);$("html, body").animate({scrollTop:$("#selectedDetail").offset().top},200)}};a.getDisplayedData=function(){var c=[],b=0,d=[];if(-1<a.trackClass.indexOf("smallnc")){var e=0;a.counts=[];a.trackClass.indexOf("ensembl");"Gene"===a.drawnAs?d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene"):"Trx"===a.drawnAs&&(d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.trx"));d.each&&
d.each(function(d){var f=a.xScale(d.getAttribute("start")),g=a.xScale(d.getAttribute("stop"));if(0<=f&&f<=a.gsvg.width||0<=g&&g<=a.gsvg.width||0>=f&&g>=a.gsvg.width)f="Ensembl","undefined"!==typeof d.getAttribute("strain")?f=d.getAttribute("strain"):"undefined"!==typeof d.getAttribute("biotype")&&(f=d.getAttribute("biotype")),"undefined"===typeof a.counts[f]?(a.counts[f]={},a.counts[e]=a.counts[f],e++,a.counts[f].value=1,a.counts[f].names=f):a.counts[f].value++,c[b]=d,b++,k++})}else if("Gene"===a.drawnAs)d=
d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene"),a.counts=[{value:0,names:"Ensembl"},{value:0,names:"Brain RNA-Seq"},{value:0,names:"Liver RNA-Seq"},{value:0,names:"Heart RNA-Seq"},{value:0,names:"Merged RNA-Seq"}],d.each(function(d){var f=a.xScale(d.getAttribute("start")),g=a.xScale(d.getAttribute("stop"));if(0<=f&&f<=a.gsvg.width||0<=g&&g<=a.gsvg.width)-1<(new String(d.childNodes[0].id)).indexOf("ENS")?a.counts[0].value++:-1<a.trackClass.indexOf("brain")?a.counts[1].value++:
-1<a.trackClass.indexOf("liver")?a.counts[2].value++:-1<a.trackClass.indexOf("heart")?a.counts[3].value++:-1<a.trackClass.indexOf("merged")&&a.counts[4].value++,c[b]=d,b++}),0===d.size()&&(a.counts=[]);else if("Trx"===a.drawnAs){d=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.trx"+a.gsvg.levelNumber);a.counts=[];var k=e=0;d.each(function(d){var f=a.xScale(d.getAttribute("start")),g=a.xScale(d.getAttribute("stop"));if(0<=f&&f<=a.gsvg.width||0<=g&&g<=a.gsvg.width||0>=f&&g>=a.gsvg.width)f=
"Ensembl","undefined"!==typeof d.getAttribute("strain")&&(f=d.getAttribute("strain")),"undefined"===typeof a.counts[f]?(a.counts[f]={},a.counts[e]=a.counts[f],e++,a.counts[f].value=1,a.counts[f].names=f):a.counts[f].value++,c[b]=d,b++,k++})}return c};a.updateData=function(c){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/"+a.trackClass+".xml",function(b,d){if(b){if(0===c&&(0===a.trackClass.indexOf("liverTotal")||0===a.trackClass.indexOf("brainTotal")||"mergedTotal"===
a.trackClass||-1<a.trackClass.indexOf("smallnc"))){var f=contextPath+"/"+pathPrefix;pathPrefix||(f="");var k=a.trackClass,g=panel;(0===track.indexOf("liverTotal")||0===track.indexOf("brainTotal"))&&0<track.indexOf("_")&&(g=track.substr(track.indexOf("_")+1),"LEStm"===g&&(g="LE-Stm"),"F344Stm"===g&&(g="F344-Stm"));$.ajax({url:f+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,minCoord:a.gsvg.xScale.domain()[0],maxCoord:a.gsvg.xScale.domain()[1],panel:g,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,
myOrganism:organism,genomeVer:genomeVer,track:k,folder:a.gsvg.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackGene")},error:function(a,c,b){}})}3>c?(f=1E4,1===c&&(f=15E3),setTimeout(function(){a.updateData(c+1)},f)):(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+
a.trackClass))}else if(d){f=d.documentElement.getElementsByTagName("Gene");k=[];g=[];for(var e=0,m=0;m<f.length;m++)f[m]&&(k[e]=f[m],g[f[m].getAttribute("ID")]=1,e++);for(m=0;m<a.data.length;m++)a.data[m]&&!g[a.data[m].getAttribute("ID")]&&(k[e]=a.data[m],e++);a.draw(k);a.hideLoading();setTimeout(function(){DisplayRegionReport()},300)}else a.hideLoading()})};a.updateDataVersion=function(c,b){var d=a.trackClass+"_"+c;d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+
"/"+d+".xml",function(f,k){if(f){if(0===b){var g=contextPath+"/"+pathPrefix;pathPrefix||(g="");var e=panel;(0===track.indexOf("liverTotal")||0===track.indexOf("brainTotal"))&&0<track.indexOf("_")&&(e=track.substr(track.indexOf("_")+1),"LEStm"===e&&(e="LE-Stm"),"F344Stm"===e&&(e="F344-Stm"));$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,minCoord:a.gsvg.xScale.domain()[0],maxCoord:a.gsvg.xScale.domain()[1],panel:e,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,
genomeVer:genomeVer,track:d,folder:a.gsvg.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackGene")},error:function(a,c,b){}})}5>b?(g=1E4,0===b&&(g=5E3),setTimeout(function(){a.updateDataVersion(c,b+1)},g)):(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+
a.trackClass))}else g=k.documentElement.getElementsByTagName("Gene"),e=parseInt(c),a.dataVer=e,a.draw(g),a.hideLoading(),setTimeout(function(){DisplayRegionReport()},300)})};a.drawTrx=function(c,b){var d=parseInt(c.getAttribute("start"),10),f=parseInt(c.getAttribute("stop"),10);c.getAttribute("cdsStart")&&c.getAttribute("cdsStop")&&(d=parseInt(c.getAttribute("cdsStart"),10),f=parseInt(c.getAttribute("cdsStop"),10));var k="";1===a.gsvg.levelNumber?k="tx":99===a.gsvg.levelNumber&&(k="ttTx");k=d3.select("#Level"+
a.gsvg.levelNumber+a.trackClass+" #"+k+c.getAttribute("ID")+a.gsvg.levelNumber);exList=getAllChildrenByName(getFirstChildByName(c,"exonList"),"exon");for(var g=0;g<exList.length;g++){var e=parseInt(exList[g].getAttribute("start"),10),m=parseInt(exList[g].getAttribute("stop"),10);if(e<d&&d<m||m>f&&f>e){var r=0,h=0,l=0,p=0;e<d?(r=a.xScale(e),h=a.xScale(d)-a.xScale(e),l=a.xScale(d),p=a.xScale(m)-a.xScale(d)):m>f&&(l=a.xScale(e),p=a.xScale(f)-a.xScale(e),r=a.xScale(f),h=a.xScale(m)-a.xScale(f));k.append("rect").attr("x",
r).attr("y",2.5).attr("height",5).attr("width",h).attr("title",function(a){return exList[g].getAttribute("ID")}).attr("id",function(a){return"ExNC"+exList[g].getAttribute("ID")}).style("fill",a.color).style("cursor","pointer");k.append("rect").attr("x",l).attr("height",10).attr("width",p).attr("title",function(a){return exList[g].getAttribute("ID")}).attr("id",function(a){return"Ex"+exList[g].getAttribute("ID")}).style("fill",a.color).style("cursor","pointer")}else{r=10;h=0;if(e<d&&m<d||m>f&&e>f)r=
5,h=2.5;k.append("rect").attr("x",function(c){return a.xScale(exList[g].getAttribute("start"))}).attr("y",h).attr("id",function(a){return"Ex"+exList[g].getAttribute("ID")}).attr("height",r).attr("width",function(c){return a.xScale(exList[g].getAttribute("stop"))-a.xScale(exList[g].getAttribute("start"))}).attr("title",function(a){return exList[g].getAttribute("ID")}).style("fill",a.color).style("cursor","pointer")}if(0<g&&(k.append("line").attr("x1",function(c){return a.xScale(exList[g-1].getAttribute("stop"))}).attr("x2",
function(c){return a.xScale(exList[g].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(a){return"Int"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("stroke",a.color).attr("stroke-width","2"),"1"==c.getAttribute("strand")||"-1"==c.getAttribute("strand"))){e=">";if("-1"==c.getAttribute("strand")||"-"==c.getAttribute("strand"))e="<";m=e;r=a.xScale(exList[g-1].getAttribute("stop"));h=a.xScale(exList[g].getAttribute("start"))-r;l=0;if(7>h)m="";else for(h-=
7;8<h;)0==l?(m+=" ",l=1):(m+=e,l=0),h-=7;k.append("svg:text").attr("id",function(a){return"IntTxt"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("dx",r+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",a.color).style("font-size","16px").text(m)}}if(2==a.density){var t=c.getAttribute("ID");"undefined"!==typeof c.getAttribute("geneSymbol")&&0<c.getAttribute("geneSymbol").length&&(t=t+" ("+c.getAttribute("geneSymbol")+")");k.append("svg:text").attr("dx",
function(){var b=a.xScale(c.getAttribute("start"));return b=b<$(window).width()/2?a.xScale(c.getAttribute("stop"))-a.xScale(c.getAttribute("start"))+5:-9*t.length}).attr("dy",10).attr("id","lblTxt").text(t)}else k.select("text#lblTxt").remove()};a.getSVGID=function(c){return a.getDisplayID(c.getAttribute("ID"))+" ("+c.getAttribute("geneSymbol")+")"};a.setupToolTipSVG=function(c,b){if("undefined"!==typeof c.getAttribute("extStart")&&null!==c.getAttribute("extStart")){var d=parseInt(c.getAttribute("extStart"),
10);var f=parseInt(c.getAttribute("extStop"),10)}else d=parseInt(c.getAttribute("start"),10),f=parseInt(c.getAttribute("stop"),10);var k=Math.floor((f-d)*b);10>k&&(k=10);d-=k;f+=k;k=toolTipSVG("div#ttSVG",450,d,f,99,a.getSVGID(c),"transcript");k.xMin=d;k.xMax=f;var g="none";0===a.trackClass.indexOf("liverTotal")?g=a.trackClass:"heartTotal"==a.trackClass?g="heartTotal":0===a.trackClass.indexOf("brainTotal")?g=a.trackClass:"mergedTotal"==a.trackClass?g="mergedTotal":200>parseInt(c.getAttribute("stop"),
10)-parseInt(c.getAttribute("start"),10)?g="small":"protein_coding"==c.getAttribute("biotype")&&200<=parseInt(c.getAttribute("stop"),10)-parseInt(c.getAttribute("start"),10)?g="protein":"protein_coding"!=c.getAttribute("biotype")&&200<=parseInt(c.getAttribute("stop"),10)-parseInt(c.getAttribute("start"),10)&&(g="long");k.txType=g;k.selectedData=c;g=[];g[0]=c;"undefined"!==typeof c.parent&&(g[0]=c.parent);k.addTrack(a.trackClass,2,"DrawTrx",g);for(g=0;g<a.ttTrackList.length;g++)if(a.trackClass!==a.ttTrackList[g]){var e=
a.gsvg.getTrackData(a.ttTrackList[g]),m=[];if("undefined"!==typeof e&&0<e.length){for(var r=0,h=0;h<e.length;h++)if(d<=parseInt(e[h].getAttribute("start"),10)&&parseInt(e[h].getAttribute("start"),10)<=f||d<=parseInt(e[h].getAttribute("stop"),10)&&parseInt(e[h].getAttribute("stop"),10)<=f||parseInt(e[h].getAttribute("start"),10)<=d&&parseInt(e[h].getAttribute("stop"),10)>=d)m[r]=e[h],r++;0<m.length&&k.addTrack(a.ttTrackList[g],3,"DrawTrx",m)}}};a.draw=function(c){a.data=c;a.trackYMax=0;a.yMaxArr=[];
a.yArr=[];a.yArr[0]=[];for(var b=0;b<a.gsvg.width;b++)a.yMaxArr[b]=0,a.yArr[0][b]=0;a.svg.selectAll(".gene").remove();b=a.drawAs;var d=a.xScale.domain()[0];if(a.xScale.domain()[1]-d<a.trxCutoff||$("#forceTrxCBX"+a.gsvg.levelNumber).is(":checked"))a.drawAs="Trx";d="Genes";"Trx"==a.drawAs&&(d="Transcripts");var e="Protein Coding",k=" / PolyA+";-1<a.trackClass.indexOf("noncoding")?(e="Long Non-Coding",k=" / Non-PolyA+"):-1<a.trackClass.indexOf("smallnc")?(e="Brain",-1<a.trackClass.indexOf("liver")?e=
"Liver":-1<a.trackClass.indexOf("heart")&&(e="Heart"),e+=" Small RNA",k=""):0===a.trackClass.indexOf("liverTotal")?(e="Liver RNA-Seq Reconstruction ",k="Total RNA"):"heartTotal"==a.trackClass?(e="Heart RNA-Seq Reconstruction ",k="Total RNA"):0===a.trackClass.indexOf("brainTotal")?(e="Whole Brain RNA-Seq Reconstruction ",k="Total RNA"):"mergedTotal"==a.trackClass&&(e="Merged (Brain,Heart,Liver) Reconstructed",k="Total RNA");e=-1<a.trackClass.indexOf("ensembl")?"Ensembl "+e+" "+d:-1===a.trackClass.indexOf("brainTotal")&&
-1===a.trackClass.indexOf("liverTotal")&&"heartTotal"!=a.trackClass&&"mergedTotal"!=a.trackClass?"Reconstruction "+e+k+" "+d:e+k+" "+d;(0===a.trackClass.indexOf("liverTotal")||0===a.trackClass.indexOf("brainTotal"))&&0<a.trackClass.indexOf("_")&&(d=a.trackClass.substr(a.trackClass.indexOf("_")+1),"LEStm"===d&&(d="LE-Stm"),"F344Stm"===d&&(d="F344-Stm"),e=d+" Filtered (>=1.0TPM) "+e);a.updateLabel(e);a.redrawLegend();d=c;if("Trx"===a.drawAs&&-1===a.trackClass.indexOf("smallnc"))for(d=[],k=e=0;k<c.length;k++)if("undefined"!==
typeof c[k])for(var g=getAllChildrenByName(getFirstChildByName(c[k],"TranscriptList"),"Transcript"),q=0;q<g.length;q++)d[e]=g[q],d[e].parent=c[k],e++;0<d.length&&("Gene"===a.drawAs||-1<a.trackClass.indexOf("smallnc")?(a.drawnAs="Gene",a.svg.selectAll(".trx0").each(function(){d3.select(this).remove()}),c=a.svg.selectAll(".gene").data(d,key).attr("transform",function(c,b){return"translate("+a.xScale(c.getAttribute("start"))+","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),
10),b)+")"}),c.enter().append("g").attr("class","gene").attr("transform",function(c,b){return"translate("+a.xScale(c.getAttribute("start"))+","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),b)+")"}).merge(c).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(c){return a.xScale(c.getAttribute("stop"))-a.xScale(c.getAttribute("start"))}).attr("title",function(a){return a.getAttribute("ID")}).attr("stroke",a.colorStroke).attr("stroke-width",
"1").attr("id",function(a){return a.getAttribute("ID")}).style("fill",a.color).style("cursor","pointer").on("click",function(c){setTimeout(function(){a.setupDetailedView(c);d3.select(this).attr("class","selected").style("fill","green")}.bind(this),10)}).on("dblclick",a.zoomToFeature).on("mouseover",function(c){0===a.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Click</B> to see additional details. <B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill","green"),
tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(c)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),c&&(a.triggerTableFilter(c),-1===a.trackClass.indexOf("smallnc")?"Trx"===a.drawAs?a.setupToolTipSVG(c.parent,.05):a.setupToolTipSVG(c,.05):a.setupToolTipSVG(c,.05),tt.style("top",function(){return a.positionTTTop(d3.event.pageY)})))}).on("mouseout",function(c){$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");
"selected"!==d3.select(this).attr("class")&&d3.select(this).style("fill",a.color);tt.transition().delay(500).duration(200).style("opacity",0);a.clearTableFilter(c)}),c.exit().remove(),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene").each(function(c){if(c){var b=d3.select(this);if("-1"==c.getAttribute("strand")||"1"==c.getAttribute("strand")){var d=">";"-1"==c.getAttribute("strand")&&(d="<");var f=d,g=b.select("rect").attr("width");if(8.5>g)f="";else for(g-=8.5,f=d;8.7<g;)f+=
d,g-=8.5;b.append("svg:text").attr("dx","1").attr("dy","10").attr("id","strandTxt").style("pointer-events","none").text(f)}if(2===a.density){var e=c.getAttribute("ID");c.getAttribute("geneSymbol")&&0<c.getAttribute("geneSymbol").length&&(e=e+" ("+c.getAttribute("geneSymbol")+")");b.append("svg:text").attr("dx",function(){var b=a.xScale(c.getAttribute("start"));return b=b<$(window).width()/2?a.xScale(c.getAttribute("stop"))-a.xScale(c.getAttribute("start"))+5:-9*e.length}).attr("dy",10).attr("id",
"lblTxt").text(e)}else b.select("text#lblTxt").remove()}}),1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene").size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1))):"Trx"==a.drawAs&&(a.drawnAs="Trx",a.svg.selectAll(".gene").each(function(){d3.select(this).remove()}),a.svg.selectAll(".trx"+a.gsvg.levelNumber).remove(),c=a.svg.selectAll(".trx"+a.gsvg.levelNumber).data(d,key).attr("transform",function(c,
b){return"translate("+a.xScale(c.getAttribute("start"))+","+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),b)+")"}),c.enter().append("g").attr("class",function(c){c=new String(c.parent.getAttribute("ID"));return"trx"+a.gsvg.levelNumber+" gene"+c.replace(".","_")}).attr("transform",function(c,b){return"translate(0,"+a.calcY(parseInt(c.getAttribute("start"),10),parseInt(c.getAttribute("stop"),10),b)+")"}).attr("id",function(c){var b="";1==a.gsvg.levelNumber&&(b="tx");
99==a.gsvg.levelNumber&&(b="ttTx");return b+c.getAttribute("ID")+a.gsvg.levelNumber}).style("cursor","pointer").on("click",function(c){setTimeout(function(){if(0==a.gsvg.levelNumber){var b=(new String(c.parent.getAttribute("ID"))).replace(".","_");a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").selectAll("line").style("stroke",a.color);a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").selectAll("rect").style("fill",a.color);a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").selectAll("text").style("opacity",
"0.6").style("fill",a.color);a.svg.selectAll("g.trx"+a.gsvg.levelNumber+".selected").each(function(){var a=new String($(this).attr("class"));a=a.replace(" selected","");$(this).attr("class",a)});a.svg.selectAll("g.gene"+b).each(function(){var a=$(this).attr("class")+" selected";$(this).attr("class",a)});a.svg.selectAll("g.gene"+b).selectAll("line").style("stroke","green");a.svg.selectAll("g.gene"+b).selectAll("rect").style("fill","green");a.svg.selectAll("g.gene"+b).selectAll("text").style("opacity",
"0.3").style("fill","green");a.setupDetailedView(c.parent)}},10)}).on("dblclick",a.zoomToFeature).on("mouseover",function(c){if(0===a.gsvg.isToolTip){if(0===a.gsvg.levelNumber&&"undefined"!==typeof c.parent){var b=(new String(c.parent.getAttribute("ID"))).replace(".","_");a.svg.selectAll("g.gene"+b).selectAll("line").style("stroke","green");a.svg.selectAll("g.gene"+b).selectAll("rect").style("fill","green");a.svg.selectAll("g.gene"+b).selectAll("text").style("opacity","0.3").style("fill","green")}else d3.select(this).selectAll("line").style("stroke",
"green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green");tt.transition().duration(200).style("opacity",1);tt.html(a.createToolTip(c)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)});a.triggerTableFilter(c);if("undefined"!==typeof c){if(-1===a.trackClass.indexOf("smallnc"))a.setupToolTipSVG(c,.05);else{b=toolTipSVG("div#ttSVG",450,
parseInt(c.getAttribute("start"),10)-10,parseInt(c.getAttribute("stop"),10)+10,99,a.getDisplayID(c.getAttribute("ID")),"");b.xMin=parseInt(c.getAttribute("start"),10)-20;b.xMax=parseInt(c.getAttribute("stop"),10)+20;var d=[];d[0]=c;b.addTrack(a.trackClass,2,"",d)}tt.style("top",function(){return a.positionTTTop(d3.event.pageY)})}}}).on("mouseout",function(c){if(-1==(new String(d3.select(this).attr("class"))).indexOf("selected"))if(0==a.gsvg.levelNumber){var b=(new String(c.parent.getAttribute("ID"))).replace(".",
"_");a.svg.selectAll("g.gene"+b).selectAll("line").style("stroke",a.color);a.svg.selectAll("g.gene"+b).selectAll("rect").style("fill",a.color);a.svg.selectAll("g.gene"+b).selectAll("text").style("opacity","0.6").style("fill",a.color)}else d3.select(this).selectAll("line").style("stroke",a.color),d3.select(this).selectAll("rect").style("fill",a.color),d3.select(this).selectAll("text").style("opacity","0.6").style("fill",a.color);tt.transition().delay(500).duration(200).style("opacity",0);a.clearTableFilter(c)}).merge(c).each(a.drawTrx),
c.exit().remove(),c,1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1))));""!=selectGene&&a.setSelected(selectGene);a.redrawSelectedArea();a.drawAs=b};a.redrawLegend=function(){var c=[],b=0;"Trx"===a.drawAs&&("braincoding"===a.trackClass?"Rn"===organism&&(c[b]={color:"#7EB5D6",label:"All"},b++,c[b]={color:"#5E95FF",label:"BN-Lx"},
b++,c[b]={color:"#BE95B6",label:"SHR"},b++):"brainnoncoding"===a.trackClass?"Rn"===organism&&(c[b]={color:"#CECFCE",label:"All"},b++,c[b]={color:"#3E75FF",label:"BN-Lx"},b++,c[b]={color:"#FE7596",label:"SHR"},b++):"liverTotal"===a.trackClass?(c[b]={color:"#bbbedd",label:"All"},b++,c[b]={color:"#9b9eFF",label:"BN-Lx"},b++,c[b]={color:"#Fb9eBd",label:"SHR"},b++):"heartTotal"===a.trackClass?(c[b]={color:"#DC7252",label:"All"},b++,c[b]={color:"#BC5292",label:"BN-Lx"},b++,c[b]={color:"#FF5232",label:"SHR"},
b++):"mergedTotal"!==a.trackClass&&"brainTotal"===a.trackClass&&(c[b]={color:"#7EB5D6",label:"All"},b++,c[b]={color:"#5E95FF",label:"BN-Lx"},b++,c[b]={color:"#BE95B6",label:"SHR"},b++));"brainsmallnc"===a.trackClass?(c[b]={color:"#3E7596",label:"All"},b++,c[b]={color:"#1E55D6",label:"BN-Lx"},b++,c[b]={color:"#7E5576",label:"SHR"}):"heartsmallnc"===a.trackClass?(c[b]={color:"#9C3212",label:"All"},b++,c[b]={color:"#7C1252",label:"BN-Lx"},b++,c[b]={color:"#DC1200",label:"SHR"}):"liversmallnc"===a.trackClass&&
(c[b]={color:"#7b7e9d",label:"All"},b++,c[b]={color:"#5b5eDd",label:"BN-Lx"},b++,c[b]={color:"#bb5e7d",label:"SHR"});a.drawLegend(c)};a.triggerTableFilter=function(c){var b=jQuery.Event("keyup");b.which=32;var d="";"undefined"!==typeof c.getAttribute&&"undefined"!==typeof c.getAttribute("ID")&&(d=a.getDisplayID(c.getAttribute("ID")));-1==a.trackClass.indexOf("smallnc")?$("#tblGenes"+a.trackClass+"_filter input").val(d).trigger(b):$("#tblsmGenes_filter input").val(d).trigger(b)};a.clearTableFilter=
function(b){b=jQuery.Event("keyup");b.which=32;"smallnc"!=a.trackClass?$("#tblGenes"+a.trackClass+"_filter input").val("").trigger(b):$("#tblsmGenes_filter input").val("").trigger(b)};a.updateSettingsFromUI=function(){0<$("#"+a.trackClass+"Dense"+a.level+"Select").length&&(a.density=$("#"+a.trackClass+"Dense"+a.level+"Select").val(),"string"===typeof a.density&&(a.density=parseInt(a.density)));0<$("#"+a.trackClass+"Version"+a.level+"Select").length&&(a.reqDataVer=$("#"+a.trackClass+"Version"+a.level+
"Select").val())};a.savePrevious=function(){a.prevSetting={};a.prevSetting.density=a.density;a.prevSetting.dataVer=a.dataVer};a.revertPrevious=function(){a.density=a.prevSetting.density;a.dataVer=a.prevSetting.dataVer};a.updateSettings=function(a){};a.generateTrackSettingString=function(){return a.trackClass+","+a.density+","+a.dataVer+";"};a.redrawLegend();a.draw(h);return a}
function RefSeqTrack(e,h,l,p,b){var a=GeneTrack(e,h,l,p);a.counts=[{value:0,names:"Ensembl"},{value:0,names:"RNA-Seq"}];a.drawAs="Gene";a.trxCutoff=1E5;a.density=3;-1<(new String(b)).indexOf("DrawTrx")&&(a.drawAs="Trx");a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(e=0;e<a.gsvg.width;e++)a.yMaxArr[e]=0,a.yArr[0][e]=0;a.ttTrackList=[];a.ttTrackList.push("ensemblcoding");a.ttTrackList.push("braincoding");a.ttTrackList.push("liverTotal");a.ttTrackList.push("heartTotal");a.ttTrackList.push("mergedTotal");a.ttTrackList.push("ensemblnoncoding");
a.ttTrackList.push("brainnoncoding");a.ttTrackList.push("repeatMask");a.ttTrackList.push("snpSHRH");a.ttTrackList.push("snpBNLX");a.ttTrackList.push("snpF344");a.ttTrackList.push("snpSHRJ");a.color=function(b){var c=d3.rgb("#000000");if("Gene"==a.drawnAs){b=getAllChildrenByName(getFirstChildByName(b,"TranscriptList"),"Transcript");for(var d=-1,e=0;e<b.length;e++){var k=new String(b[e].getAttribute("category")),g=-1;"Reviewed"==k?g=4:"Validated"==k?g=3:"Provisional"==k?g=2:"Inferred"==k?g=1:"Predicted"==
k&&(g=0);d<g&&(d=g)}4==d&&(c=d3.rgb("#18814F"));3==d?c=d3.rgb("#38A16F"):2==d?c=d3.rgb("#78E1AF"):1==d?c=d3.rgb("#A8FFDF"):0==d&&(c=d3.rgb("#A8DFFF"))}else"Trx"==a.drawnAs&&(k=new String(b.getAttribute("category")),"Reviewed"==k?c=d3.rgb("#18814F"):"Validated"==k?c=d3.rgb("#38A16F"):"Provisional"==k?c=d3.rgb("#78E1AF"):"Inferred"==k?c=d3.rgb("#A8FFDF"):"Predicted"==k&&(c=d3.rgb("#A8DFFF")));return c};a.pieColor=function(a,b){var c=d3.rgb("#000000"),f=new String(a.data.names);-1<f.indexOf("Reviewed")?
c=d3.rgb("#18814F"):-1<f.indexOf("Validated")?c=d3.rgb("#38A16F"):-1<f.indexOf("Provisional")?c=d3.rgb("#78E1AF"):-1<f.indexOf("Inferred")?c=d3.rgb("#A8FFDF"):-1<f.indexOf("Predicted")&&(c=d3.rgb("#A8DFFF"));return c};a.getDisplayedData=function(){var b=[],f=0,d=0;if("Gene"==a.drawnAs){var e=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll(".gene");a.counts=[];var k=0;e.each(function(c){var g=a.xScale(c.getAttribute("start")),e=a.xScale(c.getAttribute("stop"));if(0<=g&&g<=a.gsvg.width||
0<=e&&e<=a.gsvg.width||0>=g&&e>=a.gsvg.width){e=getAllChildrenByName(getFirstChildByName(c,"TranscriptList"),"Transcript");g=-1;for(var n=0;n<e.length;n++){var h=new String(e[n].getAttribute("category")),l=-1;"Reviewed"==h?l=4:"Validated"==h?l=3:"Provisional"==h?l=2:"Inferred"==h?l=1:"Predicted"==h&&(l=0);g<l&&(g=l)}e="Unknown";4==g?e="Reviewed":3==g?e="Validated":2==g?e="Provisional":1==g?e="Inferred":0==g&&(e="Predicted");"undefined"===typeof a.counts[e]?(a.counts[e]={},a.counts[k]=a.counts[e],
k++,a.counts[e].value=1,a.counts[e].names=e):a.counts[e].value++;b[f]=c;f++;d++}})}else a.counts=[],k=0,a.svg.selectAll("g.trx"+a.gsvg.levelNumber).each(function(c){var g=a.xScale(c.getAttribute("start")),e=a.xScale(c.getAttribute("stop"));if(0<=g&&g<=a.gsvg.width||0<=e&&e<=a.gsvg.width||0>=g&&e>=a.gsvg.width)g=new String(c.getAttribute("category")),"undefined"===typeof a.counts[g]?(a.counts[g]={},a.counts[k]=a.counts[g],k++,a.counts[g].value=1,a.counts[g].names=g):a.counts[g].value++,b[f]=c,f++,
d++});return b};a.createToolTip=function(b){var c="",d=b.getAttribute("strand");d="1"==d||"+"==d?"+":"-1"==d||"-"==d?"-":".";if("Gene"===a.drawnAs){c="";for(var e=getAllChildrenByName(getFirstChildByName(b,"TranscriptList"),"Transcript"),k=0;k<e.length;k++){var g=new String(e[k].getAttribute("ID"));c+="<B>"+g+"</B> - "+e[k].getAttribute("category");c+="<br>"}c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>Gene Symbol: '+b.getAttribute("geneSymbol")+"<BR>Location: "+b.getAttribute("chromosome")+
":"+numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(b.getAttribute("stop"))+"<BR>Strand: "+d+"<BR>Transcripts:<BR>"+c}else"Trx"===a.drawnAs&&(g=new String(b.getAttribute("ID")),c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div>RefSeq ID:'+("<B>"+g+"</B>")+"<BR>Status: "+b.getAttribute("category")+"<BR>Gene Symbol: "+b.getAttribute("geneSymbol")+"<BR>Location: "+b.getAttribute("chromosome")+":"+numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(b.getAttribute("stop"))+
"<BR>Strand: "+d);return c};a.getSVGID=function(a){return a.getAttribute("geneSymbol")};a.setupToolTipSVG=function(b,f){var c=parseInt(b.getAttribute("start"),10),e=parseInt(b.getAttribute("stop"),10),k=Math.floor((e-c)*f);20>k&&(k=20);var g=c-k;k=e+k;1>g&&(g=1);"undefined"!==typeof a.ttSVGMinWidth&&k-g<a.ttSVGMinWidth&&(g=c-a.ttSVGMinWidth/2,k=e+a.ttSVGMinWidth/2);c=toolTipSVG("div#ttSVG",450,g,k,99,a.getSVGID(b),"transcript");c.forLevel=a.gsvg.levelNumber;e=[];e.push(b);c.addTrack(a.trackClass,
3,"DrawTrx",e);for(e=0;e<a.ttTrackList.length;e++){var q=a.gsvg.getTrackData(a.ttTrackList[e]),m=[];if("undefined"!==typeof q&&0<q.length){for(var h=0,l=0;l<q.length;l++)if(g<=parseInt(q[l].getAttribute("start"),10)&&parseInt(q[l].getAttribute("start"),10)<=k||parseInt(q[l].getAttribute("start"),10)<=g&&parseInt(q[l].getAttribute("stop"),10)>=g)m[h]=q[l],h++;0<m.length&&c.addTrack(a.ttTrackList[e],3,"DrawTrx",m)}}};a.calcY=function(b,f,d){if(3==a.density)if(b>=a.xScale.domain()[0]&&b<=a.xScale.domain()[1]||
f>=a.xScale.domain()[0]&&f<=a.xScale.domain()[1]||b<=a.xScale.domain()[0]&&f>=a.xScale.domain()[1]){b=Math.floor(a.xScale(b));0>b&&(b=0);f=Math.floor(a.xScale(f))+1;f>=a.gsvg.width&&(f=a.gsvg.width-1);d=b-5;0>d&&(d=0);var c=f+5;c>=a.gsvg.width&&(c=a.gsvg.width-1);for(var e=0,g=d;g<=c;g++)a.yMaxArr[g]>e&&(e=a.yMaxArr[g]);e++;var q=e;if(a.yArr.length<=e)for(a.yArr[q]=[],g=0;g<a.gsvg.width;g++)a.yArr[q][g]=0;g=e-12;1>g&&(g=1);q=0;for(var m=g;m<e&&0==q;m++){var h=0;for(g=d;g<=c&&0==h;g++)a.yArr[m][g]>
h&&(h=1);0==h&&(e=m,q=1)}e>a.trackYMax&&(a.trackYMax=e);for(g=b;g<=f;g++)a.yMaxArr[g]<e&&(a.yMaxArr[g]=e),a.yArr[e][g]=1;b=15*e}else b=15;else b=2==a.density?15*(d+1):15;a.trackYMax<b/15&&(a.trackYMax=b/15);return b};a.redraw=function(){var b=a.xScale.domain()[0];b=a.xScale.domain()[1]-b;var f=0;a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var d=0;d<a.gsvg.width;d++)a.yMaxArr[d]=0,a.yArr[0][d]=0;a.trackYMax=0;if(b<a.trxCutoff&&"Gene"==a.drawnAs||b>=a.trxCutoff&&"Trx"==a.drawnAs&&"Trx"!=a.drawAs||"Gene"==
a.drawnAs&&$("#forceTrxCBX"+a.gsvg.levelNumber).is(":checked"))a.draw(a.data);else if(b<a.trxCutoff&&"Trx"==a.drawnAs&&"Trx"!=a.drawAs&&(f=1),"Gene"==a.drawAs&&0==f)a.svg.node()&&(a.svg.selectAll(".trx").each(function(){d3.select(this).remove()}),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene").attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c)+")"}),d3.select("#Level"+
a.gsvg.levelNumber+a.trackClass).selectAll("g.gene rect").attr("width",function(b){var c=1;1<a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start"))&&(c=a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start")));return c}).attr("stroke",a.colorStroke),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene").each(function(a){var b=d3.select(this);if("1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand")||"+"==a.getAttribute("strand")){var c=
">";if("-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand"))c="<";a="";var d=b.select("rect").attr("width");if(8.5<=d&&15.8>=d)a=c;else for(;8.7<d;)a+=c,d-=8.5;b.select("text").text(a)}})),1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene").size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));else if(1==f||"Trx"==a.drawAs)a.svg.selectAll("g.trx"+a.gsvg.levelNumber).attr("transform",function(b,
c){return"translate(0,"+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c)+")"}).each(function(b,c){var d=parseInt(b.getAttribute("cdsStart"),10),f=parseInt(b.getAttribute("cdsStop"),10);exList=getAllChildrenByName(getFirstChildByName(b,"exonList"),"exon");var e="";1==a.gsvg.levelNumber&&(e="tx");for(var k=0;k<exList.length;k++){var n=parseInt(exList[k].getAttribute("start"),10),h=parseInt(exList[k].getAttribute("stop"),10);if(n<d&&d<h||h>f&&f>n){var l=n,p=d;h>f?(l=
f,p=h,h=f):n=d;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("g#"+e+b.getAttribute("ID")+" rect#ExNC"+exList[k].getAttribute("ID")).attr("x",function(b){return a.xScale(l)}).attr("width",function(b){return a.xScale(p)-a.xScale(l)})}d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("g#"+e+b.getAttribute("ID")+" rect#Ex"+exList[k].getAttribute("ID")).attr("x",function(b){return a.xScale(n)}).attr("width",function(b){return a.xScale(h)-a.xScale(n)});if(0<k){var u=a.xScale(exList[k-
1].getAttribute("stop")),D=a.xScale(exList[k].getAttribute("start"));if("1"==b.getAttribute("strand")||"-1"==b.getAttribute("strand")||"-"==b.getAttribute("strand")||"+"==b.getAttribute("strand")){var E=">";"-1"==b.getAttribute("strand")&&(E="<");var z=E,B=D-u,A=0;if(7>B)z="";else for(B-=7;8<B;)0==A?(z+=" ",A=1):(z+=E,A=0),B-=7;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("g#"+e+b.getAttribute("ID")+" #IntTxt"+exList[k-1].getAttribute("ID")+"_"+exList[k].getAttribute("ID")).attr("dx",
u+1).text(z)}d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).select("g#"+e+b.getAttribute("ID")+" line#Int"+exList[k-1].getAttribute("ID")+"_"+exList[k].getAttribute("ID")).attr("x1",u).attr("x2",D)}}}),1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.trx"+a.gsvg.levelNumber).size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));a.redrawSelectedArea()};a.updateData=function(b){a.xScale.domain();
a.xScale.domain();d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/refSeq.xml",function(c,d){if(c)if(10>b){var f=2500;1==b&&(f=1E4);setTimeout(function(){a.updateData(b+1)},f)}else d3.select("#Level"+a.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass);else if(d){f=d.documentElement.getElementsByTagName("Gene");
for(var e=[],g=[],q=0,m=0;m<f.length;m++)f[m]&&(e[q]=f[m],e[q].setAttribute("ID",q),g[f[m].getAttribute("geneSymbol")]=1,q++);for(m=0;m<a.data.length;m++)a.data[m]&&!g[a.data[m].getAttribute("geneSymbol")]&&(e[q]=a.data[m],e[q].setAttribute("ID",q),q++);a.draw(e);a.hideLoading();a.getDisplayedData();setTimeout(function(){DisplayRegionReport()},300)}else a.updateData(b+1),a.hideLoading()})};a.drawTrx=function(b,f){var c=parseInt(b.getAttribute("cdsStart"),10),e=parseInt(b.getAttribute("cdsStop"),10),
k="";1==a.gsvg.levelNumber&&(k="tx");k=a.svg.select("#"+k+b.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(b,"exonList"),"exon");for(var g=0;g<exList.length;g++){var q=parseInt(exList[g].getAttribute("start"),10),m=parseInt(exList[g].getAttribute("stop"),10);if(q<c&&c<m||m>e&&e>q){var h=0,l=0,p=0,w=0;q<c?(h=a.xScale(q),l=a.xScale(c)-a.xScale(q),p=a.xScale(c),w=a.xScale(m)-a.xScale(c)):m>e&&(p=a.xScale(q),w=a.xScale(e)-a.xScale(q),h=a.xScale(e),l=a.xScale(m)-a.xScale(e));k.append("rect").attr("x",
h).attr("y",2.5).attr("height",5).attr("width",l).attr("title",function(a){return exList[g].getAttribute("ID")}).attr("id",function(a){return"ExNC"+exList[g].getAttribute("ID")}).style("fill",a.color).style("cursor","pointer");k.append("rect").attr("x",p).attr("height",10).attr("width",w).attr("title",function(a){return exList[g].getAttribute("ID")}).attr("id",function(a){return"Ex"+exList[g].getAttribute("ID")}).style("fill",a.color).style("cursor","pointer")}else{h=10;l=0;if(q<c&&m<c||m>e&&q>e)h=
5,l=2.5;k.append("rect").attr("x",function(b){return a.xScale(exList[g].getAttribute("start"))}).attr("y",l).attr("height",h).attr("width",function(b){return a.xScale(exList[g].getAttribute("stop"))-a.xScale(exList[g].getAttribute("start"))}).attr("title",function(a){return exList[g].getAttribute("ID")}).attr("id",function(a){return"Ex"+exList[g].getAttribute("ID")}).style("fill",a.color).style("cursor","pointer")}if(0<g&&(k.append("line").attr("x1",function(b){return a.xScale(exList[g-1].getAttribute("stop"))}).attr("x2",
function(b){return a.xScale(exList[g].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(a){return"Int"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("stroke",a.color).attr("stroke-width","2"),"1"==b.getAttribute("strand")||"-1"==b.getAttribute("strand")||"-"==b.getAttribute("strand")||"+"==b.getAttribute("strand"))){q=">";if("-"==b.getAttribute("strand")||"-1"==b.getAttribute("strand"))q="<";m=q;h=a.xScale(exList[g-1].getAttribute("stop"));l=a.xScale(exList[g].getAttribute("start"))-
h;p=0;if(7>l)m="";else for(l-=7;8<l;)0==p?(m+=" ",p=1):(m+=q,p=0),l-=7;k.append("svg:text").attr("id",function(a){return"IntTxt"+exList[g-1].getAttribute("ID")+"_"+exList[g].getAttribute("ID")}).attr("dx",h+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",a.color).style("font-size","16px").text(m)}}};a.draw=function(b){a.data=b;a.trackYMax=0;a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;a.svg.selectAll(".gene").remove();a.svg.selectAll(".trx"+
a.gsvg.levelNumber).remove();var d=a.drawAs;c=a.xScale.domain()[0];if(a.xScale.domain()[1]-c<a.trxCutoff||$("#forceTrxCBX"+a.gsvg.levelNumber).is(":checked"))a.drawAs="Trx";if(0!=b&&"Gene"===a.drawAs)a.drawnAs="Gene",a.label="Ref Seq Genes",a.updateLabel(a.label),a.redrawLegend(),b=a.svg.selectAll(".gene").data(b,key).attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c)+")"}),b.enter().append("g").attr("class",
"gene").attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(b){return a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start"))}).attr("title",function(a){return a.getAttribute("ID")}).attr("stroke",a.colorStroke).attr("stroke-width","1").attr("id",function(a){return a.getAttribute("ID")}).style("fill",
a.color).on("dblclick",a.zoomToFeature).on("mouseover",function(b){0==a.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(b)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),a.setupToolTipSVG(b,.05));return!1}).on("mouseout",function(b){overSelectable=
0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");"selected"!=d3.select(this).attr("class")&&d3.select(this).style("fill",a.color);tt.transition().delay(500).duration(200).style("opacity",0)}),b.exit().remove(),d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene").each(function(a){if("undefined"!==typeof a){var b=d3.select(this);if("1"==a.getAttribute("strand")||"-1"==a.getAttribute("strand")||"-"==a.getAttribute("strand")||"+"==
a.getAttribute("strand")){var c=">";if("-"==a.getAttribute("strand")||"-1"==a.getAttribute("strand"))c="<";var d=b.select("rect").attr("width");if(8.5>d)a="";else for(d-=8.5,a=c;8.7<d;)a+=c,d-=8.5;b.append("svg:text").attr("dx","1").attr("dy","10").style("pointer-events","none").text(a)}}}),1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.gene").size()+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));
else if(0!=b&&"Trx"===a.drawAs){a.drawnAs="Trx";a.label="Ref Seq Transcripts";a.updateLabel(a.label);a.redrawLegend();var e=[],k=0;for(c=0;c<b.length;c++)for(var g=getAllChildrenByName(getFirstChildByName(b[c],"TranscriptList"),"Transcript"),q=0;q<g.length;q++)e[k]=g[q],e[k].parent=b[c],k++;d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll(".trx"+a.gsvg.levelNumber).remove();b=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll(".trx"+a.gsvg.levelNumber).data(e,key).attr("transform",
function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c)+")"});b.enter().append("g").attr("class","trx"+a.gsvg.levelNumber).attr("transform",function(b,c){return"translate(0,"+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c)+")"}).attr("id",function(b){var c="";1==a.gsvg.levelNumber&&(c="tx");return c+b.getAttribute("ID")}).on("mouseover",function(b){0==a.gsvg.isToolTip&&
(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(b)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),"undefined"!==typeof b&&a.setupToolTipSVG(b.parent,.05))}).on("mouseout",function(b){d3.select(this).selectAll("line").style("stroke",
function(b){return a.color(b)});d3.select(this).selectAll("rect").style("fill",function(b){return a.color(b)});d3.select(this).selectAll("text").style("opacity","0.6").style("fill",function(b){return a.color(b)});tt.transition().delay(500).duration(200).style("opacity",0)}).each(a.drawTrx);b.exit().remove();2==a.density?a.svg.attr("height",15*(d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll("g.trx"+a.gsvg.levelNumber).size()+1)):3==a.density?a.svg.attr("height",15*(a.trackYMax+1)):a.svg.attr("height",
30)}a.redrawSelectedArea();a.drawAs=d};a.redrawLegend=function(){a.drawLegend([{color:"#18814F",label:"Reviewed"},{color:"#38A16F",label:"Validated"},{color:"#78E1AF",label:"Provisional"},{color:"#A8FFDF",label:"Inferred"},{color:"#A8DFFF",label:"Predicted"}])};a.redrawLegend();a.draw(h);DisplayRegionReport();return a}
function ProbeTrack(e,h,l,p,b){var a=Track(e,h,l,p);e=(new String(b)).split(",");0<e.length?(a.density=e[0],"string"===typeof a.density&&(a.density=parseInt(a.density)),a.colorSelect=1<e.length?e[1]:"annot",2<e.length?a.tissues=e[2].split(":"):(a.tissues=["Brain"],"Rn"==organism&&(a.tissues=["Brain","BrownAdipose","Heart","Liver"]))):(a.density=3,a.colorSelect="annot",a.tissues=["Brain"],"Rn"==organism&&(a.tissues=["Brain","BrownAdipose","Heart","Liver"]));1E6<a.gsvg.xScale.domain()[1]-a.gsvg.xScale.domain()[0]&&
(a.density=1);a.tissuesAll=["Brain"];"Rn"==organism&&(a.tissuesAll=["Brain","BrownAdipose","Heart","Liver"]);a.xPadding=1;a.scanBackYLines=75;a.curColor=a.colorSelect;a.ttTrackList=[];a.ttTrackList.push("ensemblcoding");a.ttTrackList.push("braincoding");a.ttTrackList.push("liverTotal");a.ttTrackList.push("heartTotal");a.ttTrackList.push("mergedTotal");a.ttTrackList.push("ensemblnoncoding");a.ttTrackList.push("brainnoncoding");a.ttTrackList.push("repeatMask");a.color=function(b,f){var c=d3.rgb("#000000");
"annot"==a.colorSelect?c=a.colorAnnotation(b):"herit"==a.colorSelect?(c=getFirstChildByName(b,"herit").getAttribute(f),c=Math.floor(255*c),c=d3.rgb(c,0,0)):"dabg"==a.colorSelect&&(c=getFirstChildByName(b,"dabg").getAttribute(f),c=Math.floor(2.55*c),c=d3.rgb(0,c,0));return c};a.colorAnnotation=function(a){var b=d3.rgb("#000000");"core"==a.getAttribute("type")?b=d3.rgb(255,0,0):"extended"==a.getAttribute("type")?b=d3.rgb(0,0,255):"full"==a.getAttribute("type")?b=d3.rgb(0,100,0):"ambiguous"==a.getAttribute("type")&&
(b=d3.rgb(0,0,0));return b};a.pieColor=function(a,b){var c=d3.rgb("#000000"),f=new String(a.data.names);"Core"==f?c=d3.rgb(255,0,0):"Extended"==f?c=d3.rgb(0,0,255):"Full"==f?c=d3.rgb(0,100,0):"Ambiguous"==f&&(c=d3.rgb(0,0,0));return c};a.createToolTip=function(b){var c=".";1==b.getAttribute("strand")?c="+":-1==b.getAttribute("strand")&&(c="-");var d=parseInt(b.getAttribute("stop"),10)-parseInt(b.getAttribute("start"),10);c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Affy Probe Set ID: '+
b.getAttribute("ID")+"<BR>Strand: "+c+"<BR>Location: "+b.getAttribute("chromosome")+":"+numberWithCommas(b.getAttribute("start"))+"-"+numberWithCommas(b.getAttribute("stop"))+" ("+d+"bp)<BR>";c=c+"Type: "+b.getAttribute("type")+"<BR><BR>";d=getFirstChildByName(b,"herit");b=getFirstChildByName(b,"dabg");c+='<table class="tooltipTable" width="100%" colSpace="0"><tr><TH>Tissue</TH><TH>Heritability</TH><TH>DABG</TH></TR>';a.tissues.length<a.tissuesAll.length&&(c+='<TR><TD colspan="3">Displayed Tissues:</TD></TR>');
for(var e={},k=0;k<a.tissues.length;k++){var g=new String(a.tissues[k]);-1<g.indexOf("Affy")&&(g=g.substr(0,g.indexOf("Affy")));e[g]=1;var q=Math.floor(255*d.getAttribute(g));q=d3.rgb(q,0,0);var m=Math.floor(2.55*b.getAttribute(g));m=d3.rgb(0,m,0);c=c+"<TR><TD>"+g+'</TD><TD style="background:'+q+';color:white;">'+d.getAttribute(g)+'</TD><TD style="background:'+m+';color:white;">'+b.getAttribute(g)+"%</TD></TR>"}if(a.tissues.length<a.tissuesAll.length)for(c+='<TR><TD colspan="3">Other Tissues:</TD></TR>',
k=0;k<a.tissuesAll.length;k++)g=new String(a.tissuesAll[k]),-1<g.indexOf("Affy")&&(g=g.substr(0,g.indexOf("Affy"))),1!=e[g]&&(q=Math.floor(255*d.getAttribute(g)),q=d3.rgb(q,0,0),m=Math.floor(2.55*b.getAttribute(g)),m=d3.rgb(0,m,0),c=c+"<TR><TD>"+g+'</TD><TD style="background:'+q+';color:white;">'+d.getAttribute(g)+'</TD><TD style="background:'+m+';color:white;">'+b.getAttribute(g)+"%</TD></TR>");return c+"</table>"};a.updateSettingsFromUI=function(){0<$("#"+a.trackClass+"Dense"+a.level+"Select").length?
a.density=$("#"+a.trackClass+"Dense"+a.level+"Select").val():a.density||(a.density=1);a.curColor=a.colorSelect;0<$("#"+a.trackClass+a.level+"colorSelect").length?a.curColor=$("#"+a.trackClass+a.level+"colorSelect").val():a.curColor||(a.curColor="annot");var b=0;if(0<$("#affyTissues"+a.level+' input[name="tissuecbx"]').length){a.tissues=[];for(var f=$("#affyTissues"+a.level+' input[name="tissuecbx"]:checked'),d=0;d<f.length;d++){var e=new String(f[d].id);e=e.substr(0,e.indexOf("Affy"));a.tissues[b]=
e;b++}}};a.savePrevious=function(){a.prevSetting={};a.prevSetting.density=a.density;a.prevSetting.curColor=a.curColor;a.prevSetting.tissues=a.tissues};a.revertPrevious=function(){a.density=a.prevSetting.density;a.curColor=a.prevSetting.curColor;a.tissues=a.prevSetting.tissues};a.calcY=function(b,f,d,e){var c=8*e+5;if(3===a.density||"3"===a.density)if(b>=a.xScale.domain()[0]&&b<=a.xScale.domain()[1]||f>=a.xScale.domain()[0]&&f<=a.xScale.domain()[1]||b<=a.xScale.domain()[0]&&f>=a.xScale.domain()[1]){b=
Math.round(a.xScale(b));0>b&&(b=0);f=Math.round(a.xScale(f));f>=a.gsvg.width&&(f=a.gsvg.width-1);d=b-a.xPadding;0>d&&(d=0);e=f+a.xPadding;e>=a.gsvg.width&&(e=a.gsvg.width-1);e+c<a.gsvg.width?(e+=c,f+=c):0<d-c&&(d-=c,b-=c);c=0;for(var g=d;g<=e;g++)a.yMaxArr[g]>c&&(c=a.yMaxArr[g]);c++;var n=c;if(a.yArr.length<=c)for(a.yArr[n]=[],g=0;g<a.gsvg.width;g++)a.yArr[n][g]=0;g=c-a.scanBackYLines;1>g&&(g=1);n=0;for(var m=g;m<c&&0==n;m++){var h=0;for(g=d;g<=e&&0==h;g++)a.yArr[m][g]>h&&(h=1);0==h&&(c=m,n=1)}c>
a.trackYMax&&(a.trackYMax=c);for(g=b;g<=f;g++)a.yMaxArr[g]<c&&(a.yMaxArr[g]=c),a.yArr[c][g]=1;b=15*c}else b=15;else b=2===a.density||"2"===a.density?15*(d+1):15;a.trackYMax<b/15&&(a.trackYMax=b/15);return b};a.redraw=function(){var b=a.tissues.length;if(a.curColor!=a.colorSelect||("herit"===a.colorSelect||"dabg"===a.colorSelect)&&b!=a.tissueLen)a.tissueLen=b,a.draw(a.data);else{a.trackYMax=0;a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var f=0;f<a.gsvg.width;f++)a.yMaxArr[f]=0,a.yArr[0][f]=0;a.colorSelect=
a.curColor;a.tissueLen=b;if("dabg"==a.colorSelect||"herit"==a.colorSelect){"dabg"==a.colorSelect?a.drawScaleLegend("0%","100%","of Samples DABG","#000000","#00FF00",0):"herit"==a.colorSelect&&a.drawScaleLegend("0","1.0","Probeset Heritability","#000000","#FF0000",0);var d=1;for(b=0;b<a.tissues.length;b++){var e=new String(a.tissues[b]);a.trackYMax=0;a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(f=0;f<a.gsvg.width;f++)a.yMaxArr[f]=0,a.yArr[0][f]=0;d++;a.svg.select("text."+e).attr("y",15*d);a.svg.selectAll("g.probe."+
e).attr("transform",function(b,c){var f=a.gsvg.xScale(b.getAttribute("start")),e=a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c,b.getAttribute("ID").length)+15*d-10;return"translate("+f+","+e+")"}).each(function(b){var c=d3.select(this),d=1;1<a.gsvg.xScale(b.getAttribute("stop"))-a.gsvg.xScale(b.getAttribute("start"))&&(d=a.gsvg.xScale(b.getAttribute("stop"))-a.gsvg.xScale(b.getAttribute("start")));c.selectAll("rect").attr("width",d).attr("fill",a.color(b,e));var f=
">";"-1"==b.getAttribute("strand")&&(f="<");var k="";if(7.5<=d&&15>=d)k=f;else if(15<d)for(d-=7.5;7.5<d;)k+=f,d-=7.5;c.select("text#strand").text(k);if(2==a.density||3==a.density){var n=b.getAttribute("ID");0===c.select("text#lblTxt").size()?c.append("svg:text").attr("dx",function(){var c=a.xScale(b.getAttribute("stop"))+8*n.length+5,d=a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start"))+5;c>a.gsvg.width&&(d=-8*n.length);return d}).attr("dy",10).attr("id","lblTxt").text(n):c.select("text#lblTxt").attr("dx",
function(){var c=a.xScale(b.getAttribute("stop"))+8*n.length+5,d=a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start"))+5;c>a.gsvg.width&&(d=-8*n.length);return d})}else c.selectAll("text#lblTxt").remove()});d+=a.trackYMax}a.trackYMax=15*d;a.svg.attr("height",a.trackYMax)}else if("annot"===a.colorSelect){a.drawLegend([{color:"#FF0000",label:"Core"},{color:"#0000FF",label:"Extended"},{color:"#006400",label:"Full"},{color:"#000000",label:"Ambiguous"}]);a.trackYMax=0;a.yMaxArr=[];a.yArr=
[];a.yArr[0]=[];for(f=0;f<a.gsvg.width;f++)a.yMaxArr[f]=0,a.yArr[0][f]=0;a.svg.selectAll("g.probe").attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c,b.getAttribute("ID").length)+")"});a.svg.selectAll("g.probe rect").attr("width",function(b){var c=1;1<a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start"))&&(c=a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start")));
return c}).attr("fill",function(b){return a.color(b,"")});a.svg.selectAll("g.probe").each(function(b){var c=d3.select(this),d=">";"-1"==b.getAttribute("strand")&&(d="<");var f="",e=c.select("rect").attr("width");if(7.5<=e&&15>=e)f=d;else if(15<e)for(e-=7.5;7.5<e;)f+=d,e-=7.5;c.select("text").text(f);if(2==a.density||3==a.density){var k=b.getAttribute("ID");0===c.select("text#lblTxt").size()?c.append("svg:text").attr("dx",function(){var c=a.xScale(b.getAttribute("stop"))+8*k.length+5,d=a.xScale(b.getAttribute("stop"))-
a.xScale(b.getAttribute("start"))+5;c>a.gsvg.width&&(d=-8*k.length);return d}).attr("dy",10).attr("id","lblTxt").text(k):c.select("text#lblTxt").attr("dx",function(){var c=a.xScale(b.getAttribute("stop"))+8*k.length+5,d=a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start"))+5;c>a.gsvg.width&&(d=-8*k.length);return d})}else c.selectAll("text#lblTxt").remove()});1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(a.trackYMax+1)):3==a.density&&a.svg.attr("height",15*
(a.trackYMax+1))}}a.redrawSelectedArea()};a.update=function(b){a.redraw()};a.updateData=function(b){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/probe.xml",function(c,d){if(c)if(3>b){var f=5E3;1==b&&(f=1E4);setTimeout(function(){a.updateData(b+1)},f)}else 3<=b&&(d3.select("#Level"+a.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,
"#Level"+a.gsvg.levelNumber+a.trackClass));else{if(d){f=d.documentElement.getElementsByTagName("probe");for(var e=[],g=[],q=0,m=0;m<a.data.length;m++)"undefined"!==typeof a.data[m]&&(e[q]=a.data[m],g[a.data[m].getAttribute("ID")]=1,q++);for(m=0;m<f.length;m++)"undefined"!==typeof f[m]&&"undefined"===typeof g[f[m].getAttribute("ID")]&&(e[q]=f[m],q++);a.draw(e)}a.hideLoading()}})};a.draw=function(b){a.data=b;a.colorSelect=a.curColor;a.trackYMax=0;a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=
0,a.yArr[0][c]=0;if("dabg"==a.colorSelect||"herit"==a.colorSelect){"dabg"==a.colorSelect?a.drawScaleLegend("0%","100%","of Samples DABG","#000000","#00FF00",0):"herit"==a.colorSelect&&a.drawScaleLegend("0","1.0","Probeset Heritability","#000000","#FF0000",0);a.svg.selectAll(".probe").remove();a.svg.selectAll(".tissueLbl").remove();a.tissueLen=a.tissues.length;for(var d=1,e=0;e<a.tissues.length;e++){var k=new String(a.tissues[e]);0<k.indexOf(";")&&(k=k.substr(0,k.indexOf(";")));0<k.indexOf(":")&&(k=
k.substr(0,k.indexOf(":")));a.trackYMax=0;a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;c=k;"BrownAdipose"==c?c="Brown Adipose":"Brain"==c&&(c="Whole Brain");c=new String("Tissue: "+c);d++;a.svg.append("text").attr("class","tissueLbl "+k).attr("x",a.gsvg.width/2-c.length/2*7.5).attr("y",15*d).text(c);0<b.length&&(c=a.svg.selectAll(".probe."+k).data(b,function(a){return keyTissue(a,k)}).attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+
","+(a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c,b.getAttribute("ID").length)+15*d-10)+")"}),c.enter().append("g").attr("class","probe "+k).attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+(a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c,b.getAttribute("ID").length)+15*d-10)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(b){var c=1;1<a.xScale(b.getAttribute("stop"))-
a.xScale(b.getAttribute("start"))&&(c=a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start")));return c}).attr("id",function(a){return a.getAttribute("ID")+k}).style("fill",function(b){return a.color(b,k)}).style("cursor","pointer").on("dblclick",a.zoomToFeature).on("mouseover",function(b){if(0==a.gsvg.isToolTip){overSelectable=1;$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature.");var c=d3.select(this);a.curTTColor=c.style("fill");0<c.style("opacity")&&(c.style("fill",
"green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(b)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),a.setupToolTipSVG(b,.2))}}).on("mouseout",function(b){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");b=d3.select(this);0<b.style("opacity")&&(b.style("fill",a.curTTColor),tt.transition().delay(500).duration(200).style("opacity",
0))}),a.svg.selectAll("g.probe."+k).each(function(b){var c=d3.select(this),d=">";"-1"==b.getAttribute("strand")&&(d="<");var f=d,e=c.select("rect").attr("width");if(7.5>e)f="";else for(e-=7.5;8.5<e;)f+=d,e-=7.5;c.append("svg:text").attr("dx","1").attr("id","strand").attr("dy","10").style("pointer-events","none").style("fill","white").text(f);if(2==a.density||3==a.density){var g=b.getAttribute("ID");c.append("svg:text").attr("dx",function(){var c=a.xScale(b.getAttribute("stop"))+8*g.length+5,d=a.xScale(b.getAttribute("stop"))-
a.xScale(b.getAttribute("start"))+5;c>a.gsvg.width&&(d=-8*g.length);return d}).attr("dy",10).attr("id","lblTxt").text(g)}else c.selectAll("text#lblTxt").remove()}),d=d+a.trackYMax+1)}a.trackYMax=d;a.svg.attr("height",15*d+45)}else if("annot"==a.colorSelect){a.drawLegend([{color:"#FF0000",label:"Core"},{color:"#0000FF",label:"Extended"},{color:"#006400",label:"Full"},{color:"#000000",label:"Ambiguous"}]);a.trackYMax=0;a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=
0;a.svg.selectAll(".probe").remove();a.svg.selectAll(".tissueLbl").remove();c=a.svg.selectAll(".probe.annot").data(b,key).attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c,b.getAttribute("ID").length)+")"});c.enter().append("g").attr("class","probe annot").attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),
10),parseInt(b.getAttribute("stop"),10),c,b.getAttribute("ID").length)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(b){var c=1;1<a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start"))&&(c=a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start")));return c}).attr("id",function(a){return a.getAttribute("ID")}).style("fill",function(b){return a.color(b,"")}).style("cursor","pointer").on("dblclick",a.zoomToFeature).on("mouseover",function(b){if(0==
a.gsvg.isToolTip){overSelectable=1;$("#mouseHelp").html("<B>Double Click</B> to zoom in on this feature.");var c=d3.select(this);0<c.style("opacity")&&(c.style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(b)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",function(){return a.positionTTTop(d3.event.pageY)}),a.setupToolTipSVG(b,.2))}}).on("mouseout",function(b){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");
b=d3.select(this);0<b.style("opacity")&&(b.style("fill",a.color),tt.transition().delay(500).duration(200).style("opacity",0))});a.svg.selectAll("g.probe").each(function(b){var c=d3.select(this),d=">";"-1"==b.getAttribute("strand")&&(d="<");var f=d,e=c.select("rect").attr("width");if(7.5>e)f="";else for(e-=7.5;15<e;)f+=d,e-=7.5;c.append("svg:text").attr("dx","1").attr("dy","10").style("pointer-events","none").style("fill","white").text(f);if(2==a.density||3==a.density){var g=b.getAttribute("ID");c.append("svg:text").attr("dx",
function(){var c=a.xScale(b.getAttribute("stop"))+8*g.length+5,d=a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start"))+5;c>a.gsvg.width&&(d=-8*g.length);return d}).attr("dy",10).attr("id","lblTxt").text(g)}else c.select("text#lblTxt").remove()});1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(a.trackYMax+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1))}a.redrawSelectedArea()};a.getDisplayedData=function(){var b=d3.select("#Level"+a.gsvg.levelNumber+
a.trackClass).selectAll("g.probe");a.counts=[{value:0,names:"Core"},{value:0,names:"Extended"},{value:0,names:"Full"},{value:0,names:"Ambiguous"}];var f=[],d=0;b.each(function(b){var c=a.xScale(b.getAttribute("start")),e=a.xScale(b.getAttribute("stop"));if(0<=c&&c<=a.gsvg.width||0<=e&&e<=a.gsvg.width)"core"==b.getAttribute("type")?a.counts[0].value++:"extended"==b.getAttribute("type")?a.counts[1].value++:"full"==b.getAttribute("type")?a.counts[2].value++:"ambiguous"==b.getAttribute("type")&&a.counts[3].value++,
f[d]=b,d++});0===b.size()&&(a.counts=[]);return f};a.generateSettingsDiv=function(b){var c=trackInfo[a.trackClass];a.savePrevious();d3.select(b).select("table").select("tbody").html("");if("undefined"!==typeof c&&"undefined"!==typeof c.Controls&&"null"!=c.Controls&&0<c.Controls.length){var d=(new String(c.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<d.length;c++)if("undefined"!==
typeof d[c]&&""!=d[c]){var e=d[c].split(";"),k=b.append("tr").append("td"),g=e[0].substr(5);3<e.length&&0==e[3].indexOf("Default=")&&e[3].substr(8);if(0==e[1].toLowerCase().indexOf("select")){k.append("text").text(g+": ");g=e[1].split(":");e=e[2].split("}");var q=a.trackClass+"Dense"+a.level+"Select";"colorSelect"==g[1]&&(q=a.trackClass+a.level+"colorSelect");for(var m=k.append("select").attr("id",q).attr("name",g[1]),h=0;h<e.length;h++){var l=e[h].substr(1).split(":");2==l.length&&(k=m.append("option").attr("value",
l[1]).text(l[0]),"colorSelect"==g[1]&&l[1]==a.curColor?k.attr("selected","selected"):l[1]==a.density&&k.attr("selected","selected"))}d3.select("select#"+q).on("change",function(){"dabg"==$(this).val()||"herit"==$(this).val()?$("div#affyTissues"+a.level).show():$("div#affyTissues"+a.level).hide();a.updateSettingsFromUI();a.redraw()})}else if(0==e[1].toLowerCase().indexOf("cbx"))for(k=k.append("div").attr("id","affyTissues"+a.level).style("display","none"),k.append("text").text(g+": "),g=e[1].split(":"),
e=e[2].split("}"),h=0;h<e.length;h++)l=e[h].substr(1).split(":"),2==l.length&&(q=k.append("div").style("display","inline-block"),m=q.append("input").attr("type","checkbox").attr("id",l[1]+"CBX"+a.level).attr("name",g[1]).style("margin-left","5px"),q.append("text").text(l[0]),d3.select("input#"+l[1]+"CBX"+a.level).on("change",function(){a.updateSettingsFromUI();a.redraw()}))}"dabg"==a.curColor||"herit"==a.curColor?$("div#affyTissues"+a.level).show():$("div#affyTissues"+a.level).hide();for(d=0;d<a.tissues.length;d++)$("#"+
a.tissues[d]+"AffyCBX"+a.level).prop("checked",!0);d=b.append("tr").append("td");d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");a.gsvg.removeTrack(a.trackClass);var b=svgList[a.gsvg.levelNumber].currentView.ViewID,c=viewMenu[a.gsvg.levelNumber].findTrackByClass(a.trackClass,b);c=viewMenu[a.gsvg.levelNumber].findTrackIndexWithViewID(c.TrackID,b);viewMenu[a.gsvg.levelNumber].removeTrackWithIDIdx(c,
b)});d.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");a.density==a.prevSetting.density&&a.curColor==a.prevSetting.curColor&&a.tissues==a.prevSetting.tissues||a.gsvg.setCurrentViewModified()});d.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){a.revertPrevious();a.draw(a.data);$("#trackSettingDialog").fadeOut("fast")})}else b=
d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),b.append("tr").append("td").html("Sorry no settings for this track."),d=b.append("tr").append("td"),d.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),d.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};a.generateTrackSettingString=function(){for(var b="",f=0;f<a.tissues.length;f++)0<f&&(b+=":"),b+=a.tissues[f];return a.trackClass+","+a.density+","+a.curColor+","+b+";"};a.draw(h);return a}
function SNPTrack(e,h,l,p,b){var a=Track(e,h,l,c);e=(new String(l)).substr(3);b=(new String(b)).split(",");a.include=0<b.length?b[0]:4;a.density=p;var c=e;"SHRH"==c?c="SHR/OlaPrin":"BNLX"==c?c="BN-Lx/CubPrin":"SHRJ"==c&&(c="SHR/NCrlPrin");a.displayStrain=c;1==a.include?c+=" SNPs":2==a.include?c+=" Insertions":3==a.include?c+=" Deletions":4==a.include&&(c+=" SNPs/Indels");a.counts=[{value:0,perc:0,names:"SNP "+a.displayStrain},{value:0,perc:0,names:"Insertion "+a.displayStrain},{value:0,perc:0,names:"Deletion "+
a.displayStrain}];a.strain=e;a.ttTrackList=[];a.ttTrackList.push("ensemblcoding");a.ttTrackList.push("braincoding");a.ttTrackList.push("liverTotal");a.ttTrackList.push("heartTotal");a.ttTrackList.push("mergedTotal");a.ttTrackList.push("refSeq");a.ttTrackList.push("ensemblnoncoding");a.ttTrackList.push("brainnoncoding");a.ttTrackList.push("ensemblsmallnc");a.ttTrackList.push("brainsmallnc");a.ttTrackList.push("probe");a.ttTrackList.push("repeatMask");a.xPadding=1;a.scanBackYLines=50;a.updateSettingsFromUI=
function(){0<$("#"+a.trackClass+"Dense"+a.level+"Select").length&&(a.density=$("#"+a.trackClass+"Dense"+a.level+"Select").val());0<$("#"+a.trackClass+a.level+"Select").length&&(a.include=$("#"+a.trackClass+a.level+"Select").val())};a.savePrevious=function(){a.prevSetting={};a.prevSetting.density=a.density;a.prevSetting.include=a.include};a.revertPrevious=function(){a.density=a.prevSetting.density;a.include=a.prevSetting.include};a.generateTrackSettingString=function(){return a.trackClass+","+a.density+
","+a.include+";"};a.generateSettingsDiv=function(b){var c=trackInfo[a.trackClass];a.savePrevious();d3.select(b).select("table").select("tbody").html("");if(0<c.Controls.length&&"null"!=c.Controls){var f=(new String(c.Controls)).split(",");b=d3.select(b).select("table").select("tbody");b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<f.length;c++)if("undefined"!==typeof f[c]&&""!=f[c]){var e=f[c].split(";"),g=b.append("tr").append("td"),q=e[0].substr(5);
g.append("text").text(q+": ");3<e.length&&0==e[3].indexOf("Default=")&&e[3].substr(8);if(0==e[1].toLowerCase().indexOf("select")){var m=e[1].split(":");e=e[2].split("}");var h=q="";2<m.length&&(q=m[2]);3<m.length&&(h=m[3]);g=g.append("select").attr("id",a.trackClass+q+a.level+h).attr("name",m[1]);for(m=0;m<e.length;m++){var l=e[m].substr(1).split(":");if(2==l.length){var p=g.append("option").attr("value",l[1]).text(l[0]);("Dense"==q&&l[1]==a.density||""==q&&l[1]==a.include)&&p.attr("selected","selected")}}d3.select("#"+
a.trackClass+q+a.level+h).on("change",function(){a.updateSettingsFromUI();a.updateData()})}else console.log("Undefined track settings:  "+f[c])}f=b.append("tr").append("td");f.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");a.gsvg.removeTrack(a.trackClass);var b=svgList[a.gsvg.levelNumber].currentView.ViewID,c=viewMenu[a.gsvg.levelNumber].findTrackByClass(a.trackClass,
b);c=viewMenu[a.gsvg.levelNumber].findTrackIndexWithViewID(c.TrackID,b);viewMenu[a.gsvg.levelNumber].removeTrackWithIDIdx(c,b)});f.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");a.density==a.prevSetting.density&&a.include==a.prevSetting.include||a.gsvg.setCurrentViewModified()});f.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left",
"5px").on("click",function(){a.revertPrevious();a.draw(a.data);$("#trackSettingDialog").fadeOut("fast")})}else b=d3.select(b).select("table").select("tbody"),b.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),b.append("tr").append("td").html("Sorry no settings for this track."),f=b.append("tr").append("td"),f.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),
f.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};a.redraw=function(){a.trackYMax=0;a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var b=0;b<a.gsvg.width;b++)a.yMaxArr[b]=0,a.yArr[0][b]=0;a.svg.selectAll("g.snp").attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),
c)+")"});a.svg.selectAll("g.snp rect").attr("width",function(b){var c=1;1<a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start"))&&(c=a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start")));return c});6<a.xScale(a.xScale.domain()[0]+1)?a.svg.selectAll(".snp").each(function(b){var c=a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start")),d=new String(b.getAttribute("strainSeq")),f="8px",e=3.2,m=8;"SNP"!=b.getAttribute("type")&&(f="7px",e=3,m=7);0==d3.select(this).selectAll("text").size()&&
d.length*e<c?d3.select(this).append("text").attr("y",m).attr("x",function(a){a=0;7<c&&(a=c/2-d.length/2*e);return a}).attr("font-size",f).attr("stroke",d3.rgb("#FFFFFF")).attr("class","snpLbl").text(d):d3.select(this).selectAll(".snpLbl").attr("x",function(a){a=0;7<c&&(a=c/2-d.length/2*e);return a})}):a.svg.selectAll("text.snpLbl").remove();1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(a.trackYMax+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1));a.redrawSelectedArea()};
a.color=function(a){d3.rgb("#000000");return"SNP"===a.getAttribute("type")?"BNLX"===a.getAttribute("strain")?d3.rgb(0,0,255):"SHRH"===a.getAttribute("strain")?d3.rgb(255,0,0):"SHRJ"===a.getAttribute("strain")?d3.rgb("#00FF00"):"F344"===a.getAttribute("strain")?d3.rgb("#00FFFF"):d3.rgb(100,100,100):"BNLX"===a.getAttribute("strain")?d3.rgb(0,0,150):"SHRH"===a.getAttribute("strain")?d3.rgb(150,0,0):"SHRJ"===a.getAttribute("strain")?d3.rgb("#009600"):"F344"===a.getAttribute("strain")?d3.rgb("#009696"):
d3.rgb(50,50,50)};a.getDisplayID=function(a){return a.getAttribute("type")+"_"+keySNP(a)};a.createToolTip=function(a){var b=a.getAttribute("strain");"SHRH"==b&&(b="SHR");b='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Type: '+a.getAttribute("type")+"<BR>Strain: "+b+"<BR>Sequence: "+a.getAttribute("refSeq")+"->"+a.getAttribute("strainSeq")+"<BR>Location: chr"+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"));"SNP"!=a.getAttribute("type")&&(b=b+"-"+numberWithCommas(a.getAttribute("stop")));
return b};a.update=function(b){a.redraw()};a.updateData=function(b){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+a.gsvg.folderName+"/snp"+a.strain+".xml",function(c,f){if(c)if(3>b){var d=1E4;1==b&&(d=15E3);setTimeout(function(){a.updateData(b+1)},d)}else 3<=b&&(d3.select("#Level"+a.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,
"#Level"+a.gsvg.levelNumber+a.trackClass));else{d=f.documentElement.getElementsByTagName("Snp");for(var e=[],n=[],m=0,h=0;h<d.length;h++)"undefined"!==typeof d[h]&&(e[m]=d[h],n[keySNP(d[h])]=1,m++);for(h=0;h<a.data.length;h++)"undefined"!==typeof a.data[h]&&"undefined"===typeof n[keySNP(a.data[h])]&&(e[m]=a.data[h],m++);a.draw(e);a.hideLoading()}})};a.getDisplayedData=function(){var b=d3.select("#Level"+a.gsvg.levelNumber+a.trackClass).selectAll(".snp");a.counts=[{value:0,perc:0,names:"SNP"},{value:0,
perc:0,names:"Insertion"},{value:0,perc:0,names:"Deletion"}];var c=[],e=0,k=0;b.each(function(b){var d=a.xScale(b.getAttribute("start")),f=a.xScale(b.getAttribute("stop"));if(0<=d&&d<=a.gsvg.width||0<=f&&f<=a.gsvg.width)d=0,"Insertion"==b.getAttribute("type")?d++:"Deletion"==b.getAttribute("type")&&(d+=2),a.counts[d].value++,c[e]=b,e++,k++});return c};a.draw=function(b){a.data=b;a.trackYMax=0;a.yMaxArr=[];a.yArr=[];a.yArr[0]=[];for(var c=0;c<a.gsvg.width;c++)a.yMaxArr[c]=0,a.yArr[0][c]=0;c=a.strain;
"SHRH"==c?c="SHR/OlaPrin":"BNLX"==c?c="BN-Lx/CubPrin":"SHRJ"==c&&(c="SHR/NCrlPrin");1==a.include?c+=" SNPs":2==a.include?c+=" Insertions":3==a.include?c+=" Deletions":4==a.include&&(c+=" SNPs/Indels");a.updateLabel(c);a.redrawLegend();if(4>a.include){c=[];for(var f=0,e=0;e<b.length;e++)"undefined"!==typeof b[e]&&(1==a.include&&"SNP"==b[e].getAttribute("type")?(c[f]=b[e],f++):2==a.include&&"Insertion"==b[e].getAttribute("type")?(c[f]=b[e],f++):3==a.include&&"Deletion"==b[e].getAttribute("type")&&(c[f]=
b[e],f++));a.data=c}a.svg.selectAll(".snp").remove();0<a.data.length&&(b=a.svg.selectAll(".snp").data(b,keySNP).attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),c)+")"}),b.enter().append("g").attr("class","snp").attr("transform",function(b,c){return"translate("+a.xScale(b.getAttribute("start"))+","+a.calcY(parseInt(b.getAttribute("start"),10),parseInt(b.getAttribute("stop"),10),
c)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",function(b){var c=1;1<a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start"))&&(c=a.xScale(b.getAttribute("stop"))-a.xScale(b.getAttribute("start")));return c}).attr("id",keySNP).style("fill",a.color).on("mouseover",function(b){0==a.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(a.createToolTip(b)).style("left",function(){return a.positionTTLeft(d3.event.pageX)}).style("top",
function(){return a.positionTTTop(d3.event.pageY)}),a.setupToolTipSVG(b,.2))}).on("mouseout",function(b){d3.select(this).style("fill",a.color);tt.transition().delay(500).duration(200).style("opacity",0)}),1==a.density?a.svg.attr("height",30):2==a.density?a.svg.attr("height",15*(a.trackYMax+1)):3==a.density&&a.svg.attr("height",15*(a.trackYMax+1)),b.merge(b),b.exit().remove());a.redrawSelectedArea()};a.pieColor=function(b,c){var d=d3.rgb("#000000"),f=new String(b.data.names);"BNLX"==a.strain?d=-1<
f.indexOf("SNP")?d3.rgb(0,0,255):-1<f.indexOf("Insertion")?d3.rgb(0,0,175):d3.rgb(0,0,125):"SHRJ"==a.strain?d=-1<f.indexOf("SNP")?d3.rgb(0,255,0):-1<f.indexOf("Insertion")?d3.rgb(0,175,0):d3.rgb(0,125,0):"F344"==a.strain?d=-1<f.indexOf("SNP")?d3.rgb(0,255,255):-1<f.indexOf("Insertion")?d3.rgb(0,175,175):d3.rgb(0,125,125):"SHRH"==a.strain&&(d=-1<f.indexOf("SNP")?d3.rgb(255,0,0):-1<f.indexOf("Insertion")?d3.rgb(175,0,0):d3.rgb(125,0,0));return d};a.redrawLegend=function(){var b=[];4==a.include?b="BNLX"==
a.strain?[{color:"#0000FF",label:"SNP"},{color:"#000096",label:"Insertion/Deletion"}]:"SHRH"==a.strain?[{color:"#FF0000",label:"SNP"},{color:"#960000",label:"Insertion/Deletion"}]:"SHRJ"==a.strain?[{color:"#00FF00",label:"SNP"},{color:"#009600",label:"Insertion/Deletion"}]:"F344"==a.strain?[{color:"#00FFFF",label:"SNP"},{color:"#009696",label:"Insertion/Deletion"}]:[{color:"#DEDEDE",label:"SNP"},{color:"#969696",label:"Insertion/Deletion"}]:3==a.include||2==a.include?b="BNLX"==a.strain?[{color:"#000096",
label:"Insertion/Deletion"}]:"SHRH"==a.strain?[{color:"#960000",label:"Insertion/Deletion"}]:"SHRJ"==a.strain?[{color:"#009600",label:"Insertion/Deletion"}]:"F344"==a.strain?[{color:"#009696",label:"Insertion/Deletion"}]:[{color:"#969696",label:"Insertion/Deletion"}]:1==a.include&&(b="BNLX"==a.strain?[{color:"#0000FF",label:"SNP"}]:"SHRH"==a.strain?[{color:"#FF0000",label:"SNP"}]:"SHRJ"==a.strain?[{color:"#00FF00",label:"SNP"}]:"F344"==a.strain?[{color:"#00FFFF",label:"SNP"}]:[{color:"#DEDEDE",label:"SNP"}]);
a.drawLegend(b)};a.strain=e;a.redrawLegend();a.draw(h);return a}
function QTLTrack(e,h,l,p){var b=Track(e,h,l,"QTLs Overlapping Region");b.color=function(a){return b.pieColorPalette(a)};b.redraw=function(){b.yCount=0;b.idList=[];b.svg.selectAll("g.qtl").attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(a,c)+")"});d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.qtl rect").attr("width",function(a){var c=1;1<b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))&&(c=b.xScale(a.getAttribute("stop"))-
b.xScale(a.getAttribute("start")));return c});b.svg.attr("height",15*b.yCount);b.redrawSelectedArea()};b.createToolTip=function(a){return"Name: "+a.getAttribute("name")+"<BR>Location: "+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Trait:<BR>"+a.getAttribute("trait")+"<BR><BR>Phenotype:<BR>"+a.getAttribute("phenotype")+"<BR><BR>Candidate Genes:<BR>"+a.getAttribute("candidate")};b.pieColorPalette=d3.scaleOrdinal(d3.schemeCategory20);
b.pieColor=function(a){return b.pieColorPalette(a.data.names)};b.triggerTableFilter=function(a){var b=jQuery.Event("keyup");b.which=32;var f="";"undefined"===typeof a.getAttribute||"undefined"===typeof a.getAttribute("ID")?"undefined"!==typeof a.data&&"undefined"!==typeof a.data.names&&(f=a.data.names):f=a.getAttribute("ID");$("#tblBQTL_filter input").val(f).trigger(b)};b.clearTableFilter=function(a){a=jQuery.Event("keyup");a.which=32;$("#tblBQTL_filter input").val("").trigger(a)};b.getDisplayedData=
function(){var a=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".qtl");b.counts=[];var c=0,f=a.data();console.log(a);console.log(f);a=[];var d=0,e=0;if("undefined"!==typeof f)for(var k=0;k<f.length;k++){var g=b.xScale(f[k].getAttribute("start")),h=b.xScale(f[k].getAttribute("stop"));if(0<=g&&g<=b.gsvg.width||0<=h&&h<=b.gsvg.width||0>=g&&h>=b.gsvg.width)g=new String(f[k].getAttribute("name")),h=/[0-9]+\s*$/g,h=g.search(h),-1<h&&(g=g.substr(0,h)),h=/QTL\s*$/g,h=g.search(h),-1<h&&(g=
g.substr(0,h)),h=/traits+\s*$/g,h=g.search(h),-1<h&&(g=g.substr(0,h+5)),"undefined"===typeof b.counts[g]?(b.counts[g]={},b.counts[c]=b.counts[g],c++,b.counts[g].value=1,b.counts[g].names=g):b.counts[g].value++,a[d]=f[k],d++,e++}return a};b.setupDetailedView=function(a){$("div#collapsableReport").is(":hidden")||($("div#collapsableReport").hide(),$("span[name='collapsableReport']").removeClass("less"));$("div#selectedDetailHeader").is(":hidden")&&$("div#selectedDetailHeader").show();$("div#selectedDetail").is(":hidden")&&
$("div#selectedDetail").show();$("div#selectedImage").hide();$("div#selectedReport").show();var b=pathPrefix+"bQTLReport.jsp";a={id:a.getAttribute("ID"),species:organism,genomeVer:genomeVer};DisplaySelectedDetailReport(b,a)};b.updateData=function(a){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/qtl.xml",function(c,f){if(c)if(3>a){var d=1E4;1==a&&(d=15E3);setTimeout(function(){b.updateData(a+1)},d)}else d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+
b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass);else{if(f){d=f.documentElement.getElementsByTagName("QTL");for(var e=[],k=[],g=0,h=0;h<d.length;h++)"undefined"!==typeof d[h]&&(e[g]=d[h],k[d[h].getAttribute("ID")]=1,g++);for(h=0;h<b.data.length;h++)"undefined"!==typeof b.data[h]&&"undefined"===typeof k[b.data[h].getAttribute("ID")]&&(e[g]=b.data[h],g++);b.draw(e)}b.hideLoading()}})};b.calcY=function(a,
c){var f=0;"undefined"===typeof b.idList[a.getAttribute("ID")]&&(f=b.yCount++);return 15*(f+1)};b.draw=function(a){b.data=a;b.yCount=0;b.idList=[];b.data&&0<b.data.length?(console.log(b.svg),console.log(b.svg.selectAll(".qtl")),a=b.svg.selectAll(".qtl").data(a,key),console.log(a),a.enter().append("g").attr("class","qtl").attr("transform",function(a,f){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(a,f)+")"}).append("rect").attr("height",10).attr("rx",1).attr("ry",1).attr("width",
function(a){var c=1;1<b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))&&(c=b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start")));return c}).attr("id",function(a){return a.getAttribute("id")}).style("fill","blue").style("cursor","pointer").on("click",b.setupDetailedView).on("mouseover",function(a){0==b.gsvg.isToolTip&&(overSelectable=1,$("#mouseHelp").html("<B>Click</B> to see additional details. <B>Double Click</B> to zoom in on this feature."),d3.select(this).style("fill",
"green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(a)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),b.triggerTableFilter(a))}).on("mouseout",function(a){overSelectable=0;$("#mouseHelp").html("Navigation Hints: Hold mouse over areas of the image for available actions.");var c=a.getAttribute("name"),d=/[0-9]+\s*$/g;d=c.search(d);-1<d&&(c=c.substr(0,d));d=/QTL\s*$/g;d=c.search(d);-1<d&&
(c=c.substr(0,d));d=/traits?\s*$/g;d=c.search(d);-1<d&&(c=c.substr(0,d+5));d3.select(this).style("fill",b.color(c));tt.transition().delay(500).duration(200).style("opacity",0);b.clearTableFilter(a)}).merge(a),a.exit().remove(),"undefined"!==typeof a[0]&&a[0].forEach(function(a){if("undefined"!==typeof a){var c=new String(a.data().getAttribute("name")),d=/[0-9]+\s*$/g;d=c.search(d);-1<d&&(c=c.substr(0,d));d=/QTL\s*$/g;d=c.search(d);-1<d&&(c=c.substr(0,d));d=/traits?\s*$/g;d=c.search(d);-1<d&&(c=c.substr(0,
d+5));d3.select(a).select("rect").style("fill",b.color(c))}}),b.svg.attr("height",15*b.yCount)):b.svg.attr("height",15);b.redrawSelectedArea()};b.draw(h);b.redraw();return b}
function TranscriptTrack(e,h,l,p){var b=Track(e,h,l,"Selected Gene Transcripts");b.createToolTip=function(a){var b=".";1==a.getAttribute("strand")?b="+":-1==a.getAttribute("strand")&&(b="-");b="ID: "+a.getAttribute("ID")+"<BR>Location: chr"+a.getAttribute("chromosome")+":"+numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(a.getAttribute("stop"))+"<BR>Strand: "+b;-1==(new String(a.getAttribute("ID"))).indexOf("ENS")&&(a=getFirstChildByName(getFirstChildByName(a,"annotationList"),"annotation"),
null!=a&&(b+="<BR>Matching: "+a.getAttribute("reason")));return b};b.color=function(a){var c=d3.rgb("#000000");"protein"==b.gsvg.txType?c=-1<(new String(a.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#DFC184"):d3.rgb("#7EB5D6"):"long"==b.gsvg.txType?c=-1<(new String(a.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#B58AA5"):d3.rgb("#CECFCE"):"small"==b.gsvg.txType?c=-1<(new String(a.getAttribute("ID"))).indexOf("ENS")?d3.rgb("#FFCC00"):d3.rgb("#99CC99"):"liverTotal"==b.gsvg.txType?c=d3.rgb("#bbbedd"):
"heartTotal"==b.gsvg.txType?c=d3.rgb("#DC7252"):"mergedTotal"==b.gsvg.txType&&(c=d3.rgb("#9F4F92"));return c};b.drawTrx=function(a,c){var e=parseInt(a.getAttribute("start"),10),d=parseInt(a.getAttribute("stop"),10);"undefined"!==typeof a.getAttribute("cdsStart")&&"undefined"!==typeof a.getAttribute("cdsStop")&&(e=parseInt(a.getAttribute("cdsStart"),10),d=parseInt(a.getAttribute("cdsStop"),10));var n=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" #tx"+a.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(a,
"exonList"),"exon");for(var k=0;k<exList.length;k++){var g=parseInt(exList[k].getAttribute("start"),10),h=parseInt(exList[k].getAttribute("stop"),10);if(g<e&&e<h||h>d&&d>g){var m=0,l=0,p=0,C=0;g<e?(m=b.xScale(exList[k].getAttribute("start")),l=b.xScale(e)-b.xScale(exList[k].getAttribute("start")),p=b.xScale(e),C=b.xScale(exList[k].getAttribute("stop"))-b.xScale(e)):h>d&&(p=b.xScale(exList[k].getAttribute("start")),C=b.xScale(d)-b.xScale(exList[k].getAttribute("start")),m=b.xScale(d),l=b.xScale(exList[k].getAttribute("stop"))-
b.xScale(d));n.append("rect").attr("x",m).attr("y",2.5).attr("height",5).attr("width",l).attr("title",function(a){return exList[k].getAttribute("ID")}).attr("id",function(a){return"ExNC"+exList[k].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer");n.append("rect").attr("x",p).attr("height",10).attr("width",C).attr("title",function(a){return exList[k].getAttribute("ID")}).attr("id",function(a){return"Ex"+exList[k].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}else{m=
10;l=0;if(g<e&&h<e||h>d&&g>d)m=5,l=2.5;n.append("rect").attr("x",function(a){return b.xScale(exList[k].getAttribute("start"))}).attr("y",l).attr("height",m).attr("width",function(a){return b.xScale(exList[k].getAttribute("stop"))-b.xScale(exList[k].getAttribute("start"))}).attr("title",function(a){return exList[k].getAttribute("ID")}).attr("id",function(a){return"Ex"+exList[k].getAttribute("ID")}).style("fill",b.color).style("cursor","pointer")}if(0<k){n.append("line").attr("x1",function(a){return b.xScale(exList[k-
1].getAttribute("stop"))}).attr("x2",function(a){return b.xScale(exList[k].getAttribute("start"))}).attr("y1",5).attr("y2",5).attr("id",function(a){return"Int"+exList[k-1].getAttribute("ID")+"_"+exList[k].getAttribute("ID")}).attr("stroke",b.color).attr("stroke-width","2");g=">";"-1"==a.getAttribute("strand")&&(g="<");h=g;m=b.xScale(exList[k-1].getAttribute("stop"));l=b.xScale(exList[k].getAttribute("start"))-m;p=0;if(7>l)h="";else for(l-=7;8<l;)0==p?(h+=" ",p=1):(h+=g,p=0),l-=7;n.append("svg:text").attr("id",
function(a){return"IntTxt"+exList[k-1].getAttribute("ID")+"_"+exList[k].getAttribute("ID")}).attr("dx",m+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",b.color).style("font-size","16px").text(h)}}};b.redraw=function(){d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll("g.trx"+b.gsvg.levelNumber).each(function(a,c){var e=parseInt(a.getAttribute("start"),10),d=parseInt(a.getAttribute("stop"),10);"undefined"!==typeof a.getAttribute("cdsStart")&&"undefined"!==
typeof a.getAttribute("cdsStop")&&(e=parseInt(a.getAttribute("cdsStart"),10),d=parseInt(a.getAttribute("cdsStop"),10));exList=getAllChildrenByName(getFirstChildByName(a,"exonList"),"exon");for(var h=0;h<exList.length;h++){var k=parseInt(exList[h].getAttribute("start"),10),g=parseInt(exList[h].getAttribute("stop"),10);if(k<e&&e<g||g>d&&d>k){var l=k,m=e;g>d?(l=d,m=g,g=d):k=e;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#tx"+a.getAttribute("ID")+" rect#ExNC"+exList[h].getAttribute("ID")).attr("x",
function(a){return b.xScale(l)}).attr("width",function(a){return b.xScale(m)-b.xScale(l)})}d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#tx"+a.getAttribute("ID")+" rect#Ex"+exList[h].getAttribute("ID")).attr("x",function(a){return b.xScale(k)}).attr("width",function(a){return b.xScale(g)-b.xScale(k)});if(0<h){var p=">";"-1"==a.getAttribute("strand")&&(p="<");var v=p,C=b.xScale(exList[h-1].getAttribute("stop")),w=b.xScale(exList[h].getAttribute("start")),t=w-C,u=0;if(7>t)v="";else for(t-=
7;8<t;)0==u?(v+=" ",u=1):(v+=p,u=0),t-=7;d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#tx"+a.getAttribute("ID")+" line#Int"+exList[h-1].getAttribute("ID")+"_"+exList[h].getAttribute("ID")).attr("x1",C).attr("x2",w);d3.select("#Level"+b.gsvg.levelNumber+b.trackClass+" g#tx"+a.getAttribute("ID")+" #IntTxt"+exList[h-1].getAttribute("ID")+"_"+exList[h].getAttribute("ID")).attr("dx",C+1).text(v)}}});b.redrawSelectedArea()};b.update=function(){var a=getAllChildrenByName(getFirstChildByName(b.gsvg.selectedData,
"TranscriptList"),"Transcript"),c=parseInt(b.gsvg.selectedData.getAttribute("start"),10),e=parseInt(b.gsvg.selectedData.getAttribute("stop"),10);"undefined"!==typeof b.gsvg.selectedData.getAttribute("extStart")&&"undefined"!==typeof b.gsvg.selectedData.getAttribute("extStop")&&(c=parseInt(b.gsvg.selectedData.getAttribute("extStart"),10),e=parseInt(b.gsvg.selectedData.getAttribute("extStop"),10));b.txMin=c;b.txMax=e;b.svg.attr("height",15*(1+a.length));d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+
b.gsvg.levelNumber).remove();a=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+b.gsvg.levelNumber).data(a,key).attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(a,c)+")"});a.enter().append("g").attr("class","trx"+b.gsvg.levelNumber).attr("transform",function(a,c){return"translate(0,"+b.calcY(a,c)+")"}).attr("id",function(a){return a.getAttribute("ID")}).style("cursor","pointer").on("mouseover",function(a){0==b.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke",
"green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(a)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}))}).on("mouseout",function(a){d3.select(this).selectAll("line").style("stroke",b.color);d3.select(this).selectAll("rect").style("fill",b.color);d3.select(this).selectAll("text").style("opacity",
"0.6").style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}).each(b.drawTrx);a.exit().remove();b.svg.selectAll(".legend").remove();a=[];"protein"==b.gsvg.txType?a=[{color:"#DFC184",label:"Ensembl"},{color:"#7EB5D6",label:"RNA-Seq"}]:"long"==b.gsvg.txType?a=[{color:"#B58AA5",label:"Ensembl"},{color:"#CECFCE",label:"RNA-Seq"}]:"small"==b.gsvg.txType?a=[{color:"#FFCC00",label:"Ensembl"},{color:"#99CC99",label:"RNA-Seq"}]:"liverTotal"==b.gsvg.txType?a=[{color:"#bbbedd",label:"Liver RNA-Seq"}]:
"mergedTotal"==b.gsvg.txType&&(a=[{color:"#9F4F92",label:"Merged RNA-Seq"}]);b.drawLegend(a)};b.calcY=function(a,b){return 15*(b+1)};b.redrawLegend=function(){};"undefined"!==typeof b.gsvg.selectedData.getAttribute("extStart")?(b.txMin=parseInt(b.gsvg.selectedData.getAttribute("extStart"),10),b.txMax=parseInt(b.gsvg.selectedData.getAttribute("extStop"),10)):(b.txMin=parseInt(b.gsvg.selectedData.getAttribute("start"),10),b.txMax=parseInt(b.gsvg.selectedData.getAttribute("stop"),10));d3.select("#Level"+
b.gsvg.levelNumber+b.trackClass).attr("height",15*(1+h.length));d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+b.gsvg.levelNumber).remove();e=d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".trx"+b.gsvg.levelNumber).data(h,key).attr("transform",function(a,c){return"translate("+b.xScale(a.getAttribute("start"))+","+b.calcY(a,c)+")"});e.enter().append("g").attr("class","trx"+b.gsvg.levelNumber).attr("transform",function(a,c){return"translate(0,"+b.calcY(a,c)+")"}).attr("id",
function(a){return"tx"+a.getAttribute("ID")}).style("cursor","pointer").on("mouseover",function(a){0==b.gsvg.isToolTip&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(a)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}))}).on("mouseout",
function(a){d3.select(this).selectAll("line").style("stroke",b.color);d3.select(this).selectAll("rect").style("fill",b.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}).each(b.drawTrx);e.exit().remove();b.redrawLegend();b.scaleSVG.transition().duration(300).style("opacity",1);b.svg.transition().duration(300).style("opacity",1);b.redraw();return b}
function HelicosTrack(e,h,l,p){e=CountTrack(e,h,l,p);e.graphColorText="#DD0000";e.updateLabel("Brain Helicos RNA Read Counts");e.redrawLegend();e.redraw();return e}function IlluminaSmallTrack(e,h,l,p){e=CountTrack(e,h,l,p);e.graphColorText="#99CC99";e.updateLabel("Brain Illumina Small RNA Read Counts");e.redrawLegend();e.redraw();e.redraw();return e}
function IlluminaTotalTrack(e,h,l,p){e=CountTrack(e,h,l,p);e.updateLabel("BNLx/SHR Brain Illumina Total-RNA(rRNA depleted) Read Counts");e.redrawLegend();return e}function LiverIlluminaTotalPlusTrack(e,h,l,p){e=CountTrack(e,h,l,p);e.graphColorText="#abaecd";e.updateLabel("BNLx/SHR Liver + Strand Total-RNA Read Counts");e.redrawLegend();e.redraw();return e}
function LiverIlluminaTotalMinusTrack(e,h,l,p){e=CountTrack(e,h,l,p);e.graphColorText="#dbdefd";e.updateLabel("BNLx/SHR Liver - Strand Total-RNA Read Counts");e.redrawLegend();e.redraw();return e}function LiverIlluminaSmallTrack(e,h,l,p){e=CountTrack(e,h,l,p);e.graphColorText="#7b7e9d";e.updateLabel("Liver  Illumina Small RNA Read Counts");e.redrawLegend();e.redraw();return e}
function HeartIlluminaTotalPlusTrack(e,h,l,p){e=CountTrack(e,h,l,p);e.graphColorText="#CC6242";e.updateLabel("BNLx/SHR Heart + Strand Total-RNA Read Counts");e.redrawLegend();e.redraw();return e}function HeartIlluminaTotalMinusTrack(e,h,l,p){e=CountTrack(e,h,l,p);e.graphColorText="#FC9272";e.updateLabel("BNLx/SHR Heart - Strand Total-RNA Read Counts");e.redrawLegend();e.redraw();return e}
function HeartIlluminaSmallTrack(e,h,l,p){e=CountTrack(e,h,l,p);e.graphColorText="#9C3212";e.updateLabel("Heart Illumina Small RNA Read Counts");e.redrawLegend();e.redraw();return e}function BrainIlluminaTotalPlusTrack(e,h,l,p){e=CountTrack(e,h,l,p);e.graphColorText="#7EB5D6";e.updateLabel("Brain + Strand Total-RNA Read Counts");e.redrawLegend();e.redraw();return e}
function BrainIlluminaTotalMinusTrack(e,h,l,p){e=CountTrack(e,h,l,p);e.updateLabel("Brain - Strand Total-RNA Read Counts");e.redrawLegend();e.redraw();return e}
function StrainSpecificIlluminaTotalTrack(e,h,l,p){h=CountTrack(e,h,l,p);p=l.substr(l.indexOf("-")+1);var b=".";0<l.indexOf("Plus")?b="+":0<l.indexOf("Minus")&&(b="-");l=l.substr(0,l.indexOf("illumina"));"brain"===l?l="Whole Brain":"liver"===l&&(l="Liver");h.graphColorText=e.strainSpecificCountColors(p);h.updateLabel(p+" "+l+" "+b+" Strand Total-RNA Read Counts");h.redrawLegend();h.redraw();return h}
function IlluminaPolyATrack(e,h,l,p){e=CountTrack(e,h,l,p);e.graphColorText="#7EB5D6";e.updateLabel("Brain Illumina PolyA+ RNA Read Counts");e.redrawLegend();e.redraw();return e}
function SpliceJunctionTrack(e,h,l,p,b,a){e=GenericTranscriptTrack(e,h,l,p,b,a);e.dataFileName=l+".xml";e.xmlTag="Feature";e.xmlTagBlockElem="block";e.idPrefix="splcJnct";"liverspliceJnct"===l?e.idPrefix="lvrsplcJnct":"heartspliceJnct"===l&&(e.idPrefix="hrtsplcJnct");e.ttSVG=1;e.ttTrackList=[];e.ttTrackList.push(l);e.ttTrackList.push("ensemblcoding");e.ttTrackList.push("braincoding");e.ttTrackList.push("brainTotal");e.ttTrackList.push("liverTotal");e.ttTrackList.push("heartTotal");e.ttTrackList.push("mergedTotal");
e.ttTrackList.push("refSeq");e.ttTrackList.push("repeatMask");"splcJnct"===l?e.ttTrackList.push("illuminaPolyA"):"liverspliceJnct"===l?(e.ttTrackList.push("liverilluminaTotalPlus"),e.ttTrackList.push("liverilluminaTotalMinus")):"heartspliceJnct"===l?(e.ttTrackList.push("heartilluminaTotalPlus"),e.ttTrackList.push("heartilluminaTotalMinus")):"brainspliceJnct"===l&&(e.ttTrackList.push("brainilluminaTotalPlus"),e.ttTrackList.push("brainilluminaTotalMinus"));e.colorValueField="readCount";e.colorScale=
d3.scaleLinear().domain([1,1E3]).range(["#E6E6E6","#000000"]);e.legendLbl="Read Depth";e.density=3;e.getDisplayID=function(a){return a.getAttribute("name")};e.createToolTip=function(a){var b='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>ID: '+a.getAttribute("name");b=b+"<BR>Read Counts="+numberWithCommas(a.getAttribute("readCount"));b=b+"<BR>Splice Junction in "+a.getAttribute("sampleCount")+" of ";"Rn"===organism?b+="6 samples(3 BN-Lx, 3 SHR)":"Mm"===organism&&(b+="6 samples(3 ILS, 3 ISS)");
var c=getAllChildrenByName(getFirstChildByName(a,"blockList"),"block"),e=0,k=1,g="start",h="stop";-1==a.getAttribute("strand")&&(e=1,k=0,g="stop",h="start");b=b+"<BR><BR>Coverage Exon 1: "+numberWithCommas(c[e].getAttribute(g))+"-"+numberWithCommas(c[e].getAttribute(h))+" ("+(parseInt(c[e].getAttribute("stop"),10)-parseInt(c[e].getAttribute("start"),10))+" bp)";b=b+"<BR>Coverage Exon 2: "+numberWithCommas(c[k].getAttribute(g))+"-"+numberWithCommas(c[k].getAttribute(h))+" ("+(parseInt(c[k].getAttribute("stop"),
10)-parseInt(c[k].getAttribute("start"),10))+" bp)";return b=b+"<BR>Intron: "+numberWithCommas(parseInt(c[1].getAttribute("start"),10)-parseInt(c[0].getAttribute("stop"),10))+" bp<BR>"};e.drawScaleLegend("1","1000+","Read Counts","#E6E6E6","#000000",0);e.draw(h);return e}
function CustomCountTrack(e,h,l,p,b){var a=CountTrack(e,h,l,p);a.graphColorText="#4E85A6";a.updateControl=0;e="Custom Count Track";b=b.split(",");if(0<b.length)for(h=0;h<b.length;h++)0==h?a.dataFileName=b[h].substr(9):b[h].indexOf("Name=")&&(e=b[h].substr(5));a.updateFullData=function(b,e){if(a.updateControl==b){a.updateControl=b+1;var c=a.xScale.domain()[0],f=a.xScale.domain()[1],k=f-c;a.showLoading();a.bin=a.calculateBin(k);var g=dataPrefix+"tmpData/trackXML/"+a.gsvg.folderName+"/tmp/"+c+"_"+f+
".count."+a.trackClass+".xml",h=dataPrefix+"tmpData/trackUpload/"+a.trackClass.substr(6),m="bg",l="";0<a.bin&&(c-=2*a.bin,c-=c%(2*a.bin),f+=2*a.bin,f+=2*a.bin-f%(2*a.bin),g=dataPrefix+"tmpData/trackXML/"+a.gsvg.folderName+"/"+c+"_"+f+".bincount."+a.bin+"."+a.trackClass+".xml");-1<a.dataFileName.indexOf("http")&&(l=h=a.dataFileName,m="bw");d3.xml(g,function(d,k){if(d){if(0==b||1==e){var n=contextPath+"/"+pathPrefix;pathPrefix||(n="");$.ajax({url:n+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,
minCoord:c,maxCoord:f,myOrganism:organism,genomeVer:genomeVer,track:a.trackClass,bedFile:h,outFile:g,folder:a.gsvg.folderName,binSize:a.bin,type:m,web:l},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackCount")},error:function(a,b,c){}})}8>b?a.fullDataTimeOutHandle=setTimeout(function(){a.updateFullData(b+1)},500):30>b?a.fullDataTimeOutHandle=setTimeout(function(){a.updateFullData(b+1)},1E3):32>b?a.fullDataTimeOutHandle=setTimeout(function(){a.updateFullData(b+1)},
1E4):(d3.select("#Level"+a.levelNumber+a.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+a.trackClass),d3.select("#Level"+a.levelNumber+a.trackClass).attr("height",15),a.gsvg.addTrackErrorRemove(a.svg,"#Level"+a.gsvg.levelNumber+a.trackClass),a.hideLoading(),a.fullDataTimeOutHandle=setTimeout(function(){a.updateFullData(b+1,0)},15E3))}else null==k?32<=b?(n=[],a.draw(n)):a.fullDataTimeOutHandle=setTimeout(function(){a.updateFullData(b+1,0)},5E3):(a.fullDataTimeOutHandle=0,a.loadedDataMin=
c,a.loadedDataMax=f,n=k.documentElement.getElementsByTagName("Count"),a.draw(n),a.updateControl=0)})}};a.updateLabel(e);a.redrawLegend();a.redraw();return a}
function CountTrack(e,h,l,p){var b=Track(e,h,l,"Generic Counts");b.loadedDataMin=b.xScale.domain()[0];b.loadedDataMax=b.xScale.domain()[1];b.dataFileName=b.trackClass;b.scaleMin=1;b.scaleMax=5E3;b.graphColorText="steelblue";b.colorScale=d3.scaleLinear().domain([b.scaleMin,b.scaleMax]).range(["#EEEEEE","#000000"]);b.ttSVG=1;b.data=h;b.density=p;b.prevDensity=p;b.displayBreakDown=null;e=b.gsvg.xScale.domain()[0];e=b.gsvg.xScale.domain()[1]-e;b.fullDataTimeOutHandle=0;b.ttTrackList=[];-1<l.indexOf("illuminaSmall")?
(b.ttTrackList.push("ensemblsmallnc"),b.ttTrackList.push("brainsmallnc"),b.ttTrackList.push("liversmallnc"),b.ttTrackList.push("heartsmallnc")):(b.ttTrackList.push("ensemblcoding"),b.ttTrackList.push("braincoding"),b.ttTrackList.push("liverTotal"),b.ttTrackList.push("heartTotal"),b.ttTrackList.push("mergedTotal"),b.ttTrackList.push("refSeq"),b.ttTrackList.push("ensemblnoncoding"),b.ttTrackList.push("brainnoncoding"),b.ttTrackList.push("probe"),b.ttTrackList.push("polyASite"),b.ttTrackList.push("spliceJnct"),
b.ttTrackList.push("liverspliceJnct"),b.ttTrackList.push("heartspliceJnct"));b.ttTrackList.push("repeatMask");b.calculateBin=function(a){a=new String(Math.floor(a/b.gsvg.width));a=a.substr(0,1)*Math.pow(10,a.length-1);a=Math.floor(a/2);5>a&&(a=0);return a};b.bin=b.calculateBin(e);b.color=function(a){var c="#FFFFFF";a.getAttribute("count")>=b.scaleMin&&(c=d3.rgb(b.colorScale(a.getAttribute("count"))));return c};b.redraw=function(){var a=b.gsvg.xScale.domain()[0],c=b.gsvg.xScale.domain()[1];b.xScale(a+
b.bin);b.xScale(a);b.prevMinCoord=a;b.prevMaxCoord=c;a=b.xScale.domain()[0];c=b.xScale.domain()[1];for(var e=[],d=0,h=0,k=0;k<b.data.length;k++)if("undefined"!==typeof b.data[k]){var g=parseInt(b.data[k].getAttribute("start"),10),l=parseInt(b.data[k].getAttribute("stop"),10),m=parseInt(b.data[k].getAttribute("count"),10);if(1!=b.density||1==b.density&&g!=l)if(k+1<b.data.length){if(l=parseInt(b.data[k+1].getAttribute("start"),10),g>=a&&g<=c||l>=a&&l<=c)e[d]=b.data[k],m>h&&(h=m),d++}else g>=a&&g<=c&&
(e[d]=b.data[k],m>h&&(h=m),d++)}1==b.density?(b.density!=b.prevDensity?(b.redrawLegend(),c=b.gsvg.xScale.domain()[1],b.prevDensity=b.density,b.svg.selectAll(".area").remove(),b.svg.selectAll("g.y").remove(),b.svg.selectAll(".grid").remove(),b.svg.selectAll(".leftLbl").remove(),a=b.svg.selectAll("."+b.trackClass).data(e,keyStart),a.enter().append("rect").attr("x",function(a){return b.xScale(a.getAttribute("start"))}).attr("y",15).attr("class",b.trackClass).attr("height",10).attr("width",function(a,
c){return b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))}).attr("fill",b.color).on("mouseover",function(a){0==b.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(a)).style("left",function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}))}).on("mouseout",function(a){d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",
0)}),a.exit().remove()):b.svg.selectAll("."+b.trackClass).attr("x",function(a){return b.xScale(a.getAttribute("start"))}).attr("width",function(a,c){return b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))}).attr("fill",b.color),b.svg.attr("height",30)):2==b.density&&(b.svg.selectAll("."+b.trackClass).remove(),b.svg.select(".y.axis").remove(),b.svg.select("g.grid").remove(),b.svg.selectAll(".leftLbl").remove(),b.yScale.domain([0,h]),b.svg.select(".area").remove(),b.area=d3.area().x(function(a){return b.xScale(a.getAttribute("start"))}).y0(140).y1(function(a){return b.yScale(a.getAttribute("count"))}),
b.redrawLegend(),b.prevDensity=b.density,b.svg.append("g").attr("class","y axis").call(b.yAxis),b.svg.append("g").attr("class","grid").call(b.yAxis.tickSize(-b.gsvg.width+10,0,0).tickFormat("")),b.svg.select("g.y").selectAll("text").each(function(a){var c=new String(a);d3.select(this).attr("x",function(){return 7.7*c.length+5}).attr("dy","0.05em");b.svg.append("svg:text").attr("class","leftLbl").attr("x",b.gsvg.width-(7.8*c.length+5)).attr("y",function(){return b.yScale(a)}).attr("dy","0.01em").style("font-weight",
"bold").text(numberWithCommas(a))}),b.svg.append("path").datum(e).attr("class","area").attr("stroke",b.graphColorText).attr("fill",b.graphColorText).attr("d",b.area),b.svg.attr("height",140));b.redrawSelectedArea()};b.createToolTip=function(a){var c='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Read Count='+numberWithCommas(a.getAttribute("count"));if(0<b.bin){var e=parseInt(a.getAttribute("start"),10)+parseInt(b.bin,10);c=c+"*<BR><BR>*Data compressed for display. Using 90th percentile of<BR>region:"+
numberWithCommas(a.getAttribute("start"))+"-"+numberWithCommas(e)+"<BR><BR>Zoom in further to see raw data(roughly a region <1000bp). The bin size will decrease as you zoom in thus the resolution of the count data will improve as you zoom in."}return c};b.update=function(a){a=b.xScale.domain()[0];var c=b.xScale.domain()[1];b.loadedDataMin<=a&&c<=b.loadedDataMax?b.redraw():b.updateFullData(0,1)};b.updateFullData=function(a,c){var e=b.xScale.domain()[0],d=b.xScale.domain()[1],h=d-e;b.showLoading();
b.bin=b.calculateBin(h);h=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/tmp/"+e+"_"+d+".count."+b.trackClass+".xml";0<b.bin&&(e-=2*b.bin,e-=e%(2*b.bin),d+=2*b.bin,d+=2*b.bin-d%(2*b.bin),h=dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+b.gsvg.folderName+"/tmp/"+e+"_"+d+".bincount."+b.bin+"."+b.trackClass+".xml");d3.xml(h,function(f,g){if(f){if(0==a||1==c){var k=contextPath+"/"+pathPrefix;pathPrefix||(k="");tmpPanel=panel;-1<b.trackClass.indexOf("-")&&
(tmpPanel=b.trackClass.substr(b.trackClass.indexOf("-")+1));$.ajax({url:k+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,minCoord:e,maxCoord:d,panel:tmpPanel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:b.trackClass,folder:b.gsvg.folderName,binSize:b.bin},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackCount")},error:function(a,b,c){}})}8>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+
1,0)},500):30>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},1E3):32>a?b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},1E4):(d3.select("#Level"+b.levelNumber+b.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+b.trackClass),d3.select("#Level"+b.levelNumber+b.trackClass).attr("height",15),b.gsvg.addTrackErrorRemove(b.svg,"#Level"+b.gsvg.levelNumber+b.trackClass),b.hideLoading(),b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+
1,1)},15E3))}else null==g?32<=a?(k=[],b.draw(k)):b.fullDataTimeOutHandle=setTimeout(function(){b.updateFullData(a+1,0)},5E3):(b.fullDataTimeOutHandle=0,b.loadedDataMin=e,b.loadedDataMax=d,k=g.documentElement.getElementsByTagName("Count"),b.draw(k))})};b.updateCountScale=function(a,c){b.scaleMin=a;b.scaleMax=c;b.colorScale=d3.scaleLinear().domain([b.scaleMin,b.scaleMax]).range(["#EEEEEE","#000000"]);1==b.density&&(b.redrawLegend(),b.redraw())};b.setupToolTipSVG=function(a,c){var e=b.xScale.domain()[0],
d=b.xScale.domain()[1],h=parseInt(a.getAttribute("start"),10),k=parseInt(a.getAttribute("stop"),10);d=Math.floor((d-e)*c);20>d&&(d=20);e=h-d;d=k+d;1>e&&(e=1);"undefined"!==typeof b.ttSVGMinWidth&&d-e<b.ttSVGMinWidth&&(e=h-b.ttSVGMinWidth/2,d=k+b.ttSVGMinWidth/2);h=toolTipSVG("div#ttSVG",450,e,d,99,a.getAttribute("ID"),"transcript");h.addTrack(b.trackClass,3,"",b.data);for(k=0;k<b.ttTrackList.length;k++){var g=b.gsvg.getTrackData(b.ttTrackList[k]),l=[];if("undefined"!==typeof g&&0<g.length){for(var m=
0,p=0;p<g.length;p++)if(e<=parseInt(g[p].getAttribute("start"),10)&&parseInt(g[p].getAttribute("start"),10)<=d||parseInt(g[p].getAttribute("start"),10)<=e&&parseInt(g[p].getAttribute("stop"),10)>=e)l[m]=g[p],m++;0<l.length&&h.addTrack(b.ttTrackList[k],3,"DrawTrx",l)}}};b.draw=function(a){b.hideLoading();b.data=a;var c=b.gsvg.xScale.domain()[0],e=b.gsvg.xScale.domain()[1];b.xScale(c+b.bin);b.xScale(c);b.redrawLegend();for(var d=[],h=0,k=0,g=0;g<a.length;g++)if("undefined"!==typeof a[g]){var l=parseInt(a[g].getAttribute("start"),
10),m=parseInt(a[g].getAttribute("stop"),10),p=parseInt(a[g].getAttribute("count"),10);if(1!=b.density||1==b.density&&l!=m)if(g+1<a.length){if(m=parseInt(a[g+1].getAttribute("start"),10),l>=c&&l<=e||m>=c&&m<=e)d[h]=a[g],p>k&&(k=p),h++}else l>=c&&l<=e&&(d[h]=a[g],p>k&&(k=p),h++)}a=d;b.svg.selectAll("."+b.trackClass).remove();b.svg.select(".y.axis").remove();b.svg.select("g.grid").remove();b.svg.selectAll(".leftLbl").remove();b.svg.select(".area").remove();b.svg.selectAll(".area").remove();1==b.density?
(e=b.gsvg.xScale.domain()[1],b.svg.selectAll("."+b.trackClass).data(a,keyStart).enter().append("rect").attr("x",function(a){return b.xScale(a.getAttribute("start"))}).attr("y",15).attr("class",b.trackClass).attr("height",10).attr("width",function(a,c){return b.xScale(a.getAttribute("stop"))-b.xScale(a.getAttribute("start"))}).attr("fill",b.color).on("mouseover",function(a){0==b.gsvg.isToolTip&&(d3.select(this).style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(b.createToolTip(a)).style("left",
function(){return b.positionTTLeft(d3.event.pageX)}).style("top",function(){return b.positionTTTop(d3.event.pageY)}),1==b.ttSVG&&b.setupToolTipSVG(a,.005))}).on("mouseout",function(a){d3.select(this).style("fill",b.color);tt.transition().delay(500).duration(200).style("opacity",0)}),b.svg.attr("height",30)):2==b.density&&(b.yScale.domain([0,k]),b.yAxis=d3.axisLeft(b.yScale).ticks(5),b.svg.select("g.grid").remove(),b.svg.select(".y.axis").remove(),b.svg.selectAll(".leftLbl").remove(),b.svg.append("g").attr("class",
"y axis").call(b.yAxis),b.svg.select("g.y").selectAll("text").each(function(a){var c=new String(a);b.svg.append("svg:text").attr("class","leftLbl").attr("x",b.gsvg.width-(7.8*c.length+5)).attr("y",function(){return b.yScale(a)}).attr("dy","0.01em").style("font-weight","bold").text(numberWithCommas(a));d3.select(this).attr("x",function(){return 7.7*c.length+5}).attr("dy","0.05em")}),b.svg.append("g").attr("class","grid").call(b.yAxis.tickSize(-b.gsvg.width+10,0,0).tickFormat("")),b.svg.select(".area").remove(),
b.area=d3.area().x(function(a){return b.xScale(a.getAttribute("start"))}).y0(140).y1(function(a,c){return b.yScale(a.getAttribute("count"))}),b.svg.append("path").datum(a).attr("class","area").attr("stroke",b.graphColorText).attr("fill",b.graphColorText).attr("d",b.area),b.svg.attr("height",140));b.redrawSelectedArea()};b.redrawLegend=function(){if(2==b.density)d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".legend").remove();else if(1==b.density){var a=new String(b.label);a=b.gsvg.width/
2+a.length/2*7.5-10;var c=new String("<"+b.scaleMin);b.drawScaleLegend(b.scaleMin,numberWithCommas(b.scaleMax)+"+","Read Counts","#EEEEEE","#00000",15+7.6*c.length);b.svg.append("text").text("<"+b.scaleMin).attr("class","legend").attr("x",a).attr("y",12);b.svg.append("rect").attr("class","legend").attr("x",a+7.6*c.length+5).attr("y",0).attr("rx",2).attr("ry",2).attr("height",12).attr("width",15).attr("fill","#FFFFFF").attr("stroke","#CECECE")}};b.redrawSelectedArea=function(){if(1<b.density){var a=
b.svg.attr("height");d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".selectedArea").remove();if(-1<b.selectionStart&&-1<b.selectionEnd){var c=b.xScale(b.selectionStart),e=b.xScale(b.selectionEnd)-c;1>e&&(e=1);d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).append("rect").attr("class","selectedArea").attr("x",c).attr("y",0).attr("height",a).attr("width",e).attr("fill","#CECECE").attr("opacity",.3).attr("pointer-events","none")}}else d3.select("#Level"+b.gsvg.levelNumber+b.trackClass).selectAll(".selectedArea").remove()};
b.savePrevious=function(){b.prevSetting={};b.prevSetting.density=b.density;b.prevSetting.scaleMin=b.scaleMin;b.prevSetting.scaleMax=b.scaleMax};b.revertPrevious=function(){b.density=b.prevSetting.density;b.scaleMin=b.prevSetting.scaleMin;b.scaleMax=b.prevSetting.scaleMax};b.generateTrackSettingString=function(){return b.trackClass+","+b.density+","+b.include+";"};b.generateSettingsDiv=function(a){var c=trackInfo[b.trackClass];b.savePrevious();d3.select(a).select("table").select("tbody").html("");
if(c&&c.Controls&&0<c.Controls.length){var e=(new String(c.Controls)).split(",");a=d3.select(a).select("table").select("tbody");a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name);for(c=0;c<e.length;c++)if("undefined"!==typeof e[c]&&""!=e[c]){var d=e[c].split(";"),h=a.append("tr").append("td"),k=d[0].substr(5),g="";3<d.length&&0==d[3].indexOf("Default=")&&(g=d[3].substr(8));if(0==d[1].toLowerCase().indexOf("select")){h.append("text").text(k+": ");var l=d[1].split(":");
d=d[2].split("}");k=b.trackClass+"Dense"+b.level+"Select";"colorSelect"==l[1]&&(k=b.trackClass+b.level+"colorSelect");h=h.append("select").attr("id",k).attr("name",l[1]);for(l=0;l<d.length;l++){var m=d[l].substr(1).split(":");if(2==m.length){var p=h.append("option").attr("value",m[1]).text(m[0]);-1<k.indexOf("Dense")?m[1]==b.density&&p.attr("selected","selected"):m[1]==g&&p.attr("selected","selected")}}d3.select("select#"+k).on("change",function(){$(this).attr("id")==b.trackClass+"Dense"+b.level+
"Select"&&1==$(this).val()?$("#scaleControl"+b.level).show():$("#scaleControl"+b.level).hide();b.updateSettingsFromUI();b.redraw()})}else 0==d[1].toLowerCase().indexOf("slider")&&(g="none",1==b.density&&(g="inline-block"),h=h.append("div").attr("id","scaleControl"+b.level).style("display",g),h.append("text").text(k+": "),h.append("input").attr("type","text").attr("id","amount").attr("value",b.scaleMin+"-"+b.scaleMax).style("border",0).style("color","#f6931f").style("font-weight","bold").style("background-color",
"#EEEEEE"),l=d[1].split(":"),d=d[2].split("}"),h=h.append("div"),h.append("text").text("Min:"),h.append("div").attr("id","min-"+l[1]).style("width","60%").style("display","inline-block").style("float","right"),h.append("br"),h.append("text").text("Max:"),h.append("div").attr("id","max-"+l[1]).style("width","60%").style("display","inline-block").style("float","right"),$("#min-"+l[1]).slider({min:1,max:1E3,step:1,value:b.scaleMin,slide:b.processSlider}),$("#max-"+l[1]).slider({min:1E3,max:2E4,step:100,
value:b.scaleMax,slide:b.processSlider}),b.updateSettingsFromUI(),b.redraw())}e=a.append("tr").append("td");e.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.gsvg.setCurrentViewModified();b.gsvg.removeTrack(b.trackClass);var a=svgList[b.gsvg.levelNumber].currentView.ViewID,c=viewMenu[b.gsvg.levelNumber].findTrackByClass(b.trackClass,a);c=viewMenu[b.gsvg.levelNumber].findTrackIndexWithViewID(c.TrackID,
a);viewMenu[b.gsvg.levelNumber].removeTrackWithIDIdx(c,a)});e.append("input").attr("type","button").attr("value","Apply").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");b.density==b.prevSetting.density&&b.scaleMin==b.prevSetting.scaleMin&&b.scaleMax==b.prevSetting.scaleMax||b.gsvg.setCurrentViewModified()});e.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){b.revertPrevious();
b.updateCountScale(b.scaleMin,b.scaleMax);b.draw(b.data);$("#trackSettingDialog").fadeOut("fast")})}else a=d3.select(a).select("table").select("tbody"),a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+c.Name),a.append("tr").append("td").html("Sorry no settings for this track."),e=a.append("tr").append("td"),e.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){b.gsvg.setCurrentViewModified();
$("#trackSettingDialog").fadeOut("fast")}),e.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};b.processSlider=function(a,c){var e=$("#min-rangeslider").slider("value"),d=$("#max-rangeslider").slider("value");$("#amount").val(e+" - "+d);b.updateCountScale(e,d)};b.yScale=d3.scaleLinear().range([140,20]).domain([0,d3.max(h,function(a){return a.getAttribute("count")})]);b.area=
d3.area().x(function(a){return b.xScale(a.getAttribute("start"))}).y0(140).y1(function(a){return a.getAttribute("count")});b.yAxis=d3.axisLeft(b.yScale).ticks(5);b.redrawLegend();b.draw(h);return b}
function PolyATrack(e,h,l,p,b,a){var c=GenericTranscriptTrack(e,h,l,p,b,a);c.dataFileName="polyASite.xml";c.density=3;c.minFeatureWidth=1;c.colorBy="Color";c.ttSVG=1;c.ttTrackList=[];c.ttTrackList.push("ensemblcoding");c.ttTrackList.push("braincoding");c.ttTrackList.push("liverTotal");c.ttTrackList.push("heartTotal");c.ttTrackList.push("mergedTotal");c.ttTrackList.push("refSeq");c.ttTrackList.push("repeatMask");c.ttSVGMinWidth=200;c.createToolTip=function(a){var b=".";1==a.getAttribute("strand")?
b="+":-1==a.getAttribute("strand")&&(b="-");var c="0";1==a.getAttribute("pvalue")&&(c="");return'<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Motif:'+a.getAttribute("motif")+"<BR>Strand:"+b+"<BR>Location: chr"+a.getAttribute("chromosome")+":"+a.getAttribute("start")+"-"+a.getAttribute("stop")+"<BR>Probability of site: "+c+a.getAttribute("pvalue")};c.updateData=function(a){d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.gsvg.folderName+"/"+c.dataFileName,function(b,
e){if(b)if(3>a){var d=1E4;1==a&&(d=15E3);setTimeout(function(){c.updateData(a+1)},d)}else 3<=a&&(d3.select("#Level"+c.levelNumber+c.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+c.trackClass),d3.select("#Level"+c.levelNumber+c.trackClass).attr("height",15),c.gsvg.addTrackErrorRemove(c.svg,"#Level"+c.gsvg.levelNumber+c.trackClass));else{d=e.documentElement.getElementsByTagName(c.xmlTag);for(var f=[],h=[],m=0,l=0;l<d.length;l++)"undefined"!==typeof d[l]&&(f[m]=d[l],h[d[l].getAttribute("ID")]=
1,m++);for(l=0;l<c.data.length;l++)"undefined"!==typeof c.data[l]&&"undefined"===typeof h[c.data[l].getAttribute("ID")]&&(f[m]=c.data[l],m++);c.draw(f);c.hideLoading()}})};c.redrawLegend=function(){c.drawLegend([{color:"#FF8000",label:"+ Strand >>>"},{color:"#330570",label:"- Strand <<<"}])};c.updateFullData=void 0;c.draw(h);return c}
function CustomTranscriptTrack(e,h,l,p,b,a){var c=GenericTranscriptTrack(e,h,l,p,b,a);e=a.split(",");c.density=b;0<e.length&&(c.dataFileName=e[0].substr(9));c.colorBy=1<e.length?e[1]:"Score";2<e.length&&(c.minValue=e[2]);3<e.length&&(c.maxValue=e[3]);4<e.length&&(c.minColor=e[4]);5<e.length&&(c.maxColor=e[5]);c.colorValueField="score";c.minFeatureWidth=1;c.updateControl=0;"Score"==c.colorBy&&c.createColorScale();c.updateFullData=function(a,b){if(c.updateControl==a){c.updateControl=a+1;var d=c.xScale.domain()[0],
e=c.xScale.domain()[1],f=dataPrefix+"tmpData/trackXML/"+c.gsvg.folderName+"/"+c.dataFileName+".xml",h=dataPrefix+"tmpData/trackUpload/"+c.dataFileName,m="",l=new Date,p="bed";-1<c.dataFileName.indexOf("http")&&(m=c.dataFileName,h="tmpData/tmpDownload/"+l.getTime()+"_"+c.trackClass,f=dataPrefix+"tmpData/trackXML/"+c.gsvg.folderName+"/"+c.trackClass+".xml",p="bb");d3.xml(f,function(g,k){if(g){console.log(g);if(0==a||1==b){var l=contextPath+"/"+pathPrefix;pathPrefix||(l="");$.ajax({url:l+"generateTrackXML.jsp",
type:"GET",cache:!1,data:{chromosome:chr,minCoord:d,maxCoord:e,folder:c.gsvg.folderName,bedFile:h,outFile:f,track:c.trackClass,web:m,type:p},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackCustomTranscript")},error:function(a,b,c){console.log(c)}})}3>a?(l=1E4,1==a&&(l=15E3),setTimeout(function(){c.updateFullData(a+1,0)},l)):(d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+c.trackClass),d3.select("#Level"+
c.gsvg.levelNumber+c.trackClass).attr("height",15),c.gsvg.addTrackErrorRemove(c.svg,"#Level"+c.gsvg.levelNumber+c.trackClass),c.hideLoading())}else l=k.documentElement.getElementsByTagName(c.xmlTag),c.draw(l),c.hideLoading(),c.updateControl=0})}};c.updateSettingsFromUI=function(){0<$("#"+c.trackClass+"Dense"+c.level+"Select").length&&(c.density=$("#"+c.trackClass+"Dense"+c.level+"Select").val());0<$("#"+c.trackClass+c.level+"colorSelect").length&&(c.colorBy=$("#"+c.trackClass+c.level+"colorSelect").val());
"Score"==c.colorBy&&(c.minValue=$("#"+c.trackClass+"minData"+c.level).val(),c.maxValue=$("#"+c.trackClass+"maxData"+c.level).val(),testIE||testSafari?(c.minColor=$("#"+c.trackClass+"minColor"+c.level).spectrum("get").toHexString(),c.maxColor=$("#"+c.trackClass+"maxColor"+c.level).spectrum("get").toHexString()):(c.minColor=$("#"+c.trackClass+"minColor"+c.level).val(),c.maxColor=$("#"+c.trackClass+"maxColor"+c.level).val()),c.createColorScale())};c.generateSettingsDiv=function(a){var b=trackInfo[c.trackClass];
c.savePrevious();d3.select(a).select("table").select("tbody").html("");if(0<b.Controls.length&&"null"!=b.Controls){var e=(new String(b.Controls)).split(",");a=d3.select(a).select("table").select("tbody");a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+b.Name);for(b=0;b<e.length;b++)if("undefined"!==typeof e[b]&&""!=e[b]){var f=e[b].split(";"),g=a.append("tr").append("td"),h=f[0].substr(5);3<f.length&&0==f[3].indexOf("Default=")&&f[3].substr(8);if(0==f[1].toLowerCase().indexOf("select")){g.append("text").text(h+
": ");h=f[1].split(":");f=f[2].split("}");var l=c.trackClass+"Dense"+c.level+"Select";"colorSelect"==h[1]&&(l=c.trackClass+c.level+"colorSelect");g=g.append("select").attr("id",l).attr("name",h[1]);for(h=0;h<f.length;h++){var p=f[h].substr(1).split(":");if(2==p.length){var v=g.append("option").attr("value",p[1]).text(p[0]);(-1<l.indexOf("Dense")&&p[1]==c.density||-1<l.indexOf("colorSelect")&&p[1]==c.colorBy)&&v.attr("selected","selected")}}d3.select("select#"+l).on("change",function(){"Score"==$(this).val()?
$("div."+c.trackClass+"Scale"+c.level).show():"Color"==$(this).val()&&$("div."+c.trackClass+"Scale"+c.level).hide();c.updateSettingsFromUI();c.draw(c.data)})}else 0==f[1].toLowerCase().indexOf("txt")&&(g=0==$("#colorTrack"+c.level).size()?g.append("div").attr("class",c.trackClass+"Scale"+c.level).style("display","none"):d3.select("#"+c.trackClass+"Scale"+c.level),g.append("text").text(h+": "),h=f[1].split(":"),f=f[2].split("}"),f="Data",l="text",p=c.minValue,v=c.maxValue,"color"==h[1]&&(l=f="Color",
p=c.minColor,v=c.maxColor),g.append("input").attr("type",l).attr("id",c.trackClass+"min"+f+c.level).attr("class",h[1]).style("margin-left","5px").attr("value",p),g.append("text").text(" - "),g.append("input").attr("type",l).attr("id",c.trackClass+"max"+f+c.level).attr("class",h[1]).style("margin-left","5px").attr("value",v),"Color"==f&&(testIE||testSafari)?($("#"+c.trackClass+"min"+f+c.level).spectrum({change:function(a){c.updateSettingsFromUI();c.draw(c.data)}}),$("#"+c.trackClass+"max"+f+c.level).spectrum({change:function(a){c.updateSettingsFromUI();
c.draw(c.data)}})):($("input#"+c.trackClass+"min"+f+c.level).on("change",function(){c.updateSettingsFromUI();c.draw(c.data)}),$("input#"+c.trackClass+"max"+f+c.level).on("change",function(){c.updateSettingsFromUI();c.draw(c.data)})))}"Score"==$("#"+c.trackClass+c.level+"colorSelect").val()?$("div."+c.trackClass+"Scale"+c.level).show():"Color"==$("#"+c.trackClass+c.level+"colorSelect").val()&&$("div."+c.trackClass+"Scale"+c.level).hide();e=a.append("tr").append("td");e.append("input").attr("type",
"button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast");c.gsvg.removeTrack(c.trackClass);var a=svgList[c.gsvg.levelNumber].currentView.ViewID,b=viewMenu[c.gsvg.levelNumber].findTrackByClass(c.trackClass,a);b=viewMenu[c.gsvg.levelNumber].findTrackIndexWithViewID(b.TrackID,a);viewMenu[c.gsvg.levelNumber].removeTrackWithIDIdx(b,a)});e.append("input").attr("type","button").attr("value","Apply").style("float",
"right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")});e.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){c.revertPrevious();c.draw(c.data);$("#trackSettingDialog").fadeOut("fast")})}else a=d3.select(a).select("table").select("tbody"),a.append("tr").append("td").style("font-weight","bold").html("Track Settings: "+b.Name),a.append("tr").append("td").html("Sorry no settings for this track."),
e=a.append("tr").append("td"),e.append("input").attr("type","button").attr("value","Remove Track").style("float","left").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")}),e.append("input").attr("type","button").attr("value","Cancel").style("float","right").style("margin-left","5px").on("click",function(){$("#trackSettingDialog").fadeOut("fast")})};c.generateTrackSettingString=function(){return c.trackClass+","+c.density+","+c.colorBy+","+c.minValue+","+c.maxValue+
","+c.minColor+","+c.maxColor+";"};return c}
function RepeatMaskTrack(e,h,l,p,b,a){var c=GenericTranscriptTrack(e,h,l,p,b,a);c.dataFileName="repeatMask.xml";c.density=1;c.xmlTag="Feature";c.xmlTagBlockElem="Block";c.minFeatureWidth=1;c.ttSVG=1;c.ttTrackList=[];c.ttTrackList.push("ensemblcoding");c.ttTrackList.push("braincoding");c.ttTrackList.push("liverTotal");c.ttTrackList.push("heartTotal");c.ttTrackList.push("mergedTotal");c.ttTrackList.push("refSeq");c.ttTrackList.push("spliceJnct");c.ttTrackList.push("liverspliceJnct");c.ttTrackList.push("heartspliceJnct");
c.ttTrackList.push("brainspliceJnct");c.ttTrackList.push("illuminaPolyA");c.ttTrackList.push("liverilluminaTotalPlus");c.ttTrackList.push("liverilluminaTotalMinus");c.ttTrackList.push("heartilluminaTotalPlus");c.ttTrackList.push("heartilluminaTotalMinus");c.ttTrackList.push("brainilluminaTotalPlus");c.ttTrackList.push("brainilluminaTotalMinus");c.ttSVGMinWidth=200;c.legendLbl="Smith-Waterman Alignment Score";c.typeList=[];c.typeList[0]={name:"SINE",clss:"SINE"};c.typeList[1]={name:"LINE",clss:"LINE"};
c.typeList[2]={name:"LTR",clss:"LTR"};c.typeList[3]={name:"DNA",clss:"DNA"};c.typeList[4]={name:"Simple",clss:"Simple_repeat"};c.typeList[5]={name:"Low Comp.",clss:"Low_complexity"};c.typeList[6]={name:"Satellite",clss:"Satellite"};c.typeList[7]={name:"RNA",clss:"RNA"};c.typeList[8]={name:"Other",clss:"Other"};c.typeList[9]={name:"Unknown",clss:"Unknown"};c.yList={};for(e=0;e<c.typeList.length;e++)c.yList[c.typeList[e].clss]=15+15*e;c.createToolTip=function(a){var b='<BR><div id="ttSVG" style="background:#FFFFFF;"></div><BR>Name: '+
a.getAttribute("name")+"&nbsp&nbsp&nbsp&nbsp&nbspClass: "+a.getAttribute("class");b=b+"&nbsp&nbsp&nbsp&nbsp&nbspFamily: "+a.getAttribute("family")+"<BR><BR>Location: "+a.getAttribute("chromosome")+":"+a.getAttribute("start")+"-"+a.getAttribute("stop");b=b+"<BR><BR>Alignment Score: "+a.getAttribute("score")+"<BR>Mismatches(parts/thousand): "+a.getAttribute("mis")+"<BR>Insertions(parts/thousand): "+a.getAttribute("ins");return b=b+"<BR>Deletions(parts/thousand): "+a.getAttribute("del")};c.pieColor=
function(a,b){var c=d3.rgb("#000000"),d=a.data.names;"LINE"===d?c=d3.rgb("#27e5e5"):"SINE"===d?c=d3.rgb("#e57927"):"LTR"===d?c=d3.rgb("#27e527"):"DNA"===d?c=d3.rgb("#e52727"):"Simple_repeat"===d?c=d3.rgb("#e51ba2"):"Low_complexity"===d?c=d3.rgb("#9029e5"):"RNA"===d?c=d3.rgb("#005be5"):"Satellite"===d?c=d3.rgb("#cccc00"):"Other"===d&&(c=d3.rgb("#007f24"));return c};c.calcY=function(a,b,e,k){a=3===c.density||"3"===c.density?c.calcYPack(a,b,e):2===c.density||"2"===c.density?c.calcYFull(k):c.calcYDense();
c.trackYMax<a/15&&(c.trackYMax=a/15);return a};c.calcYFull=function(a){a=a.getAttribute("class");-1<a.indexOf("RNA")&&(a="RNA");return c.yList[a]};c.redraw=function(){if(c.prevDensity!=c.density)c.draw(c.data);else{c.yMaxArr=[];c.yArr=[];c.yArr[0]=[];for(var a=0;a<c.gsvg.width;a++)c.yMaxArr[a]=0,c.yArr[0][a]=0;c.trackYMax=0;d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g."+c.idPrefix+"trx"+c.gsvg.levelNumber).attr("transform",function(a,b){return"translate("+c.xScale(a.getAttribute("start"))+
","+c.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),b,a)+")"}).each(function(a,b){for(var d=getAllChildrenByName(getFirstChildByName(a,c.xmlTagBlockElem+"List"),c.xmlTagBlockElem),e=0;e<d.length;e++){var f=c.idPrefix+"Ex"+d[e].getAttribute("ID");null==d[e].getAttribute("ID")&&(f=c.idPrefix+"Ex"+a.getAttribute("ID")+"_"+e);c.svg.select("g#"+c.idPrefix+"tx"+a.getAttribute("ID")+" rect#"+f).attr("x",function(b){return c.xScale(d[e].getAttribute("start"))-c.xScale(a.getAttribute("start"))}).attr("width",
function(a){return c.xScale(d[e].getAttribute("stop"))-c.xScale(d[e].getAttribute("start"))});if(0<e){f=">";"-1"==a.getAttribute("strand")&&(f="<");var h=f,l=c.xScale(d[e-1].getAttribute("stop"))-c.xScale(a.getAttribute("start")),n=c.xScale(d[e].getAttribute("start"))-c.xScale(a.getAttribute("start")),p=n-l,w=0;if(7>p)h="";else for(p-=7;8<p;)0==w?(h+=" ",w=1):(h+=f,w=0),p-=7;f=d[e-1].getAttribute("ID")+"_"+d[e].getAttribute("ID");null==d[e].getAttribute("ID")&&(f=a.getAttribute("ID")+"_"+(e-1)+"_"+
e);c.svg.select("g#"+c.idPrefix+"tx"+a.getAttribute("ID")+" line#"+c.idPrefix+"Int"+f).attr("x1",l).attr("x2",n);c.svg.select("g#"+c.idPrefix+"tx"+a.getAttribute("ID")+" #"+c.idPrefix+"IntTxt"+f).attr("dx",l+1).text(h)}}});1==c.density?c.svg.attr("height",30):2==c.density?c.svg.attr("height",15*(d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g."+c.idPrefix+"trx"+c.gsvg.levelNumber).size()+1)):3==c.density&&c.svg.attr("height",15*(c.trackYMax+1));c.redrawSelectedArea()}};c.drawTrx=
function(a,b){var d=d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).select("#"+c.idPrefix+"tx"+a.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(a,c.xmlTagBlockElem+"List"),c.xmlTagBlockElem);1===exList.length&&d.append("rect").attr("x",function(a){return c.xScale(exList[0].getAttribute("start"))-c.xScale(a.getAttribute("start"))}).attr("rx",1).attr("ry",1).attr("height",10).attr("width",function(a){a=c.xScale(exList[0].getAttribute("stop"))-c.xScale(exList[0].getAttribute("start"));
0<c.minFeatureWidth&&a<c.minFeatureWidth&&(a=c.minFeatureWidth);return a}).attr("id",function(a,b){var d=c.idPrefix+"Ex"+exList[0].getAttribute("ID");null==exList[0].getAttribute("ID")&&(d=c.idPrefix+"Ex"+a.getAttribute("ID")+"_0");return d}).style("fill",c.color).style("cursor","pointer")};c.draw=function(a){c.data=a;c.prevDensity=c.density;c.trackYMax=0;c.yArr=[];c.yArr[0]=[];for(var b=0;b<c.gsvg.width;b++)c.yMaxArr[b]=0,c.yArr[0][b]=0;c.svg.selectAll(".repeatLine"+c.gsvg.levelNumber).remove();
c.svg.selectAll(".repeatLbl"+c.gsvg.levelNumber).remove();if(2==c.density)for(b=0;b<c.typeList.length;b++)c.svg.append("line").attr("class","repeatLine"+c.gsvg.levelNumber).attr("x1",0).attr("x2",c.gsvg.width).attr("y1",12+15*(b+1)).attr("y2",12+15*(b+1)).attr("stroke","#000000").attr("stroke-width","1px"),c.svg.append("text").attr("x",5).attr("class","repeatLbl"+c.gsvg.levelNumber).attr("y",10+15*(b+1)).style("pointer-events","none").style("opacity","0.5").style("fill","#000000").style("font-size",
"11px").text(c.typeList[b].name),c.svg.append("text").attr("class","repeatLbl"+c.gsvg.levelNumber).attr("x",c.gsvg.width-5).attr("y",10+15*(b+1)).style("text-anchor","end").style("pointer-events","none").style("opacity","0.5").style("fill","#000000").style("font-size","11px").text(c.typeList[b].name);d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("."+c.idPrefix+"trx"+c.gsvg.levelNumber).remove();c.redrawLegend();a=d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("."+c.idPrefix+
"trx"+c.gsvg.levelNumber).data(a,key).attr("transform",function(a,b){return"translate("+c.xScale(a.getAttribute("start"))+","+c.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),b,a)+")"});a.enter().append("g").attr("class",c.idPrefix+"trx"+c.gsvg.levelNumber).attr("transform",function(a,b){return"translate("+c.xScale(a.getAttribute("start"))+","+c.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),b,a)+")"}).attr("id",function(a){return c.idPrefix+
"tx"+a.getAttribute("ID")}).style("cursor","move").on("mouseover",function(a){0==c.gsvg.isToolTip&&0!=c.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(c.createToolTip(a)).style("left",function(){return c.positionTTLeft(d3.event.pageX)}).style("top",function(){return c.positionTTTop(d3.event.pageY)}),
1==c.ttSVG&&c.setupToolTipSVG(a,.05))}).on("mouseout",function(a){d3.select(this).selectAll("line").style("stroke",c.color);d3.select(this).selectAll("rect").style("fill",c.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",c.color);tt.transition().delay(100).duration(200).style("opacity",0)}).each(c.drawTrx);a.exit().remove();1==c.density?c.svg.attr("height",30):2==c.density?c.svg.attr("height",15*c.typeList.length+15):3==c.density&&c.svg.attr("height",15*(c.trackYMax+2));
c.redrawSelectedArea()};c.getDisplayedData=function(){var a=d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("."+c.idPrefix+"trx"+c.gsvg.levelNumber);c.counts=[];var b={};a=a[0];var e=[],k=0;if("undefined"!==typeof a){for(var g=0;g<a.length;g++){var h=c.xScale(a[g].__data__.getAttribute("start")),l=c.xScale(a[g].__data__.getAttribute("stop"));if(0<=h&&h<=c.gsvg.width||0<=l&&l<=c.gsvg.width)"undefined"===typeof b[a[g].__data__.getAttribute("class")]?(b[a[g].__data__.getAttribute("class")]=
{},b[a[g].__data__.getAttribute("class")].value=1,b[a[g].__data__.getAttribute("class")].names=a[g].__data__.getAttribute("class")):b[a[g].__data__.getAttribute("class")].value=b[a[g].__data__.getAttribute("class")].value+1,e[k]=a[g].__data__,k++}c.counts=[];for(x in b)c.counts.push(b[x])}else c.counts=[];return e};c.draw(h);return c}
function GenericTranscriptTrack(e,h,l,p,b,a){var c=Track(e,h,l,p);c.dataFileName=l+".xml";c.xmlTag="Feature";c.xmlTagBlockElem="block";c.idPrefix="genTrx";c.ttSVG=0;c.ttTrackList=[];c.colorValueField="score";c.colorBy="Score";c.minValue=1;c.maxValue=1E3;c.minColor="#E6E6E6";c.maxColor="#000000";c.minFeatureWidth=-1;c.ttSVGMinWidth=0;c.legendLbl="";e=new String(a);if("undefined"!==typeof a&&0<e.length)for(a=e.split(","),e=0;e<a.length;e++)h=new String(a[e]),0==h.indexOf("colorBy=")?c.colorBy=h.substr(h.indexOf("=")+
1):0==h.indexOf("minColor=")?c.minColor=h.substr(h.indexOf("=")+1):0==h.indexOf("maxColor=")?c.maxColor=h.substr(h.indexOf("=")+1):0==h.indexOf("minValue=")?c.minValue=h.substr(h.indexOf("=")+1):0==h.indexOf("maxValue=")&&(c.maxValue=h.substr(h.indexOf("=")+1));c.createColorScale=function(){"undefined"!==typeof c.minColor&&"undefined"!==typeof c.maxColor&&(c.colorScale=d3.scaleLinear().domain([c.minValue,c.maxValue]).range([c.minColor,c.maxColor]))};c.createColorScale();c.setMinColor=function(a){c.minColor=
"#"+a;c.createColorScale();c.draw(c.data)};c.setMaxColor=function(a){c.maxColor="#"+a;c.createColorScale();c.draw(c.data)};c.setMinValue=function(a){c.minValue=a;c.createColorScale();c.draw(c.data)};c.setMaxValue=function(a){c.maxValue=a;c.createColorScale();c.draw(c.data)};c.setColorBy=function(a){c.colorBy=a;c.createColorScale();c.draw(c.data)};c.getDisplayID=function(a){return a.getAttribute("ID")};c.createToolTip=function(a){return""};c.getColorValue=function(a){return a.getAttribute(c.colorValueField)};
c.color=function(a){var b=d3.rgb("#FFFFFF");"Score"==c.colorBy?b=c.colorScale(c.getColorValue(a)):"Color"==c.colorBy&&(a=(new String(a.getAttribute("color"))).split(","),3==a.length&&(b=d3.rgb(a[0],a[1],a[2])));return b};c.savePrevious=function(){c.prevSetting={};c.prevSetting.density=c.density;c.prevSetting.colorValueField=c.colorValueField;c.prevSetting.colorBy=c.colorBy;c.prevSetting.minValue=c.minValue;c.prevSetting.maxValue=c.maxValue;c.prevSetting.minColor=c.minColor;c.prevSetting.maxColor=
c.maxColor};c.revertPrevious=function(){c.density=c.prevSetting.density;c.colorValueField=c.prevSetting.colorValueField;c.colorBy=c.prevSetting.colorBy;c.minValue=c.prevSetting.minValue;c.maxValue=c.prevSetting.maxValue;c.minColor=c.prevSetting.minColor;c.maxColor=c.prevSetting.maxColor;"Score"==c.colorBy&&c.createColorScale()};c.drawTrx=function(a,b){var d=d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).select("#"+c.idPrefix+"tx"+a.getAttribute("ID"));exList=getAllChildrenByName(getFirstChildByName(a,
c.xmlTagBlockElem+"List"),c.xmlTagBlockElem);for(var e=0;e<exList.length;e++)if(d.append("rect").attr("x",function(a){return c.xScale(exList[e].getAttribute("start"))-c.xScale(a.getAttribute("start"))}).attr("rx",1).attr("ry",1).attr("height",10).attr("width",function(a){a=c.xScale(exList[e].getAttribute("stop"))-c.xScale(exList[e].getAttribute("start"));0<c.minFeatureWidth&&a<c.minFeatureWidth&&(a=c.minFeatureWidth);return a}).attr("id",function(a,b){var d=c.idPrefix+"Ex"+exList[e].getAttribute("ID");
null==exList[e].getAttribute("ID")&&(d=c.idPrefix+"Ex"+a.getAttribute("ID")+"_"+e);return d}).style("fill",c.color).style("cursor","pointer"),0<e){var f=c.xScale(exList[e-1].getAttribute("stop"))-c.xScale(a.getAttribute("start")),h=c.xScale(exList[e].getAttribute("start"))-c.xScale(a.getAttribute("start"));d.append("line").attr("x1",f).attr("x2",h).attr("y1",5).attr("y2",5).attr("stroke",c.color).attr("stroke-width","2").attr("id",function(a,b){var d=c.idPrefix+"Int"+exList[e-1].getAttribute("ID")+
"_"+exList[e].getAttribute("ID");null==exList[e].getAttribute("ID")&&(d=c.idPrefix+"Int"+a.getAttribute("ID")+"_"+(e-1)+"_"+e);return d});var l=">";"-1"==a.getAttribute("strand")&&(l="<");var p=l;h-=f;var v=0;if(7>h)p="";else for(h-=7;8<h;)0==v?(p+=" ",v=1):(p+=l,v=0),h-=7;d.append("svg:text").attr("id",function(a){var b=c.idPrefix+"IntTxt"+exList[e-1].getAttribute("ID")+"_"+exList[e].getAttribute("ID");null==exList[e].getAttribute("ID")&&(b=c.idPrefix+"IntTxt"+a.getAttribute("ID")+"_"+(e-1)+"_"+
e);return b}).attr("dx",f+1).attr("dy","11").style("pointer-events","none").style("opacity","0.5").style("fill",c.color).style("font-size","16px").text(p)}};c.redraw=function(){if(c.prevDensity!=c.density)c.draw(c.data);else{c.yMaxArr=[];c.yArr=[];c.yArr[0]=[];for(var a=0;a<c.gsvg.width;a++)c.yMaxArr[a]=0,c.yArr[0][a]=0;c.trackYMax=0;d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g."+c.idPrefix+"trx"+c.gsvg.levelNumber).attr("transform",function(a,b){return"translate("+c.xScale(a.getAttribute("start"))+
","+c.calcY(parseInt(a.getAttribute("start"),10),parseInt(a.getAttribute("stop"),10),b)+")"}).each(function(a,b){for(var d=getAllChildrenByName(getFirstChildByName(a,c.xmlTagBlockElem+"List"),c.xmlTagBlockElem),e=0;e<d.length;e++){var f=c.idPrefix+"Ex"+d[e].getAttribute("ID");null==d[e].getAttribute("ID")&&(f=c.idPrefix+"Ex"+a.getAttribute("ID")+"_"+e);c.svg.select("g#"+c.idPrefix+"tx"+a.getAttribute("ID")+" rect#"+f).attr("x",function(b){return c.xScale(d[e].getAttribute("start"))-c.xScale(a.getAttribute("start"))}).attr("width",
function(a){return c.xScale(d[e].getAttribute("stop"))-c.xScale(d[e].getAttribute("start"))});if(0<e){f=">";"-1"==a.getAttribute("strand")&&(f="<");var h=f,l=c.xScale(d[e-1].getAttribute("stop"))-c.xScale(a.getAttribute("start")),n=c.xScale(d[e].getAttribute("start"))-c.xScale(a.getAttribute("start")),p=n-l,w=0;if(7>p)h="";else for(p-=7;8<p;)0==w?(h+=" ",w=1):(h+=f,w=0),p-=7;f=d[e-1].getAttribute("ID")+"_"+d[e].getAttribute("ID");null==d[e].getAttribute("ID")&&(f=a.getAttribute("ID")+"_"+(e-1)+"_"+
e);c.svg.select("g#"+c.idPrefix+"tx"+a.getAttribute("ID")+" line#"+c.idPrefix+"Int"+f).attr("x1",l).attr("x2",n);c.svg.select("g#"+c.idPrefix+"tx"+a.getAttribute("ID")+" #"+c.idPrefix+"IntTxt"+f).attr("dx",l+1).text(h)}}});1==c.density?c.svg.attr("height",30):2==c.density?c.svg.attr("height",15*(d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g."+c.idPrefix+"trx"+c.gsvg.levelNumber).size()+1)):3==c.density&&c.svg.attr("height",15*(c.trackYMax+1));c.redrawSelectedArea()}};c.update=function(a){c.redraw()};
c.updateFullData=function(a,b){var d=c.xScale.domain()[0],e=c.xScale.domain()[1];c.showLoading();d3.xml(dataPrefix+"tmpData/browserCache/"+genomeVer+"/regionData/"+c.gsvg.folderName+"/"+c.dataFileName,function(f,h){if(f){if(0==a||1==b){var g=contextPath+"/"+pathPrefix;pathPrefix||(g="");$.ajax({url:g+"generateTrackXML.jsp",type:"GET",cache:!1,data:{chromosome:chr,minCoord:d,maxCoord:e,panel:panel,rnaDatasetID:rnaDatasetID,arrayTypeID:arrayTypeID,myOrganism:organism,genomeVer:genomeVer,track:c.trackClass,
folder:c.gsvg.folderName},dataType:"json",success:function(a){ga&&ga("send","event","browser","generateTrackTranscript")},error:function(a,b,c){}})}3>a?(g=1E4,1==a&&(g=15E3),setTimeout(function(){c.updateFullData(a+1,0)},g)):(d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).select("#trkLbl").text("An errror occurred loading Track:"+c.trackClass),d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).attr("height",15),c.gsvg.addTrackErrorRemove(c.svg,"#Level"+c.gsvg.levelNumber+c.trackClass),c.hideLoading())}else null==
h?4<=a?(g=[],c.draw(g),c.hideLoading()):setTimeout(function(){c.updateFullData(a+1,0)},5E3):(g=h.documentElement.getElementsByTagName(c.xmlTag),c.draw(g),c.hideLoading())})};c.redrawLegend=function(){var a=[];"Score"==c.colorBy?c.drawScaleLegend(c.minValue,c.maxValue+"+",c.legendLbl,c.minColor,c.maxColor,0):"Color"==c.colorBy&&(a[0]={color:"#FFFFFF",label:"User assigned color from track file."},c.drawLegend(a))};c.draw=function(a){c.data=a;c.prevDensity=c.density;c.trackYMax=0;c.yArr=[];c.yArr[0]=
[];for(var b=0;b<c.gsvg.width;b++)c.yMaxArr[b]=0,c.yArr[0][b]=0;d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("."+c.idPrefix+"trx"+c.gsvg.levelNumber).remove();c.redrawLegend();a&&(a=d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("."+c.idPrefix+"trx"+c.gsvg.levelNumber).data(a,key),a.enter().append("g").attr("class",c.idPrefix+"trx"+c.gsvg.levelNumber).attr("transform",function(a,b){return"translate("+c.xScale(a.getAttribute("start"))+","+c.calcY(parseInt(a.getAttribute("start"),
10),parseInt(a.getAttribute("stop"),10),b)+")"}).attr("id",function(a){return c.idPrefix+"tx"+a.getAttribute("ID")}).style("cursor","move").on("mouseover",function(a){0==c.gsvg.isToolTip&&0!=c.trackClass.indexOf("custom")&&(d3.select(this).selectAll("line").style("stroke","green"),d3.select(this).selectAll("rect").style("fill","green"),d3.select(this).selectAll("text").style("opacity","0.3").style("fill","green"),tt.transition().duration(200).style("opacity",1),tt.html(c.createToolTip(a)).style("left",
function(){return c.positionTTLeft(d3.event.pageX)}).style("top",function(){return c.positionTTTop(d3.event.pageY)}),1==c.ttSVG&&c.setupToolTipSVG(a,.05))}).on("mouseout",function(a){d3.select(this).selectAll("line").style("stroke",c.color);d3.select(this).selectAll("rect").style("fill",c.color);d3.select(this).selectAll("text").style("opacity","0.6").style("fill",c.color);tt.transition().delay(100).duration(200).style("opacity",0)}).merge(a).each(c.drawTrx),a.exit().remove());1==c.density?c.svg.attr("height",
30):2==c.density?c.svg.attr("height",15*(d3.select("#Level"+c.gsvg.levelNumber+c.trackClass).selectAll("g."+c.idPrefix+"trx"+c.gsvg.levelNumber).size()+1)):3==c.density&&c.svg.attr("height",15*(c.trackYMax+2));c.redrawSelectedArea()};return c}window.GenomeSVG=GenomeSVG;