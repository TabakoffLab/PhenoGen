function TrackMenu(v){var a={};a.level=v;a.trackList=[];a.previewLevel=101;a.previewSVG=NaN;a.dataInitialized=0;a.trackDataTable;a.generateTrackTable=function(){for(var b=$("#trackTypeSelect"+a.level).val(),d=[],c=0,e=0;e<a.trackList.length;e++)!("all"===b||"allpublic"===b&&0===a.trackList[e].UserID||"custom"===b&&0!==a.trackList[e].UserID||"genome"===b&&"Genome"===a.trackList[e].GenericCategory||"trxome"===b&&"Transcriptome"===a.trackList[e].GenericCategory)||"AA"!==a.trackList[e].Organism.toUpperCase()&&
a.trackList[e].Organism.toUpperCase()!==organism.toUpperCase()||0!==$("table#trackListTbl"+a.level+" tr#trk"+a.trackList[e].TrackID).length||(d[c]=a.trackList[e],c++);try{$.fn.DataTable.isDataTable("table#trkSelList"+a.level)&&a.trackDataTable.destroy()}catch(f){Bugsense.notify(f,{datatables:"not initialized"})}"custom"===b&&0===d.length?($("#noCustomTracks").show(),0===uid?$("#notSignedIn1").show():$("#notSignedIn1").hide()):($("#noCustomTracks").hide(),$("#notSignedIn1").hide());d3.select("table#trkSelList"+
a.level).select("tbody").selectAll("tr").remove();d3.select("table#trkSelList"+a.level).select("tbody").selectAll("tr").data(d).enter().append("tr").attr("id",function(a){return"trk"+a.TrackID}).attr("class",function(a,b){var d="odd";0===b%2&&(d="even");return d}).each(function(b,d){var c="",e="";"local"===b.Source&&(e=" (Local)");0!==b.UserID&&(c=new String(b.SetupDate),c=c.substr(0,c.indexOf(":",c.indexOf(":")+1)),c="<BR><BR>File:"+b.OriginalFile+"<BR><BR>Setup Date:"+c+"<BR><BR>Type:"+b.Type,"local"===
b.Source&&(c+="<BR><BR>Local Track only available on this computer."));c='  <span class="trlisttooltip'+a.level+'" title= "'+b.Description+c+'"><img src="'+iconPath+'info.gif"></span>';d3.select(this).append("td").html(b.Name+e+c);e="";"RN"===b.Organism?e="Rat":"MM"===b.Organism&&(e="Mouse");c="Public";0!==b.UserID&&(c="Custom");d3.select(this).append("td").html(e);d3.select(this).append("td").html(b.GenericCategory);d3.select(this).append("td").html(b.Category);d3.select(this).append("td").html(c)});
$.fn.DataTable.isDataTable("table#trkSelList"+a.level)||(b=a.getInitTrackTableHeight(d),a.trackDataTable=$("table#trkSelList"+a.level).DataTable({bPaginate:!1,aaSorting:[[3,"asc"]],sScrollY:b,sDom:'<"rightSearch"fr><t>',columnDefs:[{width:"45%",targets:0}]}));a.trackDataTable.draw();$("td#selectedTrack"+a.level).hide();$("table#trkSelList"+a.level+" tbody").on("click","tr",function(){if(!$(this).hasClass("selected")){$("table#trkSelList"+a.level+" tbody tr.selected").removeClass("selected");$(this).addClass("selected");
$(this).attr("id");var b=a.findSelectedTrack(),c="Selected Track Name: "+b.Name+'  <span class="trInfotooltip'+a.level+'" title= "'+b.Description+'"><img src="'+iconPath+'info.gif"></span>';$("div#trackHeaderOuter"+a.level+" #trackHeaderContent").html(c);c=a.getTrackTableHeight(d);a.trackDataTable.settings()[0].oScroll.sy=c;try{a.trackDataTable.columns.adjust().draw()}catch(q){Bugsense.notify(q,{datatables:"error adjusting columns:136"})}$("#trkSelList"+a.level+"_wrapper div.dataTables_scroll div.dataTables_scrollBody").css("height",
c);$("td#selectedTrack"+a.level).show();$(".trInfotooltip"+a.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350});a.generatePreview(b);(c=a.previewSVG.getTrack(b.TrackClass))&&c.generateSettingsDiv&&c.generateSettingsDiv("td#selectedTrack"+a.level);$("td#selectedTrack"+a.level+" #trackListTbl"+a.level+" tbody tr:first").remove();$("td#selectedTrack"+a.level+" #trackListTbl"+a.level+" tbody tr:last").remove();0!==b.UserID?
$("span#deleteCustomTrack"+a.level).show():$("span#deleteCustomTrack"+a.level).hide();c.updateSettingsFromUI()}});$(".trlisttooltip"+a.level).tooltipster({position:"top-right",maxWidth:250,offsetX:10,offsetY:5,contentAsHTML:!0,interactive:!0,interactiveTolerance:350})};a.getInitTrackTableHeight=function(a){var b="750px";0===a.length?b="30px":15>a.length&&(b=30*a.length+"px");return b};a.getTrackTableHeight=function(a){var b="300px";0===a.length?b="20px":10>a.length&&(b=30*a.length+"px");return b};
a.getTrackData=function(){var b=contextPath+"/"+pathPrefix;""===pathPrefix&&(b="");$.ajax({url:b+"getBrowserTracks.jsp",type:"GET",data:{genomeVer:genomeVer},dataType:"json",success:function(b){a.trackList=b;if(0===a.level)for(trackInfo=[],b=0;b<a.trackList.length;b++)trackInfo[a.trackList[b].TrackClass]=a.trackList[b];a.readCookieTracks();a.dataInitialized=1;a.generateTrackTable();trackMenu[a.level]&&trackMenu[a.level].readCookieViews&&(trackMenu[a.level].readCookieViews(),trackMenu[a.level].generateViewList())},
error:function(a,b,e){}})};a.readCookieTracks=function(){var b="";if(!0===isLocalStorage()){var d=localStorage.getItem("phenogenCustomTracks");d&&(b=d)}else $.cookie("phenogenCustomTracks")&&(b=$.cookie("phenogenCustomTracks"));if(b&&-1<b.indexOf("<;>"))for(b=b.split("<;>"),d=0;d<b.length;d++){var c=b[d].split("<->"),e={};for(k=0;k<c.length;k++){var f=c[k].split("=");if(2>=f.length)e[f[0]]=f[1];else if(2<f.length){f=c[k].substr(0,c[k].indexOf("="));var g=c[k].substr(c[k].indexOf("=")+1);e[f]=g}}e.Source=
"local";3<c.length&&(a.trackList.push(e),0===a.level&&(trackInfo[e.TrackClass]=e))}};a.findSelectedTrack=function(){var b=NaN;if(0<$("table#trkSelList"+a.level+" tbody tr.selected").length){var d=$("table#trkSelList"+a.level+" tbody tr.selected").attr("id");d=d.substr(3);for(var c=0;c<a.trackList.length&&isNaN(b);c++)a.trackList[c].TrackID===d&&(b=a.trackList[c])}return b};a.generateSettingsString=function(a){return a.TrackClass+","+a.Settings+";"};a.generatePreview=function(b){$("div#trackPreviewOuter"+
a.level+" div#trackPreviewContent").html("");var d=(new String(organism)).toUpperCase();if("AA"===b.Organism||b.Organism===d){d=svgList[a.level].xScale.domain()[0];var c=svgList[a.level].xScale.domain()[1];a.previewSVG=toolTipSVG("div#trackPreviewOuter"+a.level+" div#trackPreviewContent",565,d,c,a.previewLevel,chr,svgList[a.level].type);a.previewSVG.folderName=svgList[a.level].folderName;b=a.generateSettingsString(b);loadStateFromString(b,"",a.previewLevel,a.previewSVG);a.previewSVG.updateData();
a.previewSVG.updateFullData();$("div#trackPreviewContent div#ScrollLevel"+a.previewLevel).css("max-height","250px").css("overflow","auto")}else $("div#previewOuter"+a.level+" div#previewContent").html("No Preview Available: The current organism doesn't match the tracks included in this view.")};a.removeTrack=function(b){a.generateTrackTable()};a.confirmdeleteCustomTrack=function(){var b=a.findSelectedTrack();$("#deleteUsrTrack"+a.level).show();$("#selectTrack"+a.level).hide();b="Name: <B>"+b.Name+
"</B><BR>Description: <B>"+b.Description+"</B><BR>Original File: <B>"+b.OriginalFile+"</B><BR>Setup Date: <B>"+b.SetupDate+"</b>";$("span#customTrackInfo"+a.level).html(b);ga&&ga("send","event","BrowserTracks","deleteCustomTrack")};a.cancelDeleteTrack=function(){$("#deleteUsrTrack"+a.level).hide();$("#selectTrack"+a.level).show()};a.deleteTrack=function(){var b=a.findSelectedTrack();if("local"===b.Source){var d="TrackClass="+b.TrackClass+"<->",c="";if(!0===isLocalStorage()){var e=localStorage.getItem("phenogenCustomTracks");
e&&(c=e)}else $.cookie("phenogenCustomTracks")&&(c=$.cookie("phenogenCustomTracks"));if(c&&-1<c.indexOf("<;>")){var f="";c=c.split("<;>");for(e=0;e<c.length;e++)-1===c[e].indexOf(d)&&(f=f+c[e]+"<;>");d=contextPath+"/"+pathPrefix;pathPrefix||(d="");$.ajax({url:d+"removeCustomTrack.jsp",type:"GET",data:{trackID:b.TrackID},dataType:"json",success:function(a){!0===isLocalStorage()?localStorage.setItem("phenogenCustomTracks",f):$.cookie("phenogenCustomTracks",f)},error:function(a,b,c){console.log(c)},
async:!1})}}else"db"===b.Source&&(d=contextPath+"/"+pathPrefix,pathPrefix||(d=""),$.ajax({url:d+"deleteTrack.jsp",type:"GET",data:{trackID:b.TrackID},dataType:"json",success:function(a){"true"===a.success?$(".uploadStatus").html("<B>Track Setup Successfully</B>"):$(".uploadStatus").html("<B>Track Setup Failed</B>")},error:function(a,b,c){console.log(c)},async:!1}));a.getTrackData();$("#deleteUsrTrack"+a.level).hide();$("#selectTrack"+a.level).show();a.generateTrackTable();ga&&ga("send","event","BrowserTracks",
"deleteTrack")};a.confirmUpload=function(){$("div#confirmUpload"+a.level).show();$("div#uploadBtn"+a.level).hide()};a.confirmBed=function(){$("input#hasconfirmBed"+a.level).val(1);a.createCustomTrack(a.level)};a.cancelUpload=function(){$("div#confirmUpload"+a.level).hide();$("div#confirmBed"+a.level).hide();$("div#uploadBtn"+a.level).show()};a.createCustomTrack=function(){$("div#confirmUpload"+a.level).hide();customTrackLevel=a.level;var b=$("#usrtrkFileTypeSelect"+a.level).val();"bed"===b||"bg"===
b?a.createUploadedCustomTrack():("bb"===b||"bw"===b)&&a.createRemoteCustomTrack();ga&&ga("send","event","BrowserTracks","createCustomTrack")};a.createUploadedCustomTrack=function(){var b=$("input#customUploadFile"+a.level)[0].files[0],d=$("#usrtrkFileTypeSelect"+a.level).val(),c=b.name,e=b.size/1024/1024;$(".uploadStatus").show();var f="";if(0<c.indexOf(".")){for(var g=c;-1<g.indexOf(".");)g=g.substr(g.indexOf(".")+1);""!==g&&g!==c&&(f=g)}20>e?f!==d?"gz"===f||"tar"===f||"zip"===f||"exe"===f||"bin"===
f?(setTimeout(function(){$("div#uploadBtn"+customTrackLevel).show();$(".progressInd").hide()},5E3),$(".uploadStatus").html("Error: Selected File Type is not supported.")):0===$("input#hasconfirmBed"+a.level).val()?$("div#confirmBed"+customTrackLevel).show():1===$("input#hasconfirmBed"+a.level).val()&&($("div#confirmBed"+customTrackLevel).hide(),a.createTrack(b)):a.createTrack(b):($("div#uploadBtn"+customTrackLevel).show(),$(".progressInd").hide(),$(".uploadStatus").html("File is too large.  20MB is the current limit."))};
a.createTrack=function(b){a.readFile(b)};a.createRemoteCustomTrack=function(){$(".uploadStatus").html("Setting up track...");$(".uploadStatus").show();var b=$("#customFileURL"+a.level).val(),d="",c=new Date;$.cookie("JSESSIONID")&&(d=$.cookie("JSESSIONID"),d=d+"_"+c.getTime());a.saveTrack(d,b)};a.saveTrack=function(b,d){var c=$("#usrtrkNameTxt"+a.level).val(),e=$("#usrtrkDescTxt"+a.level).val(),f=$("#usrtrkOrgSelect"+a.level).val(),g=$("#usrtrkGenCatSelect"+a.level).val(),q=$("#usrtrkCatTxt"+a.level).val(),
p="",l=$("#usrtrkFileTypeSelect"+a.level).val(),r="";if("bed"===l||"bg"===l)r=$("input#customUploadFile"+a.level)[0].files[0].name;var h="Color";0<$("#usrtrkColorSelect"+a.level).length&&(h=$("#usrtrkColorSelect"+a.level).val());if("Score"===h){var m="000000",n="FFFFFF",t=1,u=1E3;testIE||testSafari?(m=$("#usrtrkColorMin"+a.level).spectrum("get").toHexString(),n=$("#usrtrkColorMax"+a.level).spectrum("get").toHexString()):(m=$("#usrtrkColorMin"+a.level).val(),n=$("#usrtrkColorMax"+a.level).val(),console.log(m),
console.log(n));m=m.substr(1);n=n.substr(1);t=$("#usrtrkScoreMinTxt"+a.level).val();u=$("#usrtrkScoreMaxTxt"+a.level).val()}"bed"===l?p="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Pack:3}{Full:2};Default=3,Name=Color by;Select:colorSelect::colorSelect;{Feature Defined:Color}{Score based scale:Score};Default="+h+",Name=Scale Range;Txt:tissuecbx;{min:1}{max:1000};Default="+t+":"+u+",Name=Color Range;Txt:color;{min:FFFFFF}{max:000000};Default="+m+":"+n:"bg"===l?p="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Full:2};Default=1,Name=Scale Range;Slider:rangeslider;{min:1-1000}{max:1000-20000};Default=1:5000":
"bw"===l?p="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Full:2};Default=1,Name=Scale Range;Slider:rangeslider;{min:1-1000}{max:1000-20000};Default=1:5000":"bb"===l&&(p="Name=View Density;Select:trackSelect:Dense:Select;{Dense:1}{Pack:3}{Full:2};Default=3,Name=Color by;Select:colorSelect::colorSelect;{Feature Defined:Color}{Score based scale:Score};Default="+h+",Name=Scale Range;Txt:tissuecbx;{min:1}{max:1000};Default="+t+":"+u+",Name=Color Range;Txt:color;{min:FFFFFF}{max:000000};Default="+
m+":"+n);b="custom"+b;0<uid?(h=contextPath+"/"+pathPrefix,pathPrefix||(h=""),$.ajax({url:h+"addTrack.jsp",type:"GET",data:{trackClass:b,trackName:c,trackDesc:e,trackOrg:f,genericCategory:g,category:q,controls:p,location:d,type:l,file:r},dataType:"json",success:function(a){"true"===a.success?$(".uploadStatus").html("<B>Track Setup Successfully</B>"):$(".uploadStatus").html("<B>Track Setup Failed</B>")},error:function(a,b,c){console.log(c)},async:!1})):(h=new Date,c="TrackID="+b+"<->UserID=-999<->TrackClass="+
b+"<->Name="+c+"<->Description="+e+"<->Organism="+f.toUpperCase(),c=c+"<->Settings=<->Order=0<->GenericCategory="+g+"<->Category="+q+"<->Controls="+p+"<->SetupDate="+h+"<->Type="+l+"<->OriginalFile="+r+"<->Location="+d,c=c+"<->genomeVer="+genomeVer,c+="<;>",!0===isLocalStorage()?((g=localStorage.getItem("phenogenCustomTracks"))&&(c=g+c),localStorage.setItem("phenogenCustomTracks",c)):($.cookie("phenogenCustomTracks")&&(c=$.cookie("phenogenCustomTracks")+c),$.cookie("phenogenCustomTracks",c)),$(".uploadStatus").html("<B>Track Setup Successfully</B>"));
$("div#finished"+a.level).show();$("input#customUploadFile"+a.level).val("");$("input#customURL"+a.level).val("");$("input#usrtrkNameTxt"+a.level).val("");$("#usrtrkDescTxt"+a.level).val("");$("input#usrtrkOrgSelect"+a.level).val("Rn");$("input#usrtrkGenCatSelect"+a.level).val("Genome");$("input#usrtrkCatTxt"+a.level).val("");$("#usrtrkColorSelect"+a.level).val("Color");$("#customFileURL"+a.level).val("");a.getTrackData();ga&&ga("send","event","BrowserTracks","saveTrack")};a.readFile=function(b){var d=
new FileReader;d.readAsText(b,"UTF-8");d.onload=a.sendFile};a.sendFile=function(b){$.ajax({url:pathPrefix+"trackUpload.jsp",type:"POST",contentType:"text/plain",xhr:function(){var b=$.ajaxSettings.xhr();b.upload.addEventListener("progress",a.progressHandlingFunction,!1);return b},data:b.target.result,processData:!1,cache:!1,dataType:"json",success:function(b){$(".uploadStatus").html("<B>Upload Completed Successfully</b>");a.saveTrack(b.trackFile,b.trackFile);ga&&ga("send","event","BrowserTracks",
"customTrackUploaded")},error:function(a,b,e){console.log(e);$(".uploadStatus").html("Error:"+e);$("div#uploadBtn"+customTrackLevel).show()}})};a.progressHandlingFunction=function(a){$(".progressInd").show();$(".uploadStatus").html("Uploading...");a.lengthComputable&&$("progress").attr({value:a.loaded,max:a.total})};a.getTrackData();return a};